/*! For license information please see report.b5edab80ce4d1229.js.LICENSE.txt */
function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function formattedNumber(e){return e>1e9?(e/=1e9).toFixed(2)+"b":e>1e8?(e/=1e6).toFixed(0)+"m":e>1e7?(e/=1e6).toFixed(1)+"m":e>1e6?(e/=1e6).toFixed(2)+"m":e>1e3?(e/=1e3).toFixed(0)+"k":e.toFixed(1)}function refreshMenus(){$(".dropdown, .graph-dropdown, .wipecall-dropdown, .compare-selection-menu, #compare-metric-dropdown").smartmenus("refresh")}function nyi(){alert("This feature is not yet implemented.")}var logVersion,filterView,filterType,hostilityType,subFilterType,filterFightsString,filterFightsArray;$((function(){$(".dropdown").smartmenus({showOnClick:!0,subMenusMaxWidth:"1300px",mainMenuSubOffsetX:-1,mainMenuSubOffsetY:-1,subMenusSubOffsetX:10,subMenusSubOffsetY:0}),$(".graph-dropdown").smartmenus({showOnClick:!0,subMenusMaxWidth:"1300px",mainMenuSubOffsetX:-6,mainMenuSubOffsetY:4,subMenusSubOffsetX:10,subMenusSubOffsetY:0}),$(".compare-selection-menu, #compare-metric-dropdown").smartmenus({showOnClick:!0,subMenusMaxWidth:"1300px",mainMenuSubOffsetX:-1,mainMenuSubOffsetY:-1,subMenusSubOffsetX:10,subMenusSubOffsetY:0}),$(".wipecall-dropdown").smartmenus({showOnClick:!0,subMenusMaxWidth:"1300px",mainMenuSubOffsetX:-1,mainMenuSubOffsetY:-1,subMenusSubOffsetX:10,subMenusSubOffsetY:0}),$("#guild-reports-toggle").addClass("visible"),$("#report-info-menu").addClass("visible")})),jQuery.fn.dataTableExt.oSort["inner-text-asc"]=function(e,t){var i=$.trim(e.replace(/(<([^>]+)>)/gi,"")),r=$.trim(t.replace(/(<([^>]+)>)/gi,""));return i==r?0:i<r?-1:1},jQuery.fn.dataTableExt.oSort["inner-text-desc"]=function(e,t){var i=$.trim(e.replace(/(<([^>]+)>)/gi,"")),r=$.trim(t.replace(/(<([^>]+)>)/gi,""));return i==r?0:i<r?1:-1},Highcharts.setOptions({global:{useUTC:!0}});var filterFightIsLastPull=!1,filterFightStartTime,filterFightEndTime,fightSegmentStartTime,fightSegmentEndTime,filterSource,filterSourceInstance,filterTarget,filterTargetInstance,filterAbility,filterBoss,filterDifficulty,filterWipes,filterLastPhase,filterSourceClass,filterTargetClass,filterDeath=0,filterDeathReport,filterSpellType,filterSpell,filterOptions=-1,snapToLastPull=!1,filterReplayPosition,filterPhase,filterCutoff=0,filterTranslate=void 0,replayLoaded=!1,perfGraph=!1,filterPull,filterMetric,filterMetricTimeframe,filterMetricCompare,filterSourceBuffs=new Array,filterSourceBuffsString="",filterTargetBuffs=new Array,filterTargetBuffsString="",tableURL,chartData=null,chart,chartLineColor,needToFetchFightsAndParticipants=!0,needToBuildBossFightMenu=!0,reportsCache=new Array,fights;window.reportsCacheOnChangeHandlers=[];var fightsTable=[],phasesTable=[],players,enemies,friendlyPets,enemyPets,petsTable=new Array,actorTable=[],actorGUIDNames=[],sourceMenuActors,targetMenuActors,needToLoadAbilitiesMenu,abilitiesRequest,needToLoadCompareMenu=!0,needToLoadFilterBuffs,buffsRequest,pins=new Array,pinString="",graphPinString="",tablePinString="",summaryPinString="",weightPinString="",pinUITypeCount=0,pinUITypes=new Array,pinUIHostility=-1,pinsUIPreCommittedString,pinsUIPostCommittedString,needToLoadPinsUIAbilitiesMenu,pinsUIAbilitiesRequest,pinAbilities=null,pinsUIEditPin,pinsUIEditPinIndex=-1,pinsUIEditPinComponent,abilityNameCache=new Array,multistrikeLabel=0==game_id?"Multistrike":1==game_id?"Multi Hit":"Direct Hit",supportsMultistrike=game_id>=0&&game_id<=2,allPhasesLabel="All Phases",bossesAndTrashLabel="Bosses and Trash",aurasMap=null;function collectAbilitiesForNameCache(e){var t="",i=e.ability?parseInt(e.ability):0;i&&(t+=i),pinString=e.pins?e.pins:"",rebuildPins();for(var r=0;r<pins.length;++r)for(var a in pins[r].components){var n=pins[r].components[a];if(n.abilities&&"0"!=n.abilities){var s=n.abilities.split("|");for(a=0;a<s.length;++a){var o=s[a];'"'!=o[0]&&(t&&(t+="|"),t+=o)}}}return $("#pins").html(""),pinString="",graphPinString="",tablePinString="",summaryPinString="",weightPinString="",t||"0"}var validateExpressionRequest=null;function validateExpressionFailed(){alert("Unable to validate expression."),$("#expression-loading").hide(),$("#script-loading").hide(),validateExpressionRequest=null}function validateExpressionFinished(e,t,i){$("#expression-loading").hide(),$("#script-loading").hide(),validateExpressionRequest=null,e.error?alert("Error encountered: "+e.error):e.success?alert("The expression is valid."):alert("The expression is not valid.")}function validateExpression(){return validateExpressionOrScript("expression")}function validateScript(){return validateExpressionOrScript("script")}function validateExpressionOrScript(e){if(!validateExpressionRequest){var t=document.getElementById("pins-ui-"+e+"-box").value;if(t){$("#"+e+"-loading").show();var i="/reports/validate-"+e+"/"+report_id;i+="?"+e+"="+encodeURIComponent(t),validateExpressionRequest=$.getJSON(i,validateExpressionFinished).fail(validateExpressionFailed)}else alert("There is no expression/script to validate.")}}function pinUIString(){return $("#pins-ui-tab-paste").hasClass("selected")?document.getElementById("pins-ui-paste-box").value:buildPinsUIExpression()}function updatePinPreview(){var e="",t=parsePin(pinUIString());e="<img class='pin-close' src='"+assetServer+"/img/close.png'>",e+="<img class='pin-close' src='"+assetServer+"/img/editbox.png'>",e+='<span class="pin-expression" style="float:right">Color: <span style="display:inline-block; vertical-align:-2px; margin-left:5px; width:12px;height:12px">',e+='<div style="width:12px;height:12px;background-color:'+pinColorForNewPin()+'"></div></span></span>',e+="<span class='pin-expression' style='float:right'>Graph: <a href='#'>",e+=pinsUIEditPin?pinsUIEditPin.graph:pinUIFiltering()>=2?"Off":"Separate",e+="</a></span> ",e+="<span class='pin-expression' style='float:right'>Type: <a href='#'>"+pinFilterName(t)+"</a></span> ",e+=buildPinHTML(t,-1),$("#pin-ui-preview").html(e)}function createQuickFilterPin(){var e="2$Off$"+pinColorForNewPin()+"$expression$";e+=document.getElementById("quick-filter-pin").value;var t=$.deparam.fragment(),i=t.pins?t.pins:"";return i?i+="^"+e:i=e,t.pins=i,document.getElementById("quick-filter-pin").value="",changeView(t)}function createOrChangePin(){if(pinsUIEditPin){var e=parsePin(pinUIString());return pins[pinsUIEditPinIndex]=e,serializePins(),void hidePinUI()}var t=$.deparam.fragment(),i=t.pins?t.pins:"",r=pinUIString();return i?i+="^"+r:i=r,t.pins=i,hidePinUI(),changeView(t)}function copyPinFromUI(){prompt("Copy the string below to save your query:",buildPinsUIExpression())}function actorInFight(e,t,i,r){for(var a=i.fights,n=0;n<t.length;++n)if(-1!=a.indexOf("."+t[n]+".")){if(filterPull&&r){reportsCache[0];var s=e[t[n]].dungeonPulls;if(s&&s[filterPull-1]){var o=s[filterPull-1].enemies;if(o)for(var l=0;l<o.length;++l)if(o[l][0]==i.guid)return!0}return!1}return!0}return!1}function pinActorsAutocompleteCallback(e,t){for(var i=e.term.toLowerCase(),r=new Array,a=0;a<playersAndEnemies.length;++a)if(0==playersAndEnemies[a].name.toLowerCase().indexOf(i)){if(filterFightsArray.length&&!actorInFight(fightsTable,filterFightsArray,playersAndEnemies[a])||-1!=filterBoss&&-1==playersAndEnemies[a].bosses.indexOf("."+filterBoss+"."))continue;r.push({label:playersAndEnemies[a].name,value:playersAndEnemies[a].name,actor:playersAndEnemies[a]})}for(a=0;a<friendlyPets.length;++a)if(0==friendlyPets[a].name.toLowerCase().indexOf(i)){if(filterFightsArray.length&&!actorInFight(fightsTable,filterFightsArray,friendlyPets[a])||-1!=filterBoss&&-1==friendlyPets[a].bosses.indexOf("."+filterBoss+"."))continue;var n=buildActorName(friendlyPets[a].id,0);r.push({label:n,value:n,actor:friendlyPets[a]})}for(a=0;a<enemyPets.length;++a)if(0==enemyPets[a].name.toLowerCase().indexOf(i)){if(filterFightsArray.length&&!actorInFight(fightsTable,filterFightsArray,enemyPets[a])||-1!=filterBoss&&-1==enemyPets[a].bosses.indexOf("."+filterBoss+"."))continue;n=buildActorName(enemyPets[a].id,0),r.push({label:n,value:n,actor:enemyPets[a]})}r.length>1&&r.unshift({label:"All Matches",value:"All Matches",matches:r}),t(r)}function pinAbilitiesAutocompleteCallback(e,t){var i=e.term.toLowerCase(),r=new Array;if(pinAbilities){for(var a=0;a<pinAbilities.length;++a)0==pinAbilities[a].name.toLowerCase().indexOf(i)&&r.push({label:pinAbilities[a].name+" (ID: "+pinAbilities[a].guid+")",value:pinAbilities[a].name,ability:pinAbilities[a]});r.length>1&&r.unshift({label:"All Matches",value:"All Matches",matches:r}),t(r)}else t(r)}function buildPinsUIAbilitiesMenu(e){pinsUIAbilitiesRequest=null,(pinAbilities=e.abilities).sort(abilitySort);var t=pinAbilities.length>25,i="",r="",a="",n="<td><table class='letter-table'><tbody>";a+=t?"<td>":"<table class='ability-menu-table visible'><tbody>";for(var s=0;s<pinAbilities.length;s++)t&&pinAbilities[s].name[0]!=i&&(""!=i&&(a+="</table>"),a+="<table class='ability-menu-table indented' id='pins-letter-selector-table-"+pinAbilities[s].name[0]+"'>",n+="<tr><td class='letter-table-cell' id='pins-letter-selector-"+pinAbilities[s].name[0]+"'><a href='#' onclick='event.stopPropagation(); return selectAbilityLetter(\"pins-letter-selector\", \""+pinAbilities[s].name[0]+"\")'>"+pinAbilities[s].name[0]+"</a></td></tr>",i=pinAbilities[s].name[0],""==r&&(r=i)),a+=addAbilityToMenu(pinAbilities[s],!0);n+="</tbody></table></td>",t?""!=i&&(a+="</table></td>"):a+="</table>",$("#pins-ui-abilities").html('<table class="letter-and-ability-table"><tr>'+n+a+"</table>"),t&&selectAbilityLetter("pins-letter-selector",r),$("#pins-ui-abilities-dropdown").smartmenus("refresh")}function loadPinsUIAbilitiesMenuFailed(){pinsUIAbilitiesRequest=null,pinAbilities=null}function serializePinUITypes(){var e="";if(!pinUITypeCount)return"any";for(var t=!0,i=0;i<pinUITypes.length;++i)t?t=!1:e+="|",e+=pinUITypes[i];return e}function serializePinActorsList(e,t){for(var i="",r=!0,a=document.getElementById("pins-ui-"+e+"-list").firstChild;a;a=a.nextSibling){if(a.data=="All "+t)return"0.0.0.Any";var n=a.getAttribute("actor");n&&(r?r=!1:i+="|",i+=n)}return i}function serializePinUIAbilities(){for(var e="",t=!0,i=document.getElementById("pins-ui-abilities-list").firstChild;i;i=i.nextSibling){if("All Abilities"==i.data)return"0";var r=i.getAttribute("ability");r&&(t?t=!1:e+="|",e+=r)}return e}function serializePinUIActors(){return serializePinActorsList("actors","Actors")}function serializePinUISources(){return serializePinActorsList("sources","Sources")+(document.getElementById("pins-ui-source-pets").checked?"$true":"$false")}function serializePinUITargets(){return serializePinActorsList("targets","Targets")+(document.getElementById("pins-ui-target-pets").checked?"$true":"$false")}function buildPinsUIAbilityExpression(){var e=serializePinUITypes(),t=pinUIHostility;return"auras"==e&&(e=pinUIHostility<=1?"auras-gained":"auras-cast"),"auras-cast"==e&&(t=pinUIHostility-2),e+"$"+t+"$"+serializePinUIActors()+"$"+serializePinUISources()+"$"+serializePinUITargets()}function pinUIFiltering(){return document.getElementById("pins-ui-filter-type").selectedIndex}function pinColorForNewPin(){if(pinsUIEditPin)return pinsUIEditPin.graphColor;var e=["#244F4B","#909049","#a04D8A","#DF5353","rgb(78%, 61%, 43%)","#a0a0a0","#F43F5B","#FFFF89","#FF9D2A","#FF7373","rgb(92%, 76%, 58%)","#c0c0c0"];return e[pins.length%e.length]}function pinUIExtraOptions(){if(pinUITypes.length>1)return"";if("auras"==pinUITypes[0]||"auras-gained"==pinUITypes[0]||"auras-cast"==pinUITypes[0]){var e="";document.getElementById("pins-ui-aura-check").checked&&(e+="$"+(0==document.getElementById("pins-ui-aura-presence").selectedIndex)+"$"+(0==document.getElementById("pins-ui-aura-actors").selectedIndex));var t=0;return document.getElementById("pins-ui-aura-apply").checked&&(t|=1),document.getElementById("pins-ui-aura-refresh").checked&&(t|=2),document.getElementById("pins-ui-aura-remove").checked&&(t|=4),document.getElementById("pins-ui-aura-apply-stack").checked&&(t|=8),document.getElementById("pins-ui-aura-remove-stack").checked&&(t|=16),document.getElementById("pins-ui-aura-buffs").checked&&(t|=32),document.getElementById("pins-ui-aura-debuffs").checked&&(t|=64),127!=t&&(e+="$"+t),e}if("damage"==pinUITypes[0]){var i=0;if(document.getElementById("pins-ui-damage-misses").checked&&(i|=1),document.getElementById("pins-ui-damage-hits").checked&&(i|=2),document.getElementById("pins-ui-damage-ticks").checked&&(i|=4),0==document.getElementById("pins-ui-damage-crits").value?i|=24:1==document.getElementById("pins-ui-damage-crits").value?i|=8:2==document.getElementById("pins-ui-damage-crits").value&&(i|=16),0==document.getElementById("pins-ui-damage-blocked").value?i|=768:1==document.getElementById("pins-ui-damage-blocked").value?i|=256:2==document.getElementById("pins-ui-damage-blocked").value&&(i|=512),supportsMultistrike?0==document.getElementById("pins-ui-damage-multistrike").value?i|=3072:1==document.getElementById("pins-ui-damage-multistrike").value?i|=1024:2==document.getElementById("pins-ui-damage-multistrike").value&&(i|=2048):i|=3072,document.getElementById("pins-ui-damage-physical").checked&&(i|=32),document.getElementById("pins-ui-damage-magical").checked&&(i|=64),4095!=(i|=128))return"$"+i}if("healing"==pinUITypes[0]){var r=0;if(document.getElementById("pins-ui-healing-hits").checked&&(r|=1),document.getElementById("pins-ui-healing-ticks").checked&&(r|=2),document.getElementById("pins-ui-healing-absorbs").checked&&(r|=4),0==document.getElementById("pins-ui-healing-crits").value?r|=24:1==document.getElementById("pins-ui-healing-crits").value?r|=8:2==document.getElementById("pins-ui-healing-crits").value&&(r|=16),supportsMultistrike?0==document.getElementById("pins-ui-healing-multistrike").value?r|=96:1==document.getElementById("pins-ui-healing-multistrike").value?r|=32:2==document.getElementById("pins-ui-healing-multistrike").value&&(r|=64):r|=96,127!=r)return"$"+r}if("resources"==pinUITypes[0]){e="$"+document.getElementById("pins-ui-resource-type").value;var a=0;return document.getElementById("pins-ui-resource-gains").checked&&(a|=1),document.getElementById("pins-ui-resource-fields").checked&&(a|=2),3!=a&&(e+="$"+a),e}return""}function commitQueryPinUI(e){var t=buildPinsUIExpression();pinsUIPreCommittedString=t+="$"+e+"$",resetQueryPinsUI(),updatePinPreview()}function buildPinsUIExpression(){var e=pinUIFiltering(),t=pinsUIEditPin?pinsUIEditPin.graph:e>=2?"Off":"Separate";3==e?e+="$"+document.getElementById("pins-ui-summary-field").selectedIndex+"$"+document.getElementById("pins-ui-summary-entry").selectedIndex:4==e&&(e+="$"+document.getElementById("pins-ui-weight-field").value);var i="";if($("#pins-ui-tab-expression").hasClass("selected"))return(i=e+"$"+(pinsUIEditPin?t:"Off")+"$"+pinColorForNewPin()+"$expression$")+document.getElementById("pins-ui-expression-box").value;if($("#pins-ui-tab-script").hasClass("selected"))return(i=e+"$"+(pinsUIEditPin?t:"Off")+"$"+pinColorForNewPin()+"$script$")+document.getElementById("pins-ui-script-box").value;i=pinsUIPreCommittedString||e+"$"+t+"$"+pinColorForNewPin()+"$",i+=buildPinsUIAbilityExpression()+"$"+serializePinUIAbilities();var r=pinUIExtraOptions();return r&&(i+=r),pinsUIPostCommittedString&&(i+=pinsUIPostCommittedString),i}function loadPinsUIAbilitiesMenuIfNeeded(){if(needToLoadPinsUIAbilitiesMenu){needToLoadPinsUIAbilitiesMenu=!1;var e="/reports/pins-ability-list/";e+=report_id+"/"+filterFightsString+"/"+fightSegmentStartTime+"/"+fightSegmentEndTime+"/"+bossWipesAndDifficultyString()+"/",e+=buildPinsUIAbilityExpression(),filterTranslate&&(e+="?lang="+currentLang),pinsUIAbilitiesRequest=$.getJSON(e,buildPinsUIAbilitiesMenu).fail(loadPinsUIAbilitiesMenuFailed)}}function resetPinsUIAbilityMenu(){pinAbilities=null,$("#pins-ui-abilities").html("<li><a class='filter-item' id='filter-ability-all' href='#' onclick='return setAbilityFilter(0, 0, this)' oncontextmenu='setAbilityFilter(0, 0, this)'>All Abilities</a><li class='separator'></li><li><a href='#' onclick='return false'>Loading...</a></li>"),$("#pins-ui-abilities-dropdown").smartmenus("refresh"),needToLoadPinsUIAbilitiesMenu=!0,pinsUIAbilitiesRequest&&(pinsUIAbilitiesRequest.abort(),pinsUIAbilitiesRequest=null)}function updatePinsUIHostility(e){pinUIHostility=e-1,resetPinsUIAbilityMenu(),updatePinPreview()}function fillInPinUIHostility(){if(pinUITypes.length){var e=pinUITypes[0];"damage"==e?$("#pins-ui-hostility-select").html("<option>Damage To Any Actors<option>Damage To Enemies<option>Damage To Friendlies"):"healing"==e?$("#pins-ui-hostility-select").html("<option>Healing To Any Actors<option>Healing To Friendlies<option>Healing To Enemies"):"auras"==e||"auras-cast"==e||"auras-gained"==e?$("#pins-ui-hostility-select").html("<option>Auras Applied To Any Actors<option>Auras Applied To Friendlies<option>Auras Applied To Enemies<option>Auras Cast By Friendlies<option>Auras Cast By Enemies"):"dispels"==e?$("#pins-ui-hostility-select").html("<option>Dispels By Any Actors<option>Dispels By Friendlies<option>Dispels By Enemies"):"casts"==e?$("#pins-ui-hostility-select").html("<option>Casts By Any Actors<option>Casts By Friendlies<option>Casts By Enemies"):"interrupts"==e?$("#pins-ui-hostility-select").html("<option>Interrupts By Any Actors<option>Interrupts By Friendlies<option>Interrupts By Enemies"):"summons"==e?$("#pins-ui-hostility-select").html("<option>Summons By Any Actors<option>Summons By Friendlies<option>Summons By Enemies"):"deaths"==e?$("#pins-ui-hostility-select").html("<option>Any Deaths<option>Friendly Deaths<option>Enemy Deaths"):"resources"==e&&$("#pins-ui-hostility-select").html("<option>Any Resources<option>Friendly Resources<option>Enemy Resources")}}function updatePinUIType(e,t){if(e.checked)pinUITypeCount++,pinUITypes.push(t);else{pinUITypeCount--;var i=pinUITypes.indexOf(t);-1!==i&&pinUITypes.splice(i,1)}pinUITypeChanged()}function pinUITypeChanged(){resetPinsUIAbilityMenu(),pinUIHostility=-1,1==pinUITypeCount&&"other"!=pinUITypes[0]?($("#pins-ui-hostility").show(),fillInPinUIHostility(),"auras"==pinUITypes[0]||"auras-cast"==pinUITypes[0]||"auras-gained"==pinUITypes[0]?$("#pins-ui-auras").show():$("#pins-ui-auras").hide(),"damage"==pinUITypes[0]?$("#pins-ui-damage").show():$("#pins-ui-damage").hide(),"healing"==pinUITypes[0]?$("#pins-ui-healing").show():$("#pins-ui-healing").hide(),"resources"==pinUITypes[0]?$("#pins-ui-resources").show():$("#pins-ui-resources").hide()):(document.getElementById("pins-ui-hostility-select").selectedIndex=0,$("#pins-ui-hostility").hide(),$("#pins-ui-auras").hide(),$("#pins-ui-damage").hide(),$("#pins-ui-healing").hide(),$("#pins-ui-resources").hide()),updatePinPreview()}function togglePinUI(){"none"==document.getElementById("pins-ui").style.display?showPinUI():hidePinUI()}function showPinUIForWeights(){showPinUI(),document.getElementById("pins-ui-filter-type").selectedIndex=4,setPinsUITypeExplanation()}function selectPinsUITab(e){$(".pins-ui-tab").removeClass("selected"),$(".pins-ui-content").hide(),$("#pins-ui-tab-"+e).addClass("selected"),$("#pins-ui-content-"+e).show(),"paste"==e?(document.getElementById("pins-ui-paste-box").focus(),$("#pins-ui-filter-section").hide()):("expression"!=e&&"script"!=e||(document.getElementById("pins-ui-"+e+"-box").focus(),pinsUIEditPin&&document.getElementById("pins-ui-"+e+"-box").select()),$("#pins-ui-filter-section").show());var t=0;"query"==e?t=0:"expression"==e?t=1:"paste"==e?t=2:"bookmarks"==e?t=3:"script"==e&&(t=4),t!=pin_options&&(pin_options=t,storeUserOptions()),updatePinPreview()}function setPinsUITypeExplanation(){var e=document.getElementById("pins-ui-filter-type").selectedIndex,t="";0==e?t="A <i>decorator pin</i> adds any new results to the raw events view and to the graph as lines/bands. Pre-existing matches are badged.":1==e?t="A <i>badge pin</i> does not match any new results. Pre-existing matches are badged. This option is useful in the Deaths pane.":2==e?t="A <i>filtering pin</i> will remove any results that don't match the pin (assuming the filter is applicable to the view).":3==e?t="A <i>summary pin</i> will only show up in the Summary pane. It adds together results by source, by target or by ability.":4==e&&(t="A <i>DPS weight pin</i> will only show up in the Damage Done pane when <i>Weighted DPS</i> is selected. It will apply the weight you specify to a mob."),$("#pins-ui-filter-type-explanation").html(t),3==e?$("#pins-ui-summary").show():$("#pins-ui-summary").hide(),4==e?$("#pins-ui-weight").show():$("#pins-ui-weight").hide()}function initializePinTabs(){0==pin_options?selectPinsUITab("query"):1==pin_options?selectPinsUITab("expression"):2==pin_options?selectPinsUITab("paste"):3==pin_options?selectPinsUITab("bookmarks"):4==pin_options&&selectPinsUITab("script")}function showPinUI(){hideComponentPlayground(),$("#filter-subtype-strip").addClass("pins"),$("#view-type-tabs").addClass("pins"),$("#graph-and-table-container").addClass("pins"),$("#pins").hide(),$("#pins-ui").show(),initializePinTabs(),buildActorMenu("pins-ui-actors","all","pinActor","PinActor","&nbsp;",!0,!1),buildActorMenu("pins-ui-sources","all","pinSource","PinSource","&nbsp;",!0,!1),buildActorMenu("pins-ui-targets","all","pinTarget","PinTarget","&nbsp;",!0,!1),resetPinsUIAbilityMenu(),document.getElementById("pins-ui-actors-autocomplete").focus(),setPinsUITypeExplanation(),document.getElementById("pins-ui-create-or-change-pin").value="Create Pin",updatePinPreview()}function resetQueryPinsUI(){$("#pins-ui-actors-list").html("All Actors"),$("#pins-ui-sources-list").html("All Sources"),$("#pins-ui-targets-list").html("All Targets"),$("#pins-ui-abilities-list").html("All Abilities");for(var e=0;e<pinUITypes.length;++e){var t=pinUITypes[e];"auras-gained"!=t&&"auras-cast"!=t||(t="auras");var i=document.getElementById(t+"-pin-type");i&&(i.checked=!1)}pinUITypes=new Array,pinUITypeCount=0,$("#pins-ui-hostility").hide(),$("#pins-ui-auras").hide(),$("#pins-ui-damage").hide(),$("#pins-ui-healing").hide(),$("#pins-ui-resources").hide(),document.getElementById("pins-ui-resource-gains").checked=!0,document.getElementById("pins-ui-resource-fields").checked=!0,document.getElementById("pins-ui-resource-type").selectedIndex=0,document.getElementById("pins-ui-aura-check").checked=!1,document.getElementById("pins-ui-aura-presence").selectedIndex=0,document.getElementById("pins-ui-aura-actors").selectedIndex=1,document.getElementById("pins-ui-damage-misses").checked=!0,document.getElementById("pins-ui-damage-hits").checked=!0,document.getElementById("pins-ui-damage-ticks").checked=!0,document.getElementById("pins-ui-damage-crits").selectedIndex=0,document.getElementById("pins-ui-damage-blocked").selectedIndex=0,supportsMultistrike&&(document.getElementById("pins-ui-damage-multistrike").selectedIndex=0),document.getElementById("pins-ui-damage-physical").checked=!0,document.getElementById("pins-ui-damage-magical").checked=!0,document.getElementById("pins-ui-healing-hits").checked=!0,document.getElementById("pins-ui-healing-ticks").checked=!0,document.getElementById("pins-ui-healing-absorbs").checked=!0,document.getElementById("pins-ui-healing-crits").selectedIndex=0,supportsMultistrike&&(document.getElementById("pins-ui-healing-multistrike").selectedIndex=0),document.getElementById("pins-ui-aura-apply").checked=!0,document.getElementById("pins-ui-aura-refresh").checked=!0,document.getElementById("pins-ui-aura-remove").checked=!0,document.getElementById("pins-ui-aura-apply-stack").checked=!0,document.getElementById("pins-ui-aura-remove-stack").checked=!0,document.getElementById("pins-ui-aura-buffs").checked=!0,document.getElementById("pins-ui-aura-debuffs").checked=!0,document.getElementById("pins-ui-summary-field").selectedIndex=0,document.getElementById("pins-ui-summary-entry").selectedIndex=0,document.getElementById("pins-ui-weight-field").value="1.0",document.getElementById("pins-ui-source-pets").checked=!0,document.getElementById("pins-ui-target-pets").checked=!0,document.getElementById("pins-ui-paste-box").value="",document.getElementById("pins-ui-expression-box").value="",resetPinsUIAbilityMenu()}function hidePinUI(){$("#filter-subtype-strip").removeClass("pins"),$("#view-type-tabs").removeClass("pins"),$("#graph-and-table-container").removeClass("pins"),$("#pins-ui").hide(),resetQueryPinsUI(),document.getElementById("pins-ui-filter-type").selectedIndex=0,setPinsUITypeExplanation(),document.getElementById("pins-ui-paste-box").value="",document.getElementById("pins-ui-expression-box").value="",$("#pins").show(),$("#pins-ui-actors").html(""),$("#pins-ui-sources").html(""),$("#pins-ui-targets").html(""),$("#pins-ui-abilities").html(""),pinsUIPreCommittedString="",pinsUIPostCommittedString="",pinsUIEditPin=null,pinsUIEditPinIndex=-1,pinsUIEditPinComponent=0,updatePinPreview()}function removeFromActorsList(e,t){resetPinsUIAbilityMenu();var i=e.parentNode;i.removeChild(e),i.innerHTML||(i.innerHTML="All "+t),updatePinPreview()}function removeFromAbilitiesList(e){var t=e.parentNode;t.removeChild(e),t.innerHTML||(t.innerHTML="All Abilities"),updatePinPreview()}function updateFilterActorsList(e,t,i,r){var a=actorTable[e];if(a){var n=a.petOwner?actorTable[a.petOwner]:null,s=n?n.guid:0;updateFilterActorsListWithInfo(a.guid+"."+s+"."+t+"."+a.type,buildActorName(e,t),actorTable[e].type,i,r)}}function updateFilterActorsListWithInfo(e,t,i,r,a){resetPinsUIAbilityMenu();var n="<span style='display:inline-block; margin:2px; border:1px solid #555555; background-color:#200020; padding:4px' actor='"+e+"' class='pins-ui-actor-item "+i+"'>"+t;n+="<img style='margin-left:5px; vertical-align:-3px' src='"+assetServer+"/img/close.png' width=16 height=16 onclick='removeFromActorsList(parentNode, \""+a+"\")'></span>";var s=$("#pins-ui-"+r+"-list").html();s!="All "+a&&(n=s+n),$("#pins-ui-"+r+"-list").html(n),updatePinPreview()}function updateFilterActorsListWithClass(e,t,i){resetPinsUIAbilityMenu();var r="<span style='display:inline-block; margin:2px; border:1px solid #555555; background-color:#200020; padding:4px' actor='0.0.0."+e+"' class='pins-ui-actor-item "+e+"'>All "+pluralClassDisplay(e);r+="<img style='margin-left:5px; vertical-align:-3px' src='"+assetServer+"/img/close.png' width=16 height=16 onclick='removeFromActorsList(parentNode, \""+i+"\")'></span>";var a=$("#pins-ui-"+t+"-list").html();a!="All "+i&&(r=a+r),$("#pins-ui-"+t+"-list").html(r),updatePinPreview()}function setFilterPinSource(e,t){return updateFilterActorsList(e,t,"sources","Sources"),!1}function setFilterPinTarget(e,t){return updateFilterActorsList(e,t,"targets","Targets"),!1}function setFilterPinActor(e,t){return updateFilterActorsList(e,t,"actors","Actors"),!1}function setFilterPinSourceClass(e){return updateFilterActorsListWithClass(e,"sources","Sources"),!1}function setFilterPinTargetClass(e){return updateFilterActorsListWithClass(e,"targets","Targets"),!1}function setFilterPinActorClass(e){return updateFilterActorsListWithClass(e,"actors","Actors"),!1}function setFilterPinAbility(e,t,i){return setFilterPinAbilityWithName(e,t.innerHTML,i)}function lookupAbilityName(e){return abilityNameCache[e]||(e<0?abilityNameCache[-e]:null)}function setFilterPinAbilityWithName(e,t,i){var r="<span class='school-";r+=i+" pins-ui-ability-item'",r+=" style='",r+=setLineColorForAbilityFromType(i,!1),r+=";display:inline-block; margin:2px; border:1px solid #555555; background-color:#200020; padding:4px' ability='"+e+"'>"+t,r+="<img style='margin-left:5px; vertical-align:-3px' src='"+assetServer+"/img/close.png' width=16 height=16 onclick='removeFromAbilitiesList(parentNode)'></span>";var a=$("#pins-ui-abilities-list").html();return"All Abilities"!=a&&(r=a+r),$("#pins-ui-abilities-list").html(r),abilityNameCache[e]=t,updatePinPreview(),!1}function suggestedAllSourcesName(e,t){var i=0==t||"healing"==e||"damage-done"==e?"All Sources":"All Friendlies";return"deaths"==e?i=0==t?"All Players":"All Enemies":"auras"!=e&&"resources"!=e&&"summary"!=e&&"casts"!=e&&"summons"!=e&&"damage-taken"!=e&&"interrupts"!=e&&"dispels"!=e&&"threat"!=e||(i=0==t?"All Friendlies":"All Enemies"),i}function suggestedAllTargetsName(e,t){var i;return"damage-done"==e?i=0==t?"All Enemies":"All Friendlies":"damage-taken"==e||"threat"==e?i="All Sources":"healing"==e?i=0==t?"All Friendlies":"All Enemies":"auras"==e?i="source"==subFilterType?"All Sources":"All Targets":"casts"==e||"summons"==e?i="All Targets":"interrupts"==e||"dispels"==e?i="All Actors":"deaths"==e&&(i="Killing Blows"),i}function buildPinActorString(e){for(var t="",i=e.split("|"),r=0;r<i.length;++r){r>0&&(t+=", ");var a=i[r].split("."),n=a[0],s=parseInt(a[1]),o=parseInt(a[2]),l=a[3];t+="<span class='pin-type "+l+"'>";var p="";'"'==n[0]?p=n.substring(1,n.length-1):(guid=parseInt(n),guid?actorGUIDNames[n]?p+=actorGUIDNames[n]:p="ID of "+guid:(p="Any","Any"!=l&&(p+=" "+pluralClassDisplay(l)))),t+=buildActorNameFromGUIDs(p,o,s),t+="</span>"}return t}function buildPinAbilityString(e){for(var t="",i=e.split("|"),r=0;r<i.length;++r){r>0&&(t+=", "),t+="<span class='pin-type'>";var a=i[r],n="";if('"'==a[0])n=a.substring(1,a.length-1);else if(guid=parseInt(a),guid){var s=lookupAbilityName(guid);s?n+=s:n="ID of "+guid}else n="Any";t+=n,t+="</span>"}return t}function buildPinOption(e,t,i,r){if(!(e&i))return"";var a="";return t||(a+=", "),a+r}function pinFilterName(e){return e?0==e.filter?"Decorator":1==e.filter?"Badge":2==e.filter?"Filter":3==e.filter?"Summary":4==e.filter?"DPS Weight":void 0:"Empty Pin"}function printPowerType(e){return $("#resource-option-"+(e+100)).html()}function printResourceAmountAndType(e){return(e.resourceChange<0?-e.resourceChange:e.resourceChange)+" <span style='color:#ff8'>"+printPowerType(e.resourceChangeType)+"</span>"}function hasThreatDetails(){return 5==game_id}function safe_tags(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function buildPinHTML(e,t){if(!e)return"&nbsp;";var i="<span style='display:inline-block; vertical-align:top'>",r=e.components.length>1;for(var a in e.components){var n=e.components[a],s=n.type.split("|");i+='<span class="pin-expression">',i+="expression"==s?"Expression: ":"script"==s?"Script: ":"Events: ",i+='<span class="pin-type">';for(var o=n.hostility,l=0;l<s.length;++l){var p=s[l];if(l>0&&(i+=", "),"expression"!=p&&"script"!=p)if("damage"==p){if(i+="Damage",0==o?i+=" To Enemies":1==o&&(i+=" To Friendlies"),void 0!==n.options){i+=" (";var d=!0;7!=(7&n.options)&&((c=buildPinOption(n.options,d,1,"Miss"))&&(d=!1,i+=c),(c=buildPinOption(n.options,d,2,"Direct"))&&(d=!1,i+=c),(c=buildPinOption(n.options,d,4,"Periodic"))&&(d=!1,i+=c)),96!=(96&n.options)&&((c=buildPinOption(n.options,d,32,"Physical"))&&(d=!1,i+=c),(c=buildPinOption(n.options,d,64,"Magical"))&&(d=!1,i+=c)),24!=(24&n.options)&&((c=buildPinOption(n.options,d,8,"Require Crits"))&&(d=!1,i+=c),(c=buildPinOption(n.options,d,16,"Disallow Crits"))&&(d=!1,i+=c)),768!=(768&n.options)&&((c=buildPinOption(n.options,d,256,"Require "+game_id==0?"Blocks":"Vulnerable"))&&(d=!1,i+=c),(c=buildPinOption(n.options,d,512,"Disallow "+game_id==0?"Blocks":"Vulnerable"))&&(d=!1,i+=c)),3072!=(3072&n.options)&&((c=buildPinOption(n.options,d,1024,"Require "+multistrikeLabel))&&(d=!1,i+=c),(c=buildPinOption(n.options,d,2048,"Disallow "+multistrikeLabel))&&(d=!1,i+=c)),i+=")"}}else if("healing"==p)i+="Healing",0==o?i+=" To Friendlies":1==o&&(i+=" To Enemies"),void 0!==n.options&&(i+=" (",d=!0,7!=(7&n.options)&&((c=buildPinOption(n.options,d,1,"Direct"))&&(d=!1,i+=c),(c=buildPinOption(n.options,d,2,"Periodic"))&&(d=!1,i+=c),(c=buildPinOption(n.options,d,4,"Absorbs"))&&(d=!1,i+=c)),24!=(24&n.options)&&((c=buildPinOption(n.options,d,8,"Require Crits"))&&(d=!1,i+=c),(c=buildPinOption(n.options,d,16,"Disallow Crits"))&&(d=!1,i+=c)),96!=(96&n.options)&&((c=buildPinOption(n.options,d,32,"Require "+multistrikeLabel))&&(d=!1,i+=c),(c=buildPinOption(n.options,d,64,"Disallow "+multistrikeLabel))&&(d=!1,i+=c)),i+=")");else if("casts"==p)i+="Casts",0==o?i+=" By Friendlies":1==o&&(i+=" By Enemies");else if("summons"==p)i+="Summons and Creations",0==o?i+=" By Friendlies":1==o&&(i+=" By Enemies");else if("resources"==p)i+="Resources",0!=n.resourceType&&(i+=" ("+printPowerType(n.resourceType-100)+")"),0==o?i+=" For Friendlies":1==o&&(i+=" For Enemies"),3!=(3&n.options)&&((c=buildPinOption(n.options,d,1,"Gains"))&&(d=!1,i+=c),c=buildPinOption(n.options,d,2,"Fields"));else if("auras"==p||"auras-gained"==p||"auras-cast"==p){void 0!==n.options&&96!=(96&n.options)?32&n.options?i+="Buffs":i+="Debuffs":i+="Buffs/Debuffs";var c,u="";if(void 0!==n.auraPresence?(n.auraPresence?i+=" Present":i+=" Absent",i+=" On ",n.auraSource?i+="Source":i+="Target",u=""):"auras-cast"==p&&o>=0?(u+=" Cast ",0==o?i+=u+" By Friendlies":1==o&&(i+=u+" By Enemies")):o>=0&&("auras-gained"==p||"auras"==p)&&(u+=" On",0==o?i+=u+" Friendlies":1==o&&(i+=u+" Enemies")),void 0!==n.options&&31!=(31&n.options))i+=" (",d=!0,(c=buildPinOption(n.options,d,1,"Apply"))&&(d=!1,i+=c),(c=buildPinOption(n.options,d,2,"Refresh"))&&(d=!1,i+=c),(c=buildPinOption(n.options,d,4,"Remove"))&&(d=!1,i+=c),(c=buildPinOption(n.options,d,8,"Apply Stack"))&&(d=!1,i+=c),(c=buildPinOption(n.options,d,16,"Remove Stack"))&&(d=!1,i+=c),i+=")"}else"deaths"==p?(i+="Deaths and Resurrects",0==o?i+=" Of Friendlies":1==o&&(i+=" Of Enemies")):"interrupts"==p?(i+="Interrupts",0==o?i+=" By Friendlies":1==o&&(i+=" By Enemies")):"dispels"==p?(i+="Dispels/Steals",0==o?i+=" By Friendlies":1==o&&(i+=" By Enemies")):"threat"==p?i+="Threat":"other"==p?i+="Other":"any"==p&&(i+="Any")}"expression"!=s&&"script"!=s||(i+=safe_tags(n.expression)),i+="</span></span>","expression"!=s&&"script"!=s&&("0.0.0.Any"!=n.actors&&(i+="<span class='pin-expression'>Actors: "+buildPinActorString(n.actors)+"</span>"),"0.0.0.Any"!=n.sources&&(i+="<span class='pin-expression'>Sources: "+buildPinActorString(n.sources)+"</span>"),"0.0.0.Any"!=n.targets&&(i+="<span class='pin-expression'>Targets: "+buildPinActorString(n.targets)+"</span>"),"0"!=n.abilities&&(i+="<span class='pin-expression'>Abilities: "+buildPinAbilityString(n.abilities)+"</span>"),r&&-1!=t&&(i+="<img class='pin-close' onclick='removePinComponent("+t+","+a+")' src='"+assetServer+"/img/close.png'>",i+="<img class='pin-close' onclick='editPin("+t+","+a+")' src='"+assetServer+"/img/editbox.png'>"),n.connector&&(i+="<br>"+n.connector+" "))}return i+="</span>",-1!=t&&3!=e.filter&&4!=e.filter&&(i+="<div id='pin-graph-"+t+"' class='pin-graph'></div>"),i}function togglePinGraph(e){return pins[e].graph="Separate"==pins[e].graph?"Off":"Main"==pins[e].graph?"Separate":"Main",serializePins()}function togglePinType(e){return pins[e].filter<2?pins[e].filter=2:pins[e].filter=0,serializePins()}function fillInSummaryPinHTML(){for(var e=0,t=0;t<pins.length;++t)if(3==pins[t].filter){var i="<img class='pin-close' onclick='removePin("+t+")' src='"+assetServer+"/img/close.png'>";i+="<img class='pin-close' onclick='editPin("+t+", -1)' src="+assetServer+"/img/editbox.png'>",i+=buildPinHTML(pins[t],t),$("#summary-pin-"+e).html(i),e++}}function fillInWeightPinHTML(){for(var e="",t=0;t<pins.length;++t)if(4==pins[t].filter){var i="<div class='pin'>";i+="<img class='pin-close' onclick='removePin("+t+")' src='"+assetServer+"/img/close.png'>",i+="<img class='pin-close' onclick='editPin("+t+", -1)' src='"+assetServer+"/img/editbox.png'>",i+="<span class='pin-expression' style='float:right'>Weight: <span class='estimate'>"+pins[t].weightField+"</span></span> ",i+=buildPinHTML(pins[t],t),e+=i+="</div>"}$("#weight-pins-box").html(e),e?$("#weight-defaults-box").hide():$("#weight-defaults-box").show()}function parsePin(e){if(""!=e){var t={components:[]},i=e.split("$"),r=0;for(t.filter=parseInt(i[r++]),3==t.filter?(t.summaryField=parseInt(i[r++]),t.summaryEntry=parseInt(i[r++])):4==t.filter&&(t.weightField=parseFloat(i[r++]),isNaN(t.weightField)&&(t.weightField=1)),t.graph=i[r++],t.graphColor=i[r++],"Separate"==t.graph&&(t.graphPinString=e);r<i.length;){var a,n={};if(n.type=i[r++],"expression"!=n.type&&"script"!=n.type)n.hostility=parseInt(i[r++]),n.actors=i[r++],n.sources=i[r++],n.includeSourcePets="true"==i[r++],n.targets=i[r++],n.includeTargetPets="true"==i[r++],n.abilities=i[r++],"resources"==n.type?n.resourceType=i[r++]:r<i.length&&("auras"==n.type||"auras-cast"==n.type||"auras-gained"==n.type)&&("true"==(a=i[r++])||"false"==a?(n.auraPresence="true"==a,n.auraSource="true"==i[r++]):"and"==a||"or"==a?n.connector=a:n.options=parseInt(a)),!n.connector&&r<i.length&&("and"==(a=i[r++])||"or"==a?n.connector=a:n.options=parseInt(a)),!n.connector&&r<i.length&&(n.connector=i[r++]),t.components.push(n);else n.expression=i[r++],t.components.push(n)}return t}}function rebuildPins(){$("#pins").html("");for(var e=0;pins&&e<pins.length;++e)pins[e].graphRequest&&pins[e].graphRequest.abort();if(pins=new Array,pinString){var t=pinString.split("^");for(e=0;e<t.length;++e){var i=parsePin(t[e]);pins.push(i)}var r="";for(e=0;e<pins.length;++e)if(3!=pins[e].filter&&4!=pins[e].filter){var a="<div class='pin'>";a+="<img class='pin-close' onclick='removePin("+e+")' src='"+assetServer+"/img/close.png'>",a+="<img class='pin-close' onclick='editPin("+e+", -1)' src='"+assetServer+"/img/editbox.png'>",a+='<span class="pin-expression" style="float:right">Color: <span id="pins-colorpicker-'+e+'" style="display:inline-block; vertical-align:-2px; margin-left:5px; width:12px;height:12px">',a+='<div id="pins-colorpicker-color-'+e+'" style="width:12px;height:12px;background-color:'+pins[e].graphColor+'"></div></span></span>',a+="<span class='pin-expression' style='float:right'>Graph: <a href='#' onclick='return togglePinGraph("+e+")'>"+pins[e].graph+"</a></span> ",a+="<span class='pin-expression' style='float:right'>Type: <a href='#' onclick='return togglePinType("+e+")'>"+pinFilterName(pins[e])+"</a></span> ",a+=buildPinHTML(pins[e],e),r+=a+="</div>"}for($("#pins").html(r),e=0;e<pins.length;++e)3!=pins[e].filter&&4!=pins[e].filter&&$("#pins-colorpicker-"+e).ColorPicker({color:pins[e].graphColor,onShow:function(e){return $(e).fadeIn(250),!1},onHide:function(e){return $(e).fadeOut(250),serializePins(),!1},onChange:function(e){return function(t,i,r){$("#pins-colorpicker-color-"+e).css("backgroundColor","#"+i),pins[e].graphColor="#"+i}}(e)});weightPinString=serializePinString(4),summaryPinString=serializePinString(3),graphPinString=serializePinString(2),tablePinString=serializePinString(1)}else graphPinString=tablePinString=summaryPinString=weightPinString=""}function initActorsListFromEditPin(e,t,i){for(var r=e.split("|"),a=0;a<r.length;++a)if("0.0.0.Any"!=r[a]){var n=r[a].split("."),s=n[0],o=parseInt(n[1]),l=parseInt(n[2]),p=n[3];if("0"==s&&"0"==o&&"0"==l)return updateFilterActorsListWithClass(p,t,i);var d="";if('"'==s[0])d="Actor Name - "+s;else{var c=parseInt(s);if(!c)continue;d=actorGUIDNames[c]?actorGUIDNames[c]:"Actor ID - "+c}d=buildActorNameFromGUIDs(d,l,o),updateFilterActorsListWithInfo(r[a],d,p,t,i)}}function initQueryPinUIFromEditPin(e){for(pinsUIPreCommittedString="",pinsUIEditPinComponent>0&&(pinsUIPreCommittedString=pinsUIEditPin.filter,3==pinsUIEditPin.filter?pinsUIPreCommittedString+="$"+pinsUIEditPin.summaryField+"$"+pinsUIEditPin.summaryEntry:4==pinsUIEditPin.filter&&(pinsUIPreCommittedString+="$"+pinsUIEditPin.weightField),pinsUIPreCommittedString+="$"+pinsUIEditPin.graph+"$"+pinColorForNewPin()+"$"),j=0;j<pinsUIEditPin.components.length;++j){var t=pinsUIEditPin.components[j];if(j>0&&(pinsUIPreCommittedString+="$"),t==e)break;pinsUIPreCommittedString+=serializePinComponent(t)}for(j=pinsUIEditPinComponent+1;j<pinsUIEditPin.components.length;++j)t=pinsUIEditPin.components[j],j==pinsUIEditPinComponent+1&&(pinsUIPostCommittedString="$"+e.connector+"$"),pinsUIPostCommittedString+=serializePinComponent(t);pinUITypes=e.type.split("|"),pinUITypeCount=pinUITypes.length;for(var i=0;i<pinUITypes.length;++i){var r=pinUITypes[i];"auras-gained"!=r&&"auras-cast"!=r||(r="auras");var a=document.getElementById(r+"-pin-type");a&&(a.checked=!0)}pinUITypeChanged(),pinUIHostility=e.hostility;var n=0;1==pinUITypeCount&&"auras-cast"==pinUITypes[0]&&e.hostility>=0&&(n=2),document.getElementById("pins-ui-hostility-select").selectedIndex=pinUIHostility+1+n,void 0!==e.auraPresence&&(document.getElementById("pins-ui-aura-check").checked=!0,document.getElementById("pins-ui-aura-presence").selectedIndex=e.auraPresence?0:1,document.getElementById("pins-ui-aura-actors").selectedIndex=e.auraSource?0:1),void 0!==e.resourceType&&(document.getElementById("pins-ui-resource-type").value=e.resourceType),1==pinUITypes.length&&void 0!==e.options&&("auras"==pinUITypes[0]||"auras-cast"==pinUITypes[0]||"auras-gained"==pinUITypes[0]?(document.getElementById("pins-ui-aura-apply").checked=1&e.options,document.getElementById("pins-ui-aura-refresh").checked=2&e.options,document.getElementById("pins-ui-aura-remove").checked=4&e.options,document.getElementById("pins-ui-aura-apply-stack").checked=8&e.options,document.getElementById("pins-ui-aura-remove-stack").checked=16&e.options,document.getElementById("pins-ui-aura-buffs").checked=32&e.options,document.getElementById("pins-ui-aura-debuffs").checked=64&e.options):"damage"==pinUITypes[0]?(document.getElementById("pins-ui-damage-misses").checked=1&e.options,document.getElementById("pins-ui-damage-hits").checked=2&e.options,document.getElementById("pins-ui-damage-ticks").checked=4&e.options,8&e.options&&!(16&e.options)&&(document.getElementById("pins-ui-damage-crits").selectedIndex=1),16&e.options&&!(8&e.options)&&(document.getElementById("pins-ui-damage-crits").selectedIndex=2),256&e.options&&!(512&e.options)&&(document.getElementById("pins-ui-damage-blocked").selectedIndex=1),512&e.options&&!(256&e.options)&&(document.getElementById("pins-ui-damage-blocked").selectedIndex=2),supportsMultistrike&&(1024&e.options&&!(2048&e.options)&&(document.getElementById("pins-ui-damage-multistrike").selectedIndex=1),2048&e.options&&!(1024&e.options)&&(document.getElementById("pins-ui-damage-multistrike").selectedIndex=2)),document.getElementById("pins-ui-damage-physical").checked=32&e.options,document.getElementById("pins-ui-damage-magical").checked=64&e.options):"healing"==pinUITypes[0]?(document.getElementById("pins-ui-healing-hits").checked=1&e.options,document.getElementById("pins-ui-healing-ticks").checked=2&e.options,document.getElementById("pins-ui-healing-absorbs").checked=4&e.options,8&e.options&&!(16&e.options)&&(document.getElementById("pins-ui-healing-crits").selectedIndex=1),16&e.options&&!(8&e.options)&&(document.getElementById("pins-ui-healing-crits").selectedIndex=2),supportsMultistrike&&(32&e.options&&!(64&e.options)&&(document.getElementById("pins-ui-healing-multistrike").selectedIndex=1),64&e.options&&!(32&e.options)&&(document.getElementById("pins-ui-healing-multistrike").selectedIndex=2))):"resources"==pinUITypes[0]&&(document.getElementById("pins-ui-resource-gains").checked=1&e.options,document.getElementById("pins-ui-resource-fields").checked=2&e.options)),initActorsListFromEditPin(e.actors,"actors","Actors"),initActorsListFromEditPin(e.sources,"sources","Sources"),initActorsListFromEditPin(e.targets,"targets","Targets"),document.getElementById("pins-ui-source-pets").checked=e.includeSourcePets,document.getElementById("pins-ui-target-pets").checked=e.includeTargetPets;var s=e.abilities.split("|");for(i=0;i<s.length;++i){var o=s[i],l="";if('"'==o[0])l="Name - "+o;else{var p=parseInt(o);if(!p)continue;l=lookupAbilityName(p)||"ID - "+p}setFilterPinAbilityWithName(o,l,0)}}function initPinUIFromEditPin(){var e=pinsUIEditPin.components[pinsUIEditPinComponent];if(e){var t=e.type.split("|");"expression"==t||"script"==t?(document.getElementById("pins-ui-"+t+"-box").value=e.expression,selectPinsUITab(t)):(initQueryPinUIFromEditPin(e),selectPinsUITab("query")),document.getElementById("pins-ui-filter-type").selectedIndex=pinsUIEditPin.filter,setPinsUITypeExplanation(),3==pinsUIEditPin.filter?(document.getElementById("pins-ui-summary-field").selectedIndex=pinsUIEditPin.summaryField,document.getElementById("pins-ui-summary-entry").selectedIndex=pinsUIEditPin.summaryEntry):4==pinsUIEditPin.filter&&(document.getElementById("pins-ui-weight-field").value=pinsUIEditPin.weightField),document.getElementById("pins-ui-create-or-change-pin").value="Change Pin"}}function editPin(e,t){var i=pins[e];i&&(pinsUIEditPin=i,pinsUIEditPinIndex=e,pinsUIEditPinComponent=-1!=t?t:i.components.length-1,showPinUI(),initPinUIFromEditPin())}function removePin(e){pins[e]&&(pins.splice(e,1),serializePins())}function removePinComponent(e,t){var i=pins[e];i&&i.components[t]&&(i.components.splice(t,1),1==i.components.length&&(i.components[0].connector=void 0),serializePins())}function serializePins(){var e=serializePinString(0),t=$.deparam.fragment();return e?t.pins=e:delete t.pins,changeView(t)}function serializePinComponent(e){var t=e.type+"$";return"expression"==e.type||"script"==e.type?t+=e.expression:(t+=e.hostility+"$"+e.actors+"$"+e.sources+"$"+e.includeSourcePets+"$"+e.targets+"$"+e.includeTargetPets+"$"+e.abilities,"resources"==e.type&&(t+="$"+e.resourceType),void 0!==e.auraPresence&&(t+="$"+e.auraPresence+"$"+e.auraSource),void 0!==e.options&&(t+="$"+e.options),"and"!=e.connector&&"or"!=e.connector||(t+="$"+e.connector),t)}function serializePinString(e){for(var t="",i=!0,r=0;r<pins.length;++r){var a=pins[r];if(!(2!=a.filter&&1==e||2!=a.filter&&"Main"!=a.graph&&2==e||2!=a.filter&&3!=a.filter&&3==e||2!=a.filter&&4!=a.filter&&4==e)){i?i=!1:t+="^",t+=a.filter,3==a.filter?t+="$"+a.summaryField+"$"+a.summaryEntry:4==a.filter&&(t+="$"+a.weightField),t+="$"+a.graph+"$"+a.graphColor+"$";for(var n=0;n<a.components.length;++n)n>0&&(t+="$"),t+=serializePinComponent(a.components[n])}}return t}function addPinWithSource(e){var t=e.split("."),i=parseInt(t[0]),r=t.length>1?parseInt(t[1]):0;return addPin(filterType,hostilityType,i,r,"Any",filterTarget,filterTargetInstance,filterTargetClass,filterAbility,void 0,filterSpell)}function addPinWithTarget(e){var t=e.split("."),i=parseInt(t[0]),r=t.length>1?parseInt(t[1]):0;return addPin(filterType,hostilityType,filterSource,filterSourceInstance,filterSourceClass,i,r,"Any",filterAbility,void 0,filterSpell)}function addPinWithAbility(e,t){return addPin(filterType,hostilityType,filterSource,filterSourceInstance,filterSourceClass,filterTarget,filterTargetInstance,filterTargetClass,e,t,filterSpell)}function addPinWithResourceType(e){return addPin(filterType,hostilityType,filterSource,filterSourceInstance,filterSourceClass,filterTarget,filterTargetInstance,filterTargetClass,filterAbility,void 0,e)}function addPinWithTypeHostilityAndSource(e,t,i){var r=i.split(".");return addPin(e,t,i=parseInt(r[0]),r.length>1?parseInt(r[1]):0,"Any",filterTarget,filterTargetInstance,filterTargetClass,filterAbility,void 0,filterSpell)}function addPinWithTypeHostilityAndAbility(e,t,i,r){return addPin(e,t,filterSource,filterSourceInstance,filterSourceClass,filterTarget,filterTargetInstance,filterTargetClass,i,r,filterSpell)}function addPin(e,t,i,r,a,n,s,o,l,p,d){var c=$.deparam.fragment(),u=c.pins?c.pins:"";u&&(u+="^");var h=i>0?actorTable[i]:null,f=h?h.guid:0,m=0;f&&h.petOwner&&actorTable[h.petOwner]&&(m=actorTable[h.petOwner].guid),h&&(a=h.type);var g=n>0?actorTable[n]:null,y=g?g.guid:0;y&&g.petOwner&&actorTable[g.petOwner]&&(targetOwnerGUID=actorTable[g.petOwner].guid),g&&(o=g.type);var b=f+"."+r+"."+m+"."+a,v=y+"."+s+".0."+o;"auras"==e&&("source"==subFilterType?e="auras-gained":"target"==subFilterType&&(e="auras-cast"));var T="damage-taken"==e||"auras-gained"==e||"deaths"==e||"threat"==e,w=T?v:b,x=T?b:v,I="0.0.0.Any";if("resources"==e&&(I=w,w="0.0.0.Any"),p){var C=document.getElementById(p).innerHTML;abilityNameCache[l]=C}return"damage-done"!=e&&"damage-taken"!=e||("damage-taken"==e&&(t=0==t?1:0),e="damage"),u+="0$Separate$"+pinColorForNewPin()+"$"+e+"$"+t+"$"+I+"$"+w+"$true$"+x+"$false$"+l,"resources"==e&&(u+="$"+d),c.pins=u,changeView(c),!1}function actorEnemySort(e,t){return e.type<t.type?-1:e.type>t.type?1:e.name<t.name?-1:e.name>t.name?1:0}function actorSort(e,t){var i="Pet"!=e.type&&"Boss"!=e.type&&"NPC"!=e.type&&"Unknown"!=e.type;return i==("Pet"!=t.type&&"Boss"!=t.type&&"NPC"!=t.type&&"Unknown"!=t.type)?e.type<t.type?-1:e.type>t.type?1:e.name<t.name?-1:e.name>t.name?1:0:i?-1:1}function abilitySort(e,t){return e.name<t.name?-1:e.name>t.name?1:0}function buildActorName(e,t,i){var r=reportsCache[void 0===i?0:i];if(-1==e)return"Environment";var a=r.actorTable[e];if(!a)return"Unknown";var n=a.name;return t&&(n+=" "+(t>1e4?"Group "+(t-1e4):t)),a.petOwner&&r.actorTable[a.petOwner]&&(n+=" ("+r.actorTable[a.petOwner].name+")"),n}function buildActorNameFromGUIDs(e,t,i){var r=e;return t&&(r+=" "+(t>1e4?"Group "+(t-1e4):t)),i&&(r+=" ("+actorGUIDNames[i]+")"),r}function hashForBossAndDifficulty(e,t){return-3==e?"all":-2==e?"bosses":0==e?"trash":e+"."+t}function supportsZones(){return 0==game_id||2==game_id||4==game_id||5==game_id}function updateFightsAndParticipants(e){return function(t,i,r){if(reportsCache[e].fightsRequest=null,t.processing)initGraphProcessing();else{var a=new Proxy(reportsCache[e],{set:function(t,i,r){return t[i]=r,window.reportsCacheOnChangeHandlers.forEach((function(a){a(e,t,i,r)})),!0}});reportsCache[e]=a;var n=reportsCache[e];n.fights=t.fights,n.completeRaids=t.completeRaids,n.players=t.friendlies,n.enemies=t.enemies,n.playersAndEnemies=n.players.concat(n.enemies),n.fightsTable=new Array,n.completeRaidsTable=new Array,n.actorTable=new Array,n.actorGUIDNames=new Array,n.petsTable=new Array,n.logVersion=t.logVersion,n.lang=t.lang;for(var s=0;s<n.fights.length;++s)n.fightsTable[n.fights[s].id]=n.fights[s],n.fights[s].boss?n.lastPull=n.fights[s]:n.lastPull&&n.lastPull.boss||(n.lastPull=n.fights[s]),n.fights[s].reportIndex=e;if(n.completeRaids)for(s=0;s<n.completeRaids.length;++s)n.completeRaidsTable[n.completeRaids[s].id]=n.completeRaids[s],n.completeRaids[s].reportIndex=e;for(s=0;s<n.players.length;++s)n.actorTable[n.players[s].id]=n.players[s],n.actorGUIDNames[n.players[s].guid]=n.players[s].name;for(s=0;s<n.enemies.length;++s)n.actorTable[n.enemies[s].id]=n.enemies[s],n.actorGUIDNames[n.enemies[s].guid]=n.enemies[s].name;for(n.players.sort(actorSort),n.enemies.sort(actorEnemySort),n.playersAndEnemies.sort(actorSort),n.friendlyPets=t.friendlyPets,n.friendlyPets.sort(actorSort),n.enemyPets=t.enemyPets,n.enemyPets.sort(actorEnemySort),n.filterFightsString="0",n.filterFightsArray=new Array,n.filterFightIsLastPull=!1,s=0;s<n.friendlyPets.length;++s){var o=n.friendlyPets[s];n.petsTable[o.petOwner]||(n.petsTable[o.petOwner]=new Array),n.petsTable[o.petOwner].push(o),n.actorTable[o.id]=o,n.actorGUIDNames[o.guid]=o.name}for(s=0;s<n.enemyPets.length;++s)o=n.enemyPets[s],n.petsTable[o.petOwner]||(n.petsTable[o.petOwner]=new Array),n.petsTable[o.petOwner].push(o),n.actorTable[o.id]=o,n.actorGUIDNames[o.guid]=o;if(t.abilities)for(s=0;s<t.abilities.length;++s)abilityNameCache[t.abilities[s].guid]=t.abilities[s].name;if(t.phases)for(s=0;s<t.phases.length;++s){var l=t.phases[s];phasesTable[l.boss]=l}for(s=0;s<reportsCache.length;++s)if(reportsCache[s].fightsRequest)return;var p=reportsCache.bossArray=[],d=reportsCache.bossHash=[];d.all={name:"Encounters and Trash Fights",kills:0,wipes:0,last:new Array,lastWipes:new Array,boss:-3,difficulty:0},d.bosses={name:"Encounters",kills:0,wipes:0,last:new Array,lastWipes:new Array,boss:-2,difficulty:0},d.trash={name:"Trash Fights",kills:0,wipes:0,last:new Array,lastWipes:new Array,boss:0,difficulty:0};for(var c=supportsZones(),u=0;u<reportsCache.length;++u){!filterTranslate&&reportsCache[u].lang&&reportsCache[u].lang!=currentLang&&"unknown"!=reportsCache[u].lang&&"FAILED CONNECTION"!=reportsCache[u].lang&&showTranslationBar();var h=reportsCache[u].fights,f=new Array,m=new Array;for(s=0;s<h.length;++s){var g=h[s],y=hashForBossAndDifficulty(g.boss,g.difficulty);g.boss&&(d[y]||(d[y]={name:g.name,kills:0,wipes:0,last:new Array,lastWipes:new Array,lastKills:new Array,boss:g.boss,difficulty:g.difficulty},d[y].last[u]=g,c&&(d[y].zoneID=g.zoneID,d[y].zoneName=g.zoneName),p.push(d[y]))),d.all.last[u]=g,g.boss?(g.kill?(d.bosses.kills++,d.all.kills++):(d.bosses.wipes++,d.all.wipes++),d.bosses.last[u]=g):d.all.kills++,g.boss?g.kill?(d[y].kills++,m[y]?m[y]++:m[y]=1,g.killNumber=m[y],d[y].lastKill?(d[y].lastKill.index=u,d[y].lastKill.fight=g):d[y].lastKill={index:u,fight:g},d[y].lastKills[u]=g):(d[y].wipes++,f[y]?f[y]++:f[y]=1,g.wipeNumber=f[y],d[y].lastWipe?(d[y].lastWipe.index=u,d[y].lastWipe.fight=g):d[y].lastWipe={index:u,fight:g},d[y].lastWipes[u]=g):d[y].kills++,d[y].last[u]=g}}needToFetchFightsAndParticipants=!1,n=reportsCache[0],fights=n.fights,players=n.players,enemies=n.enemies,playersAndEnemies=n.playersAndEnemies,fightsTable=n.fightsTable,actorTable=n.actorTable,actorGUIDNames=n.actorGUIDNames,petsTable=n.petsTable,friendlyPets=n.friendlyPets,enemyPets=n.enemyPets,logVersion=n.logVersion,loadViews($.deparam.fragment())}}}function updateFightsAndParticipantsFailed(){document.getElementById("graph-loading").style.display="none",document.getElementById("event-killer").style.display="none";for(var e=0;e<reportsCache.length;++e)reportsCache[e].fightsRequest&&reportsCache[e].fightsRequest.abort();reportsCache=new Array}function fetchFightsAndParticipants(e){for(var t=0;t<reportsCache.length;++t)if(reportsCache[t].fightsRequest)return;showGraphLoadElements(!0),reportsCache=new Array;var i=collectAbilitiesForNameCache(e),r="/reports/fights-and-participants/"+report_id+"/"+i;filterTranslate&&(r+="?lang="+currentLang),reportsCache.push({fightsRequest:$.getJSON(r,updateFightsAndParticipants(0)).fail(updateFightsAndParticipantsFailed)});for(var a=0;a<comparisonReports.length;++a)r="/reports/fights-and-participants/"+comparisonReports[a].code+"/"+i,filterTranslate&&(r+="?lang="+currentLang),reportsCache.push({fightsRequest:$.getJSON(r,updateFightsAndParticipants(a+1)).fail(updateFightsAndParticipantsFailed)})}function toggleComponentPlayground(){"none"==document.getElementById("report-component-sandbox-container").style.display?showComponentPlayground():hideComponentPlayground()}function showComponentPlayground(){hidePinUI(),$("#filter-subtype-strip").addClass("components"),$("#view-type-tabs").addClass("components"),$("#graph-and-table-container").addClass("components"),$("#pins").hide(),$("#report-component-sandbox-container").show()}function hideComponentPlayground(){$("#filter-subtype-strip").removeClass("components"),$("#view-type-tabs").removeClass("components"),$("#graph-and-table-container").removeClass("components"),$("#pins").show(),$("#report-component-sandbox-container").hide()}function sortGraphSeriesByTotal(e,t){if("casts"==filterType){if("Melee"==e.name&&"Melee"!=t.name)return 1;if("Melee"!=e.name&&"Melee"==t.name)return-1;if("Pet"==e.type&&"Pet"!=t.type)return 1;if("Pet"!=e.type&&"Pet"==t.type)return-1}return null==e.total&&(e.total=0),null==t.total&&(t.total=0),e.total>t.total?-1:e.total<t.total?1:0}function sortGraphSeries(e,t){if("Total"==e.type)return-1;if("Total"==t.type)return 1;var i=e.type;"Boss"!=i&&"Pet"!=i&&"NPC"!=i&&(i="A Player");var r=t.type;return"Boss"!=r&&"Pet"!=r&&"NPC"!=r&&(r="A Player"),i<r?-1:i>r?1:e.name<t.name?-1:e.name>t.name?1:0}function setLineColorForActorFromType(e){if("Boss"==e)return"#B4BDFF";if("NPC"==e)return"#84BDF8";if("Pet"==e)return"#64BDC8";if(0==game_id){if("DeathKnight"==e)return"rgb(196, 31, 59)";if("DemonHunter"==e)return"#a330c9";if("Druid"==e)return"rgb(255, 125, 10)";if("Evoker"==e)return"#33937F";if("Hunter"==e)return"rgb(171, 212, 115)";if("Mage"==e)return"rgb(105, 204, 240)";if("Monk"==e)return"#2D9B78";if("Paladin"==e)return"rgb(245, 140, 186)";if("Priest"==e)return"#eeeeee";if("Rogue"==e)return"rgb(255, 245, 105)";if("Shaman"==e)return"rgb(36, 89, 255)";if("Warlock"==e)return"rgb(148, 130, 201)";if("Warrior"==e)return"rgb(199, 156, 110)"}else if(1==game_id){if("Medic"==e)return"rgb(16, 130, 16)";if("Stalker"==e)return"rgb(209, 38, 204)";if("Esper"==e)return"#33e2d3";if("Engineer"==e)return"#d69c00";if("Warrior"==e)return"#cf2621";if("Spellslinger"==e)return"#2599be"}else if(2==game_id){if("LimitBreak"==e)return"#2599be";if("Scholar"==e)return"#8657FF";if("Astrologian"==e)return"#FFE74A";if("Monk"==e||"Pugilist"==e)return"#d69c00";if("Ninja"==e||"Rogue"==e)return"#AF1964";if("WhiteMage"==e||"Conjurer"==e)return"#FFF0DC";if("DarkKnight"==e)return"rgb(209, 38, 204)";if("Paladin"==e||"Gladiator"==e)return"#A8D2E6";if("Bard"==e||"Archer"==e)return"rgb(57%, 73%, 37%)";if("Dragoon"==e||"Lancer"==e)return"#4164CD";if("Warrior"==e||"Marauder"==e)return"#cf2621";if("Machinist"==e)return"#6EE1D6";if("Summoner"==e||"Arcanist"==e)return"#2D9B78";if("BlackMage"==e||"Thaumaturge"==e)return"#A579D6";if("Samurai"==e)return"#e46d04";if("RedMage"==e)return"#e87b7b";if("BlueMage"==e)return"rgb(36, 89, 255)";if("Gunbreaker"==e)return"#998D50";if("Dancer"==e)return"#E2B0AF";if("Reaper"==e)return"#965A90";if("Sage"==e)return"#80A0F0"}else if(3==game_id){if("Mage"==e)return"#A579D6";if("Cleric"==e)return"rgb(57%, 73%, 37%)";if("Rogue"==e)return"rgb(255, 245, 105)";if("Warrior"==e)return"#cf2621";if("Primalist"==e)return"#d69c00"}else if(4==game_id){if("Nightblade"==e)return"#e87b7b";if("DragonKnight"==e)return"rgb(255, 125, 10)";if("Warden"==e)return"rgb(16, 130, 16)";if("Templar"==e)return"rgb(255, 245, 105)";if("Sorcerer"==e)return"rgb(148, 130, 201)";if("Necromancer"==e)return"#a330c9"}else if(5==game_id){if("JediSage"==e||"SithSorcerer"==e)return"#A8D2E6";if("SithAssassin"==e||"JediShadow"==e)return"#4164CD";if("SithJuggernaut"==e||"JediGuardian"==e)return"rgb(58%, 51%, 79%)";if("SithMarauder"==e||"JediSentinel"==e)return"#cf2621";if("Operative"==e||"Scoundrel"==e)return"#d69c00";if("Sniper"==e||"Gunslinger"==e)return"#FFE74A";if("Powertech"==e||"Vanguard"==e)return"rgb(57%, 73%, 37%)";if("Mercenary"==e||"Commando"==e)return"#2D9B78"}return"Damage Done"==e?"#84BDF8":"Damage Taken"==e?"#F84D44":"Healing Done"==e?"#84f8bd":"Healing Received"==e?"rgb(225, 215, 105)":chartLineColor}function colorForAbilityType(e){return 1==e?"rgb(229, 204, 128)":2==e?"rgb(100%, 100%, 56%)":4==e?"rgb(92%, 27%, 38%)":8==e?"rgb(82%, 98%, 60%)":16==e?"rgb(29%, 50%, 100%)":32==e?"rgb(72%, 66%, 94%)":64==e?"rgb(56%, 95%, 100%)":e>=124&&e<=127?"rgb(163, 48, 201)":128==e?"rgb(80%, 44%, 9%)":256==e?"#2599be":512==e?"rgb(75%, 75%, 75%)":"white"}function setLineColorForAbilityFromType(e,t){if("Total"==e)return chartLineColor;for(var i=0,r=1;r<128;r*=2)e&r&&i++;if(i<2||i>5)return t?colorForAbilityType(e):"";if(!t){for(r=64;r>=2;r/=2)if(0!=(e&r))return"color: "+colorForAbilityType(r)+";";return""}var a=new Array;a[1]="rgb(229, 204, 128)",a[2]="rgb(100%, 100%, 56%)",a[4]="rgb(92%, 27%, 38%)",a[8]="rgb(82%, 98%, 60%)",a[16]="rgb(29%, 50%, 100%)",a[32]="rgb(72%, 66%, 94%)",a[64]="rgb(56%, 95%, 100%)";var n=0,s=new Array,o="",l="-webkit-text-fill-color: transparent; background-clip: -webkit-text; -webkit-background-clip: text; background-image: -webkit-gradient(linear, left top, right bottom, ";for(r=64;r>=1;r/=2)0!=(e&r)&&(n++,o=a[r],t?s.push([(n-1)/(i-1),a[r]]):l+=1==n?"from("+a[r]+"), ":n==i?"to("+a[r]+")":"color-stop("+parseInt(100*(n-1)/(i-1))+"%, "+a[r]+"), ");return l+=")",t?{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:s,fallback:o}:l}$((function(){$("#pins-ui-actors-autocomplete").keydown((function(e){if(13==e.keyCode&&!$(this).data("ui-autocomplete").menu.active){var t=safe_tags(document.getElementById("pins-ui-actors-autocomplete").value),i=parseInt(t);if(i)updateFilterActorsListWithInfo(i+".0.0.Any","Actor ID - "+i,"Any","actors","Actors");else{var r=t;!t.length||'"'!=t[0]&&"'"!=t[0]||'"'!=t[t.length-1]&&"'"!=t[t.length-1]||(r=t.substring(1,t.length-1)),updateFilterActorsListWithInfo('"'+r+'".0.0.Any','Actor Name - "'+r+'"',"Any","actors","Actors")}document.getElementById("pins-ui-actors-autocomplete").value=""}})),$("#pins-ui-sources-autocomplete").keydown((function(e){if(13==e.keyCode&&!$(this).data("ui-autocomplete").menu.active){var t=safe_tags(document.getElementById("pins-ui-sources-autocomplete").value),i=parseInt(t);if(i)updateFilterActorsListWithInfo(i+".0.0.Any","Actor ID - "+i,"Any","sources","Sources");else{var r=t;!t.length||'"'!=t[0]&&"'"!=t[0]||'"'!=t[t.length-1]&&"'"!=t[t.length-1]||(r=t.substring(1,t.length-1)),updateFilterActorsListWithInfo('"'+r+'".0.0.Any','Actor Name - "'+r+'"',"Any","sources","Sources")}document.getElementById("pins-ui-sources-autocomplete").value=""}})),$("#pins-ui-targets-autocomplete").keydown((function(e){if(13==e.keyCode&&!$(this).data("ui-autocomplete").menu.active){var t=safe_tags(document.getElementById("pins-ui-targets-autocomplete").value),i=parseInt(t);if(i)updateFilterActorsListWithInfo(i+".0.0.Any","Actor ID - "+i,"Any","targets","Targets");else{var r=t;!t.length||'"'!=t[0]&&"'"!=t[0]||'"'!=t[t.length-1]&&"'"!=t[t.length-1]||(r=t.substring(1,t.length-1)),updateFilterActorsListWithInfo('"'+r+'".0.0.Any','Actor Name - "'+r+'"',"Any","targets","Targets")}document.getElementById("pins-ui-targets-autocomplete").value=""}})),$("#pins-ui-abilities-autocomplete").keydown((function(e){if(13==e.keyCode&&!$(this).data("ui-autocomplete").menu.active){var t=safe_tags(document.getElementById("pins-ui-abilities-autocomplete").value),i=parseInt(t);if(i)setFilterPinAbilityWithName(i,"Ability ID - "+i,0);else{var r=t;!t.length||'"'!=t[0]&&"'"!=t[0]||'"'!=t[t.length-1]&&"'"!=t[t.length-1]||(r=t.substring(1,t.length-1)),setFilterPinAbilityWithName('"'+r+'"','Ability Name - "'+r+'"',0)}document.getElementById("pins-ui-abilities-autocomplete").value=""}})),$("#pins-ui-actors-autocomplete").autocomplete({source:pinActorsAutocompleteCallback,minLength:3,autoFocus:!0,appendTo:"#pins-ui-actors-autocomplete-results",select:function(e,t){if(t.item.matches)for(var i=1;i<t.item.matches.length;++i)t.item.matches[i]&&setFilterPinActor(t.item.matches[i].actor.id,0);else setFilterPinActor(t.item.actor.id,0);document.getElementById("pins-ui-actors-autocomplete").value="",e.preventDefault()}}),$("#pins-ui-sources-autocomplete").autocomplete({source:pinActorsAutocompleteCallback,minLength:3,autoFocus:!0,appendTo:"#pins-ui-sources-autocomplete-results",select:function(e,t){if(t.item.matches)for(var i=1;i<t.item.matches.length;++i)t.item.matches[i]&&setFilterPinSource(t.item.matches[i].actor.id,0);else setFilterPinSource(t.item.actor.id,0);document.getElementById("pins-ui-sources-autocomplete").value="",e.preventDefault()}}),$("#pins-ui-targets-autocomplete").autocomplete({source:pinActorsAutocompleteCallback,minLength:3,autoFocus:!0,appendTo:"#pins-ui-targets-autocomplete-results",select:function(e,t){if(t.item.matches)for(var i=1;i<t.item.matches.length;++i)t.item.matches[i]&&setFilterPinTarget(t.item.matches[i].actor.id,0);else setFilterPinTarget(t.item.actor.id,0);document.getElementById("pins-ui-targets-autocomplete").value="",e.preventDefault()}}),$("#pins-ui-abilities-autocomplete").autocomplete({source:pinAbilitiesAutocompleteCallback,minLength:3,autoFocus:!0,appendTo:"#pins-ui-abilities-autocomplete-results",select:function(e,t){if(t.item.matches)for(var i=1;i<t.item.matches.length;++i)t.item.matches[i]&&setFilterPinAbilityWithName(t.item.matches[i].ability.guid,t.item.matches[i].ability.name,t.item.matches[i].ability.type);else setFilterPinAbilityWithName(t.item.ability.guid,t.item.ability.name,t.item.ability.type);document.getElementById("pins-ui-abilities-autocomplete").value="",e.preventDefault()}})}));var lineArray=["Solid","ShortDash","ShortDot","DashDot","ShortDashDot","LongDash","LongDashDotDot"];function setLineStyleFromType(e,t){var i=e[t];i||(i=0);var r=lineArray[i%lineArray.length];return e[t]=++i,r}function chartZoomed(e){return updateZoom(e.min,e.max)}function updateZoom(e,t){for(var i=$.deparam.fragment(),r="",a="",n=0;n<reportsCache.length;++n){0!=n&&(r+=",",a+=",");var s=reportsCache[n];if(s.graphURL){var o=Math.floor(e)+s.filterFightStartTime,l=Math.ceil(t)+s.filterFightStartTime;o>s.filterFightEndTime&&(o=s.filterFightEndTime),l>s.filterFightEndTime&&(l=s.filterFightEndTime),r+=o,a+=l}else r+="0",a+="0"}i.start=r,i.end=a,delete i.eventstart,delete i.graphperf,changeView(i)}function resetZoom(){var e=$.deparam.fragment();return delete e.start,delete e.end,delete e.eventstart,delete e.graphperf,changeView(e),!1}var loadElementTimeout=null;function reallyShowGraphLoadElements(){loadElementTimeout=null,document.getElementById("graph-loading").style.display="block",document.getElementById("graph-wrapper").style.opacity="0.4",document.getElementById("pins").style.opacity="0.4",document.getElementById("event-killer").style.display=""}function showGraphLoadElements(e){e?loadElementTimeout||(loadElementTimeout=setTimeout(reallyShowGraphLoadElements,1e3)):reallyShowGraphLoadElements()}function hideGraphLoadElements(){loadElementTimeout&&(clearTimeout(loadElementTimeout),loadElementTimeout=null),document.getElementById("graph-wrapper").style.opacity="",document.getElementById("pins").style.opacity="",document.getElementById("graph-loading").style.display="none",document.getElementById("event-killer").style.display="none"}function hasPendingGraphRequests(){for(var e=0;e<reportsCache.length;++e)if(reportsCache[e].graphRequest)return!0;return!1}function abortPendingGraphRequests(){for(var e=0;e<reportsCache.length;++e){var t=reportsCache[e];t.graphRequest&&(t.graphRequest.abort(),t.graphRequest=null),t.graphURL="",t.graphJSONData=null}}function clearGraphURLs(){for(var e=0;e<reportsCache.length;++e)reportsCache[e].graphURL="",reportsCache[e].graphJSONData=null}function initGraphFailed(){document.getElementById("graph").innerHTML=errorGraphHTML,hideGraphLoadElements(),abortPendingGraphRequests()}function initGraphProcessing(){document.getElementById("graph").innerHTML=processingGraphHTML,hideGraphLoadElements(),abortPendingGraphRequests()}function print_ms(e){var t=e%1e3;return t<10?"00"+t:t<100?"0"+t:t}function setColorForAmountFromType(e){return"damage"==e.type||"reflect"==e.type?1!=game_id||4!=e.hitType&&5!=e.hitType?"rgb(92%, 27%, 38%)":"rgb(92%, 27%, 92%)":"heal"==e.type||"absorbed"==e.type||"healabsorbed"==e.type?void 0!==e.shielded||"heal"!=e.type?"#84BDF8":"#84F8BD":"calculateddamage"==e.type?"#e87b7b":"calculatedheal"==e.type?"#44A89D":void 0}function printFightRelativeTimestamp(e,t,i){if(null==i)return printTimestamp(e,t,!1);var r=void 0===t?reportsCache[0]:reportsCache[t],a=r.fights[i-1].end_time-r.fights[i-1].start_time,n=e-r.fights[i-1].start_time,s=a>=36e5?"%H:%M:%S":"%M:%S",o=Highcharts.dateFormat(s,n)+"."+print_ms(n);return comparisonReports.length?"<span style='color:"+comparisonColor(t)+"'>"+o+"</span>":o}function printTimestamp(e,t,i){var r=e-(void 0===t?reportsCache[0]:reportsCache[t]).filterFightStartTime,a=Highcharts.dateFormat("%H:%M:%S",r)+(i?"":"."+print_ms(r));return comparisonReports.length?"<span style='color:"+comparisonColor(t)+"'>"+a+"</span>":a}function changeLink(e,t){var i=$.param.fragment(window.location.href,t,2);return e.href=i,!0}function followNextPageLink(e,t,i,r){var a=reportsCache[r];if(a.filterEventStart==t)return!1;var n=$.deparam.fragment();return t==a.fightSegmentStartTime&&(t=-1),updateParamsWithEventStartAtIndex(n,t,r),i&&window.scrollTo(0,0),changeLink(e,n)}function followRawLogLinkForActor(e,t,i,r,a,n,s){var o=void 0===s?0:s,l=$.deparam.fragment();return updateFilterViewParams(l,"analytical"),updateFilterTypeParams(l,t),updateFilterHostilityParams(l,i),updateFilterByParams(l,r&&"deaths"!=t&&"summary"!=t?"ability":"source",t,r),r?updateFilterSourceParams(l,a,n,o):updateFilterTargetParams(l,a,n,o),changeLink(e,l)}function followRawLogLinkForAbility(e,t,i,r){abilityNameCache[r]||(abilityNameCache[r]=e.innerHTML);var a=$.deparam.fragment();return updateFilterViewParams(a,"analytical"),updateFilterTypeParams(a,t),updateFilterHostilityParams(a,i),updateFilterByParams(a,"source",t,filterSource),updateFilterAbilityParams(a,r,0),changeLink(e,a)}function printActor(e,t,i,r,a,n,s,o,l,p,d){var c=reportsCache[d],u="";if(e){var h;if(i&&-1!=e.id&&(u+="<img width=12 height=12 src='"+icon_path+"markers/raid"+i+".png'> "),t||(t=0),n?u+='<span style="color: '+setLineColorForActorFromType(r)+'">'+a:(u+='<a class="'+r+'" href="#" onclick="',u+=h="return followRawLogLinkForActor(this, '"+o+"',"+l+","+p+","+e.id+",0)",u+='" oncontextmenu="',u+=h,u+='">'+a),t&&(n?u+=" "+t:(u+='</a> <a class="'+r+'" href="#" onclick="',u+=h="return followRawLogLinkForActor(this, '"+o+"',"+l+","+p+","+e.id+","+t+")",u+='" oncontextmenu="',u+=h,u+='">'+t)),e.petOwner){var f=c.actorTable[e.petOwner];u+=f?" ("+f.name+")":" (Unknown Owner)"}u+=n?"</span>":"</a>"}else u+="Unknown";return u}function printAbility(e,t,i,r){if(!e)return"Unknown";if(t){var a=' <span class="school-'+e.type+'" style="';a+="color: ",a+=setLineColorForAbilityFromType(e.type,t)+'">'+e.name+"</span> "}else{a=' <a class="school-'+e.type+'" style="',a+=setLineColorForAbilityFromType(e.type,t)+'" ',e.guid>abilityCutoff?a+='href="'+("auras"==i?buffExternalLinkForEntry(e):abilityExternalLinkForEntry(e))+'"':a+='href="#"',a+=' onclick="';var n="return followRawLogLinkForAbility(this, '"+i+"',"+r+","+e.guid+")";a+=n,a+='" oncontextmenu="',a+=n,a+='">'+e.name+"</a> "}return a}function printMissText(e){return 0==e?' <span style="color: #ff8">Miss</span>':6==e?' <span style="color: #ff8">Glancing</span>':7==e?' <span style="color: #ff8">Dodge</span>':8==e?' <span style="color: #ff8">Parry</span>':9==e?' <span style="color: #ff8">Deflect</span>':10==e?' <span style="color: #ff8">Immune</span>':11==e?' <span style="color: #ff8">Misfire</span>':12==e?' <span style="color: #ff8">Reflect</span>':13==e?' <span style="color: #ff8">Evade</span>':14==e?' <span style="color: #ff8">Resist</span>':15==e?' <span style="color: #ff8">Crushing</span>':""}function isAuraEvent(e){return"applybuff"==e||"applybuffstack"==e||"applydebuff"==e||"applydebuffstack"==e||"removebuff"==e||"removebuffstack"==e||"removedebuff"==e||"removedebuffstack"==e||"refreshbuff"==e||"refreshdebuff"==e}function printDifficulty(e){return 1==game_id?e>100?"Prime "+(e-100):"":0==e?"Unknown":1==e?"LFR":2==e?"Flex":3==e?"Normal":4==e?"Heroic":5==e?"Mythic":10==e?logVersion>=7?"Mythic+":"Challenge Mode":20==e?"Tower":110==e?"Story":111==e?"Veteran":112==e?"Master":""}function fullPathForIcon(e){if(e)return icon_path+"abilities/"+e}function printIcon(e,t){var i=fullPathForIcon(e.abilityIcon);if(i)return 4==game_id&&(i+=".png"),'<img class="'+t+'" title="'+e.name+'" src="'+i+'">'}function printEvent(e,t,i){var r=void 0===i?reportsCache[0]:reportsCache[i],a="";if(t&&(a+='<span style="font-size:10px;">['+printFightRelativeTimestamp(e.timestamp,i,e.fight)+"] "),e.sourceID&&(e.source=r.actorTable[e.sourceID]),e.targetID&&(e.target=r.actorTable[e.targetID]),e.killerID&&(e.killer=r.actorTable[e.killerID]),e.source||(e.source={name:"Unknown Actor",type:"NPC"}),e.target||(e.target={name:"Unknown Actor",type:"NPC"}),"encounterstart"==e.type||"dungeonstart"==e.type||"towerstart"==e.type||"dungeonencounterstart"==e.type){if(a+="<span class='Boss'>"+e.name+"</span> engaged",0==game_id&&(e.size,printDifficulty(e.difficulty)),a+=". (Encounter ID: <span class='estimate'>"+e.encounterID+"</span>",e.level>0){if(a+=", Level: <span class='estimate'>"+e.level+"</span>",e.affixes&&e.affixes.length){a+=", Affixes:<span style='display:inline-block;margin-top:3px'><span style='float:left; margin-right:4px; margin-left:2px'>";for(var n=0;n<e.affixes.length;++n)a+="<img class='affix-icon' title='"+nameForAffix(e.affixes[n])+"' src='"+icon_path+"abilities/"+iconForAffix(e.affixes[n])+"'>";a+="</span>"}}else e.layer>0&&(a+=", Layer: <span class='estimate'>"+e.layer+"</span>");a+=")"}else if("encounterend"==e.type||"dungeonend"==e.type||"dungeonencounterend"==e.type||"towerend"==e.type)a+="The <span class='Boss'>"+e.name+"</span> encounter ends in a "+(e.kill?"kill.":"wipe."),e.rating&&(a+=" Rating: <span class='estimate'>"+e.rating+"</span>.");else if("damage"==e.type||"heal"==e.type||"reflect"==e.type||"calculateddamage"==e.type||"calculatedheal"==e.type){var s="damage"==e.type||"reflect"==e.type||"calculateddamage"==e.type,o=s?"damage":"healing",l=s&&e.targetIsFriendly||("heal"==e.type||"calculatedheal"==e.type)&&!e.targetIsFriendly?1:0,p=!s||!e.targetIsFriendly;if(e.source?a+=printActor(e.source,e.sourceInstance,e.sourceMarker,e.source.type,e.source.name,t,!0,o,l,p,i):a+="Unknown","reflect"==e.type&&(a+=" reflects "+printAbility(e.extraAbility,t,o,l)+"with "),"calculateddamage"!=e.type&&"calculatedheal"!=e.type||(a+=" prepares "),e.supportID&&(e.support=r.actorTable[e.supportID]),e.support&&(a+=" ("+printActor(e.support,0,0,e.support.type,e.support.name,t,!0,o,l,p,i)+") "),a+=printAbility(e.ability,t,o,l),"calculateddamage"!=e.type&&"calculatedheal"!=e.type||(a+=" on "),e.target?a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!1,o,l,!p,i):a+="Unknown",e.tick&&(a+=" Tick "),e.amount||"heal"==e.type||"calculatedheal"==e.type){a+=' <span style="color: '+setColorForAmountFromType(e)+'">';var d=e.amount;"heal"!=e.type&&"calculatedheal"!=e.type||(a+="+",void 0!==e.shielded&&(d=e.shielded,e.shielded=void 0));var c=e.hitType&&(2==e.hitType||5==e.hitType||17==e.hitType||21==e.hitType);c&&(a+="*"),a+=d,c&&(a+="*"),a+="</span>"}var u=void 0===e.shielded?0:e.shielded;u&&(a+=' (S: <span style="color: #ff8">'+u+"</span>)");var h=(void 0===e.absorbed?0:e.absorbed)-(1==game_id?u:0);if(h&&(a+=' (A: <span style="color: #84BDF8">'+h+"</span>)"),void 0!==e.resisted&&e.resisted>0&&(a+=' (R: <span style="color: #BD84F8">'+e.resisted+"</span>)"),e.blocked)if(4==game_id)a+=' (<span style="color:#ff8">Blocked</span>)';else{var f="B";3==game_id&&(f="M"),20!=e.hitType&&21!=e.hitType||(f=2==game_id?"P":"G"),a+=" ("+f+': <span style="color: #ff8">'+e.blocked+"</span>)"}e.overkill>-1&&(a+=' (O: <span style="color: #ff8">'+e.overkill+"</span>)"),e.overheal&&(a+=' (O: <span style="color: #ff8">'+e.overheal+"</span>)"),(e.multistrike||e.directHit)&&(a+=' (<span style="color: #ff8">'+multistrikeLabel+"</span>)"),a+=printMissText(e.hitType),minimumUnmitigatedDamageLogVersion>0&&e.unmitigatedAmount&&"damage-taken"==filterType&&0==hostilityType&&(a+=" (",a+='U: <span style="color: #ff8">'+e.unmitigatedAmount+"</span>",e.mitigated&&(a+=', M: <span style="color: #ff8">'+e.mitigated+"</span>",a+=', <span style="color: #ff8">'+(100*e.mitigated/e.unmitigatedAmount).toFixed(2)+"</span>%"),a+=")"),e.bonusPercent&&(a+=' (+<span style="color: #ff8">'+e.bonusPercent+"</span>%)"),e.simulated&&(a+=" (T: <span class=estimate>"+e.expectedAmount+"</span>, C: <span class=estimate>"+e.expectedCritRate/10+"%</span>",void 0!==e.directHitPercentage&&(a+=", D: <span class=estimate>"+(100*e.directHitPercentage).toFixed(1)+"%</span>"),a+=", P/R: <span class=estimate>"+e.actorPotencyRatio.toFixed(2)+"</span>",a+=", G: <span class=estimate>"+e.guessAmount.toFixed(2)+"</span>",a+=", M: <span class=estimate>"+e.multiplier+"</span>",a+=", S: <span class=estimate>"+Math.floor(e.finalizedAmount)+"</span>",a+=")"),void 0!==e.threat&&e.threat>0&&(a+=' &lt;T: <span style="color: #BD84F8">'+e.threat+"</span>&gt;")}else if("absorbed"==e.type||"healabsorbed"==e.type)o="healing",l=e.targetIsFriendly?0:1,p=!0,a+=printActor(e.source,e.sourceInstance,e.sourceMarker,e.source.type,e.source.name,t,!0,o,l,p,i),a+="'s ",a+=printAbility(e.ability,t,o,l),a+=" absorbs ",a+=' <span style="color: '+setColorForAmountFromType(e)+'">',a+=e.amount,a+="</span>",a+="healabsorbed"==e.type?" healing of ":" damage of ",e.attackerID&&(e.attacker=r.actorTable[e.attackerID]),e.healerID&&(e.healer=r.actorTable[e.healerID]),e.attacker&&(a+=printActor(e.attacker,e.attackerInstance,e.attackerMarker,e.attacker.type,e.attacker.name,t,!1,"damage",!l,!1,i)),e.healer&&(a+=printActor(e.healer,e.healerInstance,e.healerMarker,e.healer.type,e.healer.name,t,!1,"healer",l,!1,i)),a+="'s ",e.extraAbility?a+=printAbility(e.extraAbility,t,"healabsorbed"!=e.type?"damage":"healing",0):a+="melee",a+=" on ",a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!1,o,l,!p,i);else if("begincast"==e.type||"cast"==e.type)o=filterType,a+=printActor(e.source,e.sourceInstance,e.sourceMarker,e.source.type,e.source.name,t,!0,o,0,!0,i),1==e.ability.guid||e.ability.guid<0?a+=" swings at ":("begincast"==e.type?a+=" begins casting ":a+=" casts ",a+=printAbility(e.ability,t,o,l),e.target&&-1!=e.target.id&&(a+="on ")),e.target&&-1!=e.target.id&&(a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!1,o,0,!1,i)),"begincast"==e.type&&e.duration>0&&(a+=" (<span style='color:#ff8'>"+(e.duration/1e3).toFixed(2)+"</span> sec)");else if("resourcechange"==e.type){o="resources";var m=e.resourceChange;e.waste&&(m-=e.waste);var g=m>=0?" gains ":" loses ";a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!1,o,0,!1,i),a+=g,a+=" "+printResourceAmountAndType(e),a+=" from ",a+=printActor(e.source,e.sourceInstance,e.sourceMarker,e.source.type,e.source.name,t,!0,o,0,!0,i),e.ability&&(a+="'s ",a+=printAbility(e.ability,t,o,l)),e.waste&&(a+="(O: <span class='estimate'>"+e.waste+"</span>)")}else if("drain"==e.type||"leech"==e.type)o="resources",g="drain"==e.type?" drains ":" leeches ",a+=printActor(e.source,e.sourceInstance,e.sourceMarker,e.source.type,e.source.name,t,!0,o,0,!0,i),e.ability&&(a+="'s ",a+=printAbility(e.ability,t,o,l)),a+=g,a+=e.resourceChange,a+=" "+printPowerType(e.resourceChangeType),a+=" from ",a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!1,o,0,!1,i);else if("modifythreat"==e.type||"taunt"==e.type)g=(m=e.threat)>=0?" gains ":" loses ",a+=printActor(e.source,e.sourceInstance,e.sourceMarker,e.source.type,e.source.name,t,!0,o,0,!0,i),a+=g,a+='<span style="color: #BD84F8">',a+=m<0?-m:m,a+="</span>",a+=" <span style='color:#ff8'>Threat</span>",a+=" on ",a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!1,o,0,!1,i),"taunt"==e.type?a+=" from taunting the enemy.":e.ability&&(a+=" from ",a+=printAbility(e.ability,t,o,l));else if("extraattacks"==e.type)o="damage",l=e.targetIsFriendly?1:0,p=!e.targetIsFriendly,e.target?a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!1,o,l,!p,i):a+="Unknown",a+=" gains <span class=estimate>"+e.extraAttacks+"</span> extra attacks",e.ability&&(a+=" from "+printAbility(e.ability,t,o,l));else if("interrupt"==e.type||"dispel"==e.type||"spellsteal"==e.type||"aurabroken"==e.type){o="interrupt"==e.type?"interrupts":"dispels",g=" interrupts ";var y="aurabroken"==e.type?e.ability:e.extraAbility,b="aurabroken"==e.type?e.extraAbility:e.ability;"dispel"==e.type?g=" dispels ":"spellsteal"==e.type?g=" steals ":"aurabroken"==e.type&&(g=" breaks "),a+=printActor(e.source,e.sourceInstance,e.sourceMarker,e.source.type,e.source.name,t,!0,o,0,!0,i),b&&(a+="'s ",a+=printAbility(b,t,o,0)),a+=g,a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!1,o,0,!1,i),a+="'s ",a+=printAbility(y,t,o,0)}else if("death"==e.type)a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!0,"deaths",0,!0,i),e.feign?a+=" feigns death":(a+=" dies",e.killer&&e.killingAbility&&(a+=" from ",a+=printActor(e.killer,e.killerInstance,0,e.killer.type,e.killer.name,t,!0,"damage",e.targetIsFriendly,!e.targetIsFriendly,i),a+="'s ",a+=printAbility(e.killingAbility,t,"damage",e.targetIsFriendly)));else if("destroy"==e.type)a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!0,"deaths",0,!0,i),a+=" is destroyed.";else if("create"==e.type||"summon"==e.type||"resurrect"==e.type)a+=printActor(e.source,e.sourceInstance,e.sourceMarker,e.source.type,e.source.name,t,!0,o,0,!0,i),a+=" "+e.type+"s ",a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!1,"summons",0,!1,i),e.ability&&(a+=" with ",a+=printAbility(e.ability,t,o,l));else if("instakill"==e.type)l=e.targetIsFriendly?1:0,p=!e.targetIsFriendly,a+=printActor(e.source,e.sourceInstance,e.sourceMarker,e.source.type,e.source.name,t,!0,"damage",l,p,i),a+=" kills ",a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!1,"damage",l,!p,i),a+=" instantly with ",a+=printAbility(e.ability,t,"damage",l);else if(isAuraEvent(e.type)||"applyabsorb"==e.type||"removeabsorb"==e.type){o="auras";var v="applybuff"==e.type||"applybuffstack"==e.type||"applyabsorb"==e.type,T="applydebuff"==e.type||"applydebuffstack"==e.type,w="applybuffstack"==e.type||"applydebuffstack"==e.type||"removebuffstack"==e.type||"removedebuffstack"==e.type,x="removebuff"==e.type||"removedebuff"==e.type||"removebuffstack"==e.type||"removedebuffstack"==e.type||"removeabsorb"==e.type,I="refreshbuff"==e.type||"refreshdebuff"==e.type;l=e.targetIsFriendly?0:1,x?(a+=printActor(e.source,e.sourceInstance,e.sourceMarker,e.source.type,e.source.name,t,!0,o,l,!1,i),a+="'s"):(a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!1,o,l,!0,i),a+=v?" gains ":T?" is afflicted by ":"'s"),"applyabsorb"==e.type?(a+="<span style='color: #ff8'>"+(void 0!==e.absorb?e.absorb:0)+"</span> absorb from ",a+=printActor(e.source,e.sourceInstance,e.sourceMarker,e.source.type,e.source.name,t,!0,o,l,!1,i),a+="'s ",a+=printAbility(e.ability,t,o,l),e.overcap&&(a+=' (O: <span style="color: #ff8">'+e.overcap+"</span>)")):(a+=printAbility(e.ability,t,o,l),w&&(a+=" ("+e.stack+")"),a+=x?("removeabsorb"==e.type?" absorb shield ":"")+" fades from ":I?" is refreshed by ":" from ",a+=x?printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!1,o,l,!0,i):printActor(e.source,e.sourceInstance,e.sourceMarker,e.source.type,e.source.name,t,!0,o,l,!1,i),e.extraAbility&&(v||T)&&e.extraAbility.guid!=e.ability.guid&&(a+="'s",a+=printAbility(e.extraAbility,t,"casts",l)),e.extraInfo&&(a+=" [<span style='color:#ff8'>"+e.extraInfo+"</span>]"),void 0!==e.absorb&&(a+=" ("+trans("events.shield_strength")+": <span class='event-type-absorbed'>"+e.absorb+"</span>)"),void 0!==e.absorbed&&(a+=" (A: <span style='color: #ff8'>"+e.absorbed+"</span>)"),e.duration&&(a+=" ["+trans("events.duration_seconds",{number:"<span style='color:#ff8'>"+(e.duration/1e3).toFixed(2)+"</span>"})+"]"))}else if("removecc"==e.type)l=e.targetIsFriendly?0:1,a+=printActor(e.source,e.sourceInstance,e.sourceMarker,e.source.type,e.source.name,t,!0,"interrupts",l,!1,i),a+="'s <span style='color:#ff8'>",a+=e.cctype,a+="</span> fades from ",a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!1,"interrupts",l,!0,i);else if("applycc"==e.type){l=e.targetIsFriendly?0:1,a+=printActor(e.source,e.sourceInstance,e.sourceMarker,e.source.type,e.source.name,t,!0,"interrupts",l,!1,i),a+=" uses ",a+=printAbility(e.ability,t,"interrupts",l),a+=" on ",a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!1,"interrupts",l,!0,i);var C=Math.max(0,e.ia-e.iaRemoved),P=e.ia-C;P>0?(a+=", removing <span style='color:#ff8'>"+P+"</span> Interrupt Armor ",C>0&&(a+="(Remaining: <span style='color:#ff8'>"+C+"</span>) "),a+="and causing "):a+=", causing ",a+="<span style='color:#ff8'>"+e.cctype+"</span>",1==e.flags?a+=" (Does Not Stack)":2==e.flags&&(a+=" (Immune)")}else if("combatantinfo"==e.type){if(e.sourceID&&(e.source=r.actorTable[e.sourceID]),a+="<table cellspacing=0 cellpadding=0 width=100% style='display:inline-table'><tr><td style='min-width:200px; border:none; padding:0'>",a+=printActor(e.source,0,0,e.source.type,e.source.name,!1,!0,"summary",!1,!0,i)+"<br>",e.specID&&(a+="Spec ID: <span class=estimate>"+e.specID+"</span>"),!e.error){if(a+="<td width=100% style='border:none; padding-left:10px'>",0==game_id?(a+=printCombatantStatsForWarcraft(e),a+="<br>",e.talents&&e.talents.length&&(a+="<span style='display:inline-block; margin-top:4px'><span style='margin-right:5px;'>Talents: </span> ",a+=printCombatantTalents(e),a+="</span><br>")):2==game_id&&e.vitality&&(a+=printCombatantStatsForFF(e),a+="<br>"),e.gear&&e.gear.length&&(a+="<span style='display:inline-block; margin-top:4px'><span style='margin-right:5px'>Gear: </span> ",a+=printCombatantGear(e),a+="</span><br>"),0==game_id){var S=e.customPowerSet?e.customPowerSet:e.artifact;S&&S.length&&(a+="<span style='display:inline-block;margin-top:4px'><span style='margin-right:5px'>"+primaryCustomPowerName(e.expansion)+": </span> ",a+=printCombatantPowers(S),a+="</span><br>");var k=e.secondaryCustomPowerSet?e.secondaryCustomPowerSet:e.heartOfAzeroth;k&&k.length&&(a+="<span style='display:inline-block;margin-top:4px'><span style='margin-right:5px'>"+secondaryCustomPowerName(e.expansion)+": </span> ",a+=printCombatantPowers(k),a+="</span><br>");var A=e.tertiaryCustomPowerSet;A&&A.length&&(a+="<span style='display:inline-block;margin-top:4px'><span style='margin-right:5px'>"+tertiaryCustomPowerName(e.expansion)+": </span> ",a+=printCombatantPowers(A),a+="</span><br>")}a+="<span style='display:inline-block;",(0==game_id||4==game_id||2==game_id&&e.vitality)&&(a+="margin-top:4px"),a+="'><span style='margin-right:5px'>Buffs: </span> ",a+=printCombatantAuras(e),a+="</span></td>"}a+="</table>"}else"worldmarkerplaced"==e.type?(a+="<img width=12 height=12 src='"+icon_path+"markers/world"+e.icon+".png'> ",a+=" World Marker placed at ",a+=e.x/100+","+e.y/100):"worldmarkerremoved"==e.type?(a+="<img width=12 height=12 src='"+icon_path+"markers/world"+e.icon+".png'> ",a+=" World Marker removed"):"playerentercombat"==e.type?(e.playerID&&(e.player=r.actorTable[e.playerID]),e.player?a+=printActor(e.player,0,0,e.player.type,e.player.name,t,!0,"summary",0,!0,i):a+="The logging player",a+=" entered combat."):"playerexitcombat"==e.type?(e.playerID&&(e.player=r.actorTable[e.playerID]),e.player?a+=printActor(e.player,0,0,e.player.type,e.player.name,t,!0,"summary",0,!0,i):a+="The logging player",a+=" exited combat."):"wipecalled"==e.type?a+="The logging player called a wipe.":"mapchange"==e.type?a+='Map changed to <span style="color: #ff8">'+e.mapName+"</span>.":"limitbreakupdate"==e.type?a+="The limit break gauge updated to "+e.value+". There are "+e.bars+" total bars.":"targetabilityupdate"==e.type?(a+=printActor(e.target,e.targetInstance,e.targetMarker,e.target.type,e.target.name,t,!0,"damage",1,!0,i),e.targetable?a+=" becomes targetable.":a+=" becomes untargetable."):"instancesealupdate"==e.type?(a+="<span class='Boss'>"+e.placeName+"</span> ",1==e.sealType?a+="will be sealed off in 15 seconds.":2==e.sealType?a+=" is now sealed off.":3==e.sealType&&(a+=" is no longer sealed.")):a+="We don't understand how to parse this event yet. The type was: "+e.type;if(void 0!==e.pin){var $=e.pin.split("|");for(n=0;n<$.length;n++){var F=parseInt($[n]);pins[F]&&(a+="<span class='pin-square' style='background-color:"+pins[F].graphColor+"'></span>")}}return a+=printEventBuffs(e),a+="<br/>",t&&(a+="</span>"),a}function printEventBuffs(e){var t="";if(void 0!==e.buffs&&!comparisonReports.length){if(t+="<span class='events-view-buffs'>",e.multiplier&&1!=e.multiplier){var i=Math.round(100*(e.multiplier-1)),r="calculateddamage"==e.type||"damage"==e.type;t+="<span class='aura-multiplier-in-event'>",t+=(i<0?"-":"+")+"<span class='"+(r?i<0?e.targetIsFriendly?"kill":"wipe":e.targetIsFriendly?"wipe":"kill":i<0?e.targetIsFriendly?"wipe":"kill":e.targetIsFriendly?"kill":"wipe")+"'>"+i+"</span>% ",t+=r?"damage":"healing"}for(var a=e.buffs.split("."),n=0;n<a.length;++n)a[n]&&(t+=printIcon(aurasMap[a[n]],"events-view-icon")+" ");t+="</span>"}return t}function printCombatantStat(e,t,i){if(!t)return"";var r="";return r+=e+": <span class=estimate>"+t+"</span>",i||(r+=", "),r}function printCombatantGear(e){if(!e.gear||!e.gear.length)return"";for(var t="",i=0;i<e.gear.length;++i){var r=e.gear[i];if(0!=r.id){if(0==game_id){if(t+=" <a ",t+='rel="',r.gems){t+="gems=";for(var a=0;a<r.gems.length;++a)t+=r.gems[a].id+":";t+=";"}if(r.permanentEnchant&&(t+="ench="+r.permanentEnchant+";"),r.bonusIDs){t+="&bonus=";for(var n=0;n<r.bonusIDs.length;++n)t+=r.bonusIDs[n]+":";t+=";"}t+='"',t+=' href="'+itemExternalLink(r.id),t+='">'}t+="<img class='combatant-info-event-icon' ",r.name&&(t+="title='"+r.name+"' "),t+="src='"+fullPathForIcon(r.icon),4==game_id&&(t+=".png"),t+="'>",0==game_id&&(t+="</a>")}}return t}function printCombatantAuras(e){if(!e.auras||!e.auras.length)return"";for(var t="",i=0;i<e.auras.length;++i)0!=game_id&&5!=game_id||(t+=' <a href="'+buffExternalLink(e.auras[i].ability)+'">'),t+="<img class='combatant-info-event-icon' ",e.auras[i].name&&(t+="title='"+e.auras[i].name+"' "),t+="src='"+fullPathForIcon(e.auras[i].icon),4==game_id&&(t+=".png"),t+="'>",0!=game_id&&5!=game_id||(t+="</a>");return t}function printCombatantTalents(e){if(!e.talents||!e.talents.length)return"";var t="",i=-1,r="tbc"===e.expansion;r&&(t+="<span class='estimate'>");for(var a=0;a<e.talents.length;++a)++i,r?(i>0&&(t+=" / "),t+=e.talents[a].id):e.talents[a].id&&(t+=' <a href="'+abilityExternalLink(e.talents[a].id)+'">',t+="<img class='combatant-info-event-icon' src='"+fullPathForIcon(e.talents[a].icon)+"'>",t+="</a>");return r&&(t+="</span>"),t}function printCombatantPowers(e){if(!e||!e.length)return"";for(var t="",i=0;i<e.length;++i){var r=e[i];r.spellID&&(t+=' <a href="'+abilityExternalLink(r.spellID)+artifactRank(r)+'">',t+="<img class='combatant-info-event-icon' src='"+fullPathForIcon(r.icon)+"'>",t+="</a>")}return t}function printCombatantStatsForWarcraft(e){var t="";return t+=printCombatantStat("Str",e.strength),t+=printCombatantStat("Agi",e.agility),t+=printCombatantStat("Int",e.intellect),t+=printCombatantStat("Spirit",e.spirit),t+=printCombatantStat("Armor",e.armor),t+=printCombatantStat("Dodge",e.dodge),t+=printCombatantStat("Parry",e.parry),t+=printCombatantStat("Block",e.block),t+=printCombatantStat("CritM",e.critMelee),t+=printCombatantStat("CritR",e.critRanged),t+=printCombatantStat("CritS",e.critSpell),t+=printCombatantStat("Speed",e.speed),t+=printCombatantStat("Leech",e.leech),t+=printCombatantStat("HasteM",e.hasteMelee),t+=printCombatantStat("HasteR",e.hasteRanged),t+=printCombatantStat("HasteS",e.hasteSpell),t+=printCombatantStat("Avoidance",e.avoidance),t+=printCombatantStat("Mastery",e.mastery),t+=printCombatantStat("VersDmg",e.versatilityDamageDone),t+=printCombatantStat("VersHeal",e.versatilityHealingDone),t+=printCombatantStat("VersDR",e.versatilityDamageReduction,!0),t+=printCombatantStat("HitM",e.hitMelee),t+=printCombatantStat("HitR",e.hitRanged),(t+=printCombatantStat("HitS",e.hitSpell))+printCombatantStat("Expertise",e.expertise,!0)}function printCombatantStatsForFF(e){var t="";return t+=printCombatantStat("Str",e.strength),t+=printCombatantStat("Dex",e.dexterity),t+=printCombatantStat("Vit",e.vitality),t+=printCombatantStat("Int",e.intelligence),t+=printCombatantStat("Mnd",e.mind),t+=printCombatantStat("Pie",e.piety),t+=printCombatantStat("Atk",e.attack),t+=printCombatantStat("DH",e.directHit),t+=printCombatantStat("Crit",e.criticalHit),t+=printCombatantStat("Vit",e.vitality),t+=printCombatantStat("Det",e.determination),t+=printCombatantStat("SkS",e.skillSpeed),(t+=printCombatantStat("SpS",e.spellSpeed))+printCombatantStat("Ten",e.tenacity,!0)}function pushGraphEventInfo(e,t,i,r){if(!i||!i.length)return"";for(var a="",n=0;n<t.length;++n){var s=t[n][0];if(s>e)return a;if(!(s<e)){var o=i[n];if(null!=o.type||o.length)if(o.length)for(var l=0;l<o.length;++l)o[l].type&&(a+=printEvent(o[l],!0,r));else a+=printEvent(o,!0,r)}}return a}function pushGraphResourceInfo(e,t,i,r,a){if(!i||!i.length)return"";for(var n="",s=0;s<t.length;++s){var o=t[s][0];if(o>e)break;if(!(o<e)){var l=i[s],p=r[s];void 0!==l&&void 0!==p&&(n=l+" / "+p+"<br>")}}return""!=n&&(n="<span style='font-size:10px'>"+n+"</span>"),n}function setGraphStacking(e){if(chartData&&chart&&!hasPendingGraphRequests())for(i=0;i<chart.series.length;++i)!1!==chartData[i].showInLegend&&chart.series[i].update({stacking:e?"normal":null})}function updateAllGraphItems(e,t,r){if(e&&!hasPendingGraphRequests()){for(i=0;i<e.series.length;++i)e.series[i].visible==t||!r&&!1===e.series[i].options.showInLegend||(t?e.series[i].show():e.series[i].hide());if(e==chart)for(var a=0;pins&&a<pins.length;++a)pins[a].chart&&updateAllGraphItems(pins[a].chart,t,r)}}var replayVisibilityFilters=[];function updateGraphItemsByType(e,t,r){var a=!0;for(void 0===replayVisibilityFilters[r]?replayVisibilityFilters[r]=!1:(replayVisibilityFilters[r]=!replayVisibilityFilters[r],a=!replayVisibilityFilters[r]),a?$(e).removeClass("selected"):$(e).addClass("selected"),i=0;i<replaySeries.length;++i){var n=replaySeries[i],s=n.type;"Boss"!=s&&"NPC"!=s&&"Pet"!=s&&(s="Player"),r==s&&(a&&n.visible?n.visible=!1:a||n.visible||(n.visible=!0))}positionChart.getContext("2d").clearRect(0,0,positionChart.width,positionChart.height),updateAndRedrawPositionChart()}function toggleGraphEntry(e){if(chartData&&chart&&!hasPendingGraphRequests()){var t,i=!1;for(t=0;t<chartData.length;++t)if(chartData[t].id==e){i=!0;break}i&&(chart.series[t].visible?chart.series[t].hide():chart.series[t].show())}}function toggleTableSubentries(e){var t="#main-table-row-"+e,i=".parent-"+e;if($(t).hasClass("open")){$(t).removeClass("open");for(var r=0;r<$(i).length;++r){var a=$(i)[r];$(a).removeClass("visible"),$(a).hasClass("open")&&toggleTableSubentries(a.getAttribute("id").substr(15))}}else $(t).addClass("open"),$(i).addClass("visible")}function pushFightLineTooltipInfo(e,t,i){if(i&&i.length)for(var r=0;r<i.length;++r){var a=i[r],n=void 0===a.reportIndex?0:a.reportIndex,s=reportsCache[n],o=a.timestamp-s.filterFightStartTime,l=chart.xAxis[0].max-chart.xAxis[0].min,p=Math.max(chart.xAxis[0].min,o-l/100),d=Math.min(chart.xAxis[0].max,o+l/100);if(e>=p&&e<=d){var c=s.fights[a.fight-1],u=hashForBossAndDifficulty(c.boss,c.difficulty),h=reportsCache.bossHash[u],f='<span class="'+(c.kill?"kill":"wipe")+'" style="font-size:10px"><br/>'+fightNameAndDifficulty(h)+" "+outputFightDetails(c.boss,c.difficulty,c,!1)+"</span>";t.push(f)}}}function pushHeroismTooltipInfo(e,t,i){if(i&&i.length&&$("#toggle-heroism").hasClass("current"))for(var r=0;r<i.length;++r){var a=i[r],n=void 0===a.reportIndex?0:a.reportIndex,s=reportsCache[n],o=a.startTime-s.filterFightStartTime,l=a.endTime-s.filterFightStartTime;e>=o&&e<=l&&t.push('<span style="font-size:10px"><br/>['+printFightRelativeTimestamp(a.startTime,n,a.startEvent.fight)+'] <span style="color: '+setLineColorForActorFromType(a.startEvent.source.type)+'">'+a.startEvent.source.name+'</span> casts <span style="color: '+setLineColorForAbilityFromType(a.startEvent.ability.type,!0)+'">'+a.startEvent.ability.name+"</span>.</span>")}}function pushMooTooltipInfo(e,t,i){if(i&&i.length&&$("#toggle-moo").hasClass("current"))for(var r=0;r<i.length;++r){var a=i[r],n=void 0===a.reportIndex?0:a.reportIndex,s=reportsCache[n],o=a.startTime-s.filterFightStartTime,l=a.endTime-s.filterFightStartTime;e>=o&&e<=l&&t.push('<span style="font-size:10px"><br/>['+printFightRelativeTimestamp(a.startTime,n,a.startEvent.fight)+"]-["+printFightRelativeTimestamp(a.endTime,n,a.startEvent.fight)+'] Moment of Opportunity gained on <span style="color: '+setLineColorForActorFromType(a.startEvent.target.type)+'">'+a.startEvent.target.name+"</span></span>")}}function pushDowntimeTooltipInfo(e,t,i){}function pushGraphPinsTooltipInfo(e,t,i){if(i&&i.length)for(var r=0;r<i.length;++r)pushGraphPinTooltipInfo(e,t,i[r])}function pushGraphPinTooltipInfo(e,t,i){var r=!!i.lines,a=r?i.lines:i.bands;if(a&&a.length)for(var n=!0,s=0;s<a.length;++s){var o=a[s],l=0,p=0,d=void 0===o.reportIndex?0:o.reportIndex,c=reportsCache[d];if(r){var u=o.timestamp-c.filterFightStartTime,h=chart.xAxis[0].max-chart.xAxis[0].min;l=Math.max(chart.xAxis[0].min,u-h/100),p=Math.min(chart.xAxis[0].max,u+h/100),e>=l&&e<=p&&(n&&(t.push("<br>"),n=!1),t.push(printEvent(o,!0,d)))}else l=o.startTime-c.filterFightStartTime,p=o.endTime-c.filterFightStartTime,e>=l&&e<=p&&(n&&(t.push("<br>"),n=!1),o.startEvent&&t.push(printEvent(o.startEvent,!0,d)),o.endEvent&&t.push(printEvent(o.endEvent,!0,d)))}}function pushLineTooltipInfo(e,t,i,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(r&&r.length&&(!a||$("#toggle-"+i).hasClass("current")))for(var n=!1,s=0;s<r.length;++s){var o=r[s],l=void 0===o.reportIndex?0:o.reportIndex,p=reportsCache[l],d=o.timestamp-p.filterFightStartTime,c=chart.xAxis[0].max-chart.xAxis[0].min,u=Math.max(chart.xAxis[0].min,d-c/100),h=Math.min(chart.xAxis[0].max,d+c/100);e>=u&&e<=h&&(n?t.push(printEvent(o,!0,l)):(n=!0,t.push("<br>"+printEvent(o,!0,l))))}}function isValidDeathLine(e,t){return"players"==e&&"Boss"!=t&&"Pet"!=t&&"NPC"!=t&&"Unknown"!=t||"bosses"==e&&"Boss"==t||"npcs"==e&&"NPC"==t}function pushDeathTooltipInfo(e,t,i,r){if(i&&i.length&&$("#toggle-"+r).hasClass("current"))for(var a=!1,n=0;n<i.length;++n){var s=i[n];if(isValidDeathLine(r,s.target?s.target.type:"NPC")){var o=void 0===s.reportIndex?0:s.reportIndex,l=reportsCache[o],p=s.timestamp-l.filterFightStartTime,d=chart.xAxis[0].max-chart.xAxis[0].min,c=Math.max(chart.xAxis[0].min,p-d/100),u=Math.min(chart.xAxis[0].max,p+d/100);e>=c&&e<=u&&(a?t.push(printEvent(s,!0,o)):(a=!0,t.push("<br>"+printEvent(s,!0,o))))}}}function isArray(e){return"[object Array]"===Object.prototype.toString.call(e)}function splat(e){return isArray(e)?e:[e]}replayVisibilityFilters.Pet=!1;var heroismPlotBands=[],mooPlotBands=[],downtimePlotBands=[],combatRezPlotLines=[],iaPlotLines=[],fightPlotLines=[],wipeCallPlotLines=[],graphOptionsRequest=null;function graphOptionsChanged(){graphOptionsRequest=null}function graphOptionsChangeFailed(){graphOptionsRequest=null}function initializeGraphOptions(){$(".graph_option").removeClass("current"),1&graph_options&&($("#toggle-heroism").addClass("current"),$("#toggle-moo").addClass("current"),$("#toggle-downtime").addClass("current")),2&graph_options&&$("#toggle-players").addClass("current"),4&graph_options&&($("#toggle-combatrez").addClass("current"),$("#toggle-ia").addClass("current")),8&graph_options&&$("#toggle-bosses").addClass("current"),16&graph_options&&$("#toggle-npcs").addClass("current")}function storeUserOptions(){graphOptionsRequest&&graphOptionsRequest.abort();var e=-1==filterCutoff?filterCutoff:0;graphOptionsRequest=$.getJSON("/reports/set-options/"+graph_options+"/"+pin_options+"/"+e,graphOptionsChanged).fail(graphOptionsChangeFailed)}var bookmarksRequest=null;function bookmarkFinished(){bookmarksRequest=null,window.location.reload()}function addBookmark(e){bookmarksRequest&&bookmarksRequest.abort(),bookmarksRequest=$.getJSON("/reports/bookmark/"+e+"/",bookmarkFinished).fail(bookmarkFinished)}function removeBookmark(e){bookmarksRequest&&bookmarksRequest.abort(),bookmarksRequest=$.getJSON("/reports/unbookmark/"+e+"/",bookmarkFinished).fail(bookmarkFinished)}function togglePlotBands(e,t,i){var r=chart,a="#toggle-"+t;if(!$(a).hasClass("current")){for(var n=0;n<e.length;++n){r.xAxis[0].addPlotBand(e[n]);for(var s=0;pins&&s<pins.length;++s)pins[s].chart&&pins[s].chart.xAxis[0].addPlotBand(e[n])}return $(a).addClass("current"),graph_options|=i,void storeUserOptions()}for(r.xAxis[0].removePlotBand(t),s=0;pins&&s<pins.length;++s)pins[s].chart&&pins[s].chart.xAxis[0].removePlotBand(t);$(a).removeClass("current"),graph_options&=~i,storeUserOptions()}function togglePlotLines(e,t,i){var r=chart,a="#toggle-"+t;if(!$(a).hasClass("current")){for(var n=0;n<e.length;++n){r.xAxis[0].addPlotLine(e[n]);for(var s=0;pins&&s<pins.length;++s)pins[s].chart&&pins[s].chart.xAxis[0].addPlotLine(e[n])}return $(a).addClass("current"),graph_options|=i,void storeUserOptions()}for(r.xAxis[0].removePlotLine(t),s=0;pins&&s<pins.length;++s)pins[s].chart&&pins[s].chart.xAxis[0].removePlotLine(t);$(a).removeClass("current"),graph_options&=~i,storeUserOptions()}function createPlotBands(e,t,i,r,a){if(e&&e.length)for(var n="pins"!=t&&!$("#toggle-"+t).hasClass("current"),s=0;s<e.length;++s){var o=e[s],l=void 0===o.reportIndex?reportsCache[0]:reportsCache[o.reportIndex];o.startEvent&&o.startEvent.sourceID&&(o.startEvent.source=l.actorTable[o.startEvent.sourceID]),o.startEvent&&o.startEvent.targetID&&(o.startEvent.target=l.actorTable[o.startEvent.targetID]);var p={id:t,from:o.startTime-l.filterFightStartTime,to:o.endTime-l.filterFightStartTime,color:i,events:{click:function(e,t){return function(i){updateZoom(e,t)}}(o.startTime-l.filterFightStartTime,o.endTime-l.filterFightStartTime)}};"replay"==filterView||"heroism"!=t&&"moo"!=t||(p.zIndex=0),r&&r.push(p),n||a.push(p)}}function createPlotLines(e,t,i,r,a){if(e&&e.length)for(var n="pins"!=t&&"fightStartEvents"!=t&&"wipecalls"!=t&&!$("#toggle-"+t).hasClass("current"),s=0;s<e.length;++s){var o=e[s],l=void 0===o.reportIndex?reportsCache[0]:reportsCache[o.reportIndex];o.sourceID&&(o.source=l.actorTable[o.sourceID]),o.targetID&&(o.target=l.actorTable[o.targetID]);var p=i;"comparisonColor"==i&&(p=comparisonColor(void 0===o.reportIndex?0:o.reportIndex));var d={id:t,width:1,value:o.timestamp-l.filterFightStartTime,zIndex:5,color:p};("combatrez"==t||"ia"==t||"pins"==t||"fightStartEvents"==t||"wipecalls"==t||isValidDeathLine(t,o.target?o.target.type:""))&&(r&&r.push(d),n||a.push(d))}}function isDamageFilterType(){return"damage-done"==filterType||"damage-taken"==filterType}function isDamageOrHealingFilterType(){return isDamageFilterType()||"healing"==filterType}function setDefaultChartLineColor(e,t){chartLineColor="damage-done"==e?"#84BDF8":"damage-taken"==e||"threat"==e?"#F84D44":"healing"==e||"auras"==e&&"buffs"==filterSpellType?"#84f8bd":0==t&&"auras"!=e?"#84BDF8":"#F84D44"}var pinErrorGraphHTML="<div id='pin-graph-error' style='text-align:center; margin-top:50px;'><p>Separate graphs are still being implemented. For now, change the graph type to Main to view the pin in the primary graph.</p></div>";function initPinGraphFailed(e){return function(){$("#pin-graph-"+e).html(pinErrorGraphHTML),pins[e].graphRequest=null}}var graphMaximized=!1,graphMinimized=!1;function toggleGraphMaximize(){graphMaximized=!graphMaximized,graphMinimized=!1,$("#graph-minimizer").removeClass("zmdi-window-restore"),$("#graph-minimizer").addClass("zmdi-window-minimize"),$("#graph-wrapper").removeClass("minimized"),graphMaximized?($("#graph-wrapper").addClass("maximized"),$("#graph-maximizer").removeClass("zmdi-window-maximize"),$("#graph-maximizer").addClass("zmdi-window-restore")):($("#graph-wrapper").removeClass("maximized"),$("#graph-maximizer").removeClass("zmdi-window-restore"),$("#graph-maximizer").addClass("zmdi-window-maximize")),chart.reflow()}function toggleGraphMinimize(){graphMinimized=!graphMinimized,graphMaximized=!1,$("#graph-maximizer").addClass("zmdi-window-maximize"),$("#graph-maximizer").removeClass("zmdi-window-restore"),$("#graph-wrapper").removeClass("maximized"),graphMinimized?($("#graph-wrapper").addClass("minimized"),$("#graph-minimizer").removeClass("zmdi-window-minimize"),$("#graph-minimizer").addClass("zmdi-window-restore")):($("#graph-wrapper").removeClass("minimized"),$("#graph-minimizer").removeClass("zmdi-window-restore"),$("#graph-minimizer").addClass("zmdi-window-minimize")),chart.reflow()}function singleTypeForPin(e){for(var t=0;t<e.components.length;++t){var i=e.components[t];if(void 0===i.auraPresence){var r=i.type;return"damage"==r&&(r="damage-done"),r}}return"any"}function singleHostilityForPin(e){for(var t=0;t<e.components.length;++t){var i=e.components[t];if(void 0===i.auraPresence&&i.hostility>=0)return i.hostility}return-1}function initPinGraph(e){return function(t,i,r){if(pins[e].graphRequest=null,!0===t.error)return initPinGraphFailed(e)();for(var a=0,n=0;n<(null!==(s=null==t||null===(o=t.series)||void 0===o?void 0:o.length)&&void 0!==s?s:0);++n){var s,o;if("Total"!=t.series[n].type&&++a>1)break}var l=singleTypeForPin(pins[e]),p="source",d=!1,c=!1;"auras-gained"!=l&&"auras-cast"!=l||("auras-cast"==(l="auras")&&(p="target"),d=!0,c=!0,$("#pin-graph-"+e).css("height","60px")),initGraphFromData(pins[e],"pin-graph-"+e,!1,c,l,p,1==a,!1,d,singleHostilityForPin(pins[e]),0,pins[e].graphColor,t)}}function initGraphAtIndex(e){return function(t,i,r){if(t.processing)return initGraphProcessing();reportsCache[e].graphRequest=null,reportsCache[e].graphJSONData=t;for(var a=0;a<reportsCache.length;++a)if(reportsCache[a].graphRequest)return;"replay"==filterView||hideGraphLoadElements(),initGraphFromData(null,"graph","replay"==filterView,"replay"==filterView,filterType,subFilterType,0!=filterSource,0!=filterTarget,0!=filterAbility,hostilityType,filterOptions,void 0,reportsCache[0].graphJSONData)}}function isDamageDataType(e){return"damage-done"==e||"damage-taken"==e}function isDamageOrHealingDataType(e){return isDamageDataType(e)||"healing"==e}function collectSeriesData(){if(!comparisonReports.length)return reportsCache[0].graphJSONData.series;for(var e=new Array,t=0;t<reportsCache.length;++t){var i=reportsCache[t];if(i.graphJSONData&&i.graphJSONData.series){for(var r=0;r<i.graphJSONData.series.length;++r){var a=i.graphJSONData.series[r];if(void 0===a.originalType){a.reportIndex=t,a.originalType=a.type;var n=a.id;void 0===n&&(n=a.guid),a.id=n+"-"+t;var s=0==t?report_name:comparisonReports[t-1].name;i.filterSource&&"resources"!=filterType&&(s=buildActorName(i.filterSource,i.filterSourceInstanceID,t)),a.name+=" ("+s+")"}else a.type=a.originalType,a.alreadyCollected=!0}e=e.concat(i.graphJSONData.series)}}return e}function minXAxisValue(){for(var e=-1,t=0;t<reportsCache.length;++t){var i=reportsCache[t],r=i.graphJSONData,a=(r&&r.startTime?r.startTime:i.fightSegmentStartTime)-i.filterFightStartTime;(-1==e||a<e)&&(e=a)}return e}function maxXAxisValue(){for(var e=-1,t=0;t<reportsCache.length;++t){var i=reportsCache[t],r=i.graphJSONData,a=(r&&r.endTime?r.endTime:i.fightSegmentEndTime)-i.filterFightStartTime;(-1==e||a>e)&&(e=a)}return e}function comparisonColor(e){var t=["rgb(80,149,169)","rgb(169,89,169)","rgb(169,169,80)","rgb(120,160,140)"];return t[e%t.length]}function createFightEndPlotLines(e){for(var t=0;t<reportsCache.length;++t){var i=reportsCache[t];if(i.graphURL){var r={id:"fight-end-"+t,width:1,dashStyle:"ShortDash",value:i.filterFightEndTime-(i.filterFightsArray.length?i.filterFightStartTime:0),zIndex:5,color:comparisonColor(t)};e.push(r)}}}function collectPlotBandsAndLines(e){if(!comparisonReports.length)return reportsCache[0].graphJSONData?reportsCache[0].graphJSONData[e]:null;for(var t="graphpins"==e,i=new Array,r=0;r<reportsCache.length;++r){var a=reportsCache[r];if(a.graphJSONData){var n=a.graphJSONData[e];if(n&&n.length){for(var s=0;s<n.length;++s)if(t){if(n[s].lines)for(var o=0;o<n[s].lines.length;++o)n[s].lines[o].reportIndex=r;else if(n[s].bands)for(o=0;o<n[s].bands.length;++o)n[s].bands[o].reportIndex=r}else n[s].reportIndex=r;i=i.concat(n)}}}return i}function initGraphFromData(e,t,i,r,a,n,s,o,l,p,d,c,u){var h=firstCacheWithDefinedFightID(),f=0!=(8&d)&&"healing"==a||0!=(4096&d)&&"damage-taken"==a,m="auras"!=a||l||"ability"==n?a:"summary",g="threat"===m,y=g&&!hasThreatDetails(),b=g&&hasThreatDetails(),v=!f&&("auras"==m||y||(isDamageOrHealingDataType(a)||b)&&("target"!=n&&s||"target"==n&&((0!=h||-1!=filterBoss)&&(isDamageDataType(a)||b)||o)||"ability"==n&&l)),T=!v||e||!comparisonReports.length;("resources"==m&&comparisonReports.length||"deaths"==m&&1==p)&&(T=!1),T||(v=!1);var w="auras"!=m&&!y&&v;setDefaultChartLineColor(a,p);var x=i?[]:e?u.series:collectSeriesData();if(x&&x.length||"resources"!=a){var I=!1;w||!isDamageOrHealingDataType(a)&&"casts"!=m&&"summons"!=m&&"interrupts"!=m&&"dispels"!=m?"deaths"!=m&&x.sort(sortGraphSeries):(x.sort(sortGraphSeriesByTotal),I=!0);var C=[],P=[],S=[],k=[],A=[],F=[],M=[],E=[],D=[],R=[],_=[],B=collectPlotBandsAndLines("fightStartEvents");if(createPlotLines(B,"fightStartEvents","comparisonColor",fightPlotLines,S),"auras"!=m&&!y&&(k=collectPlotBandsAndLines("heroism"),A=collectPlotBandsAndLines("moo"),F=collectPlotBandsAndLines("combatrezzes"),iaRemovalData=collectPlotBandsAndLines("iaremoval"),E=collectPlotBandsAndLines("deaths"),D=collectPlotBandsAndLines("graphpins"),R=collectPlotBandsAndLines("downtime"),_=collectPlotBandsAndLines("wipeCalledEvents"),createPlotBands(k,"heroism","rgba(20, 20, 80, 1)",heroismPlotBands=[],P),createPlotBands(A,"moo","rgba(80, 20, 80, 1)",mooPlotBands=[],P),createPlotBands(R,"downtime","rgba(40, 20, 40, 1)",downtimePlotBands=[],P),createPlotLines(F,"combatrez","rgb(100%, 49%, 4%)",combatRezPlotLines=[],S),createPlotLines(M,"ia","rgb(100%, 49%, 4%)",iaPlotLines=[],S),playerDeathPlotLines=[],createPlotLines(E,"players","#A00000",playerDeathPlotLines,S),bossDeathPlotLines=[],createPlotLines(E,"bosses","#008000",bossDeathPlotLines,S),creatureDeathPlotLines=[],createPlotLines(E,"npcs","#A000A0",creatureDeathPlotLines,S),wipeCalledPlotLines=[],createPlotLines(_,"wipecalls","rgb(90%, 50%, 40%)",wipeCalledPlotLines,S),!e&&D&&D.length))for(var L=0;L<D.length;++L)D[L].lines?createPlotLines(D[L].lines,"pins",D[L].color,null,S):D[L].bands&&createPlotBands(D[L].bands,"pins",D[L].color,null,P);comparisonReports.length&&createFightEndPlotLines(S);for(var O=0;O<x.length;O++){v&&"Total"==x[O].type&&(x[O].showInLegend=!1);var U=!1;void 0===x[O].id&&(x[O].id=x[O].guid);var z=e?e.chartData:chartData;if(z)for(L=0;L<z.length;L++)if(z[L].id&&z[L].id==x[O].id){x[O].visible=z[L].visible,x[O].color=s&&c?c:z[L].color,x[O].dashStyle=z[L].dashStyle,U=!0;break}w?(z||("Total"==x[O].type?x[O].color=chartLineColor:s&&c&&(x[O].color=c)),U||(x[O].visible="Total"!=x[O].type)):(z&&U||(("casts"!=m&&"summons"!=m||"ability"!=n)&&(void 0!==x[O].reportIndex&&"Total"==x[O].type?x[O].color=comparisonColor(x[O].reportIndex):T&&(!y||"Boss"!=x[O].type&&"NPC"!=x[O].type)&&(x[O].color=s&&c?c:"casts"==m||"interrupts"==m||"dispels"==m||"summons"==m||"auras"==m||y||"ability"!=n?setLineColorForActorFromType(x[O].type):setLineColorForAbilityFromType(x[O].type,!0))),v||!T||void 0!==x[O].reportIndex&&"Total"==x[O].type||(x[O].dashStyle=setLineStyleFromType(C,x[O].type)),"resources"==m||"summons"==m||"casts"==m?x[O].visible=O<=("casts"==m?0:2)||"Total"==x[O].type:x[O].visible||(x[O].visible="auras"==m&&("ability"==n||v&&"Total"!=x[O].type)||"threat"==m||"casts"==m||"summons"==m||"interrupts"==m||"dispels"==m||(!v||"auras"!=m)&&"Total"==x[O].type||"deaths"==m||"summary"==m)),i||"Total"!=x[O].type||"auras"==m||"casts"==m||"summons"==m||"interrupts"==m||"dispels"==m||y||(x[O].yAxis=1))}I&&x.sort(sortGraphSeries);var V=minXAxisValue(),H=maxXAxisValue();for(O=0;O<x.length;O++){x[O].type=w&&"Total"!=x[O].type?"areaspline":"spline",f&&(x[O].type="areasplinerange");var W=void 0===x[O].reportIndex?reportsCache[0]:reportsCache[x[O].reportIndex];if("deaths"==m||"auras"==m||"resources"==m||"casts"==m||"summons"==m||"interrupts"==m||"dispels"==m||"threat"==m){if(x[O].type="casts"==m||"summons"==m||"interrupts"==m||"dispels"==m||"deaths"==m&&!filterDeath?"column":v?"area":"line",x[O].step=!0,("auras"==m||y)&&(x[O].fillOpacity=.25),W.filterFightsArray.length&&!x[O].alreadyCollected)for(L=0;L<x[O].data.length;++L)x[O].data[L][0]-=W.filterFightStartTime;"column"==x[O].type&&(x[O].data.unshift([V-1e5,0]),x[O].data.push([H+1e5,0]),x[O].events&&(x[O].events.push({}),x[O].events.unshift({})))}else W.filterFightsArray.length&&!x[O].alreadyCollected&&(x[O].pointStart-=W.filterFightStartTime)}e?e.chartData=x:chartData=x;var N="";switch(m){case"damage-done":N=0==(512&filterOptions)||0!=hostilityType||e?"DPS":"WDPS";break;case"damage-taken":N=f&&!e?"Raw DTPS":0==(128&filterOptions)||e?"DTPS":"EHRPS";break;case"healing":N=f&&!e?"Raw HPS":"HPS";break;case"deaths":N=filterDeath?"Hit Points":"Death Window (ms)";break;case"threat":N=b?"Threat":0==hostilityType?"Number of Enemies":"Number of Friendlies";break;case"summary":N="Per Second Amount";break;case"auras":N="Stacks";break;case"casts":case"interrupts":N="Time Spent Casting (ms)";break;case"dispels":N="Time Until Dispel (ms)";break;case"summons":N="Summon or Creation";break;case"resources":N="Amount"}i&&(N="");var G={type:"datetime",title:{text:null},events:{afterSetExtremes:chartZoomed},ordinal:!1,plotBands:P,plotLines:S,dateTimeLabelFormats:{day:h?"%M:%S":"%H:%M",millisecond:h?"%M:%S.%L":"%H:%M:%S.%L",second:h?"%M:%S":"%H:%M:%S",minute:h?"%M:%S":"%H:%M:%S",hour:"%H:%M"}},q={title:{text:N},min:0,allowDecimals:"summary"==m||isDamageOrHealingDataType(a),endOnTick:!i,tickPixelInterval:50},X=i||w||!isDamageOrHealingDataType(a)?{}:{title:{text:""},min:0,opposite:!0,allowDecimals:isDamageOrHealingDataType(a)};"deaths"==m&&filterDeath||(G.minRange=3e3,G.min=V,G.max=H);var Y={allowPointSelect:!1,animation:!1};if(r&&(G.lineWidth=0,G.minorGridLineWidth=0,G.lineColor="transparent",G.labels={enabled:!1},G.minorTickLength=0,G.tickLength=0,q.lineWidth=0,q.minorGridLineWidth=0,q.lineColor="transparent",q.labels={enabled:!1},q.minorTickLength=0,q.tickLength=0,q.gridLineColor="transparent",i)){var j={showInLegend:!1,type:"line",color:"transparent",dataGrouping:{enabled:!1},grouping:!1,pointStart:G.min,pointInterval:1e3,data:[]};x.push(j);for(var J=fightSegmentStartTime;J<fightSegmentEndTime;J+=1e3)j.data.push(0)}$((function(){var a=new Highcharts.StockChart({chart:{renderTo:t,zoomType:"deaths"==m&&filterDeath?"":"x",pinchType:"none",panning:!1,spacingRight:r?0:10,spacingLeft:0,borderWidth:0,spacingTop:r?0:15,spacingBottom:r?0:10,events:{load:function(e){("casts"==m||"summons"==m||"interrupts"==m||y||"dispels"==m||"deaths"==m&&!filterDeath||"auras"==m&&v||w||f)&&$(".highcharts-legend-item rect").attr("height","2").attr("y","10")}}},navigator:{enabled:!1},scrollbar:{enabled:!1},rangeSelector:{buttons:[],inputEnabled:!1,enabled:!i},title:{text:null},xAxis:G,yAxis:[q,X],tooltip:{enabled:i||!r,followPointer:!0,useHTML:!0,shared:!w&&"auras"!=m&&"casts"!=m&&"summons"!=m&&"interrupts"!=m&&"dispels"!=m&&"summary"!=m&&!y,valueDecimals:"deaths"==m||"auras"==m||"casts"==m||"summons"==m||"interrupts"==m||"dispels"==m||y?0:1,pointFormat:"<span style='font-size:10px'><span style='color:{series.color}'>{series.name}</span>: <b>{point.y}</b><br/></span>",xDateFormat:filterFightsArray.length?"%M:%S":"%H:%M:%S",borderRadius:0,formatter:function(){if(i)return"<span style='font-size:10px'>"+makeSmartDuration(Math.floor(this.x/1e3))+"</span>";var t=this.points||splat(this),r=t[0].series,a=new Array,n="<span style='color:#ff8;'>"+[r.tooltipHeaderFormatter(t[0])]+"</span>",s=new Array,o=!1;return $.each(t,(function(t,i){var a=(r=i.series).tooltipFormatter&&r.tooltipFormatter(i)||i.point.tooltipFormatter(r.tooltipOptions.pointFormat),n="",l="";if("deaths"==m||"auras"==m||"resources"==m||"casts"==m||"summons"==m||"interrupts"==m||"dispels"==m||"threat"==m){var p=e?e.chart:chart,d=e?e.chartData:chartData;t=p.series.indexOf(r),d&&"resources"==m&&void 0!==d[t].currentValues&&(""!=(l=pushGraphResourceInfo(this.x,d[t].data,d[t].currentValues,d[t].maxValues,d[t].reportIndex))?a="":o=!0),d&&(n=pushGraphEventInfo(this.x,d[t].data,d[t].events,d[t].reportIndex)),""!=n?a="":o=!0}else o=!0;s+=a+l+n})),o&&a.push(n),a.push(s),"auras"==m||y||(pushHeroismTooltipInfo(this.x,a,k),pushMooTooltipInfo(this.x,a,A),pushDowntimeTooltipInfo(this.x,a,R),pushLineTooltipInfo(this.x,a,"combatrez",F),pushLineTooltipInfo(this.x,a,"ia",M),pushLineTooltipInfo(this.x,a,"wipecalls",_,!1),"deaths"!=m&&pushDeathTooltipInfo(this.x,a,E,"players"),pushDeathTooltipInfo(this.x,a,E,"bosses"),pushDeathTooltipInfo(this.x,a,E,"npcs"),e||pushGraphPinsTooltipInfo(this.x,a,D)),pushFightLineTooltipInfo(this.x,a,B),a.join("")}},legend:{enabled:!0,align:"center",verticalAlign:"top",backgroundColor:"transparent",borderWidth:0,y:r?0:-17,floating:!0},plotOptions:{spline:{allowPointSelect:!0,animation:!1},areaspline:{allowPointSelect:!0,stacking:"normal",animation:!1},areasplinerange:{allowPointSelect:!0,animation:!1},area:Y,column:{allowPointSelect:!0,pointWidth:8,grouping:!1,minPointLength:20,borderWidth:1,borderColor:"#eeeeee",pointRange:1,dataGrouping:{enabled:!1}},line:Y},series:x,credits:{enabled:!1}});e?e.chart=a:chart=a})),i&&replayLoaded&&updateReplayPlotLine()}else $("#"+t).html("<div id='graph-error'><p>The selected resource is not available for the current character filter. Try selecting a different character or resource value.<br>")}var errorHTML="<div style='text-align:center; margin-top:30px'><p>Error: Unable to fetch data.</p></div>",errorGraphHTML="<div id='graph-error'><p>Error: Unable to generate a chart.</p></div>",processingGraphHTML="<div id='graph-error'><p>This report is currently being processed by the server.</p></div>",replayRequests=[],showOneNumber=!0;function primaryCustomPowerName(e){return"shadowlands"==e?"Soulbind Powers":"bfa"==e?"Azerite Powers":"Artifact"}function secondaryCustomPowerName(e){return"shadowlands"==e?"Conduit Powers":"Essence Powers"}function tertiaryCustomPowerName(e){return"Anima Powers"}function artifactRank(e){return logVersion>=12?"":"?rank="+(e.rank-1)}function generateResourceRow(e,t,i){var r=e>=1e3;if(!r&&e<1e3)for(var a=0;a<reportsCache.length;++a){var n=reportsCache[a];if(n.deathsOrResourcesData&&n.deathsOrResourcesData.resources){for(var s=0;s<n.deathsOrResourcesData.resources.length;++s)if(n.deathsOrResourcesData.resources[s]==e){r=!0;break}if(r)break}}return r?'<a href="#" id="spell-'+e+'"'+'onclick="return selectSpellAbility('+e+', this)" class="spell-row '+i+'">'+t+'</span><span class="zmdi zmdi-plus" style="float:right; color:white; position:relative; top:2px; left:3px" onclick="event.stopPropagation(); return addPinWithResourceType('+e+')"></span></a>':""}function generateResourceTable(){var e="";return 0==game_id?(e+=generateResourceRow(1e3,$("#resource-option-1000").html(),"estimate"),e+=generateResourceRow(1001,$("#resource-option-1001").html(),"school-1"),e+=generateResourceRow(1002,$("#resource-option-1002").html(),"school-8"),logVersion<7?e+=generateResourceRow(1003,"Resolve","school-32"):logVersion>=11&&(e+=generateResourceRow(1003,$("#resource-option-1003").html(),"school-32")),logVersion>=16&&(e+=generateResourceRow(1004,$("#resource-option-1004").html(),"school-1024")),e+=generateResourceRow(100,$("#resource-option-100").html(),"Mage"),e+=generateResourceRow(101,$("#resource-option-101").html(),"Warrior"),e+=generateResourceRow(102,$("#resource-option-102").html(),"Hunter"),e+=generateResourceRow(103,$("#resource-option-103").html(),"Rogue"),logVersion>=7&&(e+=generateResourceRow(104,$("#resource-option-104").html(),"Rogue"),e+=generateResourceRow(105,$("#resource-option-105").html(),"DeathKnight")),e+=generateResourceRow(106,$("#resource-option-106").html(),"DeathKnight"),e+=generateResourceRow(107,$("#resource-option-107").html(),"Warlock"),e+=generateResourceRow(108,logVersion>=7?$("#resource-option-108").html():$("#resource-option-108").attr("oldname"),"Druid"),e+=generateResourceRow(109,$("#resource-option-109").html(),"Paladin"),e+=generateResourceRow(111,$("#resource-option-111").html(),"Shaman"),e+=generateResourceRow(112,$("#resource-option-112").html(),"Monk"),e+=generateResourceRow(113,logVersion>=7?$("#resource-option-113").html():$("#resource-option-113").attr("oldname"),"Priest"),e+=generateResourceRow(114,$("#resource-option-114").html(),"school-4"),e+=generateResourceRow(115,$("#resource-option-115").html(),"Warlock"),logVersion>=7&&(e+=generateResourceRow(116,$("#resource-option-116").html(),"Mage"),e+=generateResourceRow(117,$("#resource-option-117").html(),"DemonHunter"),e+=generateResourceRow(118,$("#resource-option-118").html(),"DemonHunter")),e+=generateResourceRow(110,$("#resource-option-110").html(),"Boss")):1==game_id?(e+=generateResourceRow(1e3,"Hit Points","estimate"),e+=generateResourceRow(1001,"Shields","Mage"),e+=generateResourceRow(1002,"Absorbs","Druid"),e+=generateResourceRow(1003,"Interrupt Armor","Warlock"),e+=generateResourceRow(1004,"Assault Power","school-1"),e+=generateResourceRow(1005,"Support Power","school-8"),e+=generateResourceRow(100,"Focus","Stalker"),e+=generateResourceRow(101,"Actuators","Medic"),e+=generateResourceRow(102,"Kinetic Energy","WSWarrior"),e+=generateResourceRow(103,"Psi Points","Esper"),e+=generateResourceRow(104,"Suit Power","Stalker"),e+=generateResourceRow(105,"Spell Power","Spellslinger"),e+=generateResourceRow(106,"Volatility","Engineer")):2==game_id?(e+=generateResourceRow(1e3,$("#resource-option-1000").html(),"estimate"),e+=generateResourceRow(1001,$("#resource-option-1001").html(),"Mage"),e+=generateResourceRow(1002,$("#resource-option-1002").html(),"school-1"),e+=generateResourceRow(1003,$("#resource-option-1003").html(),"school-64")):3==game_id?(e+=generateResourceRow(1e3,"Hit Points","estimate"),e+=generateResourceRow(1004,"Absorption","Primalist"),e+=generateResourceRow(1001,"Mana","Mage"),e+=generateResourceRow(1002,"Energy","Rogue"),e+=generateResourceRow(100,"Power","Warrior"),e+=generateResourceRow(101,"Combo Points","Rogue"),e+=generateResourceRow(102,"Charge","Mage"),e+=generateResourceRow(1003,"Planar","school-64")):4==game_id?(e+=generateResourceRow(1e3,$("#resource-option-1000").html(),"Nightblade"),e+=generateResourceRow(1001,$("#resource-option-1001").html(),"school-1024"),e+=generateResourceRow(100,$("#resource-option-100").html(),"school-64"),e+=generateResourceRow(101,$("#resource-option-101").html(),"school-8"),e+=generateResourceRow(102,$("#resource-option-102").html(),"school-16"),e+=generateResourceRow(103,$("#resource-option-103").html(),"school-32")):5==game_id&&(e+=generateResourceRow(100,$("#resource-option-100").html(),"SithSorcerer"),e+=generateResourceRow(101,$("#resource-option-101").html(),"JediGuardian"),e+=generateResourceRow(102,$("#resource-option-102").html(),"JediSentinel"),e+=generateResourceRow(103,$("#resource-option-103").html(),"Scoundrel"),e+=generateResourceRow(104,$("#resource-option-104").html(),"school-8")),e}function initResourcesMenuAtIndex(e){return function(t,i){reportsCache[e].deathsOrResourcesRequest=null,reportsCache[e].deathsOrResourcesData=t;for(var r=0;r<reportsCache.length;++r)if(reportsCache[r].deathsOrResourcesRequest)return;var a=generateResourceTable();if($("#filter-resource-selection-container").html(a),!filterSpell)return initGraphFailed(),document.getElementById("view-tabs-and-table-container").style.opacity="",$("#graph").html("<div id='graph-error'><p>No resource selected.</p></div>"),void("events"!=filterView?$("#table-container").html("<div style='text-align:center; margin-top:30px'><p>Select a specific resource from the list on the left to view information about that resource on the graph.<p></div>"):loadTableOrEvents());$("#filter-resource-selection-text").html($("#spell-"+filterSpell).text()),loadGraph(),loadTableOrEvents()}}function selectSpellAbility(e,t){if(filterSpell==e)return!1;var i=$.deparam.fragment();return e==defaultFilterSpell()?delete i.spell:i.spell=e,t?changeLink(t,i):changeView(i)}function changeSpellType(e){if(e!=filterSpellType){var t=$.deparam.fragment();return delete t.spell,"buffs"==e?delete t.spells:t.spells=e,changeView(t)}}function initDeathsOrResourcesFailed(e,t,i){abortPendingdeathsOrResourcesRequests(),document.getElementById("view-tabs-and-table-container").style.opacity="",document.getElementById("table-container").innerHTML=errorHTML,initGraphFailed()}function abortPendingTableRequests(){for(var e=0;e<reportsCache.length;++e){var t=reportsCache[e];t.tableRequest&&(t.tableRequest.abort(),t.tableRequest=null,t.tableURL="",t.tableData="")}}function abortPendingdeathsOrResourcesRequests(){for(var e=0;e<reportsCache.length;++e){var t=reportsCache[e];t.deathsOrResourcesRequest&&(t.deathsOrResourcesRequest.abort(),t.deathsOrResourcesRequest=null,t.deathsOrResourcesData="")}}function initEventsViewFailed(){document.getElementById("view-tabs-and-table-container").style.opacity="",document.getElementById("table-container").innerHTML=errorHTML,abortPendingTableRequests()}function nextPageLink(e,t,i){if(!e)return"";var r="followNextPageLink(this, "+e+","+(t?"true":"false")+","+i+")";return'<div><a href="#" id="next-page-link" onclick="return '+r+'" oncontextmenu="'+r+'">'+trans("events.next_page")+" &gt;</a></div>"}function firstPageLink(e,t){var i="followNextPageLink(this, "+reportsCache[t].fightSegmentStartTime+","+(e?"true":"false")+","+t+")";return'<div><a href="#" id="first-page-link" onclick="return '+i+'" oncontextmenu="'+i+'">'+trans("events.first_page")+"</a></div>"}function iconForAbility(e){return fullPathForIcon((e.image?e.image:e.abilityIcon?e.abilityIcon:e.icon)+(3==game_id||4==game_id?".png":""))}function iconForItem(e){return fullPathForIcon(e.icon)}function addCooldownsInfoForDeath(e,t){var i='<div class="dialog-block ui-widget-content" style="clear:both; background-color:black !important;margin-top:1em">';i+='<table cellspacing="0" class="summary-table cooldowns-table" style="width:100%;margin-bottom:1em"><thead><tr><th>Survival Ability<th style="width:120px">Last Usage</tr></thead><tbody>';for(var r=0;r<e.length;++r){var a=e[r];i+="<tr><td><img class='table-icon' src='"+iconForAbility(a)+"'> "+printAbility(a,!1,"auras",0);var n="-"+(a.total/1e3).toFixed(2)+"s";i+="<td class='main-table-number'>"+(-1==a.total?"None":n)}return i+"<tbody></table></div>"}function toggleDeathHealRow(e,t){var i=$(e);i.hasClass("closed")?(i.removeClass("closed"),i.addClass("open"),$(".death-heal-group-"+t).removeClass("hidden")):(i.removeClass("open"),i.addClass("closed"),$(".death-heal-group-"+t).addClass("hidden"))}function buildListEventsView(e,t,i,r,a,n){if(!t.length)return buildListEventsViewForEvents(e,t,i,r,-1,-1,void 0,a,n);if(void 0===t[0].fight)return buildListEventsViewForEvents(e,t,i,r,0,t.length-1,void 0,a,n);var s,o=0,l=t[0].fight,p="";for(s=0;s<t.length;++s){var d=t[s];d.fight!==l&&(p+=buildListEventsViewForEvents(e,t,i,r,o,s-1,l,a,n),l=d.fight,o=s)}return o<t.length&&(p+=buildListEventsViewForEvents(e,t,i,r,o,t.length-1,l,a,n)),p}function shouldIncludeEventInTable(e,t,i){return!!e&&!(!t&&"casts"==filterType&&"begincast"==e.type&&0==(1&i)&&e.castSuccessful)&&(2!=game_id||"absorbed"!=e.type||e.amount>0)}jQuery.extend(jQuery.fn.dataTableExt.oSort,{"num-html-pre":function(e){var t=e.replace(/<(?:.|\s)*?>/g,""),i=t.indexOf("$");return-1!=i&&(t=t.substring(0,i)),t=t.replace(/,/g,""),parseFloat(t)},"num-html-asc":function(e,t){return e<t?-1:e>t?1:0},"num-html-desc":function(e,t){return e<t?1:e>t?-1:0}}),jQuery.extend(jQuery.fn.dataTableExt.oSort,{"formatted-num-pre":function(e){return e="-"===e?0:e.replace(/[^\d\-\.]/g,""),parseFloat(e)},"formatted-num-asc":function(e,t){return e-t},"formatted-num-desc":function(e,t){return t-e}});var childEventsCache=[];function buildListEventsViewForEvents(e,t,i,r,a,n,s,o,l){var p="",d=void 0===i?0:i;if(void 0!==s){var c=(e=reportsCache[d]).fights[s-1],u=hashForBossAndDifficulty(c.boss,c.difficulty),h=reportsCache.bossHash[u];p+='<div class="event-view-mini-header"><a class="'+(c.kill?"kill":"wipe")+'" href="#" onclick="changeFightByIDAndIndex('+c.id+", "+c.reportIndex+', this, false)">'+fightNameAndDifficulty(h)+" "+outputFightDetails(c.boss,c.difficulty,c,!1)+'</a></div><div class="event-view-events-box">'}var f="text"!==o&&(r||"resources"==filterType&&1e3==filterSpell||"damage-taken"==filterType),m="text"!==o&&(f||"casts"==filterType||"summons"==filterType||"auras"==filterType||"interrupts"==filterType||"dispels"==filterType||"resources"==filterType||"deaths"==filterType||"threat"==filterType),g=m&&"resources"==filterType,y=1;return p+="<table cellspacing='0' class='summary-table events-table "+("text"==o?"events-text-view ":"events-grid-view")+"' style='width:100%;'><thead><tr><th>"+trans("events.time"),m?(p+="<th class='event-type-cell'>"+trans("events.type")+"<th class='event-ability-cell'>"+trans("events.ability"),y+=2,(f||g)&&(p+="<th>"+trans("events.amount"),y++,f&&(p+="<th>"+trans("events.hp"),y++)),p+="<th class='event-source-target-cell'>"+trans("events.source")+" &#8594; "+trans("events.target"),y++):(p+="<th class='event-description-cell'>"+trans("events.event"),y++),p+='<th style="max-width:15px"><img src="'+assetServer+'/img/arrow_right2.png"></tr></thead><tbody>',p+=buildListEventsViewForEventsList(t,a,n,d,e,l,f,r,s,m,g,++y,!1),p+="<tbody></table>",void 0!==s&&(p+="</div>"),p}function buildListEventsViewForEventsList(e,t,i,r,a,n,s,o,l,p,d,c,u){for(var h,f=0,m="",g=t;g<=i;++g){var y=e[g],b=u;if(!b&&y&&void 0!==y.pin)for(var v=y.pin.split("|"),T=0;T<v.length;T++){var w=parseInt(v[T]);if(pins[w]&&0==pins[w].filter){b=!0;break}}if(shouldIncludeEventInTable(y,b,n)){if(s&&!b&&p)if("heal"==y.type){if(!h){f++;var x=null,I=null;h={abilities:new Array,actorHealing:new Array,amount:0,hits:0};for(var C=g;C<e.length;++C){var P=e[C];if("heal"!=P.type)break;x||(x=P),I=P,P.ability&&!h.abilities[P.ability.guid]&&(h.abilities[P.ability.guid]={amount:0,ability:P.ability,hits:0}),h.abilities[P.ability.guid].amount+=P.amount,h.abilities[P.ability.guid].hits++,h.amount+=P.amount,h.hits++;var S=reportsCache[r];P.sourceID&&(P.source=S.actorTable[P.sourceID]),P.targetID&&(P.target=S.actorTable[P.targetID]),P.source&&!h.actorHealing[P.source.id]&&(h.actorHealing[P.source.id]={amount:0,actor:P.source,hits:0}),h.actorHealing[P.source.id].amount+=P.amount,h.actorHealing[P.source.id].hits++}if(x!=I){m+='<tr class="closed death-heal-composite-row"><td class="main-table-number">',m+=o?((x.timestamp-e[0].timestamp)/1e3).toFixed(2)+"s":printFightRelativeTimestamp(x.timestamp,r,l),m+="<td class='event-type-cell event-type-heal'>",m+=trans("events."+x.type),m+="<td class='indented-cell' style='cursor:pointer' nowrap onclick='toggleDeathHealRow(this.parentNode, "+f+")'>";var k=[];for(var A in h.abilities)k.push(h.abilities[A]);k.sort((function(e,t){return e.amount<t.amount?1:e.amount>t.amount?-1:0}));for(var F=0;F<k.length&&F<3;F++)m+=printIcon(k[F].ability,"death-event-ability-icon");m+="<span class='school-8'>"+trans("events.multiple_heals")+" ("+h.hits+")</span>",m+='<span class="disclosure zmdi zmdi-caret-down"></span>',m+="<td class='main-table-number'>",m+='<span style="color: '+setColorForAmountFromType(x)+'">+'+h.amount+"</span>";var M=x.target,E=M?M.type:0,D=M&&-1!=M.id?M.name:" ";m+="<td class='event-hp-cell'>",m+=printUnitFrameBarForEvent(I),m+="<td class='event-source-target-cell'>";var R=[];for(var _ in h.actorHealing)R.push(h.actorHealing[_]);R.sort((function(e,t){return e.amount<t.amount?1:e.amount>t.amount?-1:0}));var B=R[0],L=B.actor?B.actor.type:0,O=B.actor?B.actor.name:"Environment";m+='<span class="death-heal-actor">',m+=printActor(B.actor,0,0,L,O,!1,!0,"healing",0,!0,r),R.length>1&&(m+=" <span style='font-size:10px'>"+trans("events.plus_more",{number:R.length-1})+"</span>"),m+="</span>",m+=' &#8594; <span class="death-heal-actor">',m+=printActor(M,x.targetInstance,x.targetMarker,E,D,!1,!1,"casts",0,!0,r),m+="</span>",m+="<td></td></tr>"}else h=null}}else h=null;var U=!1,z=0,V="event-row-"+g+"-"+r,H=y.childEvents&&y.childEvents.length,W=null;if(H){for(var N=[],G=0;G<y.childEvents.length;++G){var q=buildListEventsViewForEventsList(y.childEvents,G,G,r,a,n,s,o,l,p,d,c,!0);N.push($.parseHTML(q)),W||void 0===y.childEvents[G].buffs||(W=y.childEvents[G])}childEventsCache[V]=N}if(m+="<tr "+(u?'class="event-child-row" ':'id="'+V+'" '),s&&!b){if(z=y.amount+(y.overkill>=0?y.overkill:0),"damage"==y.type){var X=y.targetResources?y.targetResources.maxHitPoints:y.maxHitPoints;X&&100!=X&&z/X>.2&&(U=!0)}"heal"==y.type&&h&&(m+=" class='hidden death-heal-row death-heal-group-"+f+"' ")}if(m+='><td class="main-table-number">',m+=o?((y.timestamp-e[0].timestamp)/1e3).toFixed(2)+"s":printFightRelativeTimestamp(y.timestamp,r,l),p&&(m+="<td class='event-type-cell event-type-"+y.type+"'>",m+=trans("events."+y.type)),s&&!b){if(m+="<td "+(H?"class='event-row-with-children'":"")+" nowrap ","heal"!=y.type&&"absorbeventd"!=y.type||(m+=" class='indented-cell' "),m+=">",m+="<div class='event-cell-box'><div>","death"==y.type||"damage"==y.type||"heal"==y.type||"absorbed"==y.type){var Y=y.killingAbility?y.killingAbility:y.ability;Y?(m+=printIcon(Y,"death-event-ability-icon"),m+=printAbility(Y,!1,"damage"==y.type?"damage":"healing","damage"==y.type?1:0)):m+="-",m+='</div><div style="display:flex"><div>',(void 0!==y.buffs||W)&&(m+="<div>"+printEventBuffs(W||y)+"</div>"),H&&(m+='<span class="disclosure zmdi zmdi-caret-down"></span>'),m+="</div></div></div>"}var j;m+="<td class='main-table-number'",U&&(m+=" style='font-weight:bold;'"),m+=">","damage"==y.type||"heal"==y.type||"absorbed"==y.type?(m+='<span style="color: '+setColorForAmountFromType(y)+'">'+("heal"==y.type?"+":"")+y.amount+"</span>",(y.overkill>0||y.overheal>0)&&(m+=' (O: <span style="color:#ff8">'+(null!==(j=y.overheal)&&void 0!==j?j:y.overkill)+"</span>)")):m+="-",m+="<td class='event-hp-cell'>","damage"!=y.type&&"heal"!=y.type||(m+=printUnitFrameBarForEvent(y))}else if(p&&!b){var J,K=y.castDuration>0||y.duration>0||"begincast"==y.type||null!=y.extraAbility||void 0!==y.buffs||W,Z="aurabroken"==y.type?y.extraAbility:y.ability;if("deaths"==filterType&&(Z=null!==(J=y.killingAbility)&&void 0!==J?J:y.ability),m+="<td class='event-ability-cell "+(H?"event-row-with-children ":""),(Z&&Z.isOffGCD||y.stack>0)&&(m+="indented-cell "),m+=K?" event-cell'><div class='event-cell-box'><div>":"'>",y.stack>0&&(m+="["+y.stack+"] "),Z&&Z.guid?(m+=printIcon(Z,"death-event-ability-icon"),m+=printAbility(Z,!1,filterType,0)):m+="-",void 0===y.absorbed&&void 0===y.absorb||!isAuraEvent(y.type)||(m+="<span class='event-minor-details'>",void 0!==y.absorb&&(m+="<span class='event-minor-detail'>"+trans("events.shield_strength")+": <span class='absorb'>"+y.absorb+"</span></span>"),m+="</span>"),("begincast"==y.type||y.castDuration>0||y.duration>0)&&(m+="<span class='event-minor-details'>","begincast"!=y.type||y.castSuccessful?(y.duration>0||y.castDuration>0)&&(m+=trans("events.duration_seconds",{number:((y.duration>0?y.duration:y.castDuration)/1e3).toFixed(2)})):m+="<span class='wipe'>Canceled</span>",m+="</span>"),K){if(m+='</div><div style="display:flex">',"begincast"==y.type||void 0===y.buffs&&!W){if(null!=y.extraAbility){m+=' <div class="event-extra-ability">';var Q="aurabroken"==y.type?y.ability:y.extraAbility;Q&&(m+=printIcon(Q,"death-event-ability-icon"),m+=printAbility(Q,!1,"debuffs",0))}}else m+="<div>"+printEventBuffs(W||y)+"</div>";H&&(m+='<div><span class="disclosure zmdi zmdi-caret-down"></span></div>'),m+="</div></div>"}else H&&(m+='<span class="disclosure zmdi zmdi-caret-down"></span>')}if(p)if(b){var ee=c-3;m+="<td colspan="+ee+">",m+=printEvent(y,!1,r);for(var te=0;te<ee-1;++te)m+='<td class="hidden-event-cell"></td>'}else{var ie;d&&!s&&(m+="<td class='main-table-number'>","resources"==filterType&&(m+=printResourceAmountAndType(y))),y.sourceID&&(y.source=a.actorTable[y.sourceID]),y.targetID&&(y.target=a.actorTable[y.targetID]),y.killerID&&(y.killer=a.actorTable[y.killerID]);var re=null!==(ie=y.killer)&&void 0!==ie?ie:y.source,ae=re?re.type:0,ne=re?re.name:"Environment";m+='<td class="event-source-target-cell"><span class="death-heal-actor">',m+=printActor(re,y.killer?y.killerInstance:y.sourceInstance,y.sourceMarker,ae,ne,!1,!0,"casts",0,!0,r),m+="</span>";var se=y.target,oe=se?se.type:0,le=se&&-1!=se.id?se.name:" ";if(m+=(se&&-1!=se.id?" &#8594; ":"")+'<span class="death-heal-actor">',m+=printActor(se,y.targetInstance,y.targetMarker,oe,le,!1,!1,"casts",0,!0,r),m+="</span>",void 0!==y.pin)for(var pe=y.pin.split("|"),de=0;de<pe.length;de++){var ce=parseInt(pe[de]);pins[ce]&&(m+="<span class='pin-square' style='background-color:"+pins[ce].graphColor+"'></span>")}}else m+='<td class="event-description-cell">',m+=printEvent(y,!1,r);m+='<td style="text-align:center"><a href="#" onclick="return changeToReplayWithPosition('+(y.timestamp-a.fightSegmentStartTime)+')" oncontextmenu="changeToReplayWithPosition('+(y.timestamp-a.fightSegmentStartTime)+')"><img src="'+assetServer+'/img/arrow_right2.png"></a>'}}return m}function printUnitFrameBarForEvent(e){var t=e.resourceActor?e:e.targetResources;if("death"!=e.type&&!t)return"";var i=t?t.maxHitPoints:0,r="death"==e.type?0:Math.max(0,Math.min(t?t.hitPoints:0,i)),a=0==i?100:Math.floor(100*(1-r/i)),n=computeRaidFrameColors(r,i,a),s="<div class='unit-frame' style='margin:0; border:1px solid #555555'><div class='unit-frame-health-backdrop' style='background-color:";if(s+=n[1]+"'>",s+="<div class='unit-frame-health' style='right:"+a+"%; background-color:"+n[0]+"'></div>",gameHasAbsorbs()){var o=t?t.absorb:0,l=Math.max(0,100-o);if(!gameHasPercentageAbsorbs()){var p=Math.max(0,Math.min(o,i));l=0==i?100:Math.floor(100*(1-p/i))}s+="<div class='unit-frame-shield' style='right:"+l+"%;'>",s+="</div>"}return(s+="<div class='unit-frame-hp'>"+("death"==e.type?"Dead":(100!=i?formattedNumber(r)+" - ":"")+(100-a)+"%")+"</div>")+"</div></div>"}function selectGridEventsView(){$(".events-table").removeClass("events-text-view"),$("#events-grid-view").addClass("selected"),$("#events-text-view").removeClass("selected"),window.localStorage.setItem("events-view-mode","grid"),rebuildEventsViews()}function selectTextEventsView(){$(".events-table").addClass("events-text-view"),$("#events-grid-view").removeClass("selected"),$("#events-text-view").addClass("selected"),window.localStorage.setItem("events-view-mode","text"),rebuildEventsViews()}function toggleIncludeBeginCasts(){var e=window.localStorage.getItem("events-view-options");0!=(1&e)?($("#events-include-begin-casts").removeClass("selected"),window.localStorage.setItem("events-view-options",-2&e),$(".events-table").removeClass("include-begin-casts")):($("#events-include-begin-casts").addClass("selected"),window.localStorage.setItem("events-view-options",1|e),$(".events-table").addClass("include-begin-casts")),rebuildEventsViews()}function buildEventsView(e){var t=reportsCache[e],i=t.tableData,r="",a=i.auraAbilities;if(aurasMap=[],a)for(var n=0;n<a.length;++n)aurasMap[a[n].guid.toString()]=a[n];var s="deaths"==filterType||"resources"==filterType||"casts"==filterType||"summons"==filterType||"auras"==filterType||"interrupts"==filterType||"dispels"==filterType||"threat"==filterType,o=s?window.localStorage.getItem("events-view-mode"):"text",l=window.localStorage.getItem("events-view-options"),p=i.events;return r+="<div class='events-view-control-strip'>",s&&(r+="<div id='events-view-switcher'><div class='events-view-control ",o&&"grid"!=o||(r+="selected"),r+="' id='events-grid-view' onclick='selectGridEventsView()'><span class='zmdi zmdi-view-module'></span>",r+=trans("events.grid_view"),r+="</div><div class='events-view-control ","text"==o&&(r+="selected"),r+="' id='events-text-view' onclick='selectTextEventsView()'><span class='zmdi zmdi-view-headline'></span>",r+=trans("events.text_view"),r+="</div></div>",r+="<div class='events-view-options'>","casts"==filterType&&(r+="<div onclick='toggleIncludeBeginCasts()' id='events-include-begin-casts' class='events-view-option ",0!=(1&l)&&(r+="selected"),r+="'>"+trans("events.include_all_begin_casts")+"</div>"),r+="</div>"),(i.nextPageTimestamp||t.filterEventStart!=t.fightSegmentStartTime)&&(r+=firstPageLink(!1,e)),i.nextPageTimestamp&&(r+=nextPageLink(i.nextPageTimestamp,!1,e)),r+="</div>",""==reportsCache[e].tableURL?r+="<p style='text-align:center'>No events found that match the specified time range and actors.</div>":(r+=buildListEventsView(t,p,e,i.cooldowns,o,l),r+="<div class='events-view-control-strip'>",(i.nextPageTimestamp||t.filterEventStart!=t.fightSegmentStartTime)&&(r+=firstPageLink(!0,e)),i.nextPageTimestamp&&(r+=nextPageLink(i.nextPageTimestamp,!0,e)),r+="</div>",i.cooldowns&&i.cooldowns.length&&(r+=addCooldownsInfoForDeath(i.cooldowns,e)),r)}function initEventsViewAtIndex(e){return function(t,i,r){reportsCache[e].tableRequest=null,reportsCache[e].tableData=t;for(var a=0;a<reportsCache.length;++a)if(reportsCache[a].tableRequest)return;rebuildEventsViews()}}function rebuildEventsViews(){var e;childEventsCache=[];var t="";if(comparisonReports.length)for(var i=0;i<reportsCache.length;++i)"deaths"==filterType&&firstCacheWithDefinedFightID()&&filterDeath&&i!=filterDeathReport||(t+=tableHeaderForReport(i),t+=buildEventsView(i),t+="</div></div>");else t+=buildEventsView(0);t+="</div>",$("#table-container").html(t);var r="events",a=null!==(e=window.localStorage.getItem("events-view-mode"))&&void 0!==e?e:"grid";"grid"===a&&("deaths"==filterType&&filterDeath||"resources"==filterType&&1e3==filterSpell?r="combined-damage-healing-events":"casts"!=filterType&&"summons"!=filterType&&"auras"!=filterType&&"interrupts"!=filterType&&"dispels"!=filterType&&"resources"!=filterType&&"deaths"!=filterType&&"threat"!=filterType||(r=filterType+"-events")),initTable(".events-table",r,!0),initTable(".cooldowns-table","simple"),document.getElementById("view-tabs-and-table-container").style.opacity="",attachTooltipsIfNeeded(),"grid"==a&&$(".events-grid-view").on("click",".event-row-with-children",(function(){event.preventDefault();var e=$(this).closest("tr"),t=e.closest("table"),i=$(t).DataTable().row(e);i.child.isShown()?(i.child.hide(),e.removeClass("shown")):(i.child(formatChildEventDetails(i.data(),e.attr("id"))).show(),e.addClass("shown"))}))}function formatChildEventDetails(e,t){var i=childEventsCache[t];return i&&i.length?i:""}function setFilterDeath(e,t,i){if(filterDeath==e&&filterDeathReport==t)return!1;var r=$.deparam.fragment();return 0==t?delete r.deathreport:r.deathreport=t,0==e?delete r.death:r.death=e,i?changeLink(i,r):changeView(r)}function initTableContainerFailed(e,t,i){abortPendingTableRequests(),"abort"!=i&&(document.getElementById("view-tabs-and-table-container").style.opacity="",$("#table-container").html(errorHTML),hideGraphLoadElements())}function toggleComparisonView(e){var t=$("#table-comparison-contents-"+e);t.toggle(),t.is(":visible")?$("#table-comparison-toggle-"+e).html("Collapse View"):$("#table-comparison-toggle-"+e).html("Show View")}function tableHeaderForReport(e){var t="rankings"!=filterView&&!filterDeath,i=!t&&"deaths"!=filterType&&"timeline"!=filterView,r=reportsCache[e],a=0==e?report_name:comparisonReports[e-1].name;r.filterSource>0&&(a=buildActorName(r.filterSource,r.filterSourceInstanceID,e));var n='<div class="table-comparison-wrapper"';return t&&(n+=' style="float:left; width:calc(50% - 5px);',n+=e%2?"margin-left:5px;":"margin-right:5px;",n+='"'),n+='><div class="dialog-block" style="margin-bottom:10px;"><div class="dialog-title" style="position:relative; border-bottom:0;padding:3px; font-size:14px"><div class="small comparison-color comparison-'+e+'"></div> '+a,i&&(n+='<div class="table-comparison-toggle" id="table-comparison-toggle-'+e+'" onclick="toggleComparisonView('+e+')">Collapse View</div>'),(n+="</div></div>")+("timeline"!=filterView?'<div id="table-comparison-contents-'+e+'">':"</div>")}function attachTooltipsIfNeeded(){4==game_id&&"undefined"!=typeof addEsoHubToolTipsToAll?addEsoHubToolTipsToAll():5==game_id&&"undefined"!=typeof initTooltips&&setTimeout(initTooltips,250)}function buildTimelineScaffolding(){return"<div id='timeline-tooltips-container'></div><div id='timeline-names-container'></div><div id='timeline-container'></div>"}function moveTimelineNames(){var e=$(".timeline-names-column");if(void 0!==e.first().position()){var t=e.first().position().top;e.each((function(e){$(this).css({marginTop:t+10*e})})),e.appendTo($("#timeline-names-container"))}}var initTableContainer=function(e,t,i){return function(r,a){if("error"==a)return $("#table-container").html(errorHTML),void abortPendingTableRequests();reportsCache[i].tableRequest=null,reportsCache[i].tableData=r;for(var n=0;n<reportsCache.length;++n)if(reportsCache[n].tableRequest)return;if(document.getElementById("view-tabs-and-table-container").style.opacity="","rankings"==filterView&&hideGraphLoadElements(),!comparisonReports.length)return"timeline"==filterView?($("#table-container").html(buildTimelineScaffolding()),$("#timeline-container").html(r),edgeSpriteFix("#timeline-container"),$("#timeline-container").mCustomScrollbar({theme:"light-thin",scrollButtons:{enable:!0},axis:"x",advanced:{updateOnImageLoad:!1}}),moveTimelineNames()):($("#table-container").html(r),edgeSpriteFix("#table-container")),initTable(e,t,!0),void attachTooltipsIfNeeded();var s="execution"==filterView?'<div id="'+filterView+'-header-container"></div>':"";for(n=0;n<reportsCache.length;++n)s+=tableHeaderForReport(n),""==reportsCache[n].tableURL?s+="<p style='text-align:center'>No events found that match the specified time range and actors.</div>":s+=reportsCache[n].tableData,s+="</div></div>";"timeline"==filterView?($("#table-container").html(buildTimelineScaffolding()),$("#timeline-container").html(s),edgeSpriteFix("#timeline-container"),$("#timeline-container").mCustomScrollbar({theme:"light-thin",scrollButtons:{enable:!0},axis:"x",advanced:{updateOnImageLoad:!1}}),moveTimelineNames()):($("#table-container").html(s),edgeSpriteFix("#table-container")),"execution"==filterView&&$("#"+filterView+"-header").appendTo($("#"+filterView+"-header-container")),initTable(e,t),attachTooltipsIfNeeded()}};function initTable(e,t,i){if("#main-table"!=e&&"#spell-actor-table"!=e&&"#survivability-table"!=e||(document.getElementById("view-tabs-and-table-container").style.opacity=""),"#survivability-table"==e&&hideGraphLoadElements(),"actors"!=t&&"abilities"!=t){var r,a=[[1,"desc"]],n={sType:null,sWidth:16,bSortable:!1};if("simple"==t||"abilitymisses"==t||"abilityhits"==t||"simple-deaths"==t||"simple-aggregate-deaths"==t)r=[{sType:"inner-text"},{sType:"num-html"}];else if("pets"==t)r=[{sType:"inner-text"},{sType:"num-html"},{sType:"formatted-num"}];else if("events"==t)r=[{sType:null,sWidth:50,bSortable:!1},{sType:null,bSortable:!1},{sType:null,bSortable:!1}];else if("combined-damage-healing-events"==t||"resources-events"==t)r=[{sType:null,sWidth:50,bSortable:!1},{sType:null,sWidth:80,bSortable:!1},{sType:null,bSortable:!1},{sType:null,sWidth:80,bSortable:!1},{sType:null,sWidth:80,bSortable:!1},{sType:null,bSortable:!1},{sType:null,sWidth:30,bSortable:!1}];else if("casts-events"==t||"summons-events"==t||"auras-events"==t||"interrupts-events"==t||"dispels-events"==t||"deaths-events"==t||"threat-events"==t)r=[{sType:null,sWidth:50,bSortable:!1},{sType:null,sWidth:80,bSortable:!1},{sType:null,bSortable:!1},{sType:null,bSortable:!1},{sType:null,sWidth:30,bSortable:!1}];else if("spells"==t)r=[{sType:"inner-text"},{sType:"formatted-num"},{sType:"formatted-num"},n];else if("abilityamounts"==t)r="damage-done"==filterType?[{sType:"inner-text"},{sType:"num-html"},{sType:"formatted-num"},{sType:"formatted-num"},{sType:"formatted-num"}]:[{sType:"inner-text"},{sType:"num-html"},{sType:"numeric"},{sType:"formatted-num"},{sType:"formatted-num"},{sType:"formatted-num"}];else if("summary"==t)r=[{sType:"inner-text"},{sType:"num-html"},{sType:"formatted-num"},n];else if("summary-deaths"==t)r=[{sType:"inner-text"},{sType:"inner-text"},{sType:null},n];else if("summary-aggregate-deaths"==t)r=[{sType:"inner-text"},{sType:"formatted-num"},n];else if("resources"==t)r=[{sType:"inner-text"},n];else if("resource-gains"==t)r=[{sType:"inner-text"},{sType:"formatted-num"},{sType:"formatted-num"},{sType:"formatted-num"},n];else if("survivability"==t){var s=$(".survivability-table th").length;r=[{sType:"inner-text"}];for(var o=0;o<s-1;++o)r.push({sType:"formatted-num",sWidth:60});a=[[1,"asc"]]}else"auras"==t?r=[{sType:"inner-text"},{sType:"formatted-num"},{sType:"num-html"},n]:"auras-by-ability"==t?r=[{sType:"inner-text"},{sType:"formatted-num"},{sType:"num-html"},{sType:"inner-text"},{sType:"inner-text"},n]:"auras-by-ability-with-source"==t?r=[{sType:"inner-text"},{sType:"formatted-num"},{sType:"num-html"},{sType:"inner-text"},n]:"missed"==t?r=[{sType:"inner-text"},{sType:"formatted-num"},{sType:"num-html"}]:"deaths"==t?r=0==hostilityType?[{sType:"date",sWidth:50},{sType:"inner-text"},{sType:"inner-text"},{sType:"formatted-num"},{sType:"inner-text"},{sType:"formatted-num"},{sType:"formatted-num"}]:[{sType:"date",sWidth:50},{sType:"inner-text"},{sType:"formatted-num"},{sType:"inner-text"},{sType:"formatted-num"},{sType:"formatted-num"}]:"threat"==t&&(r=[{sType:"inner-text"},{sType:"num-html"},n]);"events"==t||"combined-damage-healing-events"==t||"casts-events"==t||"summons-events"==t||"auras-events"==t||"interrupts-events"==t||"dispels-events"==t||"resources-events"==t||"threat-events"==t?a=[[0,"deaths"==filterType?"desc":"asc"]]:"spells"==t?a=[[2,"desc"],[0,"asc"]]:"resources"==t?a=[[0,"asc"]]:"resource-gains"==t?a=[[3,"desc"]]:"auras"==t||"auras-by-ability"==t||"auras-by-ability-with-source"==t?a=[[2,"desc"],[0,"asc"]]:"threat"==t?a=[[1,"desc"],[0,"asc"]]:"deaths"==t?a=[[0,"asc"]]:"summary-aggregate-deaths"==t||"simple-aggregate-deaths"==t?a=[[1,"desc"]]:"simple-deaths"==t&&(a=[[1,"asc"]]);var l={responsive:"survivability"!=t,bJQueryUI:!0,bPaginate:!1,bLengthChange:!1,bFilter:!1,bInfo:!1,bAutoWidth:!1,aoColumns:r,aaSorting:a,bSort:"events"!=t&&"resources"!=t&&"summary-deaths"!=t&&"missed"!=t&&"combined-damage-healing-events"!=t&&"casts-events"!=t&&"summons-events"!=t&&"interrupts-events"!=t&&"auras-events"!=t&&"dispels-events"!=t&&"resources-events"!=t&&"threat-events"!=t};i&&(l.dom="tB",l.buttons=["csv"]),$(e).dataTable(l)}}function updateFilterHostilityParams(e,t){t!=hostilityType&&(!0===t?t=1:!1===t&&(t=0),0==t?delete e.hostility:e.hostility=t,t!=hostilityType&&(delete e.source,delete e.sourceclass,delete e.target,delete e.targetclass,delete e.death),delete e.ability,delete e.spell,delete e.eventstart)}function changeHostilityType(e,t){if(hostilityType==e)return!1;var i=$.deparam.fragment();return updateFilterHostilityParams(i,e),t?changeLink(t,i):changeView(i)}function changeView(e){return $.bbq.pushState(e,2),!1}function initDeathsMenuAtIndex(e){return function(t,i){reportsCache[e].deathsOrResourcesRequest=null,reportsCache[e].deathsOrResourcesData=t;for(var r=0;r<reportsCache.length;++r)if(reportsCache[r].deathsOrResourcesRequest)return;for(var a="<li><a href='#' style='color:white' onclick='return setFilterDeath(0,0,this)' oncontextmenu='setFilterDeath(0,0,this)'>All Deaths</a></li><li class='separator'></li>",n=0,s=new Array,o=0;o<reportsCache.length;++o){var l=reportsCache[o];if(l.deathsOrResourcesData)for(n+=l.deathsOrResourcesData.entries.length,r=0;r<l.deathsOrResourcesData.entries.length;++r){var p=l.deathsOrResourcesData.entries[r];s.push({entry:p,index:o,time:Math.floor((p.timestamp-l.fightSegmentStartTime)/1e3)})}}for(var d=Math.ceil(n/12),c=Math.ceil(n/d),u=0;u<d;u=++u){a+="<table class='actor-menu-table ",u<d-1&&(a+="bordered"),a+="'><tbody>";for(var h=0;h<c;++h)if(!((r=h+c*u)>=n)){p=s[r].entry;var f=s[r].index;a+="<tr><td><li><a href='#' class='"+p.type+"' onclick='return setFilterDeath("+(r+1)+", "+f+", this)' oncontextmenu='setFilterDeath("+(r+1)+", "+f+", this)'>",a+="<span style='color:white'>"+makeSmartDuration(s[r].time)+" -</span> "+p.name+" ",a+=menuItemComparisonMarkers(null,f,!0),a+="</a></li>"}a+="</tbody></table>"}$("#filter-death-selection-container").html(a),filterDeath?(p=reportsCache[filterDeathReport].deathsOrResourcesData.entries[filterDeath-1],$("#filter-death-selection-text").html("<span style='color:white'>"+makeSmartDuration(Math.floor((p.timestamp-reportsCache[filterDeathReport].fightSegmentStartTime)/1e3))+" -</span> <span class='"+p.type+"'>"+p.name+" </span> "+menuItemComparisonMarkers(null,filterDeathReport,!0))):$("#filter-death-selection-text").html("<span style='color:white'>All Deaths</span>"),loadGraph(),loadTableOrEvents()}}function loadDeathEventsAtIndex(e){var t=firstCacheWithDefinedFightID(),i=reportsCache[e];if(!i.fightSegmentEndTime&&!i.fightSegmentStartTime||filterDeath&&filterDeathReport!=e||!i.filterFightsArray.length&&t)return i.tableURL="",i.tableData="",!1;var r=0==e?report_id:comparisonReports[e-1].code,a="/reports/";return"events"==filterView||filterDeath?a+="deaths-events":(1==i.filterFightsArray.length||1==hostilityType?a+="deaths":a+="survivability","timeline"==filterView&&(a+="-timeline")),a+="/"+r+"/"+i.filterFightsString+"/"+("events"==filterView||filterDeath?i.filterEventStart:i.fightSegmentStartTime)+"/"+i.fightSegmentEndTime+"/",a+=i.filterSource+"/"+filterAbility+"/"+hostilityType+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff+"/"+filterSourceClass+"/"+i.filterSourceInstance,"events"==filterView||filterDeath?a+="/"+filterDeath:(1==i.filterFightsArray.length||"deaths"==filterType&&1==hostilityType)&&(a+="/"+i.filterFightStartTime),a+=queryStringForLoads(pinString,e),i.tableURL!=a&&(i.tableURL=a,"events"==filterView||filterDeath?i.tableRequest=$.getJSON(a,initEventsViewAtIndex(e)).fail(initEventsViewFailed):1!=i.filterFightsArray.length&&0==hostilityType?i.tableRequest=$.ajax({url:a,success:initTableContainer(".survivability-table","survivability",e),error:initTableContainerFailed}):i.tableRequest=$.ajax({url:a,success:initTableContainer(".deaths-table","deaths",e),error:initTableContainerFailed}),!0)}function loadPinGraphs(){for(var e=0;pins&&e<pins.length;++e)if("Separate"==pins[e].graph){$("#pin-graph-"+e).show();var t="/reports/pin-graph/"+report_id+"/"+filterFightsString+"/"+fightSegmentStartTime+"/"+fightSegmentEndTime+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff;(pins[e].graphPinString||filterPhase)&&(t+="?"),pins[e].graphPinString&&(t+="pins="+encodeURIComponent(pins[e].graphPinString)+"&"),filterPhase&&(t+="phase="+filterPhase),pins[e].graphRequest&&pins[e].graphRequest.abort(),pins[e].graphRequest=$.getJSON(t,initPinGraph(e)).fail(initPinGraphFailed(e))}else $("#pin-graph-"+e).hide()}function loadGraphAtIndex(e){var t=reportsCache[e];if(!t.fightSegmentEndTime&&!t.fightSegmentStartTime||-2==t.filterSource||-2==t.filterTarget||t.filterFightsArray.length&&"deaths"==filterType&&filterDeath&&filterDeathReport!=e)return t.graphURL="",t.graphJSONData=null,!1;var i=0==e?report_id:comparisonReports[e-1].code,r="/reports/",a=filterType,n=isDamageOrHealingFilterType()||"threat"===filterType&&hasThreatDetails();return n?("threat"===a&&(a+="-details"),r+="graph/"+a):r+="summary"==filterType||"auras"==filterType&&!filterAbility?"summary-graph":filterType+"-graph",r+="/"+i+"/"+t.filterFightsString+"/"+t.fightSegmentStartTime+"/"+t.fightSegmentEndTime+"/",n?r+=subFilterType+"/"+hostilityType+"/"+t.filterSource+"/"+t.filterTarget+"/"+t.filterSourceInstance+"/"+t.filterTargetInstance+"/"+filterAbility+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff+"/"+filterSourceClass+"/"+filterTargetClass+"/"+filterOptions+"/"+perfGraph:"deaths"==filterType?r+=t.filterSource+"/"+filterAbility+"/"+hostilityType+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff+"/"+filterSourceClass+"/"+t.filterSourceInstance+"/"+filterDeath:"summary"==filterType||"auras"==filterType&&!filterAbility?r+=t.filterSource+"/"+t.filterSourceInstance+"/"+filterSourceClass+"/"+hostilityType+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff:"auras"==filterType?r+=filterSpellType+"/"+filterAbility+"/"+t.filterSource+"/"+t.filterTarget+"/"+t.filterSourceInstance+"/"+t.filterTargetInstance+"/"+subFilterType+"/"+hostilityType+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff+"/"+filterSourceClass+"/"+filterTargetClass+"/"+filterOptions:"resources"==filterType?r+=filterSpell+"/"+hostilityType+"/"+t.filterSource+"/"+t.filterSourceInstance+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff+"/"+filterSourceClass:"casts"==filterType||"summons"==filterType?(r+=t.filterSource+"/"+t.filterSourceInstance+"/"+filterSourceClass+"/"+t.filterTarget+"/"+t.filterTargetInstance+"/"+filterTargetClass+"/"+filterAbility+"/"+subFilterType+"/"+hostilityType+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff,"casts"==filterType&&(r+="/"+filterOptions)):"interrupts"==filterType||"dispels"==filterType?r+=t.filterSource+"/"+t.filterSourceInstance+"/"+filterSourceClass+"/"+t.filterTarget+"/"+t.filterTargetInstance+"/"+filterTargetClass+"/"+filterAbility+"/"+hostilityType+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff:"threat"==filterType&&(r+=hostilityType+"/"+t.filterSource+"/"+t.filterSourceInstance+"/"+filterSourceClass+"/"+t.filterTarget+"/"+t.filterTargetInstance+"/"+filterTargetClass+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff+"/"+filterOptions),r+=queryStringForLoads(graphPinString,e),t.graphURL!=r&&(t.graphURL=r,t.graphJSONData=null,t.graphRequest=$.getJSON(r,initGraphAtIndex(e)).fail(initGraphFailed),!0)}function loadGraph(){if("rankings"!=filterView){if($("#graph").show(),!reportsCache[0].fights.length)return initGraphFailed(),void $("#graph").html("<div id='graph-error'><p>This report contains no fights yet.</p></div>");var e=firstCacheWithDefinedFightID();if("casts"==filterType&&(!e||filterFightsArray.length>1))return initGraphFailed(),void $("#graph").html("<div id='graph-error'><p>The casts graph is limited to a single fight.</p></div>");for(var t=!1,i=0;i<reportsCache.length;++i)loadGraphAtIndex(i)&&(t=!0);t||hideGraphLoadElements()}else abortPendingGraphRequests()}function setMenuAbilityString(e){var t="";filterAbility&&(t+="<img class='filter-clear-box' src='"+assetServer+"/img/close.png' width=16 height=16 onclick='",t+="return clearAbilityFilter(event)'>"),t+=e,$("#filter-ability-text").html(t)}function allowAds(){return"replay"!=filterView}function loadTableOrEvents(){for(var e=!1,t=0;t<reportsCache.length;++t)"deaths"==filterType?loadDeathEventsAtIndex(t)&&(e=!0):"events"==filterView||"analytical"==filterView&&"resources"==filterType&&1e3==filterSpell?loadEventsAtIndex(t)&&(e=!0):loadTableAtIndex(t)&&(e=!0);if(!e){var i=document.getElementById("view-tabs-and-table-container");return i&&(i.style.opacity=""),e}return Tipped.remove(".tooltip"),e}function loadTableAtIndex(e){var t=reportsCache[e];if(!t.fightSegmentEndTime&&!t.fightSegmentStartTime||-2==t.filterSource||-2==t.filterTarget)return t.tableURL="",t.tableData="",!1;var i=0==e?report_id:comparisonReports[e-1].code,r="summary"==filterType?summaryPinString:"damage-done"==filterType&&0==hostilityType&&0!=(512&filterOptions)?weightPinString:tablePinString,a="";if("rankings"==filterView){if(a+="/rankings/report-rankings-for-",t.filterFightsArray.length)a+="fight/"+i+"/"+t.filterFightsString+"/"+t.fightsTable[t.filterFightsArray[0]].boss;else{if(!filterBoss)return!1;a+="boss/"+i+"/"+filterBoss+"/"+filterDifficulty}return a+="/"+filterMetric+"/"+filterMetricTimeframe+"/"+filterMetricCompare,a+=queryStringForLoads(r,e),t.tableURL!=a&&(t.tableURL=a,t.tableData="",t.tableRequest=$.ajax({url:a,success:initTableContainer("#main-table","rankings",e),error:initTableContainerFailed}),!0)}a+="/reports/";var n=filterType,s=isDamageOrHealingFilterType()||"summons"==filterType||"casts"==filterType||"threat"===filterType&&hasThreatDetails();s&&("threat"===n&&(n+="-details"),a+="analytical"==filterView?"table/":"timeline/");var o="execution"==filterView;if("deaths"==filterType?n="death":o&&(n=filterView),"timeline"!=filterView||"summary"!=filterType&&"resources"!=filterType&&"interrupts"!=filterType&&"dispels"!=filterType&&"auras"!=filterType&&"deaths"!=filterType&&"threat"!=filterType||(n+="-timeline"),a+=n+"/"+i+"/"+t.filterFightsString+"/"+t.fightSegmentStartTime+"/"+t.fightSegmentEndTime+"/",s?a+=subFilterType+"/"+hostilityType+"/"+t.filterSource+"/"+t.filterTarget+"/"+t.filterSourceInstance+"/"+t.filterTargetInstance+"/"+filterAbility+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff+"/"+filterSourceClass+"/"+filterTargetClass+"/"+filterOptions+"/"+(t.filterFightsArray.length?t.fightsTable[t.filterFightsArray[0]].boss:filterBoss):"summary"==filterType?a+=o?filterCutoff+"/"+(t.filterFightsArray.length?t.fightsTable[t.filterFightsArray[0]].boss:filterBoss)+"/"+filterWipes+"/"+(t.filterFightsArray.length?t.fightsTable[t.filterFightsArray[0]].difficulty+"/"+t.fightsTable[t.filterFightsArray[0]].size+"/":filterDifficulty+"/0/"):t.filterSource+"/"+t.filterSourceInstance+"/"+filterSourceClass+"/"+hostilityType+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff:"resources"==filterType?a+=filterSpell+"/"+hostilityType+"/"+t.filterSource+"/"+t.filterSourceInstance+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff+"/"+filterSourceClass+"/":"interrupts"==filterType||"dispels"==filterType?a+=t.filterSource+"/"+t.filterSourceInstance+"/"+filterSourceClass+"/"+t.filterTarget+"/"+t.filterTargetInstance+"/"+filterTargetClass+"/"+filterAbility+"/"+hostilityType+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff:"auras"==filterType?a+=filterSpellType+"/"+filterAbility+"/"+t.filterSource+"/"+t.filterTarget+"/"+t.filterSourceInstance+"/"+t.filterTargetInstance+"/"+subFilterType+"/"+hostilityType+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff+"/"+filterSourceClass+"/"+filterTargetClass+"/"+filterOptions:"threat"==filterType&&(a+=hostilityType+"/"+t.filterSource+"/"+t.filterSourceInstance+"/"+filterSourceClass+"/"+t.filterTarget+"/"+t.filterTargetInstance+"/"+filterTargetClass+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff+"/"+filterOptions),a+=queryStringForLoads(r,e),t.tableURL==a)return!1;t.tableURL=a,t.tableData="";var l="actors";return"auras"==filterType?l="auras":"resources"==filterType?l="resource-gains":"interrupts"==filterType||"dispels"==filterType?l="spells":("ability"==subFilterType||filterAbility)&&(l="abilities"),t.tableRequest=$.ajax({url:a,success:initTableContainer("#main-table",l,e),error:initTableContainerFailed}),!0}function queryStringForLoads(e,t){var i="";return(e||filterPhase||comparisonReports.length||filterTranslate||filterSourceBuffsString||filterTargetBuffsString)&&(i+="?"),e&&(i+="pins="+encodeURIComponent(e)+"&"),comparisonReports.length&&(i+="compare="+t+"&"),filterPhase&&(i+="phase="+filterPhase+"&"),filterTranslate&&(i+="lang="+currentLang+"&"),filterSourceBuffsString&&(i+="sourcebuffs="+encodeURIComponent(filterSourceBuffsString)+"&"),filterTargetBuffsString&&(i+="targetbuffs="+encodeURIComponent(filterTargetBuffsString)+"&"),i}function loadEventsAtIndex(e){var t=reportsCache[e];if(!t.fightSegmentEndTime&&!t.fightSegmentStartTime||-2==t.filterSource||-2==t.filterTarget)return t.tableURL="",t.tableData="",!1;var i=0==e?report_id:comparisonReports[e-1].code,r="/reports/",a=filterType,n=isDamageOrHealingFilterType()||"threat"===filterType&&hasThreatDetails();return n?("threat"===a&&(a+="-details"),r+="events/"+a):r+=filterType+"-events",r+="/"+i+"/"+t.filterFightsString+"/"+t.filterEventStart+"/"+t.fightSegmentEndTime+"/",n?r+=subFilterType+"/"+hostilityType+"/"+t.filterSource+"/"+t.filterTarget+"/"+t.filterSourceInstance+"/"+t.filterTargetInstance+"/"+filterAbility+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff+"/"+filterSourceClass+"/"+filterTargetClass+"/"+filterOptions:"summary"==filterType?r+=t.filterSource+"/"+t.filterSourceInstance+"/"+filterSourceClass+"/"+hostilityType+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff:"resources"==filterType?r+=filterSpell+"/"+hostilityType+"/"+t.filterSource+"/"+t.filterSourceInstance+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff+"/"+filterSourceClass+"/":"casts"==filterType||"summons"==filterType||"interrupts"==filterType||"dispels"==filterType?(r+=t.filterSource+"/"+t.filterSourceInstance+"/"+filterSourceClass+"/"+t.filterTarget+"/"+t.filterTargetInstance+"/"+filterTargetClass+"/"+filterAbility+"/"+hostilityType+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff,"casts"==filterType&&(r+="/"+filterOptions)):"auras"==filterType?r+=filterSpellType+"/"+filterAbility+"/"+t.filterSource+"/"+t.filterTarget+"/"+t.filterSourceInstance+"/"+t.filterTargetInstance+"/"+subFilterType+"/"+hostilityType+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff+"/"+filterSourceClass+"/"+filterTargetClass+"/"+filterOptions:"threat"==filterType&&(r+=hostilityType+"/"+t.filterSource+"/"+t.filterSourceInstance+"/"+filterSourceClass+"/"+t.filterTarget+"/"+t.filterTargetInstance+"/"+filterTargetClass+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff+"/"+filterOptions),r+=queryStringForLoads(pinString,e),t.tableURL!=r&&(t.tableURL=r,t.tableRequest=$.getJSON(r,initEventsViewAtIndex(e)).fail(initEventsViewFailed),!0)}function loadDeathsOrResources(){for(var e=0;e<reportsCache.length;++e)loadDeathsOrResourcesAtIndex(e)}function loadDeathsOrResourcesAtIndex(e){var t=reportsCache[e];if(!t.fightSegmentEndTime&&!t.fightSegmentStartTime||-2==t.filterSource)return t.deathsOrResourcesData="",t.deathsOrResourcesRequest=null,!1;var i=0==e?report_id:comparisonReports[e-1].code;if("deaths"==filterType){var r="/reports/deaths-menu/"+i+"/"+t.filterFightsString+"/"+t.fightSegmentStartTime+"/"+t.fightSegmentEndTime+"/"+t.filterSource+"/"+filterAbility+"/"+hostilityType+"/"+bossWipesAndDifficultyString()+"/"+filterCutoff+"/"+filterSourceClass+"/"+t.filterSourceInstance;r+=queryStringForLoads(pinString,e),t.deathsOrResourcesRequest=$.getJSON(r,initDeathsMenuAtIndex(e)).fail(initDeathsOrResourcesFailed)}else"resources"==filterType&&(r="/reports/resources-menu/"+i+"/"+t.filterFightsString+"/"+t.fightSegmentStartTime+"/"+t.fightSegmentEndTime+"/"+hostilityType+"/"+t.filterSource+"/"+t.filterSourceInstance+"/"+bossWipesAndDifficultyString()+"/"+filterSourceClass+"/",r+=queryStringForLoads(graphPinString,e),t.deathsOrResourcesRequest=$.getJSON(r,initResourcesMenuAtIndex(e)).fail(initDeathsOrResourcesFailed))}function isCompositeAbility(e){return 0==game_id&&e<-512||4==game_id&&e<0}function subFilterTypeForView(){return isDamageOrHealingFilterType()||"casts"==filterType||"summons"==filterType||"threat"==filterType?filterSource?filterAbility&&!isCompositeAbility(filterAbility)?"target":"ability":"source":"resources"==filterType?"hp":"source"}function clearSourceFilter(e){var t=$.deparam.fragment();return updateFilterSourceParams(t,0,0),changeView(t),e.stopPropagation(),!1}function clearTargetFilter(e){var t=$.deparam.fragment();return updateFilterTargetParams(t,0,0),changeView(t),e.stopPropagation(),!1}function clearAbilityFilter(e){var t=$.deparam.fragment();return updateFilterAbilityParams(t,0,0),changeView(t),e.stopPropagation(),!1}function setFilterActorText(e,t){var i=t?suggestedAllSourcesName(filterType,hostilityType):suggestedAllTargetsName(filterType,hostilityType),r=t?filterSourceClass:filterTargetClass;if("Any"!=r&&(i="All "+pluralClassDisplay(r)),!(l=t?reportsCache[0].filterSource:reportsCache[0].filterTarget)){var a="";return"Any"!=r&&(a+="<img class='filter-clear-box' src='"+assetServer+"/img/close.png' width=16 height=16 onclick='",a+=t?"return clearSourceFilter(event)":"return clearTargetFilter(event)",a+="'>"),a+=i,$("#"+e).html(a),void $("#"+e).attr("class",r)}a="";for(var n=!1,s=0;s<reportsCache.length;++s){var o=reportsCache[s],l=t?o.filterSource:o.filterTarget,p=t?o.filterSourceInstance:o.filterTargetInstance;if(-2!=l){a+="<span style='display:inline-block;",n&&(a+="margin-top:3px");var d=o.actorTable[l];a+="' class='"+(d?d.type:"Unknown")+"'>"+menuItemComparisonMarkers(null,s,!0)+" ",a+="<img class='filter-clear-box' src='"+assetServer+"/img/close.png' width=16 height=16 onclick='",a+=t?"event.stopPropagation(); return setFilterSource(-2, 0, null,"+s+")":"event.stopPropagation(); return setFilterTarget(-2, 0, null,"+s+")",a+="'>",a+=buildActorName(l,p,s),n=!0,a+="</span><br>"}}$("#"+e).html(a)}function parseFilterFights(e){for(var t=!1,i=new Array,r=0;r<reportsCache.length;++r)i.push({filterFightsString:reportsCache[r].filterFightsString,filterFightIsLastPull:reportsCache[r].filterFightIsLastPull});var a=void 0===e?new Array:e.split(",");for(r=0;r<reportsCache.length;++r){var n=r>=a.length?"0":a[r];n&&"-"==n[0]&&(n=n.substring(1)),(u=reportsCache[r]).filterFightIsLastPull=!1,u.filterFightsString=n,u.filterFightsArray=new Array;var s=n.split(".");if(s.length)if("last"==n&&u.lastPull)u.filterFightIsLastPull=!0,u.lastPull&&u.filterFightsArray.push(u.lastPull.id),u.filterFightsString=u.lastPull.id;else for(var o=0;o<s.length;++o){var l=parseInt(s[o]);!isNaN(l)&&l>0&&u.filterFightsArray.push(l)}else u.filterFightsString="0"}reportsCache.filterFightBoss=-1,reportsCache.filterFightDifficulty=-1;var p=firstCacheWithDefinedFightID();if(p&&(reportsCache.filterFightBoss=p.fightsTable[p.filterFightsArray[0]].boss,reportsCache.filterFightDifficulty=p.fightsTable[p.filterFightsArray[0]].difficulty),-1!=reportsCache.filterFightBoss)for(r=0;r<reportsCache.length;++r)if(!(u=reportsCache[r]).filterFightsArray.length){var d=hashForBossAndDifficulty(reportsCache.filterFightBoss,reportsCache.filterFightDifficulty),c=reportsCache.bossHash[d].last;r<c.length&&(u.filterFightsString=c[r]?c[r].id:"0",c[r]&&c[r].id>0&&u.filterFightsArray.push(c[r].id))}for(r=0;r<reportsCache.length;++r){var u=reportsCache[r];if(!t&&(u.filterFightsString!=i[r].filterFightsString||u.filterFightIsLastPull!=i[r].filterFightIsLastPull)){t=!0;break}}return filterFightsString=reportsCache[0].filterFightsString,filterFightsArray=reportsCache[0].filterFightsArray,filterFightIsLastPull=reportsCache[0].filterFightIsLastPull,t}function parseFilterFightTimes(e,t){for(var i=!1,r=void 0!==e?e.split(","):void 0,a=void 0!==t?t.split(","):void 0,n=0;n<reportsCache.length;++n){var s,o=(s=reportsCache[n]).filterFightStartTime,l=s.filterFightEndTime,p=s.fightSegmentStartTime,d=s.fightSegmentEndTime;if((s=reportsCache[n]).filterFightsArray.length)s.filterFightStartTime=parseInt(s.fightsTable[s.filterFightsArray[0]].start_time),s.filterFightEndTime=parseInt(s.fightsTable[s.filterFightsArray[s.filterFightsArray.length-1]].end_time);else if(-1!=filterBoss){var c=lastMatchingFight(s,filterBoss,filterWipes,filterDifficulty);s.filterFightStartTime=0,s.filterFightEndTime=c?c.end_time:0}else s.filterFightStartTime=s.filterFightEndTime=0;var u=s.filterFightStartTime,h=s.filterFightEndTime;filterPull&&0==n&&s.filterFightsArray.length&&(u=s.fightsTable[s.filterFightsArray[0]].dungeonPulls[filterPull-1].start_time,h=s.fightsTable[s.filterFightsArray[0]].dungeonPulls[filterPull-1].end_time),s.fightSegmentStartTime=r?parseInt(r[n]):u,s.fightSegmentEndTime=a?parseInt(a[n]):h,i||o==s.filterFightStartTime&&l==s.filterFightEndTime&&p==s.fightSegmentStartTime&&d==s.fightSegmentEndTime||(i=!0)}return filterFightStartTime=reportsCache[0].filterFightStartTime,filterFightEndTime=reportsCache[0].filterFightEndTime,fightSegmentStartTime=reportsCache[0].fightSegmentStartTime,fightSegmentEndTime=reportsCache[0].fightSegmentEndTime,i}function hasZoomedFight(){for(var e=0;e<reportsCache.length;++e){var t=reportsCache[e],i=t.filterFightStartTime,r=t.filterFightEndTime;if(filterPull&&0==e&&(i=t.fightsTable[t.filterFightsArray[0]].dungeonPulls[filterPull-1].start_time,r=t.fightsTable[t.filterFightsArray[0]].dungeonPulls[filterPull-1].end_time),i!=t.fightSegmentStartTime||r!=t.fightSegmentEndTime)return!0}return!1}function parseFilterEventStart(e){for(var t=!1,i=void 0!==e?e.split(","):void 0,r=0;r<reportsCache.length;++r){var a=reportsCache[r],n=a.filterEventStart;a.filterEventStart=void 0===i||r>=i.length||-1==i[r]?a.fightSegmentStartTime:parseInt(i[r]),t||n==a.filterEventStart||(t=!0)}return t}function updateParamsWithEventStartAtIndex(e,t,i){if(comparisonReports.length){for(var r=!0,a="",n=0;n<reportsCache.length;++n){n>0&&(a+=",");var s=n==i?t:reportsCache[n].filterEventStart==reportsCache[n].fightSegmentStartTime?-1:reportsCache[n].filterEventStart;-1!=s&&(r=!1),a+=s}r?delete e.eventstart:e.eventstart=a}else-1==t?delete e.eventstart:e.eventstart=t}function parseFilterActorAndInstance(e,t){for(var i=!1,r=void 0!==e?e.split(","):void 0,a=0;a<reportsCache.length;++a){var n=reportsCache[a],s=t?n.filterSource:n.filterTarget,o=t?n.filterSourceInstance:n.filterTargetInstance,l=(void 0!==r?a<r.length?r[a].toString():"-2":"0").split("."),p=parseInt(l[0]);if(isNaN(p))for(a=0;a<n.players.length;++a)n.players[a].name==l[0]&&(p=n.players[a].id);var d=l.length>1?parseInt(l[1]):0;i||s==p&&o==d||(i=!0),t?(n.filterSource=p,n.filterSourceInstance=d,0==a&&(filterSource=p,filterSourceInstance=d)):(n.filterTarget=p,n.filterTargetInstance=d,0==a&&(filterTarget=p,filterTargetInstance=d))}return i}function determineDefaultFilterOptions(){if("damage-taken"==filterType||"casts"==filterType||"summons"==filterType||"threat"==filterType&&1==hostilityType){for(var e=2==game_id&&"damage-taken"==filterType?logVersion>=47?36:4:0,t=!1,i=0;i<reportsCache.length;++i){var r=reportsCache[i];if(r.filterSource){var a=r.actorTable[r.filterSource];if(a&&a.petOwner){t=!0;break}}}return e|(t?0:2)}return 0}function defaultFilterSpell(){return"resources"==filterType?1e3:0}function defaultView(){return"analytical"}function loadViews(e){if(1==expired_state)return initGraphFailed(),$("#graph").html("<div id='graph-error'><p>This report has expired, and the fights it contained have been deleted. You can still view the rankings for the report by clicking View Rankings at the top of the page.</p></div>"),document.getElementById("view-tabs-and-table-container").style.opacity="",void $("#table-container").html("<div style='text-align:center; margin-top:30px'>This report has expired, and the fights it contained have been deleted. You may still view the rankings for this report by clicking View Rankings at the top of the page.</div>");var t=filterTranslate;if(filterTranslate=!!e.translate&&"true"==e.translate,void 0===t||filterTranslate==t){if(filterTranslate&&showUntranslationBar(),needToFetchFightsAndParticipants)return fetchFightsAndParticipants(e);hideFightSelectionUI(),$("#report-top-bar").css("visibility","visible");var i=filterView;filterView=archived?"rankings":e.view?e.view:defaultView();var r=filterType;filterType=e.type?e.type:"summary";var a=hostilityType;hostilityType=e.hostility?e.hostility:0,"damage"==filterType&&(0==hostilityType?filterType="damage-done":1!=hostilityType&&2!=hostilityType||(filterType="damage-taken",hostilityType=0));var n=filterSpell;filterSpell=e.spell?parseInt(e.spell):defaultFilterSpell();var s=filterSourceBuffsString,o=filterTargetBuffsString;filterSourceBuffsString=e.sourcebuffs?e.sourcebuffs:"",filterTargetBuffsString=e.targetbuffs?e.targetbuffs:"",filterSourceBuffs=filterSourceBuffsString?filterSourceBuffsString.split("."):new Array,filterTargetBuffs=filterTargetBuffsString?filterTargetBuffsString.split("."):new Array;var l=filterType!=r,p=l,d=parseFilterActorAndInstance(e.source,!0),c=parseFilterActorAndInstance(e.target,!1),u=filterSourceClass;filterSourceClass=e.sourceclass?e.sourceclass:"Any";var h=filterTargetClass;filterTargetClass=e.targetclass?e.targetclass:"Any",u==filterSourceClass&&h==filterTargetClass||(chartData=null);var f=filterAbility;filterAbility=e.ability?parseInt(e.ability):0;var m=filterPhase;filterPhase=e.phase?parseInt(e.phase):0;var g=subFilterType;subFilterType=e.by?e.by:subFilterTypeForView();var y=perfGraph;perfGraph="damage-done"!=filterType&&"healing"!=filterType||"source"!=subFilterType||void 0===e.graphperf?0:e.graphperf,(subFilterType!=g||l||filterView!=i)&&("casts"==filterType&&"replay"!=filterView?$("#by_interrupt").show():$("#by_interrupt").hide(),"summary"==filterType||"deaths"==filterType||"resources"==filterType||"replay"==filterView||"interrupts"==filterType||"dispels"==filterType?($("#by_target").hide(),$("#by_source").hide(),$("#by_ability").hide()):($("#by_target").show(),$("#by_source").show(),$("#by_ability").show()),"target"==subFilterType?($("#by_target").addClass("selected"),$("#by_source").removeClass("selected"),$("#by_ability").removeClass("selected")):"source"==subFilterType?($("#by_target").removeClass("selected"),$("#by_ability").removeClass("selected"),$("#by_source").addClass("selected")):"ability"==subFilterType&&($("#by_target").removeClass("selected"),$("#by_source").removeClass("selected"),$("#by_ability").addClass("selected")),$("#filter-subtype-selection-text").html($(".filter-subtype-option.selected").html()),(subFilterType!=g||l)&&(chartData=null));var b=filterBoss;filterBoss=void 0!==e.boss?parseInt(e.boss):-1;var v=filterWipes;filterWipes=e.wipes?e.wipes:0;var T=filterDifficulty;filterDifficulty=void 0!==e.difficulty?parseInt(e.difficulty):-1;var w=filterLastPhase;filterLastPhase=void 0!==e.lastphase?parseInt(e.lastphase):-1;var x=filterFightsArray,I=parseFilterFights(e.fight);I||filterPull==C||(I=!0);var C=filterPull;filterPull=e.pull?parseInt(e.pull):0;var P=parseFilterFightTimes(e.start,e.end),S=filterCutoff;filterCutoff=void 0===e.cutoff?parseInt(wipe_options):parseInt(e.cutoff),isNaN(filterCutoff)&&(filterCutoff=0),(-1==S&&filterCutoff>=0||S>=0&&-1==filterCutoff)&&storeUserOptions();var k=document.getElementById("wipe_cutoff");k.value=filterCutoff<=0?"":filterCutoff,-1==filterCutoff?($(k).hide(),$("#filter-wipecall-text").html($("#cutoff-item-1").html())):($(k).show(),$("#filter-wipecall-text").html($("#cutoff-item-0").html())),parseFilterEventStart(e.eventstart);var A=pinString,F=graphPinString,M=tablePinString,E=!1;m!=filterPhase&&(E=!0),filterReplayPosition=(e.position?parseInt(e.position):fightSegmentStartTime-filterFightStartTime)+filterFightStartTime,A!=(pinString=e.pins?e.pins:"")&&(rebuildPins(),E=!0);var D=m!=filterPhase;(I||filterBoss!=b||filterWipes!=v||filterDifficulty!=T||filterLastPhase!=w)&&(updateFightBossAndDetails(),p=!0,D=!0,E=!0),P&&(E=!0);var R=filterDeath;filterDeath=e.death?parseInt(e.death):0;var _=filterDeathReport;if(filterDeathReport=e.deathreport?parseInt(e.deathreport):0,(I||d||c||f!=filterAbility||filterDeath!=R)&&(chartData=null),f!=filterAbility&&(chartData=null),(a!=hostilityType||l)&&(chartData=null,$(".hostility-link").removeClass("selected"),0==hostilityType?$("#hostility-friendlies").addClass("selected"):$("#hostility-enemies").addClass("selected"),p=!0,$("#filter-subtype-strip").show(),$("#filter-subtype-tabs").hide(),$("#filter-subtype-options").hide(),$("#filter-ability-selection-dropdown").show(),$("#filter-target-selection-dropdown").show(),"damage-done"==filterType||"threat"==filterType&&hasThreatDetails()?($("#filter-subtype-options").show(),$("#filter-subtype-tabs").show(),$("#by_source").html("Done By Source"),$("#by_target").html("Done "+(0==hostilityType?"To Enemy":"To Friendly")),$("#by_ability").html("Done By Ability")):"damage-taken"==filterType?($("#filter-subtype-options").show(),$("#filter-subtype-tabs").show(),$("#by_target").html("Taken From Source"),$("#by_source").html("Taken "+(0==hostilityType?"By Friendly":"By Enemy")),$("#by_ability").html("Taken From Ability")):"healing"==filterType?($("#filter-subtype-options").show(),$("#filter-subtype-tabs").show(),$("#by_source").html("Done By Source"),$("#by_target").html("Done "+(0==hostilityType?"To Friendly":"To Enemy")),$("#by_ability").html("Done By Ability")):"auras"==filterType?($("#filter-subtype-options").show(),$("#filter-subtype-tabs").show(),$("#by_target").html(0==hostilityType?"Cast By Friendly":"Cast By Enemy"),$("#by_source").html(0==hostilityType?"Gained By Friendly":"Gained By Enemy"),$("#by_ability").html("")):"casts"==filterType?($("#filter-subtype-options").show(),$("#filter-subtype-tabs").show(),$("#by_source").html("Cast By Source"),$("#by_target").html("Cast On Target"),$("#by_ability").html("Cast By Spell")):"summons"==filterType?($("#filter-subtype-options").show(),$("#filter-subtype-tabs").show(),$("#by_source").html("By Creator"),$("#by_target").html("By Creation"),$("#by_ability").html("By Creating Ability")):"threat"==filterType?($("#by_ability").html(""),$("#filter-ability-selection-dropdown").hide(),$("#filter-subtype-options").show()):"deaths"==filterType&&$("#filter-target-selection-dropdown").hide(),$("#filter-subtype-selection-text").html($(".filter-subtype-option.selected").html())),filterSpellType!=(filterSpellType=e.spells?e.spells:"buffs")){p=!0,chartData=null,$(".filter-type-tab").removeClass("selected");var B="auras"==filterType?filterSpellType:filterType;$("#filter-"+B+"-tab").addClass("selected"),$("#graph-caption-text").html($("#filter-"+B+"-tab").html()),$("#filter-type-selector-text").html($("#filter-"+B+"-tab").html())}filterSpell!=n&&(chartData=null,"resources"==filterType?$("#filter-resource-selection-text").html($("#spell-"+filterSpell).text()):$("#filter-ability-text").html($("#spell-"+filterSpell).text()));var L=filterOptions;if((filterOptions=e.options?parseInt(e.options):determineDefaultFilterOptions())!=L&&(1&filterOptions?$("#filter-option-1").addClass("selected"):$("#filter-option-1").removeClass("selected"),2&filterOptions?$("#filter-option-2").removeClass("selected"):$("#filter-option-2").addClass("selected"),4&filterOptions?$("#filter-option-4").removeClass("selected"):$("#filter-option-4").addClass("selected"),8&filterOptions?$("#filter-option-8").addClass("selected"):$("#filter-option-8").removeClass("selected"),16&filterOptions?$("#filter-option-16").addClass("selected"):$("#filter-option-16").removeClass("selected"),32&filterOptions?$("#filter-option-32").removeClass("selected"):$("#filter-option-32").addClass("selected"),64&filterOptions?$("#filter-option-64").addClass("selected"):$("#filter-option-64").removeClass("selected"),128&filterOptions?$("#filter-option-128").addClass("selected"):$("#filter-option-128").removeClass("selected"),256&filterOptions?$("#filter-option-256").addClass("selected"):$("#filter-option-256").removeClass("selected"),512&filterOptions?$("#filter-option-512").addClass("selected"):$("#filter-option-512").removeClass("selected"),1024&filterOptions?$("#filter-option-1024").addClass("selected"):$("#filter-option-1024").removeClass("selected"),2048&filterOptions?$("#filter-option-2048").addClass("selected"):$("#filter-option-2048").removeClass("selected"),4096&filterOptions?$("#filter-option-4096").addClass("selected"):$("#filter-option-4096").removeClass("selected"),16384&filterOptions?$("#filter-option-16384").addClass("selected"):$("#filter-option-16384").removeClass("selected"),32768&filterOptions?$("#filter-option-32768").removeClass("selected"):$("#filter-option-32768").addClass("selected")),filterView!=i){$(".view-type-tab").removeClass("selected"),$("#filter-"+filterView+"-tab").addClass("selected"),"replay"==filterView?(l=!1,$("#pins").hide(),$("#footer").hide(),$("#top-banner").hide(),$("#bottom-banner").hide(),$("body").addClass("replay"),$("#view-tabs-and-table-container").hide(),$("#graph-wrapper").show(),$("#filter-source-and-hostility-selection").hide(),$("#filter-target-and-ability-selection").hide(),$("#filter-graph-dropdown").hide(),$(".filter-type-tab").removeClass("selected"),$("#position-graph").show(),$("#replay-buttons").show(),$("#graph-legend-buttons").hide(),$("#summary-menu").hide(),document.getElementById("replay-fight-duration").innerHTML=makeSmartDuration(Math.floor((fightSegmentEndTime-fightSegmentStartTime)/1e3),!0),$("#graph-zoom-container").hide(),$("#unit-frames-container").show(),$(".guild-sidebar").hide(),$("#filter-type-menubar").hide(),$("#filter-type-tabs").hide(),$("#filter-source-and-target-selection").hide(),$("#graph-caption").hide()):($("#pins").show(),$("#footer").show(),$("#top-banner").show(),$("#bottom-banner").show(),$("body").removeClass("replay"),$("#filter-replay-tab").removeClass("selected"),$("#filter-graph-dropdown").show(),"analytical"==filterView||"timeline"==filterView||"events"==filterView?($("#filter-analyze-tab").addClass("selected"),$("#filter-type-menubar").show(),$("#graph-wrapper").show(),$("#filter-type-tabs").show(),$("#filter-source-and-target-selection").show(),$("#row-above-table").show(),$("#graph-zoom-container").show(),$("#table-caption").show()):($("#filter-analyze-tab").removeClass("selected"),$("#filter-type-menubar").hide(),$("#filter-type-tabs").hide(),$("#filter-source-and-target-selection").hide(),"execution"==filterView?($("#graph-wrapper").show(),$("#row-above-table").show(),$("#graph-zoom-container").show(),$("#table-caption").show()):($("#graph-wrapper").hide(),$("#row-above-table").hide(),$("#graph-zoom-container").hide(),$("#table-caption").hide())),"replay"==i&&(l=!0),$("#view-tabs-and-table-container").show(),$("#position-graph").hide(),$("#replay-buttons").hide(),$("#graph-legend-buttons").show(),$("#summary-menu").show(),$("#unit-frames-container").hide(),$(".guild-sidebar").show(),$("#view-"+filterView+"-tab").addClass("selected"),$("#graph-caption").show()),$("#replay-map-info").hide(),"replay"!=filterView&&"replay"!=i||(clearGraphURLs(),chartData=null),B="auras"==filterType?filterSpellType:filterType;var O="execution"==filterView?$("#filter-"+filterView+"-tab").text():$("#filter-"+B+"-tab").html();$("#graph-caption-text").html(O)}if((l||I)&&"deaths"==filterType&&$("#filter-death-selection-dropdown").show(),l){p=!0,clearGraphURLs(),$(".filter-type-tab").removeClass("selected"),B="auras"==filterType?filterSpellType:filterType,$("#filter-"+B+"-tab").addClass("selected"),O="execution"==filterView?$("#filter-"+filterView+"-tab").text():$("#filter-"+B+"-tab").html(),$("#graph-caption-text").html(O),$("#filter-summons-tab").hide(),$("#filter-summons-tab").removeClass("selected"),$("#filter-death-selection-dropdown").hide(),$("#filter-resource-selection-dropdown").hide();var U=$("#graph-container").hasClass("compact");"summary"==filterType?($("#filter-source-and-hostility-selection").show(),$("#filter-target-and-ability-selection").hide(),$("#filter-ability-selection-container").hide(),$("#hostility-link-container").show(),$("#graph-container").addClass("compact")):"deaths"==filterType?($("#filter-source-and-hostility-selection").show(),$("#filter-target-and-ability-selection").show(),$("#filter-ability-selection-container").show(),$("#filter-death-selection-dropdown").show(),$("#hostility-link-container").show(),$("#graph-container").addClass("compact")):"auras"==filterType?($("#filter-source-and-hostility-selection").show(),$("#filter-target-and-ability-selection").show(),$("#filter-ability-selection-container").hide(),$("#hostility-link-container").show(),$("#graph-container").addClass("compact")):"resources"==filterType?($("#filter-source-and-hostility-selection").show(),$("#filter-target-and-ability-selection").hide(),$("#filter-ability-selection-container").hide(),$("#hostility-link-container").show(),$("#filter-resource-selection-dropdown").show(),$("#graph-container").removeClass("compact")):"casts"==filterType||"summons"==filterType||"interrupts"==filterType||"dispels"==filterType?($("#filter-source-and-hostility-selection").show(),$("#filter-target-and-ability-selection").show(),$("#filter-ability-selection-container").show(),$("#hostility-link-container").show(),$("#graph-container").addClass("compact"),$("#filter-summons-tab").show(),"summons"==filterType&&$("#filter-summons-tab").addClass("selected")):($("#filter-source-and-hostility-selection").show(),$("#filter-target-and-ability-selection").show(),$("#filter-ability-selection-container").show(),$("#hostility-link-container").show(),$("#graph-container").removeClass("compact")),$("#graph-container").hasClass("compact")!=U&&$("#graph").html("");for(var z=1;z<=32768;z*=2)8192!=z&&$("#filter-option-"+z).hide();"damage-taken"==filterType?($("#filter-option-4").html(trans("reports.external_absorbs")),$("#filter-option-1").show(),$("#filter-option-2").show(),$("#filter-option-4").show(),0==game_id&&logVersion>=5||2==game_id&&logVersion>=47||4==game_id?($("#filter-option-32").show(),$("#filter-option-128").show()):$("#filter-option-4").html(trans("reports.absorbs")),minimumUnmitigatedDamageLogVersion>0&&logVersion>=minimumUnmitigatedDamageLogVersion&&$("#filter-option-4096").show()):"damage-done"==filterType||"casts"==filterType||"summons"==filterType?($("#filter-option-2").show(),"casts"!=filterType&&"summons"!=filterType||$("#filter-option-64").show(),"damage-done"==filterType&&$("#filter-option-256").show()):"healing"==filterType?($("#filter-option-8").show(),$("#filter-option-2").show(),$("#filter-option-4").show(),$("#filter-option-4").html(trans("reports.absorbs")),0==game_id&&$("#filter-option-2048").show(),minimumMitigationInHealingDoneLogVersion>0&&0==hostilityType&&logVersion>=minimumMitigationInHealingDoneLogVersion&&$("#filter-option-16384").show(),$("#filter-option-32768").show()):"auras"==filterType?($("#filter-option-16").show(),$("#filter-option-2").show()):"threat"==filterType&&($("#filter-option-2").show(),$("#filter-option-1024").show()),$("#filter-type-selector-text").html($("#filter-"+B+"-tab").html())}(l||a!=hostilityType)&&("damage-done"==filterType||"casts"==filterType||"summons"==filterType?("damage-done"==filterType&&0==game_id&&(0==hostilityType?$("#filter-option-512").show():$("#filter-option-512").hide()),0==hostilityType?$("#filter-option-1024").show():$("#filter-option-1024").hide()):"deaths"==filterType&&(0==hostilityType?$("#filter-target-and-ability-selection").show():$("#filter-target-and-ability-selection").hide())),p&&(clearCompareSearchResults(),"none"!=document.getElementById("compare-ui").style.display&&(hideCompareUI(),showCompareUI()),sourceMenuActors="friendlies",targetMenuActors="enemies","healing"==filterType||"resources"==filterType||"summons"==filterType?0==hostilityType?targetMenuActors="friendlies":sourceMenuActors="enemies":"auras"==filterType?(1==hostilityType&&(sourceMenuActors="enemies",targetMenuActors="friendlies"),"buffs"==filterSpellType&&(targetMenuActors=sourceMenuActors)):"summary"==filterType||"damage-done"==filterType||"damage-taken"==filterType||"threat"==filterType||"deaths"==filterType||"interrupts"==filterType||"dispels"==filterType?1==hostilityType&&(sourceMenuActors="enemies",targetMenuActors="friendlies"):"casts"==filterType&&(1==hostilityType&&(sourceMenuActors="enemies"),targetMenuActors="all"),buildActorMenu("filter-source-selection",sourceMenuActors,"source","Source","&nbsp;",!1,"deaths"==filterType&&0==hostilityType),"deaths"==filterType||"resources"==filterType?($("#filter-target-selection-dropdown").addClass("hidearrow"),$("#filter-target-selection-container").html("")):($("#filter-target-selection-dropdown").removeClass("hidearrow"),buildActorMenu("filter-target-selection",targetMenuActors,"target","Target","&nbsp;",!1,!1))),D&&buildPhaseMenu();var V=p||d||u!=filterSourceClass||c||h!=filterTargetClass||P;V&&resetFilterBuffs(),(V||g!=subFilterType)&&resetAbilityMenu(),setFilterActorText("filter-source-text",!0),setFilterActorText("filter-target-text",!1),setMenuAbilityString(filterAbility?lookupAbilityName(filterAbility):"deaths"==filterType?"All Killing Blows":"All Abilities"),l&&Tipped.remove(".tabtooltip"),abortPendingGraphRequests(),abortPendingTableRequests(),abortPendingdeathsOrResourcesRequests();var H=!1;if(("deaths"==filterType&&0==hostilityType&&(p||d||u!=filterSourceClass||M!=tablePinString||S!=filterCutoff||f!=filterAbility)||"resources"==filterType&&(p||d||u!=filterSourceClass||M!=tablePinString))&&(loadDeathsOrResources(),H=!0,F!=graphPinString&&clearGraphURLs(),M!=tablePinString&&(tableURL="")),H)Tipped.remove(".tabtooltip");else if("deaths"==filterType&&(filterDeath!=R||filterDeathReport!=_))if(filterDeath){var W=reportsCache[filterDeathReport],N=W.deathsOrResourcesData.entries[filterDeath-1];$("#filter-death-selection-text").html("<span style='color:white'>"+makeSmartDuration(Math.floor((N.timestamp-W.fightSegmentStartTime)/1e3))+" -</span> <span class='"+N.type+"'>"+N.name+"</span> "+menuItemComparisonMarkers(null,filterDeathReport,!0))}else $("#filter-death-selection-text").html("All Deaths");filterMetric=e.playermetric?e.playermetric:"default",filterMetricTimeframe=e.playermetrictimeframe?e.playermetrictimeframe:"today",filterMetricCompare=e.playermetriccompare?e.playermetriccompare:"rankings";var G=!1,q=document.getElementById("view-tabs-and-table-container");q&&(q.style.opacity="0.4"),"replay"==filterView?G=!loadReplay():("replay"==i&&replayLoaded&&haltReplay(),H||(G=!loadTableOrEvents()));var X=!G||graphPinString!=F||perfGraph!=y;if(X&&showGraphLoadElements(!0),!H&&X&&loadGraph(),hasZoomedFight()){var Y=Math.floor((fightSegmentStartTime-filterFightStartTime)/1e3),j=Math.floor((fightSegmentEndTime-filterFightStartTime)/1e3);$("#graph-zoom-info").html(makeSmartDuration(Y)+"-"+makeSmartDuration(j)+(-1!=filterBoss||filterFightsArray.length>1?" (Multiple Fights)":"")),document.getElementById("graph-reset-zoom").style.display="inline"}else if(document.getElementById("graph-reset-zoom").style.display="none",1==filterFightsArray.length){var J=isDungeonOrTower(fightsTable[filterFightsArray[0]]);document.getElementById("graph-zoom-info").innerHTML="Entire "+(filterPull?"Pull":J?"Dungeon":"Fight")}else fights.length?document.getElementById("graph-zoom-info").innerHTML="Multiple Fights":document.getElementById("graph-zoom-info").innerHTML="Entire Report";filterView==i||"replay"!=filterView&&"replay"!=i||($("#table-container").html(""),$("#graph").html(""),$("#unit-frame-container").html("")),E&&loadPinGraphs();var K=x&&x.length?fightsTable[x[0]].boss:b,Z=filterFightsArray.length?fightsTable[filterFightsArray[0]].boss:filterBoss,Q=x&&x.length?fightsTable[x[0]].difficulty:T,ee=filterFightsArray.length?fightsTable[filterFightsArray[0]].difficulty:filterDifficulty;K==Z&&Q==ee||!document.getElementById("view-rankings-command")||(document.getElementById("view-rankings-command").href="/rankings/report/"+report_id+(Z>0?"#boss="+Z+"&difficulty="+ee:""));var te=comparePlayer;(comparePlayer=void 0!==e.comparesearchplayer?parseInt(e.comparesearchplayer):0)!=te&&setComparisonPlayerText("compare","Compare",comparePlayer);var ie=compareMetric;(compareMetric=void 0!==e.comparesearchmetric?e.comparesearchmetric:"default")!=ie&&setComparisonMetricText();var re=compareSearch;compareSearch=void 0!==e.comparesearch?e.comparesearch:"",te==comparePlayer&&ie==compareMetric&&re==compareSearch||(clearCompareSearchResults(),re!=compareSearch&&performComparisonSearch()),"replay"==filterView&&pins.length?$("#slideshow").show():$("#slideshow").hide(),loadAbilitiesMenuIfNeeded(),needToLoadFilterBuffs?loadFilterBuffsIfNeeded():s==filterSourceBuffsString&&o==filterTargetBuffsString||updateFilterBuffsSelection();var ae=-1!=filterBoss||0!=filterWipes;return reportsCache[0].filterFightsArray.length||ae?($("body").removeClass("overview"),$("#anyclip-container-box").show()):$("body").addClass("overview"),!1}window.location.reload()}function updateFilterViewParams(e,t){t==defaultView()?delete e.view:e.view=t,"replay"==t&&(delete e.type,delete e.source,delete e.sourceClass,delete e.target,delete e.targetclass,delete e.ability,delete e.by,delete e.death,delete e.spell,delete e.spells,delete e.eventstart,delete e.start,delete e.end,delete e.pull,delete e.sourcebuffs,delete e.targetbuffs),"execution"!=t&&"rankings"!=t||(delete e.type,delete e.sourcebuffs,delete e.targetbuffs),"compare"==t&&(delete e.start,delete e.end)}function changeFilterView(e,t){if("none"!=document.getElementById("pins-ui").style.display&&hidePinUI(),"none"!=document.getElementById("compare-ui").style.display&&hideCompareUI(),document.getElementById("report-component-sandbox-container")&&"none"!=document.getElementById("report-component-sandbox-container").style.display&&hideComponentPlayground(),filterView==e)return!1;var i=$.deparam.fragment();return updateFilterViewParams(i,e),t?changeLink(t,i):changeView(i)}function changeToReplayWithPosition(e,t){var i=$.deparam.fragment();return updateFilterViewParams(i,"replay"),0==e?delete i.position:i.position=e,t?changeLink(t,i):changeView(i)}function setTranslate(e){if(filterTranslate!=e){var t=$.deparam.fragment();e?t.translate="true":delete t.translate,changeView(t)}}function updateFilterTypeParams(e,t){if(filterType!=t&&(filterSource||"Any"!=filterSourceClass||!filterTarget&&!filterTargetClass||"auras"!=t||"healing"!=filterType||(filterTarget?updateFilterSourceParams(e,filterTarget,filterTargetInstance):filterTargetClass&&(e.sourceclass=filterTargetClass)),"summary"!=t&&"execution"==filterView&&delete e.view,delete e.target,delete e.targetclass,delete e.ability,delete e.by,delete e.death,delete e.spell,delete e.spells,delete e.eventstart,delete e.options,delete e.graphperf,delete e.sourcebuffs,delete e.targetbuffs,e.type=t,"deaths"==t&&(e.type=t,filterSource))){for(var i=null,r=0;r<players.length;++r)if(players[r].id==filterSource){i=players[r];break}i||delete e.source}}function toggleSummonsFilter(e){return changeFilterType("summons"==filterType?"casts":"summons",e)}function changeFilterType(e,t){if("none"!=document.getElementById("pins-ui").style.display&&hidePinUI(),document.getElementById("report-component-sandbox-container")&&"none"!=document.getElementById("report-component-sandbox-container").style.display&&hideComponentPlayground(),filterType==e&&"replay"!=filterView)return!1;var i=$.deparam.fragment();return updateFilterTypeParams(i,e),"replay"==filterView&&updateFilterViewParams(i,"analytical"),t?changeLink(t,i):changeView(i)}function changeAuraType(e,t){if("auras"==filterType&&filterSpellType==e&&"replay"!=filterView)return!1;var i=$.deparam.fragment();return updateFilterTypeParams(i,"auras"),"replay"==filterView&&updateFilterViewParams(i,"analytical"),"buffs"==e?delete i.spells:i.spells=e,t?changeLink(t,i):changeView(i)}function updateFilterByParams(e,t,i,r){if("damage-done"==i||"damage-taken"==i||"healing"==i||"casts"==i||"summons"==i)return r&&"ability"==t||!r&&"source"==t?delete e.by:e.by=t,void delete e.graphperf;"source"==t||"hp"==t?delete e.by:e.by=t}function changeSubFilterType(e,t){if(subFilterType==e)return!1;var i=$.deparam.fragment();return updateFilterByParams(i,e,filterType,filterSource),t?changeLink(t,i):changeView(i)}function toggleFilterOption(e,t){var i;i=0!=(filterOptions&e)?filterOptions&~e:filterOptions|e;var r=$.deparam.fragment();return i==determineDefaultFilterOptions()?delete r.options:r.options=i,delete r.graphperf,t?changeLink(t,r):changeView(r)}function pluralClassDisplay(e){return"Shaman"==e?"Shaman":"DeathKnight"==e?"Death Knights":"DemonHunter"==e?"Demon Hunters":"WSWarrior"==e?"Warriors":"Boss"==e?"Bosses":e+"s"}function changeBossAndWipes(e,t,i,r,a,n){if(filterBoss==e&&filterDifficulty==t&&filterWipes==i&&filterLastPhase==r&&!n)return!1;var s=$.deparam.fragment();if(n&&updateFilterViewParams(s,n),delete s.fight,delete s.pull,delete s.cutoff,delete s.start,delete s.end,delete s.death,delete s.eventstart,delete s.compareplayersearch,delete s.sourcebuffs,delete s.targetbuffs,(filterFightsArray.length?fightsTable[filterFightsArray[0]].boss:-1!=filterBoss?filterBoss:0)!=(-1!=e?e:0)&&delete s.phase,-1==e?delete s.boss:s.boss=e,-1==t?delete s.difficulty:s.difficulty=t,-1==r||e<=0||1!=i?delete s.lastPhase:s.lastphase=r,i?s.wipes=i:delete s.wipes,e<=0||1!=i||-1==r?delete s.lastphase:s.lastphase=r,e){var o=filterSource?actorTable[filterSource]:void 0,l=filterTarget?actorTable[filterTarget]:void 0,p=comparePlayer?actorTable[comparePlayer]:void 0;o&&-1==o.bosses.indexOf("."+e+".")&&delete s.source,l&&-1==l.bosses.indexOf("."+e+".")&&delete s.target,p&&-1==p.bosses.indexOf("."+e+".")&&delete s.comparesearchplayer}return a?changeLink(a,s):changeView(s)}function displayNiceTime(e){var t=e.getHours(),i=e.getMinutes(),r=" AM";return t>=12&&(t-=12,r=" PM"),0===t&&(t=12),i<10&&(i="0"+i.toString()),t+":"+i+r}function isChallengeMode(e){return e.difficulty>=9&&e.difficulty<=11}function isTowerRun(e){return 20==e.difficulty}function isDungeonOrTower(e){return isChallengeMode(e)||isTowerRun(e)}function outputFightDetails(e,t,i,r,a,n,s,o,l,p,d){var c="";!r||o&&comparisonReports.length||(c+="<span class='last-pull-label'>Last "+(isDungeonOrTower(i)?"Run":"Pull")+" -</span> "),c+="<span style='white-space:nowrap; position:relative; line-height:17px' class='",i.kill?c+="kill":i.inProgress?c+="inprogress":i.boss>0?c+="wipe":c+="NPC",c+="'>",e<=0&&(!l||0==d)&&(c+=fightNameAndDifficulty(i)+" ");var u=isChallengeMode(i),h=isTowerRun(i),f=!1;if(void 0!==s&&s>=0&&(c+=phasesTable[e].phases[s]+" ",f=!0),i.boss>0&&(!l||0==d||p!=i.kill)){if(i.kill?u?c+=" "+fightMedal(i):h||(c+=" Kill"):i.inProgress?c+=" In Progress Pull":c+=" "+(u||h?logVersion>=7?"":"Reset":1==i.partial?"Invalid Log":"Wipe"),u&&i.keystoneLevel>0&&(!l||0==d)){if(c+=" Level "+i.keystoneLevel,i.affixes&&i.affixes.length){c+=" <span style='display:inline-block;'><span style='vertical-align:-4px; margin-right:4px; margin-left:2px'>";for(var m=0;m<i.affixes.length;++m)c+="<img class='affix-icon' title='"+nameForAffix(i.affixes[m])+"' src='"+icon_path+"abilities/"+iconForAffix(i.affixes[m])+"'>";c+="</span></span>"}}else h&&i.layer>0&&(!l||0==d)&&(c+=" Layer "+i.layer);i.kill?e>0&&!a&&i.killNumber>1&&(c+=" "+i.killNumber):e>0&&!a&&i.wipeNumber>1&&(c+=" "+i.wipeNumber)}if(a&&n){a>1&&!u&&!h&&(c+="s"),f||(c+=" ("+a+")");var g=hashForBossAndDifficulty(e,t);return(c+=menuItemComparisonMarkers(i.kill?reportsCache.bossHash[g].lastKills:reportsCache.bossHash[g].lastWipes,i.reportIndex,o))+"</span>"}return a>1&&(c+=" "+(i.kill?i.killNumber:i.wipeNumber)),l||(c+=addFightTimeAndDuration(i)),comparisonReports.length&&(c+=o?" <span class='comparison-color small comparison-"+i.reportIndex+"'></span>":menuItemComparisonMarkers(null,i.reportIndex,!0)),c+"</span>"}function lastMatchingFight(e,t,i,r){for(var a,n=e.fights.length-1;n>=0;--n){if(e.fights[n].boss>0){if(1==i&&e.fights[n].kill)continue;if(2==i&&!e.fights[n].kill)continue}if(!(t>=0&&t!=e.fights[n].boss)&&!(t>0&&r>=0&&r!=e.fights[n].difficulty)&&(-2!=t||e.fights[n].boss)){a=e.fights[n];break}}return a}function firstCacheWithDefinedFightID(){for(var e=0;e<reportsCache.length;++e)if(reportsCache[e].filterFightsArray.length)return reportsCache[e];return null}function updateFightBossAndDetails(){needToBuildBossFightMenu&&(needToBuildBossFightMenu=!1,buildFightBossOverview());var e=firstCacheWithDefinedFightID(),t=e?e.fightsTable[e.filterFightsArray[0]].boss:filterBoss,i=e?e.fightsTable[e.filterFightsArray[0]].difficulty:filterDifficulty,r=hashForBossAndDifficulty(t,i),a=reportsCache.bossHash[r];if(0==game_id||2==game_id||4==game_id||5==game_id){var n=-1==zone_id?"unknown":zone_id;document.getElementById("filter-fight-boss-icon").src=t<=-2?icon_path+"zones/zone-"+n+".png":icon_path+"bosses/"+t+"-icon."+(4==game_id||5==game_id?"png":"jpg")}e&&t>0?$("#filter-fight-boss-text").html(fightNameAndDifficulty(e.fightsTable[e.filterFightsArray[0]])+"<span class='sub-arrow'>+</span>"):a&&$("#filter-fight-boss-text").html(fightNameAndDifficulty(a)+"<span class='sub-arrow'>+</span>");var s=a?a.wipes:0,o=a?a.kills:0,l=a&&a.lastWipe?a.lastWipe.fight:void 0,p=a&&a.lastKill?a.lastKill.fight:void 0,d=-3==t?"Encounters and Trash Fights":"Encounters";if(-1!=filterBoss)if(filterBoss<=0){$("#filter-fight-details-text").attr("class",0==filterBoss?"NPC":"Boss");var c="All "+(0==filterWipes?d:1==filterWipes?"Wipes":"Kills");c+=menuItemComparisonMarkers(1==filterWipes?a.lastWipes:2==filterWipes?a.lastKills:a.last,-1,!0),$("#filter-fight-details-text").html(c)}else 0==filterWipes?($("#filter-fight-details-text").attr("class","kill"),c="All "+d,c+=menuItemComparisonMarkers(a.last,-1,!0),$("#filter-fight-details-text").html(c)):1==filterWipes&&l?$("#filter-fight-details-text").html(outputFightDetails(t,i,l,!1,s,!0,filterLastPhase,!1)):2==filterWipes&&p&&$("#filter-fight-details-text").html(outputFightDetails(t,i,p,!1,o,!0,-1,!1));else{c="";for(var u=0;u<reportsCache.length;++u){var h=reportsCache[u];if(h.filterFightsArray.length>=1){for(var f=!1,m=0;m<h.filterFightsArray.length;++m){m>0&&(c+=", ");var g=0;!h.fightsTable[h.filterFightsArray[m]].kill&&l?g=s:h.fightsTable[h.filterFightsArray[m]].boss>0&&h.fightsTable[h.filterFightsArray[m]].kill&&p&&(g=o),c+=outputFightDetails(t,i,h.fightsTable[h.filterFightsArray[m]],h.filterFightIsLastPull,g,!1,-1,!1,h.filterFightsArray.length>1,f,m),f=h.fightsTable[h.filterFightsArray[m]].kill}c+=" "}}c||(c="None"),c&&$("#filter-fight-details-text").html(c)}}function changeToLastFights(e,t,i){for(var r=$.deparam.fragment(),a=hashForBossAndDifficulty(e,t),n=reportsCache.bossHash[a],s=n.last,o=n.lastKills,l="",p=0;p<reportsCache.length;++p)p>0&&(l+=","),p<o.length&&void 0!==o[p]?(updateParamsWithFightIDAtIndex(r,p,o[p].id),l+=o[p].id):p>=s.length||void 0===s[p]?(updateParamsWithFightIDAtIndex(r,p,-1),l+=0):(updateParamsWithFightIDAtIndex(r,p,s[p].id),l+=s[p].id);if(s.length>0&&s[0]==reportsCache[0].lastPull){if("last"==r.fight)return toggleFightSelectionUI(!0),!1;r.fight="last",delete r.pull}else{if(r.fight==l)return toggleFightSelectionUI(!0),!1;r.fight=l,delete r.pull}return i?changeLink(i,r):changeView(r)}function updateParamsWithFightIDAtIndex(e,t,i){var r=reportsCache[t];if(i==r.filterFightsString&&-1==filterBoss&&!filterWipes)return!1;if(delete e.boss,delete e.wipes,delete e.difficulty,delete e.lastphase,delete e.death,delete e.comparesearch,delete e.sourcebuffs,delete e.targetbuffs,updateParamsWithEventStartAtIndex(e,-1,t),i>=0){var a=filterSource?r.actorTable[filterSource]:void 0,n=filterTarget?r.actorTable[filterTarget]:void 0,s=comparePlayer?r.actorTable[comparePlayer]:void 0;a&&-1==a.fights.indexOf("."+i+".")&&delete e.source,n&&-1==n.fights.indexOf("."+i+".")&&delete e.target,s&&-1==s.fights.indexOf("."+i+".")&&delete e.comparesearchplayer}var o=reportsCache.filterFightBoss>=0?reportsCache.filterFightBoss:filterBoss,l=i>=0?r.fightsTable[i].boss:filterBoss;return i>=0&&!e.target&&"damage-taken"==filterType&&filterAbility&&o!=l&&delete e.ability,o!=l&&delete e.phase,i>=0&&filterSpell&&"auras"==filterType&&!e.target&&(0==hostilityType&&"debuffs"==filterSpellType||1==hostilityType&&"buffs"==filterSpellType)&&delete e.ability,delete e.start,delete e.end,!0}function buildFightParameterString(e,t,i){if(!comparisonReports.length)return i?"last":e;for(var r="",a=0;a<reportsCache.length;++a)a>0&&(r+=","),r+=a==t?i?"last":e:reportsCache[a].filterFightsString;return r}function changeWipeCutoff(e){if(""==e&&(e=0),e==filterCutoff)return!1;var t=$.deparam.fragment();return e==wipe_options?delete t.cutoff:t.cutoff=e,changeView(t)}function changeFightByIDAndIndex(e,t,i,r){if(fightMultipleSelectBoss>0){var a=reportsCache[t].fightsTable[e];if(a.boss==fightMultipleSelectBoss&&a.difficulty==fightMultipleSelectDifficulty)return toggleFightMultipleSelection(a),i&&i.setAttribute("onclick","return false"),!1}i&&i.removeAttribute("onclick");var n=$.deparam.fragment(),s=r==reportsCache[0].filterFightIsLastPull;return!(!updateParamsWithFightIDAtIndex(n,t,e)&&s)&&(n.fight=buildFightParameterString(e,t,r),delete n.pull,i?changeLink(i,n):changeView(n))}function fightNameAndDifficulty(e){var t=e.name;return 1==game_id?t+(e.difficulty>100?" Prime "+(e.difficulty-100):""):(1==e.difficulty?t+=" LFR":2==e.difficulty?t+=" Flex":3==e.difficulty?t+=" Normal":4==e.difficulty?t+=" Heroic":5==e.difficulty?t+=" Mythic":20==e.difficulty&&e.size?1==e.size?t+=" (Solo)":t+=" ("+e.size+"-Man)":101==e.difficulty?t+=" Savage":9==e.difficulty||120==e.difficulty?t+=" Normal":10==e.difficulty&&4==game_id||121==e.difficulty?t+=" Veteran":11==e.difficulty||122==e.difficulty?t+=" Veteran HM":e.difficulty>=123?t+=" Veteran +"+(e.difficulty-122):e.difficulty>=110&&e.difficulty<=112&&(e.size&&(t+=" ("+e.size+"-Man "),110==e.difficulty?t+=" Story":111==e.difficulty?t+=" Veteran":112==e.difficulty&&(t+=" Master"),e.size&&(t+=")")),t)}function fightMedal(e){return logVersion>=7?"":3==e.medal?"Gold Run":2==e.medal?"Silver Run":1==e.medal?"Bronze Run":"Run"}function bossWipesAndDifficultyString(){return filterBoss+"."+filterWipes+"."+filterDifficulty+"."+filterLastPhase}function makeSmartDuration(e,t){var i="",r=Math.floor(e/3600),a=Math.floor(e%3600/60),n=e%60;return r>0&&(i+=r+":",t=!0),i+(t&&a<10?"0":"")+a+":"+(n<10?"0":"")+Math.floor(n)}function durationForFight(e){return void 0!==e.completionTime?e.completionTime:e.end_time-e.start_time}function addFightTimeAndDuration(e,t){var i="";i+=" <span class='fight-duration'>("+makeSmartDuration(Math.floor(durationForFight(e)/1e3))+")</span>",e.kill||(e.bossPercentage>0&&(i+=" <span class='fight-percent'><span style='color:white'>-</span> "+Math.floor(e.bossPercentage/100)+"%</span>"),e.lastPhaseForPercentageDisplay>=1&&(i+="<span class='fight-phase'> ",e.lastPhaseIsIntermission?i+="I":i+="P",i+=e.lastPhaseForPercentageDisplay+"</span>"));var r=start_time;e.reportIndex>0&&(r=comparisonReports[e.reportIndex-1].start);var a=new Date(r+e.start_time);return(i+=" <span class='fight-time' style='color:#ddd;font-style:italic;font-size:11px; margin-left:4px'>"+(void 0!==t?"+"+makeSmartDuration((e.start_time-t)/1e3):displayNiceTime(a))+" ")+"</span>"}function classForBossPercentage(e){return e<=0?"":e>=7500?"common-bg":e>=5e3?"uncommon-bg":e>=2500?"rare-bg":e>=1e3?"epic-bg":e>=100?"legendary-bg":e<100?"astounding-bg":void 0}function buildFightGridCell(e,t){var i="<span class='fight-grid-number'>"+t+"</span><span class='fight-grid-duration'>(",r=start_time;e.reportIndex>0&&(r=comparisonReports[e.reportIndex-1].start);var a=new Date(r+e.start_time);i+=makeSmartDuration(Math.floor(durationForFight(e)/1e3)),i+=")</span><span class='fight-grid-time' style='color:#ddd;font-style:italic;font-size:11px; margin-left:4px'>"+displayNiceTime(a)+" ",i+="</span>",comparisonReports.length&&(i+=" <span class='comparison-color small comparison-"+e.reportIndex+"'></span>");var n=e.fightPercentage>0?e.fightPercentage:e.bossPercentage;if(!e.kill){var s=100-Math.floor(n/100);i+="<div class='wipes-percent-bg'><div class='wipes-percent-fg "+classForBossPercentage(n)+"' style='width:"+s+"%'></div></div>"}return i}function menuItemComparisonMarkers(e,t,i){var r="";if(!comparisonReports.length)return r;var a=20*reportsCache.length;i||(r+="<span style='margin-right:"+a+"px'></span>",r+="<span style='position:absolute; right:4px; white-space:nowrap'>");for(var n=e?e.length:reportsCache.length,s=0;s<n;++s){var o=e&&e[s]||t>=0&&t==s;i&&!o||(r+="<span class='comparison-color small "),o&&(r+="comparison-"+s),i&&!o||(r+="'></span>")}return i||(r+="</span>"),r}function log(e){}function buildFightBossOverviewEntry(e){var t="";if(t+="<div ",t+=" class='report-overview-boss-box'",t+="><a class='report-overview-boss-caption' ",e.boss>0?t+=" onmousedown='changeToLastFights("+e.boss+", "+e.difficulty+", this)'":t+=" onmousedown='changeBossAndWipes("+e.boss+", "+e.difficulty+", 0, -1, this)'",t+=">",0==game_id||2==game_id||4==game_id||5==game_id){var i=-1==zone_id?"unknown":zone_id;e.boss<=-2?t+="<img onerror='this.src = defaultBossImage()' class='fight-selection-boss-icon' src='"+icon_path+"zones/zone-"+i+".png'>":t+="<img onerror='this.src = defaultBossImage()' class='fight-selection-boss-icon' src='"+icon_path+"bosses/"+e.boss+"-icon."+(4==game_id||5==game_id?"png":"jpg")+"'>"}t+='<span class="report-overview-boss-text">'+fightNameAndDifficulty(e)+"</span>";var r=e.boss,a=e.difficulty,n=hashForBossAndDifficulty(r,a),s=reportsCache.bossHash[n],o=s&&s.lastKill?s.lastKill.fight:void 0;o||(o=s&&s.lastWipe?s.lastWipe.fight:void 0);var l=reportsCache[0].lastPull;s&&o&&(t+="<span class='report-overview-boss-kill'>"+outputFightDetails(r,a,o,o==l,0,!1,-1,!1)+"</span>");var p=-3==r;return r>0&&s.kills+s.wipes>1&&(1===s.kills&&(p=!0),t+="<span onmousedown='event.stopPropagation()' id='fight-details-toggle-"+r+"-"+a+"' class='report-overview-boss-details-toggle' onclick='return toggleFightPullsVisibility(event, "+r+","+a+")'><span class='fight-details-toggle-text'>",t+=p?"Show All":"Hide All",t+="</span> <span class='sub-arrow'>+</span></span>"),e.zoneName&&(t+="<span class='report-overview-zone-name'>"+e.zoneName+"</span>"),t+="</a>",(r<=0||s.kills+s.wipes>1)&&(t+=buildFightOverviewEntryDetails(e,p)),t+"</div>"}function buildFightOverviewEntryDetails(e,t){var i=reportsCache[0].lastPull,r=e.boss,a=e.difficulty,n=hashForBossAndDifficulty(r,a),s=reportsCache.bossHash[n],o=(s&&s.lastWipe&&s.lastWipe.fight,s&&s.lastKill&&s.lastKill.fight,0==r),l=s?s.kills:0,p=s?s.wipes:0,d=r>0&&p>1&&phasesTable[r]&&phasesTable[r].separatesWipes,c='<div id="fight-details-'+r+"-"+a+'" class="report-overview-boss-pulls '+(t?"collapsed":"")+'">',u=!0;if(0!=r){if(l>1&&(c+=buildFightDetailsAllFightsEntry(r,a,l,0,2,!0),c+=buildFightDetailsAllFightsEntry(r,a,l,0,2)),p>1&&(c+=buildFightDetailsAllFightsEntry(r,a,0,p,1)),l>0&&p>0&&(c+=buildFightDetailsAllFightsEntry(r,a,l,p,0)),d){c+="<a href='#' onclick='return toggleWipePhaseSeparation(this, "+r+","+a+")' class='";var h=window.localStorage.getItem("wipes-phase-separation-mode");void 0!==h&&"combined"===h&&(u=!1),u&&(c+="selected"),c+=" wipe-phase-separation-toggle all-fights-entry'>Separate Wipes By Phase</a>"}r>0&&(l>1||p>1)&&(c+="<span id='specific-fights-"+r+"-"+a+"'><a class='specific-fights-toggle all-fights-entry Boss' href='#' onclick='showFightMultipleSelectionUI("+r+","+a+"); return false'>Select Specific Fights...</a><br><span class='specific-fights-selection' style='outline:none'>Click the specific fights you want to view, and then click the <i>View Fights</i> link to the right. ",c+="<a class='Boss' style='margin-left:5px' href='#' onclick=\"return changeToMultipleSelectedFights(this)\"",c+=' oncontextmenu="changeToMultipleSelectedFights(this)"',c+=">View Fights</a></span></span>"),r<0&&i&&(c+="<a class='all-fights-entry ",i.kill?c+="kill":i.inProgress?c+="inprogress":i.boss>0?c+="wipe":c+="NPC",c+="' href='#' onmousedown=\"changeFightByIDAndIndex("+i.id+', 0, this, true)"',c+=">",c+=outputFightDetails(r,a,i,!0),c+="</a>")}if(0==l&&0==p&&(c+="None"),o)for(var f=0;f<reportsCache.length;++f)for(var m=reportsCache[f],g=0;g<m.fights.length;++g){var y=m.fights[g];if(0==y.boss){needSeparatorAfterKills=!0;var b="";b+="<div><a class='NPC' href='#' onmousedown=\"changeFightByIDAndIndex("+y.id+", "+y.reportIndex+', this, false)">',b+=outputFightDetails(r,a,y,!1),c+=b+="</a></div>"}}else if(r>0&&((l>1||t&&1===l)&&(c+=buildFightGridCellsForPhase(r,a,!1)),p>0&&(d&&(c+="<div style='"+(u?"display:none":"")+"' class='fight-grid-"+r+"-"+a+"-wipes-all'>"),c+=buildFightGridCellsForPhase(r,a,!0),d))){c+="</div>",c+="<div style='"+(u?"":"display:none")+"' class='fight-grid-"+r+"-"+a+"-wipes-phases'>";for(var v=0;v<phasesTable[r].phases.length;++v){var T=phasesTable[r].phases[v],w=buildFightGridCellsForPhase(r,a,!0,v);w&&(c+="<a class='phase-fight-grid-caption' ",c+="' href='#' onmousedown=\"",c+="changeBossAndWipes("+r+", "+a+", 1, "+v+', this)"',c+=">"+T+"</a>",c+=w)}c+="</div>"}return c+"</div>"}function buildFightGridCellsForPhase(e,t,i,r){for(var a=0,n="",s=0;s<reportsCache.length;++s){n+="<div class='wipes-table'>";for(var o=reportsCache[s],l=-1,p=0;p<o.fights.length;++p){var d=o.fights[p];d.boss!==e||d.kill&&i||!d.kill&&!i||e>0&&d.difficulty!==t||i&&void 0!==r&&d.lastPhaseAsAbsoluteIndex!==r||(a++,-1!==l&&l!==d.reportIndex&&(n+="<br>"),n+="<a class='wipes-entry fight-grid-cell-"+d.id+"-"+d.reportIndex+" "+(d.inProgress?"inprogress":i?"wipe":"kill")+"' href='#'",n+=' onmousedown="return changeFightByIDAndIndex('+d.id+", "+d.reportIndex+', this, false)"',n+=">",n+=buildFightGridCell(d,i?d.wipeNumber:d.killNumber),n+="</a>",l=d.reportIndex)}n+="</div>"}return void 0===r||a?n:null}function toggleWipePhaseSeparation(e,t,i){var r=$(e);return r.hasClass("selected")?(r.removeClass("selected"),$(".fight-grid-"+t+"-"+i+"-wipes-all").show(),$(".fight-grid-"+t+"-"+i+"-wipes-phases").hide(),window.localStorage.setItem("wipes-phase-separation-mode","combined")):(r.addClass("selected"),$(".fight-grid-"+t+"-"+i+"-wipes-all").hide(),$(".fight-grid-"+t+"-"+i+"-wipes-phases").show(),window.localStorage.setItem("wipes-phase-separation-mode","separate")),!1}function buildFightBossOverview(){var e=reportsCache.bossArray,t=reportsCache.bossHash,i=$("#report-overview-fights-contents"),r="";if(!reportsCache[0].fights.length)return r+="This report contains no fights yet.",void i.html(r);r+=buildFightBossOverviewEntry(t.all),r+=buildFightBossOverviewEntry(t.bosses);for(var a=0;a<e.length;++a)r+=buildFightBossOverviewEntry(e[a]);r+=buildFightBossOverviewEntry(t.trash),i.html(r)}function buildFightDetailsAllFightsEntry(e,t,i,r,a,n){var s="";s+="<a class='all-fights-entry ",s+=1==a?"wipe":"kill",s+="' href='#' onmousedown=\"",s+="changeBossAndWipes("+e+", "+t+", "+a+", -1, this, "+(n?"'rankings'":"''")+')"',s+=">",n||(s+="All ");var o=n?rankingsLabel:"Kill",l=n?"":"s";return s+=0==a?"Encounters (":1==a?"Wipes (":o+l+" (",0==e?s+=i+r+" Encounters":(i&&(s+=i,0==a&&(s+=" "+o+(i>1?l:""),r&&(s+=", "))),r&&(s+=r,0==a&&(s+=" Wipe"+(r>1?"s":"")))),s+=")",(s+=menuItemComparisonMarkers(reportsCache.bossHash[hashForBossAndDifficulty(e,t)].last,-1,!0))+"</a>"}function selectViewFromOverview(e){return function(){}}function addActorToMenu(e,t,i,r,a){var n="Pet"==e.type||"NPC"==e.type||"Boss"==e.type;if(r&&n)return"";var s=reportsCache[i],o="",l=e.instanceCounts?e.instanceCounts["fight"+(1==s.filterFightsArray.length?s.filterFightsArray[0]:0)]:1,p=e.instanceGroupCounts?e.instanceGroupCounts["fight"+(1==s.filterFightsArray.length?s.filterFightsArray[0]:0)]:0,d=!1;if(s.petsTable[e.id]&&s.petsTable[e.id].length&&!r){for(var c=0,u=0;u<s.petsTable[e.id].length;u++)s.filterFightsArray.length&&!actorInFight(s.fightsTable,s.filterFightsArray,s.petsTable[e.id][u])||-1!=filterBoss&&-1==s.petsTable[e.id][u].bosses.indexOf("."+filterBoss+".")||c++;d=c>0}o+="<tr><td ",(!n&&!e.displayName||0==game_id&&e.guid>=5e5)&&(o+=" colspan=2"),o+="><li class='actor-menu-item ",o+="'>",o+="<a href='#' class='",o+=e.type+" actor-menu-link' onclick='",o+="return setFilter"+t+"("+e.id+", 0, this,"+i+")'",o+=" oncontextmenu='",o+="setFilter"+t+"("+e.id+", 0, this,"+i+")'>",comparisonReports.length&&!a&&(o+=menuItemComparisonMarkers(null,i,!0)+" ");var h=actorIconAndClasses(e);if(o+="<img style='vertical-align:middle; margin-right:8px; margin-top:-2px; margin-bottom:1px; --size:18; width:18px; height:18px; border:1px solid #555555;' class='"+h.classes+"' src='"+h.icon+"'>",o+=e.name+"</a>",d&&l>1&&(o+="<ul>"),l>1){if(d&&(o+="<li><a href='#' onclick='return false' class='"+e.type+"'>Instances</a>"),o+="<ul>",p>=1&&p!=l){o+="<div class='groups-menu-caption'>Groups: </div><table class='instances-table'>";for(var f=1;f<=p;f++)f%10==1&&(o+="<tr>"),o+="<td><a href='#' class='"+e.type+"' onclick='",o+="return setFilter"+t+"("+e.id+","+(1e4+f)+", this,"+i+")'",o+=" oncontextmenu='",o+="setFilter"+t+"("+e.id+","+(1e4+f)+", this,"+i+")'>",o+=f+"</a>";o+="</table>",o+="<div class='instances-menu-caption'>Instances:</div>"}for(o+="<table class='instances-table'>",f=1;f<=l;f++)f%10==1&&(o+="<tr>"),o+="<td><a href='#' class='"+e.type+"' onclick='",o+="return setFilter"+t+"("+e.id+","+f+", this,"+i+")'",o+=" oncontextmenu='",o+="setFilter"+t+"("+e.id+","+f+", this,"+i+")'>",o+=f+"</a>";o+="</table></ul>"}if(d){for(l>1&&(o+="<li><a href='#' onclick='return false' class='Pet'>Pets</a>"),o+="<ul><table class='actor-menu-table'><tbody>",f=0;f<s.petsTable[e.id].length;++f)s.filterFightsArray.length&&!actorInFight(s.fightsTable,s.filterFightsArray,s.petsTable[e.id][f])||-1!=filterBoss&&-1==s.petsTable[e.id][f].bosses.indexOf("."+filterBoss+".")||(o+=addActorToMenu(s.petsTable[e.id][f],t,i,r));o+="</ul></tbody></table>"}return d&&l>1&&(o+="</ul>"),o+="</li>",n&&(0!=game_id||e.guid<5e5)&&(o+="<td class='ability-menu-id'>",npcPath&&(o+="<a href='"+npcExternalLinkForEntry(e)+"'>"),o+="ID: "+e.guid,npcPath&&(o+="</a>")),!n&&e.displayName&&(o+="<td class='ability-menu-id'>","nil"!=e.displayName&&(o+=e.displayName)),o+"</tr>"}var actorMulticolumnThreshold=16;function buildActorMenu(e,t,i,r,a,n,s,o,l){for(var p,d=$("#"+e+"-container"),c=0,u=filterPull&&"enemies"==t,h="",f=0;f<reportsCache.length&&!(l&&f>0);++f)for(var m=reportsCache[f],g="all"==t?m.playersAndEnemies:"friendlies"==t?m.players:m.enemies,y=0;y<g.length;y++)filterBoss>=-1&&(m.filterFightsArray.length&&!actorInFight(m.fightsTable,m.filterFightsArray,g[y],0==f&&u)||-1!=filterBoss&&-1==g[y].bosses.indexOf("."+filterBoss+"."))||(!s||"Boss"!=g[y].type&&"Pet"!=g[y].type&&"NPC"!=g[y].type)&&(c++,p&&g[y].type,p=g[y].type);var b=Math.ceil(c/actorMulticolumnThreshold),v=new Array,T=new Array,w=new Array;for(f=0;f<reportsCache.length&&!(l&&f>0);++f)for(m=reportsCache[f],g="all"==t?m.playersAndEnemies:"friendlies"==t?m.players:m.enemies,y=0;y<g.length;y++)filterBoss>=-1&&(m.filterFightsArray.length&&!actorInFight(m.fightsTable,m.filterFightsArray,g[y],0==f&&u)||-1!=filterBoss&&-1==g[y].bosses.indexOf("."+filterBoss+"."))||(!s||"Boss"!=g[y].type&&"Pet"!=g[y].type&&"NPC"!=g[y].type)&&(T[g[y].type]||(T[g[y].type]=new Array,v.push(g[y].type)),w.push({actor:g[y],index:f}));v.sort();for(var x=Math.ceil(w.length/b),I=0;I<b;I=++I){h+="<table class='actor-menu-table ",I<b-1&&(h+="bordered"),h+="'",1!=b||s||(h+="style='min-width:"+30*v.length+"px'"),h+="><tbody>";for(var C=0;C<x;++C)(y=C+x*I)<w.length&&(h+=addActorToMenu(w[y].actor,r,w[y].index,s,l));h+="</tbody></table>"}if(!s){for(h+="<li class='separator' style='margin:0!important; border-bottom:1px solid #555555 !important'></li>",h+="<table class='actor-classes-table'><tr>",y=0;y<v.length;++y){h+="<td style='text-align:center;padding:0'>",h+="<a style='margin:0; padding:0' href='#' onclick=\"return setFilter",h+=r,h+="Class('"+v[y]+"', this)\" ",h+='oncontextmenu="setFilter',h+=r,h+="Class('"+v[y]+"', this)\">";var P=icon_path+"icons/";h+="<img style='margin:2px 0 0 0; --size:18; width:18px; height:18px; border:1px solid #555555;' class='sprite actor-sprite-"+v[y]+"' onclick='parentNode.click(); event.stopPropagation(); return false;' width=16 src='"+P+"actors"+(0==game_id?".jpg":".png")+"?v=8'>",h+="</a>"}h+="</table>"}d.html(h),$("#"+e+"-dropdown").smartmenus("refresh")}function defaultBossImage(){return icon_path+"icons/Boss."+(0==game_id?"jpg":"png")}function loadAbilitiesMenuFailed(){abilitiesRequest=null}function addAbilityToMenu(e,t){var i=null!=e.abilities,r="";r+="<tr><td class='ability-menu-name'",e.composite&&(r+=" colspan=2><li"),r+="><a href='#' class='school-",r+=e.type+"'",r+=" style='",r+=setLineColorForAbilityFromType(e.type,!1),r+="' onclick='";var a=e.composite?-e.guid:e.guid;if(t?r+="return setFilterPinAbility("+a+",this,"+e.type+")'":(r+="return setAbilityFilter("+a+", 0, this)'",r+=" oncontextmenu='",r+="setAbilityFilter("+a+", 0, this)'"),r+=">",r+=e.name,r+="</a>",!e.composite){var n=e.secondaryGameID?e.secondaryGameID:a;r+="<td class='ability-menu-id'>",(0!=game_id||a>10)&&(r+='<a target="_new" href="'+("auras"==filterType?buffExternalLink(n):abilityExternalLink(n))+'">'),r+="ID: "+a,(0!=game_id||a>10)&&(r+="</a>")}if(i){e.abilities.sort(abilitySort),r+="<ul><table class='ability-menu-table visible'>";for(var s=0;s<e.abilities.length;++s)r+=addAbilityToMenu(e.abilities[s],t);r+="</table></ul>",r+="</li>"}return r}function buildAbilitiesMenu(e,t,i){abilitiesRequest=null;var r=e.abilities;r.sort(abilitySort);var a=r.length>70,n="",s="",o="",l=r.length,p=Math.ceil(l/actorMulticolumnThreshold);if(a){for(d="<td><table class='letter-table'><tbody>",o+="<td>",f=0;f<r.length;f++)r[f].name[0]!=n&&(""!=n&&(o+="</table>"),o+="<table class='ability-menu-table indented' id='letter-selector-table-"+r[f].name[0]+"'>",d+="<tr><td class='letter-table-cell' id='letter-selector-"+r[f].name[0]+"'><a href='#' onclick='event.stopPropagation(); return selectAbilityLetter(\"letter-selector\", \""+r[f].name[0]+"\")'>"+r[f].name[0]+"</a></td></tr>",n=r[f].name[0],""==s&&(s=n)),o+=addAbilityToMenu(r[f],!1);d+="</tbody></table></td>",a?""!=n&&(o+="</table></td>"):o+="</table>"}else for(var d="",c=(l=r.length,p=Math.ceil(l/actorMulticolumnThreshold),Math.ceil(l/p)),u=0;u<p;u=++u){o+="<table class='actor-menu-table ",u<p-1&&(o+="bordered"),o+="'><tbody>";for(var h=0;h<c;++h){var f;(f=h+c*u)<l&&(o+=addAbilityToMenu(r[f],!1))}o+="</tbody></table>"}$("#filter-ability-selection-container").html('<table class="letter-and-ability-table"><tr>'+d+o+"</table>"),a&&selectAbilityLetter("letter-selector",s),$("#filter-ability-selection-dropdown").smartmenus("refresh")}function selectAbilityLetter(e,t){return $(".letter-table-cell").removeClass("selected"),$(".ability-menu-table").removeClass("selected"),$("#"+e+"-"+t).addClass("selected"),$("#"+e+"-table-"+t).addClass("selected"),!1}function loadAbilitiesMenuIfNeeded(){if(needToLoadAbilitiesMenu){needToLoadAbilitiesMenu=!1;var e=isDamageOrHealingFilterType()||"casts"==filterType||"summons"==filterType||"auras"==filterType||"interrupts"==filterType||"dispels"==filterType||"deaths"==filterType||"threat"==filterType&&hasThreatDetails(),t=filterType,i="/reports/";e&&("threat"==t&&(t+="-details"),i+="ability-list/",i+=t+"/"+report_id+"/"+filterFightsString+"/"+fightSegmentStartTime+"/"+fightSegmentEndTime+"/",i+=hostilityType+"/"+filterSource+"/"+filterTarget+"/"+filterSourceInstance+"/"+filterTargetInstance+"/"+bossWipesAndDifficultyString()+"/"+filterSourceClass+"/"+filterTargetClass+"/",i+=filterOptions+"/"+subFilterType+"/"+filterSpellType,filterTranslate&&(i+="?lang="+currentLang),abilitiesRequest=$.getJSON(i,buildAbilitiesMenu).fail(loadAbilitiesMenuFailed))}}function resetAbilityMenu(){if(needToLoadAbilitiesMenu)return!1;var e=$("#filter-ability-selection-container");e.html("<li><a class='filter-item' id='filter-ability-all' href='#' onclick='return setAbilityFilter(0, 0, this)' oncontextmenu='return setAbilityFilter(0, 0, this)'>All Abilities</a><li class='separator'></li><li><a href='#' onclick='return false'>Loading...</a></li>"),$("#filter-ability-selection-dropdown").smartmenus("refresh"),e.hide(),needToLoadAbilitiesMenu=!0,abilitiesRequest&&(abilitiesRequest.abort(),abilitiesRequest=null)}function loadFilterBuffsFailed(){buffsRequest=null}function updateFilterBuffsSelection(){$(".aura-filter-link").removeClass("present"),$(".aura-filter-link").removeClass("absent");for(var e=0;e<filterSourceBuffs.length;++e)(t=filterSourceBuffs[e])<0?$("#source-buff-"+-t).addClass("absent"):$("#source-buff-"+t).addClass("present");for(e=0;e<filterTargetBuffs.length;++e){var t;(t=filterTargetBuffs[e])<0?$("#target-buff-"+-t).addClass("absent"):$("#target-buff-"+t).addClass("present")}}function buildFilterBuffs(e,t){buffsRequest=null,"error"!=t?($("#filter-buffs-container").html(e),updateFilterBuffsSelection(),$("#filter-buffs-container").show()):$("#filter-buffs-container").html(errorHTML)}function loadFilterBuffsIfNeeded(){if(needToLoadFilterBuffs)if(needToLoadFilterBuffs=!1,!isDamageOrHealingFilterType()||0==filterSource&&"Any"==filterSourceClass)$("#filter-buffs-container").hide();else{$("#filter-buffs-container").show();var e="/reports/filter-buffs/";e+=filterType+"/"+report_id+"/"+filterFightsString+"/"+fightSegmentStartTime+"/"+fightSegmentEndTime+"/",e+=hostilityType+"/"+filterSource+"/"+filterTarget+"/"+filterSourceInstance+"/"+filterTargetInstance+"/"+bossWipesAndDifficultyString()+"/"+filterSourceClass+"/"+filterTargetClass+"/",e+=filterOptions,filterTranslate&&(e+="?lang="+currentLang),buffsRequest=$.ajax({url:e,success:buildFilterBuffs,error:loadFilterBuffsFailed})}}function resetFilterBuffs(){if(needToLoadFilterBuffs)return!1;needToLoadFilterBuffs=!0,buffsRequest&&(buffsRequest.abort(),buffsRequest=null)}function setFilterPhase(e,t){if(filterPhase==e&&!filterPull)return!1;var i=$.deparam.fragment();return 0==e?delete i.phase:i.phase=e,delete i.graphperf,delete i.pull,t?changeLink(t,i):changeView(i)}function useDungeonPhases(e){return 0==game_id&&e>1e4||4==game_id&&e>=2e3&&e<=2999||2==game_id&&(e>=4e3&&e<=4999||e>=1e4&&e<=19999)}function buildPhaseMenu(){var e=$("#filter-phase-text"),t=$("#filter-phase-container"),i=filterFightsArray.length?fightsTable[filterFightsArray[0]].boss:filterBoss,r=!phasesTable||i<=0||!phasesTable[i],a=allPhasesLabel,n=useDungeonPhases(i);n&&(a=bossesAndTrashLabel);var s="<li><a href='#' onclick='return setFilterPhase(0, this)' oncontextmenu='setFilterPhase(0, this)'>"+a+"</a>";if(r)filterPhase=0;else{var o=phasesTable[i].phases;n&&(s+="<li class='separator'></li>",s+="<li><a href='#' onclick='return setFilterPhase(-1, this)' oncontextmenu='setFilterPhase(-1, this)' id='phase-menu--1'>Bosses</a>",s+="<li><a href='#' onclick='return setFilterPhase(-2, this)' oncontextmenu='setFilterPhase(-2, this)' id='phase-menu--2'>Trash</a>"),s+="<li class='separator'></li>";for(var l=0;l<o.length;++l)s+="<li><a href='#' onclick='return setFilterPhase("+(l+1)+", this)' oncontextmenu='setFilterPhase("+(l+1)+", this)' id='phase-menu-"+(l+1)+"'>"+o[l]+"</a>"}if(n&&filterFightsArray.length&&fightsTable[filterFightsArray[0]].dungeonPulls&&fightsTable[filterFightsArray[0]].dungeonPulls.length){for(s+="<li class='separator'></li><div style='columns:6; max-height:50vh; overflow:auto'>",l=0;l<fightsTable[filterFightsArray[0]].dungeonPulls.length;++l)s+="<li style='page-break-inside:avoid'><a style='white-space:nowrap;font-size:11px!important' href='#' onclick='return setDungeonPull("+(l+1)+", this)' oncontextmenu='setDungeonPull("+(l+1)+", this)' id='phase-menu-pull-"+(l+1)+"'>",s+=outputDungeonPullName(fightsTable[filterFightsArray[0]].dungeonPulls[l],l+1),s+="</a>";s+="</div>"}t.html(s),filterPull?e.html(outputDungeonPullName(fightsTable[filterFightsArray[0]].dungeonPulls[filterPull-1],filterPull,!0)):filterPhase?e.html($("#phase-menu-"+filterPhase).html()):e.html(a),$("#filter-phase-dropdown").smartmenus("refresh")}function outputDungeonPullName(e,t,i){if(!e)return"Unknown Pull";var r=i?"<span>":'<span style="color:#c0c0c0">',a=addFightTimeAndDuration(e,fightsTable[filterFightsArray[0]].start_time),n=(r+="Pull "+t+(i?"":a)+"</span>")+(i?" - ":"<br>");return e.boss?n+="<span class='"+(e.kill?"kill":"wipe")+"'>"+e.name:n+="<span class='NPC'>"+e.name,i&&(n+=a),n+"</span>"}function dropdownClicked(e,t){return hideFightSelectionUI(),$.SmartMenus.hideAll(),!1}function updateFilterSourceParams(e,t,i,r){var a=void 0===r?0:r;if(t){var n=t.toString();i&&(n+="."+i.toString());for(var s="",o=!1,l=0;l<reportsCache.length;++l){l>0&&(s+=",");var p=l==a?n:reportsCache[l].filterSource?reportsCache[l].filterSource+(reportsCache[l].filterSourceInstance?"."+reportsCache[l].filterSourceInstance.toString():""):-2;s+=p,-2!=p&&(o=!0)}o?(e.source=s,updateParamsWithEventStartAtIndex(e,-1,a)):(delete e.source,delete e.eventstart)}else delete e.source,delete e.eventstart;delete e.sourceclass,delete e.death,delete e.sourcebuffs,delete e.targetbuffs}function setFilterSource(e,t,i,r){var a=void 0===r?0:r,n=reportsCache[a];if(!(n.filterSource!=e||n.filterSourceInstance!=t||filterSourceClass||filterAbility&&"damage-taken"!=filterType))return!1;var s=$.deparam.fragment();return updateFilterSourceParams(s,e,t,a),i?changeLink(i,s):changeView(s)}function setDungeonPull(e,t){var i=$.deparam.fragment();return delete i.phase,delete i.boss,delete i.wipes,delete i.difficulty,delete i.lastphase,delete i.sourcebuffs,delete i.targetbuffs,i.pull=e,t?changeLink(t,i):changeView(i)}function setFilterFightAndSource(e,t,i){var r=$.deparam.fragment();return updateFilterSourceParams(r,t,0),delete r.boss,delete r.wipes,delete r.difficulty,delete r.lastphase,delete r.sourcebuffs,delete r.targetbuffs,delete r.pull,r.fight=e,i?changeLink(i,r):changeView(r)}function setFilterSourceClass(e,t){if(!(filterSourceClass!=e||filterSource||filterAbility&&"damage-taken"!=filterType))return!1;var i=$.deparam.fragment();return i.sourceclass=e,delete i.source,delete i.death,delete i.sourcebuffs,delete i.targetbuffs,filterAbility&&"damage-taken"!=filterType&&delete i.ability,t?changeLink(t,i):changeView(i)}function serializeFilterBuffs(e,t){for(var i="",r=!1,a=!0,n=0;n<e.length;++n)t!=e[n]?t!=-e[n]?(a?a=!1:i+=".",i+=e[n]):r=!0:(r=!0,a?a=!1:i+=".",i+=-e[n]);return r||(a?a=!1:i+=".",i+=t),i}function setSourceBuffFilter(e,t){var i=$.deparam.fragment(),r=serializeFilterBuffs(filterSourceBuffs,e);return r?i.sourcebuffs=r:delete i.sourcebuffs,t?changeLink(t,i):changeView(i)}function setTargetBuffFilter(e,t){var i=$.deparam.fragment(),r=serializeFilterBuffs(filterTargetBuffs,e);return r?i.targetbuffs=r:delete i.targetbuffs,t?changeLink(t,i):changeView(i)}function updateFilterAbilityParams(e,t,i){delete e.eventstart,t?e.ability=t:delete e.ability,i&&(1==hostilityType&&i!=filterTarget?e.target=i:1!=hostilityType&&i!=filterSource&&(e.source=i)),"ability"!=subFilterType||filterAbility||!t||!isDamageOrHealingFilterType()&&"casts"!=filterType&&"summons"!=filterType&&"threat"!=filterType||delete e.by}function setAbilityFilter(e,t,i,r){if(filterAbility==e)return!1;var a=$.deparam.fragment();return updateFilterAbilityParams(a,e,t),i?(abilityNameCache[e]=r||i.innerHTML,changeLink(i,a)):changeView(a)}function updateFilterTargetParams(e,t,i,r){var a=void 0===r?0:r;if(t){var n=t.toString();i&&(n+="."+i.toString());for(var s="",o=!1,l=0;l<reportsCache.length;++l){l>0&&(s+=",");var p=l==a?n:reportsCache[l].filterTarget?reportsCache[l].filterTarget+(reportsCache[l].filterTargetInstance?"."+reportsCache[l].filterTargetInstance.toString():""):-2;s+=p,-2!=p&&(o=!0)}o?(e.target=s,updateParamsWithEventStartAtIndex(e,-1,a)):(delete e.target,delete e.eventstart)}else delete e.target,delete e.eventstart;delete e.targetclass,delete e.graphperf,"target"!=subFilterType||filterTarget||!t||!isDamageOrHealingFilterType()&&"casts"!=filterType&&"summons"!=filterType&&"threat"!=filterType||delete e.by}function setFilterTarget(e,t,i,r){var a=void 0===r?0:r,n=reportsCache[a];if(!(n.filterTarget!=e||n.filterTargetInstance!=t||filterTargetClass||filterAbility&&"damage-taken"==filterType))return!1;var s=$.deparam.fragment();return updateFilterTargetParams(s,e,t,a),i?changeLink(i,s):changeView(s)}function setFilterTargetClass(e,t){if(!(filterTargetClass!=e||filterTarget||filterAbility&&"damage-taken"==filterType))return!1;var i=$.deparam.fragment();return i.targetclass=e,delete i.target,filterAbility&&"damage-taken"==filterType&&delete i.ability,t?changeLink(t,i):changeView(i)}var reportDeleteRequest=null;function deleteReportFailed(){alert("The report deletion was unsuccessful."),hideGraphLoadElements(),reportDeleteRequest=null}function deleteReportFinished(e,t,i){hideGraphLoadElements(),reportDeleteRequest=null,e.success?(alert("The report was successfully deleted."),window.location.href=guildForReportFollowingDeletion):alert("The report deletion was unsuccessful. "+e.reason)}function deleteReport(e){reportDeleteRequest||confirm("Are you sure you want to delete this report?")&&(showGraphLoadElements(!1),$("#graph-loading").html("<p>Deleting Report...</p><p><img src='"+assetServer+"/img/spinny.gif'></p>"),reportDeleteRequest=$.getJSON("/reports/delete/"+e,deleteReportFinished).fail(deleteReportFailed))}function removeReportComparisonBar(e){for(var t="",i=!0,r=0;r<comparisonReports.length;++r)r!=e-1&&(i?i=!1:t+=".",t+=comparisonReports[r].code);return window.location.href=""==t?"/reports/"+report_id+"/":"/reports/compare/"+report_id+"/"+t,!1}var initReplayBufferFailed=function(e){return function(){document.getElementById("view-tabs-and-table-container").style.opacity="",document.getElementById("table-container").innerHTML=errorHTML,document.getElementById("play-button").style.opacity="",document.getElementById("position-graph").style.opacity="",hideGraphLoadElements(),delete replayRequests[e]}},replaySegmentMSRange=24e4,initReplayBuffer=function(e){return function(t,i,r){replayEvents[e]=t,updateReplayPlotLine(),delete replayRequests[e],fightSegmentStartTime+(e+1)*replaySegmentMSRange<replayPosition+2*replaySegmentMSRange&&loadReplayBuffer(e+1),replayPosition>=fightSegmentStartTime+e*replaySegmentMSRange&&replayPosition<fightSegmentStartTime+(e+1)*replaySegmentMSRange&&shiftReplayPositionToPlotLine(0,!0),pins.length&&countReplayPinMatchesForSlideshow(e)}};function haltReplay(){replayPlaying&&toggleReplayState(),positionChart=null,document.getElementById("position-graph-contents").innerHTML="",$("#position-graph-backdrop").hide(),replayPlaying=!1,replayMaps=null,replayMapIndex=0,currentMapindex=0,currentMapID=0,replayPosition=filterReplayPosition,replayUpdateTime=0,replayEventIndex=0,replayEvents=[],replayEventsSegment=0,replayActorSet=[],replayGlobalActorInfo=null,replaySeries=[],replaySourceID=0,replaySourceInstanceID=0,replayTargetID=0,replayTargetInstanceID=0,replayToTID=0,replayToTInstacneID=0,clearTimeout(replayTimeout),replayTimeout=null,replayCurrentSlide=0,replayTotalSlides=0,replayCurrentSlideEvent=null,replayRouteView=!1,replaySnapToPulls=!1,replayDungeonPull=replayDisplayedDungeonPull=0,replayBetweenPulls=replayDisplayedBetweenPulls=!1,meterCategory="categories",meterCategoryLevel=0,meterActorID=0,meterTargetActorID=0,meterTargetActorInstanceID=0;var e=document.getElementById("replay-current-time");for(var t in e.innerHTML="00:00",replayRequests)replayRequests[t].abort();replayRequests=[]}function initReplayViewFailed(){document.getElementById("view-tabs-and-table-container").style.opacity="",document.getElementById("table-container").innerHTML=errorHTML,document.getElementById("play-button").style.opacity="",document.getElementById("position-graph").style.opacity="",hideGraphLoadElements(),delete replayRequests[0]}var replayHasNPCIcons=!1,replayEffects=null,replayDungeonPull=0,replayDisplayedDungeonPull=0,replayBetweenPulls=!0,replayDisplayedBetweenPulls=!0,replaySnapToPulls=!1,replayRouteView=!1,oldPositionGraphWidth,oldPositionGraphHeight;function initReplayView(e,t,i){if(delete replayRequests[0],document.getElementById("view-tabs-and-table-container").style.opacity="",document.getElementById("table-container").innerHTML="",document.getElementById("play-button").style.opacity="",document.getElementById("position-graph").style.opacity="",hideGraphLoadElements(),createPositionChart(e),pins.length&&countReplayPinMatchesForSlideshow(0),positionChart)for(var r=Math.ceil((fightSegmentEndTime-fightSegmentStartTime)/replaySegmentMSRange),a=1;a<=r;++a)loadReplayBuffer(a);replayHasNPCIcons=e.hasNPCIcons,replayEffects=e.effects,buildReplayRaidUI(e.composition)}function loadReplay(){if(1!=filterFightsArray.length)return haltReplay(),document.getElementById("position-graph-contents").innerHTML="<div id='graph-error'><p>Combat Replay is limited to single fights only.</p>",tableURL="",hideGraphLoadElements(),!1;var e=fightSegmentStartTime,t=Math.min(e+replaySegmentMSRange-1,fightSegmentEndTime),i=reportsCache[0],r="/reports/replaysegment/";if(r+=report_id+"/"+(i.filterFightsArray.length?i.fightsTable[i.filterFightsArray[0]].boss:filterBoss)+"/"+e+"/"+t,(pinString||filterPhase||filterTranslate)&&(r+="?"),pinString&&(r+="pins="+encodeURIComponent(pinString)+"&"),filterPhase&&(r+="phase="+filterPhase+"&"),filterTranslate&&(r+="lang="+currentLang+"&"),reportsCache[0].tableURL==r)return document.getElementById("view-tabs-and-table-container").style.opacity="",!1;Tipped.remove(".tooltip"),replayLoaded&&haltReplay();var a=document.getElementById("position-graph");return a.style.opacity=.4,document.getElementById("play-button").style.opacity=.4,$("#replay-map-info").hide(),oldPositionGraphWidth=a.clientWidth,oldPositionGraphHeight=a.clientHeight,reportsCache[0].tableURL=r,replayRequests[0]=$.getJSON(r,initReplayView).fail(initReplayViewFailed),!0}function loadReplayBuffer(e){if(!replayRequests[e]){var t="/reports/replaysegment/",i=e*replaySegmentMSRange+fightSegmentStartTime;if(!(i>fightSegmentEndTime)){var r=Math.min(i+replaySegmentMSRange-1,fightSegmentEndTime),a=reportsCache[0];t+=report_id+"/"+(a.filterFightsArray.length?a.fightsTable[a.filterFightsArray[0]].boss:filterBoss)+"/"+i+"/"+r+"/",(pinString||filterPhase||filterTranslate)&&(t+="?"),pinString&&(t+="pins="+encodeURIComponent(pinString)+"&"),filterPhase&&(t+="phase="+filterPhase+"&"),filterTranslate&&(t+="lang="+currentLang+"&"),replayRequests[e]=$.getJSON(t,initReplayBuffer(e)).fail(initReplayBufferFailed(e))}}}function toggleExecutionPane(e,t){var i=$("#"+e+"-toggle-"+t),r=$("#"+e+"-contents-"+t);r.is(":visible")?(r.hide(),i.html("Expand")):(r.show(),i.html("Collapse"))}function showTranslationBar(){1!=game_id&&$("#translate-bar").show()}function showUntranslationBar(){1!=game_id&&$("#untranslate-bar").show()}function addComparison(e){return null!=e&&(window.location.href="/reports/compare/"+report_id+"/"+comparison_reports_string+(""!=comparison_reports_string?".":"")+e),!1}function toggleCompareUI(){hideFightSelectionUI(),"none"==document.getElementById("compare-ui").style.display?showCompareUI():hideCompareUI(),resetZoom()}function initCompareMenu(e,t){needtoLoadCompareenu=!1,$("#compare-reports-menu-contents").html(e),$((function(){$("#compare-reports-menu").smartmenus({showOnClick:!0,subMenusMaxWidth:"500px",mainMenuSubOffsetX:-1,mainMenuSubOffsetY:-1,subMenusSubOffsetX:10,subMenusSubOffsetY:0})}))}function initCompareMenuFailed(e,t,i){}function showCompareUI(){$("body").addClass("compare"),$("#compare-ui").show(),buildActorMenu("compare-selection","friendlies","compare","Compare","&nbsp;",!1,!0,!0,!0),buildActorMenu("compare-first-selection","friendlies","compare","CompareFirst","&nbsp;",!1,!0,!0,!0),buildActorMenu("compare-second-selection","friendlies","compare","CompareSecond","&nbsp;",!1,!0,!0,!0),needToLoadCompareMenu&&$.ajax({url:"/reports/load-compare-menu/"+report_id,success:initCompareMenu,error:initCompareMenuFailed})}function hideCompareUI(){$("body").removeClass("compare"),$("#compare-ui").hide()}var comparePlayer=0,compareSearch="",compareSearchRequest,compareMetric="default";function setComparisonPlayerText(e,t,i){var r=e+"-selection-text";if(!i){var a="Select a Player";return $("#"+r).html(a),void("undefined"!=typeof filterClass&&$("#"+r).attr("class",filterClass))}a="",a+="<span style='display:inline-block;",a+="' class='"+reportsCache[0].actorTable[i].type+"'>"+menuItemComparisonMarkers(null,0,!0)+" ",a+="<img class='filter-clear-box' src='"+assetServer+"/img/close.png' width=16 height=16 onclick='",a+="clear"+t+"Filter()",a+="'>",a+=buildActorName(i,0,0),a+="</span><br>",$("#"+r).html(a)}function setComparisonMetricText(){var e="Default";"dps"==compareMetric?e="Damage":"hps"==compareMetric?e="Healing":"krsi"==compareMetric&&(e="Survivability"),$("#compare-metric-text").html(e)}function clearCompareFilter(){return setFilterCompare(0,0,0,0)}function setFilterCompare(e,t,i,r){var a=$.deparam.fragment();if(a.comparesearchplayer!=e)return e?a.comparesearchplayer=e:delete a.comparesearchplayer,delete a.comparesearch,i?changeLink(i,a):changeView(a)}var firstCompare=0,secondCompare=0;function setFilterCompareFirst(e,t,i,r){return setComparisonPlayerText("compare-first","CompareFirst",firstCompare=e),!1}function setFilterCompareSecond(e,t,i,r){return setComparisonPlayerText("compare-second","CompareSecond",secondCompare=e),!1}function selectComparisonSearchMetric(e,t){var i=$.deparam.fragment();if(i.comparesearchmetric!=e)return"default"==e?delete i.comparesearchmetric:i.comparesearchmetric=e,delete i.comparesearch,t?changeLink(t,i):changeView(i)}function comparePlayersInSameReport(){window.location.href="/reports/compare/"+report_id+"/"+report_id+"#fight="+filterFightsString+","+filterFightsString+"&source="+firstCompare+","+secondCompare}function updateCompareSearchFromTextFields(){updateCompareSearch(parseInt(document.getElementById("compare-size-delta").value)+"."+parseInt(document.getElementById("compare-duration-delta").value)+"."+parseInt(document.getElementById("compare-ilvl-delta").value)+"."+parseInt(document.getElementById("compare-date-delta").value))}function updateCompareSearch(e){var t=$.deparam.fragment();if(t.comparesearch!=e)return""==e?delete t.comparesearch:t.comparesearch=e,changeView(t)}function clearCompareSearchResults(){$("#comparison-search-results").html(""),Tipped.remove(".compare-tooltip"),compareSearchRequest&&(compareSearchRequest.abort(),compareSearchRequest=null)}function initCompareSearchResults(e,t,i){$("#comparison-search-results").html(e),compareSearchRequest=null}function initCompareSearchResultsFailed(){$("#comparison-search-results").html("An error was encountered during the comparison search. Unable to show results."),compareSearchRequest=null}function performComparisonSearch(){if(""==compareSearch)return document.getElementById("compare-size-delta").value=2,document.getElementById("compare-duration-delta").value=10,document.getElementById("compare-ilvl-delta").value=2,void(document.getElementById("compare-date-delta").value=28);var e=compareSearch.split("."),t=parseInt(e[0]),i=parseInt(e[1]),r=parseInt(e[2]),a=parseInt(e[3]);document.getElementById("compare-size-delta").value=t,document.getElementById("compare-duration-delta").value=i,document.getElementById("compare-ilvl-delta").value=r,document.getElementById("compare-date-delta").value=a;var n=reportsCache[0],s=filterFightsArray.length>0?fightsTable[filterFightsArray[0]].boss:filterBoss;if(s<=0)alert("The comparison feature only works with boss fights. Select a boss from the fights dropdown and try again.");else{var o="/reports/comparesearch/";o+=report_id+"/"+n.filterFightsString+"/"+n.fightSegmentStartTime+"/"+n.fightSegmentEndTime+"/"+s+"/",o+=comparePlayer+"/"+t+"/"+i+"/"+r+"/"+a+"/"+compareMetric,compareSearchRequest=$.ajax({url:o,success:initCompareSearchResults,error:initCompareSearchResultsFailed}),$("#comparison-search-results").html("<p style='margin-top:30px;text-align:center'>Searching for Similar Parses...</p><p style='text-align:center'><img src='"+assetServer+"/img/spinny.gif'></p>")}}function showTimelineTooltipText(e,t,i){if(i){for(var r=e.parentNode;r&&"TABLE"!=r.tagName;)r=r.parentNode;r=r.parentNode;var a=parseInt(r.style.left),n=$(e).position(),s=$(e.parentNode).position(),o=i+(t>1?"+"+(t-1)+" more similar events.":"");$("#timeline-tooltips-container").html("<div id='timeline-tooltip-singleton' style='top:"+(s.top+30)+"px; left: "+(n.left+a+125)+"px'>"+o+"</div>")}}function hideTimelineTooltipText(e,t){$("#timeline-tooltips-container").html("")}function togglePerformanceGraph(e,t){var i=$.deparam.fragment();i.graphperf?delete i.graphperf:i.graphperf=t?2:1;var r=changeLink(e,i);return event.stopPropagation(),r}function lazyLoadTooltipImages(e,t){var i=$(e).find(".lazyload");i&&"function"==typeof i.lazyload&&i.lazyload()}function createTipped(e,t){return Tipped.create(e,t,{voila:!1,target:"mouse",position:"bottomleft",showDelay:0,radius:0,border:0,background:{opacity:.95},fadeIn:0,fadeOut:0,offset:{x:50,y:15},stem:!1,afterUpdate:lazyLoadTooltipImages})}function formatComparisonDetail(e,t){if(!talentsAndGear||!talentsAndGear[t])return"<div>No talents or gear information available.</div>";var i="<div class='talents-and-gear'>",r=talentsAndGear[t];r.thumbnail&&(i+="<img class='rankings-profile-image' src='"+r.thumbnail+"'>"),i+="<div class='rankings-talents'>",i+="<div class='rankings-talents-header'>Talents</div><table cellpadding=0 cellspacing=0 border=0><tbody>";for(var a=0;a<r.talents.length;++a){var n=r.talents[a];i+="<tr><td class='rankings-talent-row'><img class='rankings-talent-image' src='"+iconForAbility(n)+"'> <span class='rankings-talent-name school-1'>"+n.name+"</span></td>"}for(i+="</table></div>",i+="<div class='rankings-gear'>",i+="<div class='rankings-gear-header'>Gear</div><table cellpadding=0 cellspacing=0 border=0><tbody>",a=0;a<r.gear.length/2;++a){i+="<tr>";var s=r.gear[a];s.id&&(i+="<td class='rankings-gear-row'><img class='rankings-gear-image' src='"+iconForItem(s)+"'> <span class='rankings-gear-name "+s.quality+"'>"+s.name+"</span>"),(s=r.gear[a+9]).id&&(i+="<td class='rankings-gear-row'><img class='rankings-gear-image' src='"+iconForItem(s)+"'> <span class='rankings-gear-name "+s.quality+"'>"+s.name+"</span>")}return i+="</table></div>",(i+="<div style='clear:both'></div>")+"</div>"}var fightSelectionUIVisible=!1;function hideFightSelectionUI(){fightSelectionUIVisible&&(window.scrollTo(0,0),showFightMultipleSelectionUI(0,0),fightSelectionUIVisible=!1,$("#report-fight-selection-area").hide(),$("#report-view-contents").css("visibility","visible"),$("#filter-fight-boss-wrapper").removeClass("pressed"))}function toggleFightSelectionUI(){(fightSelectionUIVisible=!fightSelectionUIVisible)?($("#report-fight-selection-area").show(),$("#report-view-contents").css("visibility","hidden"),$("#filter-fight-boss-wrapper").addClass("pressed"),$("#anyclip-container-box").hide()):($("#report-fight-selection-area").hide(),$("#report-view-contents").css("visibility","visible"),$("#filter-fight-boss-wrapper").removeClass("pressed"),$("#anyclip-container-box").show())}var fightMultipleSelectBoss=0,fightMultipleSelectDifficulty=0,fightMultipleSelectArray=new Array;function showFightMultipleSelectionUI(e,t){if(fightMultipleSelectBoss>0&&($("#specific-fights-"+fightMultipleSelectBoss+"-"+fightMultipleSelectDifficulty+" span").css("display","none"),$(".multiple-select").removeClass("multiple-select"),fightMultipleSelectArray=new Array),fightMultipleSelectBoss==e&&fightMultipleSelectDifficulty==t)return fightMultipleSelectBoss=0,void(fightMultipleSelectDifficulty=0);fightMultipleSelectDifficulty=t,(fightMultipleSelectBoss=e)>0&&$("#specific-fights-"+e+"-"+t+" span").css("display","inline-block")}function toggleFightMultipleSelection(e){var t=".fight-grid-cell-"+e.id+"-"+e.reportIndex;fightMultipleSelectArray[e.reportIndex]||(fightMultipleSelectArray[e.reportIndex]=new Array),fightMultipleSelectArray[e.reportIndex][e.id]?($(t).removeClass("multiple-select"),delete fightMultipleSelectArray[e.reportIndex][e.id]):($(t).addClass("multiple-select"),fightMultipleSelectArray[e.reportIndex][e.id]=1)}function changeToMultipleSelectedFights(e){for(var t="",i=0;i<reportsCache.length;++i){var r=i>0?",":"",a=fightMultipleSelectArray[i];if(a&&a.length)for(var n=!0,s=0;s<a.length;++s)void 0!==a[s]&&(n?n=!1:r+=".",r+=s);else r=reportsCache[i].filterFightsString;t+=r}var o=$.deparam.fragment();return o.fight=t,delete o.pull,e?changeLink(e,o):changeView(o)}function toggleFightPullsVisibility(e,t,i){var r="#fight-details-"+t+"-"+i,a="#fight-details-toggle-"+t+"-"+i+" .fight-details-toggle-text";return $(r).is(":visible")?($(r).hide(),$(a).html("Show All")):($(r).show(),$(a).html("Hide All")),e.stopPropagation(),!1}$(window).bind("hashchange",(function(e){loadViews($.deparam.fragment()),window.dispatchEvent(new CustomEvent("page-changed",{detail:{allowAds:allowAds()}}))}));var positionChart=null,fightMinX,fightMinY,fightMaxX,fightMaxY,positionGraphMinX,positionGraphMinY,positionGraphMaxX,positionGraphMaxY,positionUnzoomedGraphMinX,positionUnzoomedGraphMaxX,positionUnzoomedGraphMinY,positionUnzoomedGraphMaxY,positionMapMinX,positionMapMinY,positionMapMaxX,positionMapMaxY,replayPlaying=!1,replayPosition=0,replayUpdateTime=0,replayEventIndex=0,replaySourceID=0,replaySourceInstanceID=0,replayTargetID=0,replayTargetInstanceID=0,replayToTID=0,replayToTInstanceID=0,replayTimeout,replayEvents,replayEventsSegment=0,replayActorSet=[],replayGlobalActorInfo=null,replaySeries,rewindingReplay=!1,replayMapIndex=0,replayCurrentSlide=0,replayCurrentSlideEvent=null,replayTotalSlides=0,youtubeAPILoaded=!1,videoPlayer=null,resumePlayWhenVideoReady=!1,videoReady=!1,disallowPlayClick=!1,videoLookupRequest=null,videoOffset=0,videoID=0,videoProvider=0,selectVideoRequest=null,removeVideoRequest=null;function gameHasFlippedY(){return 1==game_id||2==game_id}function gameHasAbsorbs(){return 0==game_id&&logVersion>=16||game_id>=2}function gameHasShieldsOrAbsorbs(){return gameHasAbsorbs()||1==game_id}function gameHasPercentageAbsorbs(){return 2==game_id}!function(e){e.fn.mousecapture=function(t){var i=e(document);return this.each((function(){var r=e(this),a={};r.mousedown((function(e){var n,s;t.move&&(n=function(e){t.move.call(r,e,a)},i.mousemove(n));var o=function(){t.move&&i.unbind("mousemove",n),i.unbind("mouseup",s)};return s=t.up?function(e){return o(),t.up.call(r,e,a)}:o,i.mouseup(s),t.down.call(r,e,a)}))})),this}}(jQuery);var pfx=["webkit","moz","ms","o",""];function RunPrefixMethod(e,t){for(var i,r,a=0;a<pfx.length&&!e[i];){if(i=t,""==pfx[a]&&(i=i.substr(0,1).toLowerCase()+i.substr(1)),"undefined"!=(r=_typeof(e[i=pfx[a]+i])))return pfx=[pfx[a]],"function"==r?e[i]():e[i];a++}}function toggleFullScreen(){var e=document.getElementById("graphs");RunPrefixMethod(document,"FullScreen")||RunPrefixMethod(document,"IsFullScreen")||RunPrefixMethod(document,"FullscreenElement")?RunPrefixMethod(document,"CancelFullScreen")||RunPrefixMethod(document,"ExitFullscreen"):RunPrefixMethod(e,"RequestFullScreen")||RunPrefixMethod(e,"RequestFullscreen")}function fullScreenChanged(e){setTimeout(fullScreenDelayed,250)}function fullScreenDelayed(){var e=document.getElementById("fullscreen-toggle");document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement||document.fullscreenElement?(0==game_id&&$WowheadPower.setParent(document.getElementById("graphs")),$(e).removeClass("zmdi-fullscreen"),$(e).addClass("zmdi-fullscreen-exit")):($(e).removeClass("zmdi-fullscreen-exit"),$(e).addClass("zmdi-fullscreen"),0==game_id&&$WowheadPower.setParent(document.body)),recreatePositionChart(!1)}function symbolForType(e){return"NPC"==e?"square":"Pet"==e?"diamond":"Boss"==e?"square":"circle"}function radiusForType(e,t){var i=14;return"Pet"==e&&(i=10),"Boss"==e&&(i=18),"NPC"==e&&(i=16),i}document.addEventListener("webkitfullscreenchange",fullScreenChanged),document.addEventListener("mozfullscreenchange",fullScreenChanged),document.addEventListener("MSFullscreenChange",fullScreenChanged),document.addEventListener("fullscreenchange",fullScreenChanged);var replaySpeed=1;function setReplaySpeed(e,t){e!=replaySpeed&&(replaySpeed=e,$(".replay-speed").removeClass("selected"),$(t).addClass("selected"),setVideoPlaybackRate())}var replayRaidMarkers=!0,replayActorIcons=!0,replayRaidMeters=!0,replayRaidLog=!1,replayRaidVideo=!1,replayRaidVideoIsFullscreen=!1,replayRaidVideoIsUnmuted=!1,replayRaidEffects=!0;function toggleReplayRaidEffects(e){replayRaidEffects=!replayRaidEffects,updateAndRedrawPositionChart(!0),replayRaidEffects?$(e).addClass("selected"):$(e).removeClass("selected")}function toggleReplayActorIcons(e){replayActorIcons=!replayActorIcons,updateAndRedrawPositionChart(!0),replayActorIcons?$(e).addClass("selected"):$(e).removeClass("selected")}function toggleReplayRaidMarkers(e){replayRaidMarkers=!replayRaidMarkers,updateAndRedrawPositionChart(!0),replayRaidMarkers?$(e).addClass("selected"):$(e).removeClass("selected")}function toggleReplayRaidMeters(e){(replayRaidMeters=!replayRaidMeters)?$("#meters-frame").show():$("#meters-frame").hide(),replayRaidMeters?$(e).addClass("selected"):$(e).removeClass("selected")}function toggleReplayRaidLog(e){(replayRaidLog=!replayRaidLog)?$(e).addClass("selected"):$(e).removeClass("selected")}function onYoutubePlayerReady(e){videoReady=!0,e.target.mute(),setVideoPlaybackRate(),e.target.seekTo(videoOffset+(replayPosition-fightSegmentStartTime)/1e3)}function onTwitchPlayerReady(e){disallowPlayClick=!1,videoReady=!0,setVideoPlaybackRate(),videoPlayer.getPlayer().seek(videoOffset+(replayPosition-fightSegmentStartTime)/1e3)}function onYoutubePlayerStateChange(e){e.data==YT.PlayerState.PLAYING||e.data==YT.PlayerState.CUED?(disallowPlayClick=!1,videoReady=!0,replayPlaying||(resumePlayWhenVideoReady?toggleReplayState():e.target.pauseVideo())):e.data==YT.PlayerState.BUFFERING&&(videoReady=!1,disallowPlayClick=!0,replayPlaying&&(resumePlayWhenVideoReady=!0,toggleReplayState()))}function setVideoPlaybackRate(){videoPlayer&&1==videoProvider&&videoPlayer.setPlaybackRate(replaySpeed)}function updateVideoPosition(e){videoPlayer&&(1==videoProvider?videoPlayer.seekTo(videoOffset+(replayPosition-fightSegmentStartTime)/1e3,e):2==videoProvider&&videoPlayer.getPlayer().seek(videoOffset+(replayPosition-fightSegmentStartTime)/1e3))}function loadVideoPlayer(){1==videoProvider?videoPlayer=new YT.Player("player",{height:"100%",width:"100%",videoId:videoID,playerVars:{controls:0},events:{onReady:onYoutubePlayerReady,onStateChange:onYoutubePlayerStateChange}}):2==videoProvider&&(videoPlayer=new Twitch.Player("video-frame-inner",{width:"100%",height:"100%",autoplay:!1,muted:!0,video:videoID,parent:["localhost",window.location.host]})).addEventListener(Twitch.Player.READY,onTwitchPlayerReady)}function onYouTubeIframeAPIReady(){youtubeAPILoaded=!0,loadVideoPlayer()}function showVideoFrame(){$("#video-frame").show(),disallowPlayClick=!0,replayPlaying&&(toggleReplayState(),resumePlayWhenVideoReady=!0),$("#video-frame-inner").html("<div style='text-align:center; margin-top:100px'><p>Looking For Associated Video...</p><p><img src='"+assetServer+"/img/spinny.gif'></p></div>"),videoLookupRequest=$.getJSON("/reports/video/"+report_id+"/"+fightSegmentStartTime,lookedUpVideo).fail(lookedUpVideoFailed)}function lookedUpVideoFailed(e,t,i){videoLookupRequest=null,disallowPlayClick=!1,!replayPlaying&&resumePlayWhenVideoReady&&toggleReplayState(),$("#video-frame-inner").html("<div style='text-align:center; margin-top:100px'><p>An error occurred trying to look up a video for this replay.</p></div>")}function playDisallowedAlert(){alert("Combat Replay is waiting for the video to buffer enough data before allowing play to continue.")}function lookedUpVideo(e){if(videoLookupRequest=null,"none"==e.video&&($("#video-frame-inner").html("<div style='text-align:center; margin-top:100px'><p>There is no video associated with this replay."+(e.canEdit?"</p><p>Click the <i>Select Video</i> button below to attach a video.":"")+"</p></div>"),disallowPlayClick=!1,!replayPlaying&&resumePlayWhenVideoReady&&toggleReplayState()),$("#video-frame-inner").html('<div id="player"></div>'),videoOffset=(fightSegmentStartTime-e.start)/1e3+e.offset,videoID=e.video,1==(videoProvider=e.provider))if(youtubeAPILoaded)loadVideoPlayer();else{var t=document.createElement("script");t.src="//www.youtube.com/iframe_api";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(t,i)}else 2==videoProvider&&loadVideoPlayer();e.canEdit&&($("#select-video").show(),$("#remove-video").show())}function hideVideoFrame(){videoLookupRequest&&(videoLookupRequest.abort(),videoLookupRequest=null),videoPlayer=null,videoPlayerReady=!1,resumePlayWhenVideoReady=!1,disallowPlayClick=!1,videoID="",videoProvider=0,$("#video-frame").hide(),$("#video-frame-inner").html("")}function toggleReplayRaidVideo(e){(replayRaidVideo=!replayRaidVideo)?showVideoFrame():hideVideoFrame(),replayRaidVideo?$(e).addClass("selected"):$(e).removeClass("selected")}function toggleFullscreenVideo(){(replayRaidVideoIsFullscreen=!replayRaidVideoIsFullscreen)?($("#video-frame").addClass("fullscreen"),$("#fullscreen-video").html("Exit Fullscreen")):($("#video-frame").removeClass("fullscreen"),$("#fullscreen-video").html("Enter Fullscreen"))}function muteVideo(){videoPlayer&&(1==videoProvider?videoPlayer.mute():2==videoProvider&&videoPlayer.getPlayer().setMuted(!0))}function unmuteVideo(){videoPlayer&&(1==videoProvider?videoPlayer.unMute():2==videoProvider&&videoPlayer.getPlayer().setMuted(!1))}function toggleMuteForVideo(){(replayRaidVideoIsUnmuted=!replayRaidVideoIsUnmuted)?(unmuteVideo(),$("#mute-video").html("Mute")):(muteVideo(),$("#mute-video").html("Unmute"))}function selectedVideo(e){selectVideoRequest=null,e.error?$("#video-error").html("Error: "+e.error):showVideoFrame()}function selectedVideoFailed(e,t,i){$("#video-error").html("An error occurred trying to set the video info for this replay.")}function selectVideo(){selectVideoRequest&&(selectVideoRequest.abort(),selectVideoRequest=null),$("#video-error").html("");var e=document.getElementById("video_url").value;if(""!=e){var t=document.getElementById("video_offset").value;""==t&&(t=0);var i="/reports/select-video/"+report_id+"/"+fightSegmentStartTime+"/"+t+"?video_url="+encodeURIComponent(e);selectVideoRequest=$.getJSON(i,selectedVideo).fail(selectedVideoFailed)}else $("#video-error").html("Error: You must specify a URL.")}function showSelectVideoUI(){$("#video-frame-inner").html("<div style='text-align:center; margin-top:50px'><form style=\"margin:0\" accept-charset=\"utf-8\" method=get action=\"/reports/select_video\" onsubmit=\"selectVideo(); return false\"><table cellspacing=8 style='margin:auto; text-align:left'><tr><td>Video URL:<td><input type=text style='min-width:350px' id='video_url' name=video_url><tr><td>Offset (Seconds):<td><input size=4 id=video_offset name=video_offset> <i>At what point in the video the fight starts.</i><tr><td colspan=2><i>Note: This video will be used for all subsequent fights in the report as well.</i><tr><td><td style='text-align:right'><input type=button value='Cancel' onclick='showVideoFrame()'><input type=submit value='Ok'><tr><td colspan=2 id='video-error'></table></form></div>"),document.getElementById("video_url").focus()}function removedVideo(e){removeVideoRequest=null,showVideoFrame()}function removedVideoFailed(){removeVideoRequest=null,showVideoFrame()}function removeVideo(){removeVideoRequest&&(removeVideoRequest.abort(),removeVideoRequest=null);var e="/reports/remove-video/"+report_id+"/"+fightSegmentStartTime;removeVideoRequest=$.getJSON(e,removedVideo).fail(removedVideoFailed)}function computeRaidFrameColors(e,t,i){var r,a,n;if(i<=50){var s=(50-i)/50;r=64,n=64,a=Math.ceil(64*s)}else{var o=(100-i)/50;r=64,n=Math.ceil(64*o),a=0}var l=e?.6:0;return["rgb("+r+","+n+","+a+")","rgb("+Math.ceil(r*l)+","+Math.ceil(n*l)+","+Math.ceil(a*l)+")"]}function setRaidFrameColors(e,t,i,r,a){var n=computeRaidFrameColors(i,r,a);t.css("backgroundColor",n[0]),e.css("backgroundColor",n[1])}function toggleReplayRaidFrameSelection(e){var t=e.getAttribute("actorid"),i=e.getAttribute("instanceid");i||(i=1),updateReplaySource(t,i,!$(e).hasClass("selected"))}function updateReplaySource(e,t,i){i&&replaySourceID&&(replaySourceID!=e||replaySourceInstanceID!=t)&&updateReplaySource(replaySourceID,replaySourceInstanceID,!1);var r=$("#raid-frame-"+e),a=$("#boss-frame-"+e);if(i?(r&&r.length&&r.addClass("selected"),a&&a.length&&a.addClass("selected")):(r&&r.length&&r.removeClass("selected"),a&&a.length&&a.removeClass("selected")),replaySourceID=i?e:0,replaySourceInstanceID=i?t:0,replayTargetID=replayTargetInstanceID=replayToTID=replayToTInstanceID=0,i){var n=replayActorSet[e];if(n){var s=n.instances[t];s&&(replayTargetID=s.targetID,replayTargetInstanceID=s.targetInstanceID)}}if(i){updateUnitFrame("source",replaySourceID,replaySourceInstanceID),updateUnitFrame("target",replayTargetID,replayTargetInstanceID);var o=replayActorSet[replayTargetID];if(o){var l=o.instances[replayTargetInstanceID];l&&(replayToTID=l.targetID,replayToTInstanceID=l.targetInstanceID)}updateUnitFrame("tot",replayToTID,replayToTInstanceID)}else $("#source-frames").html(""),$("#target-frames").html(""),$("#tot-frames").html("");notifyReplayMetersOfSourceChange(e,t,i)}function shouldExcludeDebuff(e){return!(!e.sourceIsFriendly||e.source<=0)&&(0!=game_id||184450!=e.ability&&185065!=e.ability&&185066!=e.ability&&186362!=e.ability)}function debuffsForRaidFrames(e){var t="";for(var i in e.debuffsTable){var r=e.debuffsTable[i];shouldExcludeDebuff(r)||(r.ability>abilityCutoff&&(t+='<a target="_new" href="'+buffExternalLink(r.ability)+'">'),t+="<img class='raid-frame-debuff' src='"+iconForAbility(r)+"'>",r.ability>abilityCutoff&&(t+="</a>"))}return t}function buffsForActorInstanceCompact(e,t,i,r,a){var n="source"==r?e:"target"==r?replaySourceID:replayTargetID,s="source"==r?t:"target"==r?replaySourceInstanceID:replayTargetInstanceID,o=!a&&"source"!=r,l="";for(var p in i.buffsTable){var d=i.buffsTable[p];o&&!d.source||!a&&d.source>=0&&(d.source!=n||d.sourceInstance!=s)||(d.ability>abilityCutoff&&(l+="<a href='"+buffExternalLink(d.ability)+"'"),l+=" class='unit-frame-aura'>",l+="<img style='width:100%;display:block' src='"+iconForAbility(d)+"'>",d.stack>1&&(l+="<div class='unit-frame-aura-stack'>"+d.stack+"</div>"),d.ability>abilityCutoff&&(l+="</a>"))}return l}function debuffsForActorInstanceCompact(e,t,i,r,a){var n="target"==r?replaySourceID:replayTargetID,s="target"==r?replaySourceInstanceID:replayTargetInstanceID,o="";for(var l in i.debuffsTable){var p=i.debuffsTable[l];a&&("source"==r||p.source>0&&(p.source!=n||p.sourceInstance!=s))||!a&&shouldExcludeDebuff(p)||(p.ability>abilityCutoff&&(o+="<a href='"+buffExternalLink(p.ability)+"'"),o+=" class='unit-frame-aura'>",o+="<img style='width:100%;display:block' src='"+iconForAbility(p)+"'>",p.stack>1&&(o+="<div class='unit-frame-aura-stack'>"+p.stack+"</div>"),p.ability>abilityCutoff&&(o+="</a>"))}return o}function updateRaidFrame(e,t){var i=$("#raid-frame-"+e);if(i.length){var r=$("#raid-frame-"+e+" .raid-frame-health"),a=t.maxHitPoints,n=Math.max(0,Math.min(t.hitPoints,a)),s=Math.floor(100*(1-n/a));if(r.css("right",s+"%"),setRaidFrameColors(i,r,n,a,s),1==game_id){var o=$("#raid-frame-"+e+" .raid-frame-shield"),l=t.maxShieldCapacity,p=Math.max(0,Math.min(t.shieldCapacity,l)),d=Math.floor(100*(1-p/l));o.css("right",d+"%")}else gameHasAbsorbs()&&(o=$("#raid-frame-"+e+" .raid-frame-shield"),d=Math.max(0,100-t.absorb),gameHasPercentageAbsorbs()||(p=Math.max(0,Math.min(t.absorb,a)),d=Math.floor(100*(1-p/a))),o.css("right",d+"%"));t.dead?i.addClass("dead"):i.removeClass("dead");var c=$("#raid-frame-"+e+" .raid-frame-marker");if(t.dead||!t.marker?c.removeClass("marker"):(c.addClass("marker"),c.attr("src",icon_path+"markers/raid"+t.marker+".png")),i.removeClass("aggro"),t.debuffsDirty){var u=$("#raid-frame-"+e+" .raid-frame-debuffs");u&&u.html(debuffsForRaidFrames(t))}}}function rebuildInterruptBars(e,t,i){for(var r="<table class='ia-bars-table'><tr>",a=1;a<=i;++a)r+="<td id='ia-bar-"+a+"' class='ia-bar'>";e.html(r)}function recolorInterruptBars(e,t,i){for(var r=i-t,a=1;a<=i;++a){var n=$("#ia-bar-"+a);a<=r?n.addClass("good"):0==r?(n.removeClass("good"),n.removeClass("bad")):n.addClass("bad")}}function updateUnitFrame(e,t,i){var r=actorTable[t];if(!("boss"==e&&"Boss"!=r.type||"npc"==e&&"NPC"!=r.type)){var a=replayActorSet[t];if(a){var n=a.instances[i];if(n&&n.maxHitPoints&&!(r.maxHPThreshold&&n.maxHitPoints<r.maxHPThreshold)){var s="boss"==e||"npc"==e,o="boss"==e||"npc"==e&&n.tookDamageFromFriendly,l="#"+e+"-frame-"+t+"-"+i,p=$(l),d=(!s||!n.dead&&!n.stale&&o)&&void 0!==n.firstSeen&&replayPosition>=n.firstSeen;if(!p.length||d){var c="Boss"!=r.type&&"NPC"!=r.type?r.type+"-behind-text":"";if(!p.length&&d){var u="<div onclick='toggleReplayRaidFrameSelection(this)' class='unit-frame "+c+"' id='"+e+"-frame-"+t+"-"+i+"' actorid='"+t+"' instanceid='"+i+"'>";if(4==game_id&&"Boss"!=r.type&&"NPC"!=r.type&&(u+="<div class='unit-frame-magicka-container'><div class='unit-frame-magicka'></div></div>",u+="<div class='unit-frame-stamina-container'><div class='unit-frame-stamina'></div></div>"),u+="<table class='unit-frame-auras'><tr><td class='unit-frame-buffs'></td><td class='unit-frame-debuffs'></table>","source"==e&&(u+="<div class='unit-frame-cast-boxes'></div>"),u+="<div class='unit-frame-contents'>"+r.name+(i>1?" "+i:"")+"</div>","tot"!=e&&(u+="<div class='unit-frame-health-backdrop'><div class='unit-frame-health'></div>"+(gameHasShieldsOrAbsorbs()?"<div class='unit-frame-shield'></div>":"")+"<div class='unit-frame-hp'></div><div class='unit-frame-castbar'></div>",1==game_id&&(u+="<div class='unit-frame-interrupt-armor'></div>")),u+="</div>",s){var h=$("#"+e+"-frame-section"),f=$("#"+e+"-guid-frame-"+r.guid);f.length||(h.append("<div class='composite-unit-frame' id='"+e+"-guid-frame-"+r.guid+"'></div>"),f=$("#"+e+"-guid-frame-"+r.guid+" > .composite-unit-frame-contents")),f.append(u)}else $("#"+e+"-frames").append(u);p=$(l),n.debuffsDirty=n.buffsDirty=!0}""!=c&&(n.dead?p.hasClass(c)&&p.removeClass(c):p.hasClass(c)||p.addClass(c)),1==game_id&&(n.vulnerable?p.addClass("vulnerable"):p.removeClass("vulnerable"));var m="Boss"==r.type||"NPC"==r.type,g=$(l+" .unit-frame-buffs");n.buffsDirty&&g.html(buffsForActorInstanceCompact(t,i,n,e,m)),g=$(l+" .unit-frame-debuffs"),n.debuffsDirty&&"boss"!=e&&g.html(debuffsForActorInstanceCompact(t,i,n,e,m));var y=$(l+" .unit-frame-health"),b=$(l+" .unit-frame-health-backdrop"),v=n.maxHitPoints,T=Math.max(0,Math.min(n.hitPoints,v)),w=0==v?100:Math.floor(100*(1-T/v));if(y.css("right",w+"%"),setRaidFrameColors(b,y,T,v,w),$(l+" .unit-frame-hp").html(n.dead?"Dead":formattedNumber(T)+" - "+(100-w)+"%"),1==game_id){var x=$(l+" .unit-frame-shield"),I=n.maxShieldCapacity,C=Math.max(0,Math.min(n.shieldCapacity,I)),P=0==I?100:Math.floor(100*(1-C/I));x.css("right",P+"%");var S=$(l+" .unit-frame-interrupt-armor"),k=S.attr("ia"),A=S.attr("ia-max");k==n.interruptArmor&&A==n.maxInterruptArmor||(-1==n.maxInterruptArmor?S.hide():(S.show(),A!=n.maxInterruptArmor&&rebuildInterruptBars(S,n.interruptArmor,n.maxInterruptArmor),k!=n.interruptArmor&&recolorInterruptBars(S,n.interruptArmor,n.maxInterruptArmor)),S.attr("ia",n.interruptArmor),S.attr("ia-max",n.maxInterruptArmor))}else gameHasAbsorbs()&&(x=$(l+" .unit-frame-shield"),P=Math.max(0,100-n.absorb),gameHasPercentageAbsorbs()||(I=n.maxHitPoints,C=Math.max(0,Math.min(n.absorb,I)),P=0==I?100:Math.floor(100*(1-C/I))),x.css("right",P+"%"));if(4==game_id&&"Boss"!=e&&"NPC"!=e){var F=$(l+" .unit-frame-stamina"),M=n.maxStamina,E=Math.max(0,Math.min(n.stamina,M)),D=0==M?100:Math.floor(100*(1-E/M));F.css("top",D+"%");var R=$(l+" .unit-frame-magicka"),_=n.maxMagicka,B=Math.max(0,Math.min(n.magicka,_)),L=0==_?100:Math.floor(100*(1-B/_));R.css("top",L+"%")}var O=$(l+" .unit-frame-castbar");if(n.castEvent){O.show();var U="",z=replayPosition-n.castEvent.timestamp,V=n.castEvent.castDuration,H=(m="Boss"==r.type||"NPC"==r.type)&&!n.castEvent.castSuccessful||!m&&n.castEvent.castSuccessful?"good":"bad";V&&(U+="<div class='unit-frame-castbar-backdrop'><div class='unit-frame-castbar-duration "+H,U+="-cast-duration' style='right:"+(w=Math.floor(100*(1-z/V)))+"%'></div></div>");var W=n.castEvent.ability.guid;n.castEvent.ability.abilityIcon,W>abilityCutoff&&(U+='<a target="_new" href="'+abilityExternalLink(W)+'">'),U+="<img class='unit-frame-castbar-icon' src='"+iconForAbility(n.castEvent.ability)+"'>",W>abilityCutoff&&(U+="</a>"),U+=n.castEvent.ability.name+"<span class='unit-frame-castbar-time ",void 0===V?U+=H+"-cast'>Aborted":!n.castEvent.castSuccessful&&n.castEvent.endCastActorID?(actorTable[n.castEvent.endCastActorID],U+=H+"-cast'>Stopped"):U+="'>"+(z/1e3).toFixed(1)+"s",U+="</span>",O.html(U)}else O.html(""),O.hide();n.dead?p.addClass("dead"):p.removeClass("dead")}else p.remove()}}}}function considerForNPCThreat(e){return 1==e.guid||!(4!=game_id||!e.icon)&&("death_recap_melee_basic"==e.icon||"death_recap_ranged_basic"==e.icon)}function updateReplayActorInstanceFromResources(e,t,i,r,a,n){if(t){i||(i=1);var s=replayActorSet[t.id];if(s){var o=n?e.sourceMarker:e.targetMarker,l=s.instances[i];if(l){if(l.maxHitPoints||(l.maxHitPoints=r.maxHitPoints>0?r.maxHitPoints:r.hitPoints),1!=game_id||l.maxShieldCapacity||(l.maxShieldCapacity=r.maxShieldCapacity?r.maxShieldCapacity:r.shieldCapacity),l.hitPoints=l.dead?0:r.hitPoints,r.maxHitPoints>0?l.maxHitPoints=r.maxHitPoints:l.hitPoints>l.maxHitPoints&&("Boss"==t.type||"NPC"==t.type)&&(l.maxHitPoints=l.hitPoints),1==game_id?(l.shieldCapacity=l.dead?0:r.shieldCapacity,r.maxShieldCapacity?l.maxShieldCapacity=r.maxShieldCapacity:l.shieldCapacity>l.maxShieldCapacity&&("Boss"==t.type||"NPC"==t.type)&&(l.maxShieldCapacity=l.maxShieldCapacity),l.interruptArmor=r.interruptArmor,l.maxInterruptArmor=r.maxInterruptArmor):gameHasAbsorbs()&&void 0!==r.absorb&&(l.absorb=l.dead?0:r.absorb),4==game_id&&(l.stamina=r.stamina,l.maxStamina=r.maxStamina,l.magicka=r.magicka,l.maxMagicka=r.maxMagicka),l.x=r.x/100,l.y=r.y/100,l.facing=r.facing,l.lastUpdate=e.timestamp,r.nextTimestamp?(l.nextUpdate=r.nextTimestamp,l.nextX=r.nextX/100,l.nextY=r.nextY/100):(l.nextUpdate=l.lastUpdate,l.nextX=l.x,l.nextY=l.y),l.stale=!1,("cast"==e.type&&e.target&&e.target.id>0&&considerForNPCThreat(e.ability)||n&&e.ability&&e.ability.guid>0&&a&&1&a.targeted)&&(l.meleeID=e.target.id,l.meleeInstanceID=e.targetInstance?e.targetInstance:1),1==game_id&&"damage"==e.type&&!n){var p=4==e.hitType||5==e.hitType;p!=(!0===l.vulnerable)&&(l.vulnerable=p)}l.dead&&"death"!=e.type&&n&&(l.dead=!1,l.update||(l.resurrect=!0,l.update=!0)),o!=l.marker&&(l.marker=o,l.update=!0)}}}}function switchReplayTarget(e,t,i){e.target&&e.target.id>0&&t&&(t.targetID=e.target.id,t.targetInstanceID=e.targetInstance?e.targetInstance:1,replaySourceID==e.source.id&&replaySourceInstanceID==i&&(!replayTargetID||replayTargetID==t.targetID&&replayTargetInstanceID==t.targetInstanceID||($("#target-frames").html(""),$("#tot-frames").html("")),replayTargetID=t.targetID,replayTargetInstanceID=t.targetInstanceID),replayTargetID>0&&replayTargetID==e.source.id&&replayTargetInstanceID==i&&(!replayToTID||replayToTID==t.targetID&&replayToTInstanceID==t.targetInstanceID||$("#tot-frames").html(""),replayToTID=t.targetID,replayToTInstanceID=t.targetInstanceID))}function debuffEventHasFixateAbility(e){return 0==game_id&&(143445==e.ability.guid||162497==e.ability.guid||158986==e.ability.guid||155196==e.ability.guid||154952==e.ability.guid)}function treatDamageAsHealing(e){return!(!e||!e.ability||98021!=e.ability&&196917!=e.ability&&243021!=e.ability)}function treatAbsorbAsNegativeDamage(e){return"absorbed"==e.type&&e.ability&&184553==e.ability.guid}function excludeAbsorbedEventFromHealing(e){return"absorbed"==e.type&&e.ability&&(20711==e.ability.guid||114556==e.ability.guid||115069==e.ability.guid||157533==e.ability.guid||184553==e.ability.guid)}function effectiveDamageForEvent(e,t){if(0==game_id){if(!t&&treatAbsorbAsNegativeDamage(e))return-e.amount;if("damage"==e.type&&treatDamageAsHealing(e))return 0}return"damage"!=e.type?0:e.amount+(t||void 0===e.absorbed?0:e.absorbed)+(t&&e.overkill>0?e.overkill:0)}function effectiveHealingForEvent(e){if(0==game_id){if(excludeAbsorbedEventFromHealing(e))return 0;if("damage"==e.type&&treatDamageAsHealing(e))return-(e.amount+(void 0===e.absorbed?0:e.absorbed))}return"heal"==e.type||"absorbed"==e.type||"removebuff"==e.type||"removedebuff"==e.type||"refreshbuff"==e.type||"refreshdebuff"==e.type||"removeabsorb"==e.type?e.shielded?e.shielded:(e.amount>0?e.amount:0)+(e.absorbed>0?e.absorbed:0):0}function expireReplayEffects(e,t){if(e&&e.effects)for(var i=0;i<e.effects.length;++i){var r=e.effects[i],a=!1;r.duration?a=t&&replayPosition<r.startTime||!t&&-1!=r.duration&&replayPosition>r.startTime+r.duration:r.expiration&&(a=t&&replayPosition<r.startTime-r.expiration||!t&&replayPosition>r.startTime+r.expiration),a&&(e.effects.splice(i,1),i--)}}function removeReplayEffect(e,t){if(e.effects)for(var i=0;i<e.effects.length;++i){var r=e.effects[i];r!=t&&r.sourceEffect!=t||(e.effects.splice(i,1),i--)}}var chains=new Array;function applyReplayEffects(e,t,i,r){if(replayEffects&&e.ability)for(var a=0;a<replayEffects.length;++a){var n=replayEffects[a];if(e.ability.guid==n.ability){var s="aura"==n.effectType?n.graphicType:n.effectType;if("line"!=s||t&&!t.stale||(s="point"),"aura"==n.effectType){if(!i)continue;var o=n.stackRadius>0&&("applydebuffstack"==e.type||"removedebuffstack"==e.type||"applybuffstack"==e.type||"removebuffstack"==e.type),l="applydebuff"==e.type||"applybuff"==e.type,p="removedebuff"==e.type||"removebuff"==e.type;if(!l&&!p&&!o)continue;var d=!r&&l||r&&p;if("chain"==s){if(o)continue;var c;if(d)if(c=chains["guid_"+n.ability]){if(c.length){c.push(i);var u={sourceEffect:n,source:c[0],graphicType:"line",effectType:n.effectType,thickness:n.radius,icon:n.icon,swell:n.swell,ability:n.ability,type:n.type,image:n.image};i.effects||(i.effects=new Array),i.effects.push(u)}}else(c=new Array).push(i),chains["guid_"+n.ability]=c;else if(c=chains["guid_"+n.ability]){for(a=0;a<c.length;++a)removeReplayEffect(c[a],n);delete chains["guid_"+n.ability]}continue}if(d&&!o||removeReplayEffect(i,n),d||o)if(i.effects||(i.effects=new Array),"circle"==s||"point"==s)o?((u=Object.assign({},n)).radius+=e.stack*u.stackRadius,u.sourceEffect=n,i.effects.push(u)):i.effects.push(n);else if("line"==s){if(!t)continue;u={sourceEffect:n,source:t,graphicType:s,effectType:n.effectType,thickness:n.radius,icon:n.icon,swell:n.swell,ability:n.ability,type:n.type,image:n.image},i.effects.push(u)}}else if("line"==s){if(!t||!i||n.eventType!=e.type)continue;if("healabsorbed"==e.type){e.healerID&&(e.healer=actorTable[e.healerID]);var h=e.healerInstance;h||(h=1);var f=e.healer?replayActorSet[e.healer.id]:null,m=null;if(f&&!(m=f.instances[h]))continue;t=m}t.effects||(t.effects=new Array),u={target:i,graphicType:s,thickness:n.thickness,startTime:e.timestamp,expiration:n.expiration,type:n.type,ability:n.ability,image:n.image,eventType:n.eventType},t.effects.push(u)}else if("circle"==s){if(!t||n.eventType!=e.type)continue;t.effects||(t.effects=new Array),u={target:i,graphicType:s,radius:n.radius,startTime:e.timestamp,expiration:n.expiration,type:n.type,ability:n.ability,image:n.image,eventType:n.eventType},t.effects.push(u)}else if("point"==s){if(!i||n.eventType!=e.type)continue;i.effects||(i.effects=new Array),u={graphicType:s,startTime:e.timestamp,expiration:n.expiration,type:n.type,ability:n.ability,image:n.image,eventType:n.eventType},i.effects.push(u)}}}}function updateReplayForEvent(e,t){e.pin&&e.pin.length&&e!=replayCurrentSlideEvent&&(replayCurrentSlideEvent=e,t?replayCurrentSlide--:replayCurrentSlide++,$("#slideshow-current-slide").html(replayCurrentSlide),replayCurrentSlideEvent&&$("#slideshow-current-event").html(printEvent(replayCurrentSlideEvent,!1,0))),e.sourceID&&(e.source=actorTable[e.sourceID]),e.targetID&&(e.target=actorTable[e.targetID]),e.endCastActorID&&e.castSuccessful&&(e.target=actorTable[e.endCastActorID],e.targetInstance=e.endCastActorInstance,e.targetIsFriendly=e.endCastActorIsFriendly);var i=e.sourceInstance;i||(i=1);var r=e.source?replayActorSet[e.source.id]:null,a=null;r&&((a=r.instances[i])||(a=r.instances[i]={id:i,stale:!0}),(void 0===a.firstSeen||e.timestamp<a.firstSeen)&&(a.firstSeen=e.timestamp));var n=e.targetInstance;n||(n=1);var s=e.target?replayActorSet[e.target.id]:null,o=null;s&&((o=s.instances[n])||(o=s.instances[n]={id:n,stale:!0}),(void 0===o.firstSeen||e.timestamp<o.firstSeen)&&(o.firstSeen=e.timestamp)),expireReplayEffects(a,t),expireReplayEffects(o,t),a&&a.expirePin&&(t?replayPosition<a.expirePin:replayPosition>a.expirePin)&&(a.update=!0,a.overrideColor=void 0,a.expirePin=void 0,a.pinArrows=void 0),o&&o.expirePin&&(t?replayPosition<o.expirePin:replayPosition>o.expirePin)&&(o.update=!0,o.overrideColor=void 0,o.expirePin=void 0,o.pinArrows=void 0),applyReplayEffects(e,a,o,t);var l=isAuraEvent(e.type);if(!l||!e.ability||void 0===e.ability.flags||0==(4&e.ability.flags)){var p="applydebuff"==e.type||"removedebuff"==e.type||"applydebuffstack"==e.type||"removedebuffstack"==e.type,d="applybuff"==e.type||"removebuff"==e.type||"applybuffstack"==e.type||"removebuffstack"==e.type;if(void 0!==e.pin&&"applybuffstack"!=e.type&&"removebuffstack"!=e.type&&"applydebuffstack"!=e.type&&"removedebuffstack"!=e.type){var c=e.pin.split("|");if(c.length){var u=parseInt(c[0]);if(a&&!l&&(a.overrideColor=pins[u].graphColor,a.expirePin=e.timestamp+(t?-3e3:3e3),a.update=!0),o){if(l){var h=!t&&("applybuff"==e.type||"applydebuff"==e.type)||t&&("removebuff"==e.type||"removedebuff"==e.type);o.overrideColor=h?pins[u].graphColor:void 0}else o.overrideColor=pins[u].graphColor,o.expirePin=e.timestamp+(t?-3e3:3e3),a!=o&&a&&(a.pinArrows||(a.pinArrows=new Array),a.pinArrows.push({target:o,color:o.overrideColor}));o.update=!0}}}if(p){if(!s)return;if(!(T=o)||T.dead)return;T.debuffsDirty=!0,T.debuffsTable||(T.debuffsTable=[]);var f=t?"applydebuff"==e.type:"removedebuff"==e.type,m=e.ability.guid+"."+e.sourceID+"."+i;if(f)t||(e.stackForRewind=T.debuffsTable[m]?T.debuffsTable[m].stack:1),delete T.debuffsTable[m];else{var g=1;"removedebuff"==e.type?g=e.stackForRewind?e.stackForRewind:1:"removedebuffstack"==e.type?g=t?e.stack+1:e.stack:"applydebuffstack"==e.type&&(g=t?e.stack-1:e.stack),T.debuffsTable[m]={ability:e.ability.guid,icon:e.ability.abilityIcon,stack:g,source:e.sourceID,sourceInstance:i,sourceIsFriendly:e.sourceIsFriendly},e.ability.icon&&(T.debuffsTable[m].icon=e.ability.icon)}!f&&debuffEventHasFixateAbility(e)&&switchReplayTarget(e,a,i)}else if(d){if(!s)return;if(!(T=o)||T.dead)return;T.buffsDirty=!0,T.buffsTable||(T.buffsTable=[]);var y=t?"applybuff"==e.type:"removebuff"==e.type,b=e.ability.guid+"."+e.sourceID+"."+i;y?(t||(e.stackForRewind=T.buffsTable[b]?T.buffsTable[b].stack:1),delete T.buffsTable[b]):(g=1,"removebuff"==e.type?g=e.stackForRewind?e.stackForRewind:1:"removebuffstack"==e.type?g=t?e.stack+1:e.stack:"applybuffstack"==e.type&&(g=t?e.stack-1:e.stack),T.buffsTable[b]={ability:e.ability.guid,icon:e.ability.abilityIcon,stack:g,source:e.sourceID,sourceInstance:i,sourceIsFriendly:e.sourceIsFriendly},e.ability.icon&&(T.buffsTable[b].icon=e.ability.icon))}if(("death"==e.type||"destroy"==e.type)&&!e.feign){var v=o;if(!o)return;v.dead=!t,v.update=!0,v.lastUpdate=e.timestamp,v.nextUpdate=e.timestamp,v.hitPoints=0,v.meleeID=0,v.meleeInstanceID=0,v.debuffsDirty=!0,v.debuffsTable=[],v.buffsDirty=!0,v.buffsTable=[],t?e.linkedCast&&(v.castEvent=e.linkedCast):(!e.linkedCast&&v.castEvent&&(e.linkedCast=v.castEvent),v.castEvent=null)}if(e.resourceActor?updateReplayActorInstanceFromResources(e,1==e.resourceActor?e.source:e.target,1==e.resourceActor?e.sourceInstance:e.targetInstance,e,e,1==e.resourceActor):(e.sourceResources&&updateReplayActorInstanceFromResources(e,e.source,e.sourceInstance,e.sourceResources,e.targetResources,!0),e.targetResources&&updateReplayActorInstanceFromResources(e,e.target,e.targetInstance,e.targetResources,e.sourceResources,!1)),"begincast"==e.type||"cast"==e.type||"interrupt"==e.type){var T,w="interrupt"==e.type,x=w?n:i;if(!(w?s:r))return;if(!(T=w?o:a)||T.dead)return;if("begincast"==e.type?T.castEvent=t?null:e:t?e.linkedCast&&(T.castEvent=e.linkedCast):(!e.linkedCast&&T.castEvent&&(e.linkedCast=T.castEvent),T.castEvent=null),!w){if(switchReplayTarget(e,T,x),e.source&&e.sourceID==replaySourceID&&i==replaySourceInstanceID&&e.ability&&e.ability.guid>abilityCutoff){var I=$("#source-frames .unit-frame-cast-boxes");if(I){var C="";a&&a.lastCast&&a.lastCast.guid&&a.lastCast.guid>abilityCutoff&&(C+='<a target="_new" href="'+abilityExternalLink(a.lastCast.guid)+'"><img class="unit-frame-cast-box" src="'+iconForAbility(a.lastCast)+'"></a>'),C+='<a target="_new" href="'+abilityExternalLink(e.ability.guid)+'"><img class="unit-frame-main-cast-box" src="'+iconForAbility(e.ability)+'"></a>',I.html(C)}}"cast"==e.type&&a&&e.ability.guid>abilityCutoff&&(a.lastCast=e.ability)}}else e.targetResources&&void 0!==e.targetResources.targeted&&1&e.targetResources.targeted&&switchReplayTarget(e,a,i);if("mapchange"==e.type&&(t&&e.isTransition||!t&&e.mapID!=currentMapID)&&(e.isTransition=!0,selectReplayMapAt(currentMapIndex=t?currentMapIndex-1:currentMapIndex+1),recreatePositionChart(!1),updatePositionChartBackdrop()),0===game_id&&logVersion>=16&&e.mapID>0&&(t&&e.isTransition||!t&&currentMapID>0&&e.mapID!=currentMapID)){var P=t?currentMapIndex-1:currentMapIndex+1,S=t;if(!S){var k=replayMaps?replayMaps[P]:null;k&&k.mapID==e.mapID&&(S=!0)}S&&(e.isTransition=!0,currentMapID=e.mapID,selectReplayMapAt(currentMapIndex=P),recreatePositionChart(!1),updatePositionChartBackdrop())}if("worldmarkerplaced"==e.type?t?removeWorldMarkerWithIcon(e.icon):pushWorldMarkerWithIcon(e.icon,e.x,e.y):"worldmarkerremoved"==e.type&&markWorldMarkerWithIconAsStale(e.icon,!t),"limitbreakupdate"==e.type){var A=e.value;updateLimitBreakBar("3",Math.max(0,A-2e4)),updateLimitBreakBar("2",Math.min(1e4,Math.max(0,A-1e4))),updateLimitBreakBar("1",Math.min(1e4,Math.max(0,A)))}var F=e.source&&e.sourceIsFriendly&&!e.targetIsFriendly&&"NPC"!=e.source.type&&"Boss"!=e.source.type,M=e.target&&e.targetIsFriendly&&"NPC"!=e.target.type&&"Boss"!=e.target.type&&"Pet"!=e.target.type,E=effectiveDamageForEvent(e,M);if(0!=E&&(o&&!o.tookDamageFromFriendly&&e.source&&e.sourceIsFriendly&&e.target&&"NPC"==e.target.type&&(o.tookDamageFromFriendly=!0),U=M?s:r)){var D=U,R=M?e.source&&e.source.id?e.source.id:0:e.target&&e.target.id?e.target.id:0,_=M?i:n;if(U.actor.petOwner&&F){var B=actorTable[U.actor.petOwner];replayActorSet[B.id]&&(U=replayActorSet[B.id])}var L=t?-E:E,O=null;F?(U.damageDoneToTargets||(U.damageDoneToTargets=[]),O=U.damageDoneToTargets):M&&(U.damageTakenByTargets||(U.damageTakenByTargets=[]),O=U.damageTakenByTargets),O&&(addAmountForReplayMeter(U,O,"0-0",L,e,D),R&&(addAmountForReplayMeter(U,O,R+"-0",L,e,D),_>0&&addAmountForReplayMeter(U,O,R+"-"+_,L,e,D)),M&&(replayGlobalActorInfo.damageTakenByTargets||(replayGlobalActorInfo.damageTakenByTargets=[]),O=replayGlobalActorInfo.damageTakenByTargets,addAmountForReplayMeter(replayGlobalActorInfo,O,"0-0",L,e,replayGlobalActorInfo),R&&(addAmountForReplayMeter(replayGlobalActorInfo,O,R+"-0",L,e,replayGlobalActorInfo),_>0&&addAmountForReplayMeter(replayGlobalActorInfo,O,R+"-"+_,L,e,replayGlobalActorInfo))))}var U,z=effectiveHealingForEvent(e);if(0!=z&&e.sourceIsFriendly&&e.targetIsFriendly&&"NPC"!=e.source.type&&"Boss"!=e.source.type)(U=r)&&(U.actor.petOwner&&(B=actorTable[U.actor.petOwner],replayActorSet[B.id]&&(U=replayActorSet[B.id])),L=t?-z:z,U.healingDoneToTargets||(U.healingDoneToTargets=[]),addAmountForReplayMeter(U,U.healingDoneToTargets,"0-0",L,e,r),e.target&&e.target.id>0&&(addAmountForReplayMeter(U,U.healingDoneToTargets,e.target.id+"-0",L,e,r),n>0&&addAmountForReplayMeter(U,U.healingDoneToTargets,e.target.id+"-"+n,L,e,r))),(U=s)&&(L=t?-z:z,U.healingTakenByTargets||(U.healingTakenByTargets=[]),addAmountForReplayMeter(U,U.healingTakenByTargets,"0-0",L,e,s),e.source&&e.source.id>0&&(addAmountForReplayMeter(U,U.healingTakenByTargets,e.source.id+"-0",L,e,s),n>0&&addAmountForReplayMeter(U,U.healingTakenByTargets,e.source.id+"-"+i,L,e,s)));var V=filterFightsArray.length?fightsTable[filterFightsArray[0]]:null;if(V&&V.dungeonPulls&&V.dungeonPulls.length){if(e.timestamp<V.dungeonPulls[0].start_time)return replayDungeonPull=1,void(replayBetweenPulls=!0);if(e.timestamp>V.dungeonPulls[V.dungeonPulls.length-1].end_time)return replayDungeonPull=V.dungeonPulls.length,void(replayBetweenPulls=!0);if(replayDungeonPull){var H=V.dungeonPulls[replayDungeonPull-1];if(H&&e.timestamp>=H.start_time&&e.timestamp<=H.end_time)return void(replayBetweenPulls=!1)}for(var W in V.dungeonPulls){var N=V.dungeonPulls[W],G=parseInt(W)+1;if(e.timestamp<=N.end_time){replayDungeonPull=G,replayBetweenPulls=e.timestamp<N.start_time;break}}}}}function removeStaleActorsFromReplay(){for(var e in replayActorSet)for(var t in replayActorSet[e].instances){var i=replayActorSet[e].instances[t],r=i.dead?3e3:1e4;(!rewindingReplay&&i.lastUpdate<replayPosition-r||rewindingReplay&&i.lastUpdate>replayPosition+r)&&(actorTable[e]&&actorTable[e].lockBossFrame||(replayActorSet[e].instances[t].stale=!0))}}function updateUnitFrames(e,t){actorTable[e]&&"Boss"==actorTable[e].type&&!actorTable[e].excludeFromReplayUnitFrames&&updateUnitFrame("boss",e,t),actorTable[e]&&"NPC"==actorTable[e].type&&!actorTable[e].excludeFromReplayUnitFrames&&updateUnitFrame("npc",e,t),replaySourceID&&e==replaySourceID&&t==replaySourceInstanceID&&updateUnitFrame("source",e,t),replayTargetID&&e==replayTargetID&&t==replayTargetInstanceID&&updateUnitFrame("target",e,t),replayToTID&&e==replayToTID&&t==replayToTInstanceID&&updateUnitFrame("tot",e,t)}function checkMapForUnit(e,t,i){if(!actorTable[e]||"Boss"==actorTable[e].type||"NPC"==actorTable[e].type||"Pet"==actorTable[e].type)return-1;for(var r=!1,a=replayMaps.length-1;a>=0;a--)if((n=replayMaps[a]).transitionAt&&(r=!0,replayPosition>=n.transitionAt))return a;if(r)return 0;for(a=0;a<replayMaps.length;a++){var n,s=(n=replayMaps[a]).hasClamp?n.clampMinX:n.mapMinX,o=n.hasClamp?n.clampMaxX:n.mapMaxX,l=n.hasClamp?n.clampMinY:n.mapMinY,p=n.hasClamp?n.clampMaxY:n.mapMaxY;if(i.x>=s/100&&i.x<=o/100&&i.y>=l/100&&i.y<=p/100)return a}return-1}var lastMinX=0,lastMinY=0,lastMaxX=0,lastMaxY=0,images=new Array;function resolveOverrideColor(e){return e.dead?"red":e.overrideColor}function colorForEffect(e){return"physical"==e?"rgb(229, 204, 128)":"frost"==e?"rgb(29%, 50%, 100%)":"nature"==e?"rgb(82%, 98%, 60%)":"shadow"==e?"rgb(72%, 66%, 94%)":"holy"==e?"rgb(100%, 100%, 56%)":"fire"==e?"rgb(100%, 20%, 20%)":"arcane"==e?"rgb(56%, 95%, 100%)":"white"}function drawLineEffect(e,t,i,r,a){var n=Math.round(convertXToPixels(t.currentX)),s=Math.round(convertYToPixels(t.currentY)),o=Math.round(convertXToPixels(i.currentX)),l=Math.round(convertYToPixels(i.currentY));e.save(),e.beginPath(),e.globalAlpha=.35,e.moveTo(n,s),e.lineTo(o,l),e.strokeStyle=r,e.lineWidth=a,e.stroke(),e.restore()}function drawCircleEffect(e,t,i,r){var a=Math.round(convertXToPixels(t.currentX)),n=Math.round(convertYToPixels(t.currentY)),s=Math.round(convertXToPixels(t.currentX)-convertXToPixels(t.currentX-r));e.save(),e.beginPath(),e.moveTo(a,n),e.globalAlpha=.35,e.arc(a,n,s,0,2*Math.PI,!1),e.fillStyle=i,e.fill(),e.restore(),a-s<lastMinX&&(lastMinX=a-s-5),n-s<lastMinY&&(lastMinY=n-s-5),a+s>lastMaxX&&(lastMaxX=a+s+5),n+s>lastMaxY&&(lastMaxY=n+s+5)}function drawImageWithBackground(e,t,i,r,a,n,s){if(!i)return e.fillStyle=t,void e.fillRect(r,a,n,s);1!=game_id&&(e.fillStyle="black",e.fillRect(r,a,n,s));try{e.drawImage(i,r,a,n,s)}catch(e){}}function drawCircle(e,t,i,r,a,n,s){e.save(),e.beginPath(),e.arc(t,i,r,0,2*Math.PI,!1),e.clip(),drawImageWithBackground(e,a.color,s,t-r,i-r,2*r,2*r),e.restore(),e.arc(t,i,r,0,2*Math.PI,!1),e.lineWidth=a.marker.lineWidth,e.strokeStyle=s?n.dead?"rgb(255, 0, 0)":a.color:"black",e.stroke();var o=resolveOverrideColor(n);o&&(e.globalAlpha=.5,e.fillStyle=o,e.fill(),e.globalAlpha=1)}function drawDiamond(e,t,i,r,a,n,s){e.beginPath(),e.moveTo(t-r,i),e.lineTo(t,i-r),e.lineTo(t+r,i),e.lineTo(t,i+r),e.lineTo(t-r,i),e.closePath(),e.fillStyle=n.dead?"rgb(255, 0, 0)":a.color,e.fill(),e.lineWidth=a.marker.lineWidth,e.strokeStyle="black",e.stroke();var o=resolveOverrideColor(n);o&&(e.globalAlpha=.5,e.fillStyle=o,e.fill(),e.globalAlpha=1)}function drawSquare(e,t,i,r,a,n,s){if(drawImageWithBackground(e,a.color,s,t-r,i-r,2*r,2*r),e.beginPath(),e.lineWidth=1,e.strokeStyle=s?a.color:"black",e.strokeRect(t-r,i-r,2*r,2*r),s){var o=n.maxHitPoints,l=Math.max(0,Math.min(n.hitPoints,o));o>0&&l>0&&(e.fillStyle="rgb(0, 192, 0)",e.fillRect(t-r,i+r-3,2*r*l/o,3))}var p=resolveOverrideColor(n);p&&(e.globalAlpha=.5,e.fillStyle=p,e.fill(),e.globalAlpha=1)}function drawDungeonPull(e,t,i){var r=t.maps&&t.maps.length?t.maps[0]:null,a=4==game_id?r?r.mapID:0:r;if(a==currentMapID||!a&&!currentMapID){var n=Math.round(convertXToPixels(t.x/100)),s=Math.round(convertYToPixels(t.y/100));t.drawX=n,t.drawY=s;e.lineWidth=1,e.strokeStyle="white",e.strokeRect(n-16,s-16,32,32),e.fillStyle=i==replayDungeonPull?"rgb(64,0,64)":"rgb(64,64,64)",e.fillRect(n-16,s-16,32,32),e.font="14px Arial",e.fillStyle="white",e.textAlign="center",e.fillText(i,n,s+4)}}function removeWorldMarkerWithIcon(e){if(replayWorldMarkers)for(var t=replayWorldMarkers.length-1;t>=0;--t){var i=replayWorldMarkers[t];if(i.icon==e&&i.dynamic)return void replayWorldMarkers.splice(t,1)}}function pushWorldMarkerWithIcon(e,t,i){replayWorldMarkers||(replayWorldMarkers=new Array),replayWorldMarkers.push({x:t,y:i,icon:e,dynamic:!0})}function markWorldMarkerWithIconAsStale(e,t){if(replayWorldMarkers)for(var i=replayWorldMarkers.length-1;i>=0;--i){var r=replayWorldMarkers[i];if(r.icon==e)return void(r.stale=t)}}function drawWorldMarker(e,t){var i=Math.round(convertXToPixels(t.x/100)),r=Math.round(convertYToPixels(t.y/100));t.drawX=i,t.drawY=r;var a=20;if(t.drawRadius=12,!t.stale){e.save(),e.beginPath(),e.strokeStyle="black",e.arc(i,r,a,0,2*Math.PI,!1),e.clip(),e.fillStyle="#200020",e.globalAlpha=.35,e.fillRect(i-a,r-a,40,40),e.restore();var n=icon_path+"markers/world"+t.icon+".png";images[n]||(images[n]=new Image,images[n].src=n),e.save(),e.globalAlpha=.8;try{e.drawImage(images[n],i-12,r-12,24,24)}catch(e){}e.restore()}i-a<lastMinX&&(lastMinX=i-a-12),r-a<lastMinY&&(lastMinY=r-a-12),i+a>lastMaxX&&(lastMaxX=i+a+12),r+a>lastMaxY&&(lastMaxY=r+a+12)}function drawActorAndInstance(e,t,i,r,a){var n=Math.round(convertXToPixels(i.currentX)),s=Math.round(convertYToPixels(i.currentY)),o=t.marker.lineWidth+5;if(a&&void 0!==i.facing){e.save();var l=i.facing/100,p=null;try{p=e.createRadialGradient(n,s,0,n,s,100)}catch(e){p=null}p&&(p.addColorStop(0,"rgba(190,80,110,1"),p.addColorStop(.75,"rgba(190,80,110,0.5)"),p.addColorStop(1,"rgba(190,80,110,0)"),e.fillStyle=p,e.globalAlpha=.6,e.beginPath(),e.moveTo(n,s),e.arc(n,s,100,l-Math.PI/8,l+Math.PI/8,!1),e.closePath(),e.fill(),e.restore(),o+=120)}i.drawX=n,i.drawY=s;var d=t.marker.radius;(replaySourceID==t.actorid&&replaySourceInstanceID==i.id||r)&&(d=Math.ceil(1.2*d)),replayActorIcons||(d=Math.floor(.7*d)),i.drawRadius=d;var c=replayActorIcons?i.icon:null,u=i.badgeIcon;!images[c]&&c&&(images[c]=new Image,images[c].src=c);var h=replayActorIcons?images[c]:null,f=t.marker.symbol;if("circle"==f?drawCircle(e,n,s,d,t,i,h):"diamond"==f?drawDiamond(e,n,s,d,t,i,h):"square"==f&&drawSquare(e,n,s,d,t,i,h),i.marker&&replayRaidMarkers){c=icon_path+"markers/raid"+i.marker+".png",images[c]||(images[c]=new Image,images[c].src=c);try{e.drawImage(images[c],n-10,s-d-10,20,20)}catch(e){}o+=12}if(u){images[u]||(images[u]=new Image,images[u].src=u);try{e.drawImage(images[u],n-10,s+d-10,20,20)}catch(e){}o+=12}n-d-o<lastMinX&&(lastMinX=n-d-o),s-d-o<lastMinY&&(lastMinY=s-d-o),n+d+o>lastMaxX&&(lastMaxX=n+d+o),s+d+o>lastMaxY&&(lastMaxY=s+d+o)}$(window).resize((function(){if(positionChart){var e=document.getElementById("position-graph-contents"),t=e.clientWidth,i=e.clientHeight;!positionChart||positionChart.width==t&&positionChart.height==i||(positionChart.width=t,positionChart.height=i,recreatePositionChart(!1),updatePositionChartBackdrop(),updateAndRedrawReplayChart(!0))}}));var currentMapIndex=0,currentMapID=0;function eventsContainExplicitMapTransitions(){return 2===game_id||4===game_id||0===game_id&&logVersion>=16}function updateAndRedrawReplayChart(e){for(var t=[],i=[],r=0;r<replaySeries.length;++r)if((S=replaySeries[r]).visible){var a=S.actorid,n=replayActorSet[a];for(var s in n.instances)updateRaidFrame(a,E=n.instances[s]),updateUnitFrames(a,s),replayMaps&&replayMaps.length>1&&!eventsContainExplicitMapTransitions()&&-1!=(l=checkMapForUnit(a,s,E))&&(i[l]?i[l]++:i[l]=1),E.debuffsDirty=E.buffsDirty=!1,E.stale||E.meleeID&&!t[E.meleeID]&&(t[E.meleeID]=!0)}for(var a in t){var o=$("#raid-frame-"+a);o&&o.addClass("aggro")}if(replayMaps&&replayMaps.length>1&&!eventsContainExplicitMapTransitions()){var l=-1,p=-1;for(r=0;r<replayMaps.length;++r)i[r]>p&&(l=r,p=i[r]);replayMapIndex!=l&&l>=0&&(selectReplayMapAt(l),updatePositionChartBackdrop())}if(null!==positionChart){var d=positionChart.getContext("2d");d.clearRect(lastMinX,lastMinY,lastMaxX-lastMinX,lastMaxY-lastMinY);var c=null,u=null,h=!1,f=new Array;for(r=0;r<replaySeries.length;++r)if((S=replaySeries[r]).visible)for(var s in a=S.actorid,(n=replayActorSet[a]).instances)if(!(E=n.instances[s]).stale){var m=E.x,g=E.y,y=E.nextUpdate-E.lastUpdate;if(e&&y>0){var b=(replayPosition-E.lastUpdate)/y;m=E.x+(E.nextX-E.x)*b,g=E.y+(E.nextY-E.y)*b}E.currentX=m,E.currentY=g,E.icon=iconForReplayActor(n.actor,n.spec),E.badgeIcon=null,(E.pinArrows&&E.pinArrows.length||replayRaidEffects&&E.effects&&E.effects.length)&&f.push({series:S,instance:E})}if(replayRouteView){d.clearRect(0,0,positionChart.width,positionChart.height);var v=fightsTable[filterFightsArray[0]].dungeonPulls;if(!v)return;for(var T in v){var w=v[T];replayDungeonPull!=parseInt(T)+1&&drawDungeonPull(d,w,parseInt(T)+1)}return replayDungeonPull&&drawDungeonPull(d,v[replayDungeonPull-1],replayDungeonPull),void hitTestCanvas()}if(replayWorldMarkers&&replayRaidMarkers)for(var x=new Array,I=replayWorldMarkers.length-1;I>=0;--I){var C=replayWorldMarkers[I];x[C.icon]||(x[C.icon]=!0,drawWorldMarker(d,C))}for(var P in f){var S=f[P].series,k=f[P].instance;if(k.pinArrows)for(var A in k.pinArrows){var F=k.pinArrows[A];F.target.stale||F.target.overrideColor!=F.color||drawLineEffect(d,k,F.target,F.color,1)}if(k.effects)for(var r in k.effects)(P=k.effects[r]).radius&&"circle"==P.graphicType?(drawCircleEffect(d,k,colorForEffect(P.type),P.radius),k.badgeIcon=iconForAbility(P)):P.thickness&&"line"==P.graphicType?(drawLineEffect(d,"aura"==P.effectType?P.source:k,"aura"==P.effectType?k:P.target,"aura"==P.effectType?colorForEffect(P.type):"healabsorbed"==P.eventType?"lightgreen":"red",P.thickness+("aura"==P.effectType?0:2)),"aura"==P.effectType?k.badgeIcon=iconForAbility(P):P.target.badgeIcon=iconForAbility(P)):"point"==P.graphicType&&(k.badgeIcon=iconForAbility(P))}for(var M=1;M<=3;M++)for(r=0;r<replaySeries.length;++r)if((S=replaySeries[r]).visible&&S.zIndex==M)for(var s in a=S.actorid,(n=replayActorSet[a]).instances){var E;if(!(E=n.instances[s]).stale){var D=!1;if(E.effects&&replayRaidEffects)for(var R in E.effects)(P=E.effects[R]).icon&&!E.badgeIcon&&(E.badgeIcon=iconForAbility(P)),P.swell&&(D=!0);replaySourceID==S.actorid&&replaySourceInstanceID==E.id?(c=S,u=E,h=D):drawActorAndInstance(d,S,E,D)}}u&&drawActorAndInstance(d,c,u,h,!0),hitTestCanvas()}}function updateAndRedrawPositionChart(e){updateAndRedrawReplayChart(e)}function replayCombatToReplayPosition(e,t){if(!0===t)replayEventIndex=0,replayEventsSegment=0,$(".raid-frame").removeClass("dead"),$(".raid-frame-marker").removeClass("marker"),$(".unit-frame").remove();else if(replayPosition==e)return;for(rewindingReplay=replayPosition<e;null===(i=null===(r=replayEvents[replayEventsSegment])||void 0===r?void 0:r.events.length)||void 0===i||!i||(rewindingReplay?replayEventIndex>=0:replayEventIndex<(null!==(a=null===(n=replayEvents[replayEventsSegment])||void 0===n?void 0:n.events.length)&&void 0!==a?a:0));rewindingReplay?--replayEventIndex:++replayEventIndex){var i,r,a,n,s,o,l,p,d=replayEvents[replayEventsSegment]?replayEvents[replayEventsSegment].events:null;if(!d||d.length){var c=d?d[replayEventIndex]:null;if(!c||!rewindingReplay&&c.timestamp>replayPosition||rewindingReplay&&c.timestamp<replayPosition)break;updateReplayForEvent(c,rewindingReplay)}if(rewindingReplay||null!==(s=null===(o=replayEvents[replayEventsSegment])||void 0===o?void 0:o.events.length)&&void 0!==s&&s&&replayEventIndex!=d.length-1){if(rewindingReplay&&(null===(l=null===(p=replayEvents[replayEventsSegment])||void 0===p?void 0:p.events.length)||void 0===l||!l||0==replayEventIndex)){if(!(replayEventsSegment-1>=0))break;replayEventsSegment--,replayEventIndex=replayEvents[replayEventsSegment].events.length}}else{if(!(replayEventsSegment+1<replayEvents.length))break;replayEventsSegment++,replayEventIndex=-1}}removeStaleActorsFromReplay(),updateAndRedrawPositionChart(),updateReplayMeters(),updateReplayDungeonPullsFrame(),rewindingReplay=!1,document.getElementById("replay-current-time").innerHTML=makeSmartDuration(Math.floor((replayPosition-fightSegmentStartTime)/1e3),!0)}function updateReplayFrame(){replayTimeout=0;var e=(new Date).getTime();replayPosition+=(e-replayUpdateTime)*replaySpeed,updateReplayPlotLine(),document.getElementById("replay-current-time").innerHTML=makeSmartDuration(Math.floor((replayPosition-fightSegmentStartTime)/1e3),!0);var t=Math.ceil((fightSegmentEndTime-fightSegmentStartTime)/replaySegmentMSRange);for(replayEvents[replayEventsSegment]||console.log("Segment failed to load at "+replayEventsSegment);replayEvents[replayEventsSegment]&&replayEvents[replayEventsSegment].events&&(!replayEvents[replayEventsSegment].events.length||replayEventIndex<replayEvents[replayEventsSegment].events.length);++replayEventIndex){var i=replayEvents[replayEventsSegment].events;if(i.length){var r=i[replayEventIndex];if(r&&r.timestamp>replayPosition)break}r&&updateReplayForEvent(r,!1),(!replayEvents[replayEventsSegment].events.length||replayEventIndex==i.length-1&&replayEventsSegment+1<t)&&(replayEventsSegment++,replayEventIndex=-1)}if(removeStaleActorsFromReplay(),updateAndRedrawPositionChart(!0),updateReplayMeters(),updateReplayDungeonPullsFrame(),(!replayEvents[replayEventsSegment]||replayEventIndex==replayEvents[replayEventsSegment].events.length)&&replayEventsSegment+1==t)return toggleReplayState(),replayEventIndex=0,void(replayEventsSegment=0);replayUpdateTime=e,replayTimeout=requestAnimationFrame(updateReplayFrame)}function toggleReplayState(){if(null!=positionChart){var e=document.getElementById("play-button");(replayPlaying=!replayPlaying)?(replayUpdateTime=(new Date).getTime(),replayTimeout=requestAnimationFrame(updateReplayFrame),$(e).removeClass("zmdi-play"),$(e).addClass("zmdi-pause")):(replayTimeout&&cancelAnimationFrame(replayTimeout),replayTimeout=null,$(e).removeClass("zmdi-pause"),$(e).addClass("zmdi-play")),videoPlayer&&videoReady&&(replayPlaying?playReplayVideo():pauseReplayVideo())}}function playReplayVideo(){videoPlayer&&(1==videoProvider?videoPlayer.playVideo():2==videoProvider&&videoPlayer.getPlayer().play())}function pauseReplayVideo(){videoPlayer&&(1==videoProvider?videoPlayer.pauseVideo():2==videoProvider&&videoPlayer.getPlayer().pause())}function replayPointClicked(e){this.select(!this.selected,!1);var t=this.options.id.indexOf("-");updateReplaySource(this.options.id.substring(0,t),this.options.instance?this.options.instance:1,this.selected)}var npcColors=["#aaeeee","#f45b5b","#90ee7e","#7798BF","#777777","#ff0066","#7E4DB1","#55BF3B","#DF5353","#058DC7","#50B432","#ED561B","#DDDF00","#24CBE5","#64E572","#FF9655","#FFF263","#6AF9C4"],npcColorIndex=-1;function createPositionGraphSeries(e,t,i){var r=void 0;"Boss"!=e.type&&"NPC"!=e.type?r=setLineColorForActorFromType(t?t.type:e.type):(++npcColorIndex>=npcColors.length&&(npcColorIndex=0),r=npcColors[npcColorIndex]);var a={symbol:symbolForType(e.type),radius:radiusForType(e.type,!1),lineColor:"black",lineWidth:1,states:{select:{radius:radiusForType(e.type,!0),fillColor:void 0,lineWidth:3}}},n={id:"actor-"+e.id,actorid:e.id,name:e.name,color:r,type:e.type,visible:!0,filterType:e.type,marker:a,data:[],point:{events:{click:replayPointClicked}},enemy:i};return"Pet"==e.type?(n.zIndex=1,n.visible=!1):"Boss"==e.type||"NPC"==e.type?n.zIndex=2:n.zIndex=3,t&&(n.showInLegend=!1,n.owner="("+t.name+")"),n}function createInitialPositionGraphSeries(){replaySeries=[],replayGlobalActorInfo={actor:null,instances:[],instanceCount:1};for(var e=players.length,t=0;t<playersAndEnemies.length;++t)if(!(filterFightsArray.length&&!actorInFight(fightsTable,filterFightsArray,playersAndEnemies[t])||-1!=filterBoss&&-1==actors[t].bosses.indexOf("."+filterBoss+"."))){var i=playersAndEnemies[t];if("LimitBreak"!=i.type){var r=replayActorSet[i.id]={actor:i,instances:[],instanceCount:i.instanceCounts?i.instanceCounts["fight"+filterFightsArray[0]]:1},a=createPositionGraphSeries(i,null,t>=e);if(r.series=a,replaySeries.push(a),petsTable[i.id])for(var n=0;n<petsTable[i.id].length;++n)if(!(filterFightsArray.length&&!actorInFight(fightsTable,filterFightsArray,petsTable[i.id][n])||-1!=filterBoss&&-1==petsTable[i.id][n].bosses.indexOf("."+filterBoss+"."))){null==a.pets&&(a.pets=[]);var s=petsTable[i.id][n],o=(replayActorSet[s.id]={actor:s,instances:[],instanceCount:s.instanceCounts?s.instanceCounts["fight"+filterFightsArray[0]]:1},createPositionGraphSeries(s,i,t>=e));a.pets.push(o),replaySeries.push(o)}}}replaySeries.sort(sortGraphSeries)}function updateReplayPlotLine(){if(chart){chart.xAxis[0].removePlotLine("position"),chart.xAxis[0].removePlotBand("positionband"),chart.xAxis[0].removePlotBand("bufferband"),chart.xAxis[0].addPlotLine({id:"position",width:1,value:replayPosition-filterFightStartTime,zIndex:5,color:"white"}),chart.xAxis[0].addPlotBand({id:"positionband",from:fightSegmentStartTime-filterFightStartTime,to:replayPosition-filterFightStartTime,color:"rgba(130,20,20,0.5)"});var e=0,t=replayEvents.length?replayEvents[replayEvents.length-1].events:null;if(t&&t.length&&(e=t[t.length-1].timestamp),e<=replayPosition)return;chart.xAxis[0].addPlotBand({id:"bufferband",from:replayPosition-filterFightStartTime+1,to:e-filterFightStartTime,color:"rgba(90,90,90,0.5)"})}}function shiftReplayPositionToPlotLine(e,t){if(!0===t)for(var i in replayActorSet)for(var r in replayActorSet[i].instances)delete replayActorSet[i].instances[r];replayCombatToReplayPosition(e,t)}function updatePositionMinMaxForAspectRatio(){if(positionChart){var e,t=fightMaxY-fightMinY,i=fightMaxX-fightMinX,r=positionChart,a=r.clientWidth/(r.clientHeight-replayAspectFudge);i<=t*a?(positionUnzoomedGraphMinX=fightMinX-(e=t*a-i)/2,positionUnzoomedGraphMaxX=fightMaxX+e/2):(positionUnzoomedGraphMinY=fightMinY-(e=i/a-t)/2,positionUnzoomedGraphMaxY=fightMaxY+e/2)}}function convertXToPixels(e){var t=positionGraphMaxX-positionGraphMinX;return positionChart.offsetWidth/t*(e-positionGraphMinX)}function convertYToPixels(e){var t=Math.abs(positionGraphMaxY-positionGraphMinY),i=positionChart.offsetHeight,r=1!=game_id&&2!=game_id,a=i/t*(e-(r?positionGraphMaxY:positionGraphMinY));return r?-a:a}function updatePositionChartBackdrop(){if(positionChart&&("undefined"!=typeof positionMapBoss&&positionMapBoss||eventsContainExplicitMapTransitions())){var e=document.getElementById("position-graph-backdrop"),t=Math.floor(convertXToPixels(positionMapMinX)),i=Math.ceil(convertXToPixels(positionMapMaxX))-t;e.width=i,e.style.left=t+"px";var r=Math.floor(convertYToPixels(positionMapMaxY)),a=Math.floor(convertYToPixels(positionMapMinY)),n=Math.abs(a-r);e.height=n,gameHasFlippedY()&&(r=-(n-r)),e.style.top=r+"px"}}var replayAspectFudge=73,replayMaps=null,replayInitialZoomIn=0,replayLockToMap=!1,replayWorldMarkers=new Array;function selectReplayMapAt(e){replayLockToMap=!1,replayInitialZoomIn=0,replayMapIndex=0;var t=replayMaps?replayMaps[e]:null;if(positionMapMinX=t?t.mapMinX/100:0,positionMapMaxX=t?t.mapMaxX/100:0,positionMapMinY=t?t.mapMinY/100:0,positionMapMaxY=t?t.mapMaxY/100:0,positionMapBoss||eventsContainExplicitMapTransitions()){$("#position-graph-backdrop").show();var i=t?t.mapID:0;currentMapID=i;var r=document.getElementById("position-graph-backdrop"),a=t?t.mapFile:null,n=icon_path+(a?"maps/"+a:(i>0?"maps/"+i:"bosses/"+positionMapBoss)+"-map");e>0&&!a&&!i&&(n+="-"+(e+1)),2===game_id&&a||(n+="."+(0===game_id&&!i||4===game_id?"jpg":"png")),r.src=n}else $("#position-graph-backdrop").hide();if((replayLockToMap=replayMaps&&replayMaps.length>1&&!replayMaps[0].respectBoundingBox)&&(replayInitialZoomIn=2===game_id?4:1),t&&($("#replay-map-name").html(t.name),$("#replay-map-info").show(),replayMapIndex=e,replayLockToMap||(replayLockToMap=t.lockToMap),t.zoomIn&&(replayInitialZoomIn=t.zoomIn)),replayLockToMap&&(positionUnzoomedGraphMinX=fightMinX=positionMapMinX,positionUnzoomedGraphMinY=fightMinY=positionMapMinY,positionUnzoomedGraphMaxX=fightMaxX=positionMapMaxX,positionUnzoomedGraphMaxY=fightMaxY=positionMapMaxY,positionChart)){updatePositionMinMaxForAspectRatio(),zoomRatio=40-replayInitialZoomIn;for(var s=40;s>zoomRatio;--s)setReplayZoom(!0)}}function zoomMapSlightly(){zoomRatio=40-replayInitialZoomIn;for(var e=40;e>zoomRatio;--e)setReplayZoom(!0)}function getMouseXY(e,t){var i=e.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}}var replayHoveredDungeonPull=null,replayHoveredDungeonPullNumber=0,replayHoveredSeries=null,replayHoveredInstanceInfo=null,replayDrawX=0,replayDrawY=0,mouseX=0,mouseY=0;function handleCanvasClick(e){if(hitTestCanvas(),replayRouteView){if(!replayHoveredDungeonPull)return;return changeReplayDungeonPull(replayHoveredDungeonPullNumber-replayDungeonPull),replayHoveredDungeonPull=null,replayHoveredDungeonPullNumber=0,updatePositionChartTooltip(),toggleRouteView(),void toggleReplayState()}if(replayHoveredInstanceInfo){var t=replaySourceID==replayHoveredSeries.actorid&&replaySourceInstanceID==replayHoveredInstanceInfo.id;updateReplaySource(replayHoveredSeries.actorid,replayHoveredInstanceInfo.id,!t),updateAndRedrawPositionChart(!0)}}function updatePositionChartTooltip(){if(replayHoveredSeries||replayHoveredDungeonPull){var e="",t=y=0;if(replayHoveredDungeonPull)e=outputReplayDungeonPull(replayHoveredDungeonPullNumber),t=replayHoveredDungeonPull.drawX+20,y=replayHoveredDungeonPull.drawY;else{var i=replayHoveredSeries.name;replayHoveredInstanceInfo.id>1&&(i+=" "+replayHoveredInstanceInfo.id),replayHoveredSeries.owner&&(i+=" "+replayHoveredSeries.owner),e="<span style='color:"+replayHoveredSeries.color+"'>"+i+"</span><br>",e+="X: <span class='estimate'>"+parseFloat(replayHoveredInstanceInfo.currentX).toFixed(2)+"</span> Y: <span class='estimate'>"+parseFloat(replayHoveredInstanceInfo.currentY).toFixed(2)+"</span>",t=replayHoveredInstanceInfo.drawX+replayHoveredSeries.marker.radius+5,y=replayHoveredInstanceInfo.drawY}$("#replay-canvas-tooltip").html(e),$("#replay-canvas-tooltip").show(),$("#replay-canvas-tooltip").css("left",t+"px"),$("#replay-canvas-tooltip").css("top",y+"px")}else $("#replay-canvas-tooltip").hide()}function hitTestDungeonPull(e){return mouseX>=e.drawX-16&&mouseX<e.drawX+16&&mouseY>=e.drawY-16&&mouseY<e.drawY+16}function hitTestCanvasInRouteView(){replayHoveredSeries=replayHoveredInstanceInfo=null;var e=fightsTable[filterFightsArray[0]].dungeonPulls;if(e){var t=null,i=0;if(replayDungeonPull&&hitTestDungeonPull(e[replayDungeonPull-1],replayDungeonPull))t=e[replayDungeonPull-1],i=replayDungeonPull;else for(var r=e.length-1;r>=0;--r){var a=e[r];if(replayDungeonPull!=parseInt(r)+1&&hitTestDungeonPull(a,parseInt(r)+1)){t=a,i=parseInt(r)+1;break}}(replayHoveredDungeonPull!=t||t&&(replayDrawX!=t.drawX||replayDrawY!=t.drawY))&&(replayHoveredDungeonPull=t,replayHoveredDungeonPullNumber=i,t?(replayDrawX=t.drawX,replayDrawY=t.drawY):replayDrawX=replayDrawY=0,updatePositionChartTooltip())}}function hitTestCanvas(){if(replayRouteView)return hitTestCanvasInRouteView();replayHoveredDungeonPull=null;for(var e=null,t=null,i=3;i>=1;i--)for(var r=replaySeries.length-1;r>=0;--r){var a=replaySeries[r];if(a.visible&&a.zIndex==i){var n=a.actorid,s=replayActorSet[n];for(var o in s.instances){var l=s.instances[o];if(!l.stale){var p=l.drawRadius;mouseX>=l.drawX-p&&mouseX<l.drawX+p&&mouseY>=l.drawY-p&&mouseY<l.drawY+p&&(e=a,t=l,hitRadius=p)}}if(e)break}}(replayHoveredInstanceInfo!=t||t&&(replayDrawX!=t.drawX||replayDrawY!=t.drawY))&&(replayHoveredSeries=e,replayHoveredInstanceInfo=t,t?(replayDrawX=t.drawX,replayDrawY=t.drawY):replayDrawX=replayDrawY=0,updatePositionChartTooltip())}function handleCanvasMouseMove(e){var t=getMouseXY(positionChart,e);mouseX=parseInt(t.x),mouseY=parseInt(t.y),hitTestCanvas()}function computeFudgeFactor(e,t){if(4!=game_id)return.1;var i=Math.max(e,t);return i>=2500?.1:.1+(2500-i)/2/i}function createPositionChart(e){var t=computeFudgeFactor(e.maxX-e.minX,e.maxY-e.minY),i=t*(e.maxX-e.minX),r=t*(e.maxY-e.minY);if(positionUnzoomedGraphMinX=fightMinX=(e.minX-i)/100,positionUnzoomedGraphMinY=fightMinY=(e.minY-r)/100,positionUnzoomedGraphMaxX=fightMaxX=(e.maxX+i)/100,positionUnzoomedGraphMaxY=fightMaxY=(e.maxY+i)/100,replayWorldMarkers=e.worldMarkers,replayMaps=e.maps,positionMapBoss=e.mapBoss,replayAspectFudge=0,selectReplayMapAt(0),fightMinX>=fightMaxX||fightMinY>=fightMaxY)return document.getElementById("position-graph-contents").innerHTML="<div id='graph-error'><p>This fight has no position information associated with it, so replay is not available.",void $("#unit-frames-container").hide();var a=document.getElementById("position-graph-contents"),n=a.clientWidth,s=a.offsetHeight;$("#position-graph-contents").html("<canvas id='replay-canvas' width='"+n+"' height='"+s+"'></canvas><div id='replay-canvas-tooltip'></div>"),positionChart=document.getElementById("replay-canvas"),$("#replay-canvas").mousemove((function(e){handleCanvasMouseMove(e)})),$("#replay-canvas").click((function(e){handleCanvasClick(e)})),replayEvents[0]=e,replayEventsSegment=0,replayEventsIndex=0,replayPull=0,createInitialPositionGraphSeries(),recreatePositionChart(!1)}function recreatePositionChart(e){updatePositionMinMaxForAspectRatio(),positionGraphMinX=positionUnzoomedGraphMinX,positionGraphMaxX=positionUnzoomedGraphMaxX,positionGraphMinY=positionUnzoomedGraphMinY,positionGraphMaxY=positionUnzoomedGraphMaxY,updateReplayPlotLine(),updatePositionChartBackdrop(),replayLockToMap&&zoomMapSlightly()}function setPositionChartXExtremes(e,t){var i=positionUnzoomedGraphMaxX-positionUnzoomedGraphMinX;if(t-e>i)return positionGraphMinX=positionUnzoomedGraphMinX,void(positionGraphMaxX=positionUnzoomedGraphMaxX);var r=e-(positionUnzoomedGraphMinX-.75*i);r<0&&(e-=r,t-=r);var a=t-(positionUnzoomedGraphMaxX+.75*i);a>0&&(t-=a,e-=a),positionGraphMinX=e,positionGraphMaxX=t}function setPositionChartYExtremes(e,t){var i=positionUnzoomedGraphMaxY-positionUnzoomedGraphMinY;if(t-e>i)return positionGraphMinY=positionUnzoomedGraphMinY,void(positionGraphMaxY=positionUnzoomedGraphMaxY);var r=e-(positionUnzoomedGraphMinY-.75*i);r<0&&(e-=r,t-=r);var a=t-(positionUnzoomedGraphMaxY+.75*i);a>0&&(t-=a,t-=a),positionGraphMinY=e,positionGraphMaxY=t}var zoomRatio=40,lastX,lastY,resumePlayOnMouseUp=!1;function chartXMin(){return positionGraphMinX}function chartXMax(){return positionGraphMaxX}function chartYMin(){return positionGraphMinY}function chartYMax(){return positionGraphMaxY}function setReplayZoom(e){if(40==zoomRatio)return setPositionChartXExtremes(positionUnzoomedGraphMinX,positionUnzoomedGraphMaxX),setPositionChartYExtremes(positionUnzoomedGraphMinY,positionUnzoomedGraphMaxY),updatePositionChartBackdrop(),void updateAndRedrawPositionChart(!0);var t=chartXMin(),i=chartXMax(),r=chartYMin(),a=chartYMax(),n=.1*(i-t);e||(n=1.1*-n);var s=.1*(a-r);e||(s=1.1*-s),setPositionChartXExtremes(t+n,i-n),setPositionChartYExtremes(r+s,a-s),updatePositionChartBackdrop(),updateAndRedrawPositionChart(!0)}function hidePositionChartTooltip(){$("#replay-tooltip").hide()}$((function(){var e;$("#position-graph-contents").mousecapture({down:function(e,t){lastX=e.pageX,lastY=e.pageY},move:function(e,t){var i=!1,r=document.getElementById("position-graph-contents"),a=r.clientWidth,n=r.clientHeight-replayAspectFudge,s=chartXMin(),o=chartXMax(),l=chartYMin(),p=chartYMax();if(e.pageX>lastX)setPositionChartXExtremes(s-(d=(d=e.pageX-lastX)*(o-s)/a),o-d),i=!0;else if(e.pageX<lastX){var d;setPositionChartXExtremes(s+(d=(d=lastX-e.pageX)*(o-s)/a),o+d),i=!0}if(e.pageY>lastY){var c=e.pageY-lastY;gameHasFlippedY()&&(c=-c),setPositionChartYExtremes(l+(c=c*(p-l)/n),p+c),i=!0}else e.pageY<lastY&&(c=lastY-e.pageY,gameHasFlippedY()&&(c=-c),setPositionChartYExtremes(l-(c=c*(p-l)/n),p-c),i=!0);i&&(hidePositionChartTooltip(),panning?(updatePositionChartBackdrop(),updateAndRedrawPositionChart(!0)):(panning=!0,replayPlaying&&(toggleReplayState(),resumePlayOnMouseUp=!0))),lastX=e.pageX,lastY=e.pageY},up:function(e,t){panning&&(panning=!1,resumePlayOnMouseUp&&(resumePlayOnMouseUp=!1,toggleReplayState()))}}),$("#graph").mousecapture({down:function(t,i){if("replay"==filterView){chart.mouseIsDown=!1;var r=$("#graph").offset(),a=t.pageX-r.left-1,n=replayPosition;replayPosition=chart.xAxis[0].toValue(a)+filterFightStartTime,e=replayPosition,updateVideoPosition(!1),updateReplayPlotLine(),shiftReplayPositionToPlotLine(n),lastX=t.pageX,replayPlaying&&(toggleReplayState(),resumePlayOnMouseUp=!0),chart.mouseIsDown=!1}},move:function(t,i){if("replay"==filterView){var r=document.getElementById("graph").clientWidth,a=replayPosition;if(t.pageX>lastX)n=(n=t.pageX-lastX)*((s=chart.xAxis[0].getExtremes()).max-s.min)/r,e+=n,a!=(replayPosition=Math.min(fightSegmentEndTime,Math.max(fightSegmentStartTime,e)))&&(updateReplayPlotLine(),shiftReplayPositionToPlotLine(a));else if(t.pageX<lastX){var n,s;n=(n=lastX-t.pageX)*((s=chart.xAxis[0].getExtremes()).max-s.min)/r,e-=n,a!=(replayPosition=Math.min(fightSegmentEndTime,Math.max(fightSegmentStartTime,e)))&&(updateReplayPlotLine(),shiftReplayPositionToPlotLine(a))}updateVideoPosition(!1),lastX=t.pageX}},up:function(t,i){if("replay"==filterView){var r=document.getElementById("graph").clientWidth,a=replayPosition;if(t.pageX>lastX)n=(n=t.pageX-lastX)*((s=chart.xAxis[0].getExtremes()).max-s.min)/r,e+=n,a!=(replayPosition=Math.min(fightSegmentEndTime,Math.max(fightSegmentStartTime,e)))&&(updateReplayPlotLine(),shiftReplayPositionToPlotLine(a));else if(t.pageX<lastX){var n,s;n=(n=lastX-t.pageX)*((s=chart.xAxis[0].getExtremes()).max-s.min)/r,e-=n,a!=(replayPosition=Math.min(fightSegmentEndTime,Math.max(fightSegmentStartTime,e)))&&(updateReplayPlotLine(),shiftReplayPositionToPlotLine(a))}updateVideoPosition(!0),resumePlayOnMouseUp&&(resumePlayOnMouseUp=!1,toggleReplayState())}}}),$("#position-graph-contents").bind("mousewheel",(function(e){e.originalEvent.preventDefault();var t=e.deltaY;t>0?zoomRatio>1&&(zoomRatio-=1,setReplayZoom(!0)):t<0&&zoomRatio<40&&(zoomRatio+=1,setReplayZoom(!1))}))}));var panning=!1;function computeRoleIndex(e){var t=e&&e.specs&&e.specs.length?e.specs[0]:void 0;return t&&"dps"!=t.role?"tank"==t.role?1:3:2}function sortByRoleAndName(e,t){var i=computeRoleIndex(e),r=computeRoleIndex(t);return i<r?-1:i>r?1:e.name<t.name?-1:e.name>t.name?1:0}var meterCategory="categories",meterCategoryLevel=0,meterActorID=0,meterTargetActorID=0,meterTargetActorInstanceID=0;function selectReplayMeterCategory(e){meterCategory=e,setMeterCategoryLevel(0),meterActorID=0,$("#meters-frame-contents").html(buildReplayMeterBars()),$("#meters-frame-title-text").html(nameForMeterCategory()),"categories"!=meterCategory?$("#meters-category-up-arrow").show():$("#meters-category-up-arrow").hide()}function addAmountForReplayMeter(e,t,i,r,a,n){t[i]||(t[i]={actor:e.actor,spec:e.spec,total:0,abilities:[]}),t[i].total+=r,a.ability&&(t[i].abilities[n.id+"-"+a.ability.guid]||(t[i].abilities[n.id+"-"+a.ability.guid]={name:e!=n?n.actor.name:void 0,ability:a.ability,total:0}),t[i].abilities[n.id+"-"+a.ability.guid].total+=r)}function nameForMeterCategory(){var e="Categories";return"damage-done"==meterCategory?e="Damage Done":"damage-taken"==meterCategory?e="Damage Taken":"damage-taken-by-ability"==meterCategory?e="Damage Taken By Ability":"healing-done"==meterCategory?e="Healing Done":"healing-received"==meterCategory&&(e="Healing Received"),"Categories"!=e&&(meterActorID&&(e+=" by "+replayActorSet[meterActorID].actor.name),meterTargetActorID&&(e+=("damage-taken"==meterCategory||"damage-taken-by-ability"==meterCategory||"healing-received"==meterCategory?" from ":" to ")+replayActorSet[meterTargetActorID].actor.name),meterTargetActorInstanceID>1&&(e+=" "+meterTargetActorInstanceID)),e}function sortByMeterAmount(e,t){return e.total>t.total?-1:e.total<t.total?1:0}function smallTotal(e){return e>1e9||e<-1e9?(e/=1e9).toFixed(2)+"b":e>1e6||e<-1e6?(e/=1e6).toFixed(2)+"m":e>1e3||e<-1e3?(e/=1e3).toFixed(1)+"k":e.toFixed(1)}function notifyReplayMetersOfSourceChange(e,t,i){if(!i)return meterTargetActorID&&(meterTargetActorID=0,meterTargetActorInstanceID=0),meterCategoryLevel=0,meterActorID=0,lastReplayMeterUpdatePosition=-1e3,updateReplayMeters(),void $("#meters-frame-title-text").html(nameForMeterCategory());var r=replayActorSet[e];if(r){var a=r.actor;if("Pet"!=a.type){if("Boss"==a.type||"Pet"==a.type||"NPC"==a.type)return"damage-done"!=meterCategory&&"damage-taken"!=meterCategory&&"damage-taken-by-ability"!=meterCategory&&(meterCategory="damage-done",$("#meters-category-up-arrow").show()),meterCategoryLevel=0,void selectReplayMeterTarget(e,t);meterCategory="healer"==replayActorSet[e].role?"healing-done":"damage-done",$("#meters-category-up-arrow").show(),selectReplayMeterActor(e)}}}function actorCustomIcon(e){return e?0===e.indexOf("custom-icon-")?icon_path+"abilities/"+e.substring(12):0===e.indexOf("abilities/")?icon_path+e:null:null}function actorIconAndClasses(e){var t={classes:"",icon:""};return t.icon=actorCustomIcon(e.icon),t.icon||(t.classes="sprite actor-sprite-"+e.icon,t.icon=icon_path+"icons/actors"+extensionForActorIcons+"?v=8"),t}function iconForReplayActor(e,t){return actorCustomIcon(e.icon)||icon_path+"icons/"+e.type+(2!=game_id&&t?"-"+t:"")+extensionForActorIcons}function buildReplayMeterActorBar(e,t,i,r){var a=e.actor,n="<div class='meters-frame-bar' onmousedown='if (event.button != 0) return; selectReplayMeterActor("+a.id+"); return false'>";return n+="<div class='meters-frame-amount-bar "+a.type+"-behind-text' style='width:"+t/i*100+"%'></div>",n+="<img class='meters-frame-bar-icon' src='"+iconForReplayActor(a,e.spec)+"'> ",n+="<span class='meters-frame-bar-description'>"+a.name+"</span> <div class='meters-frame-amount-text'>"+smallTotal(t),n+=" ("+smallTotal(t/((replayPosition-fightSegmentStartTime)/1e3))+", "+Math.round(100*t/r)+"%)",(n+="</div>")+"</div>"}function outputGradient(e,t,i,r){for(var a="background-image:"+r,n=0,s=64;s>=1;s/=2)0!=(e&s)&&(a+=1==++n?t[s]+", ":n==i?t[s]:t[s]+" "+Math.floor(100*(n-1)/(i-1))+"%, ");return a+");"}function generateAbilityStyle(e){for(var t=0,i=1;i<128;i*=2)e&i&&t++;if(t<2||7==t)return"";var r=new Array;r[1]="rgb(50%, 32%, 9%)",r[2]="rgb(50%, 50%, 28%)",r[4]="rgb(46%, 13%, 19%)",r[8]="rgb(41%, 49%, 30%)",r[16]="rgb(14%, 25%, 50%)",r[32]="rgb(36%, 33%, 47%)",r[64]="rgb(28%, 47%, 50%)";var a="background-color:#a0a0a0;";return a+=outputGradient(e,r,t,"-webkit-linear-gradient(45deg,"),a+=outputGradient(e,r,t,"-moz-linear-gradient(45deg,"),(a+=outputGradient(e,r,t,"-ms-linear-gradient(45deg,"))+outputGradient(e,r,t,"linear-gradient(45deg,")}function buildReplayMeterAbilityBar(e,t,i,r){var a="<div class='meters-frame-bar'>",n=e.ability;return a+="<div class='meters-frame-amount-bar school-"+n.type+"-behind-text' style='width:"+t/i*100+"%;"+generateAbilityStyle(n.type)+"'></div>",n.guid>abilityCutoff&&(a+='<a target="_new" href="'+abilityExternalLink(n.guid)+'">'),a+="<img class='meters-frame-bar-icon'  src='"+iconForAbility(n)+"'> ",n.guid>abilityCutoff&&(a+="</a>"),a+="<span class='meters-frame-bar-description'>",e.name&&(a+=e.name+": "),a+=n.name+"</span> <div class='meters-frame-amount-text'>"+smallTotal(t),a+=" ("+smallTotal(t/((replayPosition-fightSegmentStartTime)/1e3))+", "+Math.round(100*t/r)+"%)",(a+="</div>")+"</div>"}function selectReplayMeterActor(e){setMeterCategoryLevel(1),meterActorID=e,lastReplayMeterUpdatePosition=-1e3,updateReplayMeters(),$("#meters-frame-title-text").html(nameForMeterCategory())}function selectReplayMeterTarget(e,t){setMeterCategoryLevel(0),meterActorID=0,lastReplayMeterUpdatePosition=-1e3,meterTargetActorID=e,meterTargetActorInstanceID=t,updateReplayMeters(),$("#meters-frame-title-text").html(nameForMeterCategory())}function tableForMeterCategory(e){return"damage-done"==meterCategory?e.damageDoneToTargets:"healing-done"==meterCategory?e.healingDoneToTargets:"healing-received"==meterCategory?e.healingTakenByTargets:"damage-taken"==meterCategory||"damage-taken-by-ability"==meterCategory?e.damageTakenByTargets:null}function buildReplayMeterBars(){var e="";if("categories"==meterCategory)e+="<div class='meters-frame-bar' onmousedown=\"if (event.button != 0) return; selectReplayMeterCategory('damage-done')\"><span class='meters-frame-bar-description'>Damage Done</span></div>",e+="<div class='meters-frame-bar' onmousedown=\"if (event.button != 0) return; selectReplayMeterCategory('damage-taken')\"><span class='meters-frame-bar-description'>Damage Taken</span></div>",e+="<div class='meters-frame-bar' onmousedown=\"if (event.button != 0) return; selectReplayMeterCategory('damage-taken-by-ability')\"><span class='meters-frame-bar-description'>Damage Taken by Ability</span></div>",e+="<div class='meters-frame-bar' onmousedown=\"if (event.button != 0) return; selectReplayMeterCategory('healing-done')\"><span class='meters-frame-bar-description'>Healing Done</span></div>",e+="<div class='meters-frame-bar' onmousedown=\"if (event.button != 0) return; selectReplayMeterCategory('healing-received')\"><span class='meters-frame-bar-description'>Healing Received</span></div>";else if("damage-done"==meterCategory||"healing-done"==meterCategory||"healing-received"==meterCategory||"damage-taken"==meterCategory||"damage-taken-by-ability"==meterCategory){var t=meterTargetActorID+"-"+meterTargetActorInstanceID;if(0==meterCategoryLevel&&"damage-taken-by-ability"!=meterCategory){var i=[];for(var r in replayActorSet)(s=tableForMeterCategory(replayActorSet[r]))&&s[t]&&s[t].total>0&&i.push(s[t]);i.sort(sortByMeterAmount);for(var a=0,n=0;n<i.length;++n)a+=i[n].total;for(n=0;n<i.length;++n)e+=buildReplayMeterActorBar(i[n],i[n].total,i[0].total,a)}else if(1==meterCategoryLevel||"damage-taken-by-ability"==meterCategory){var s,o=[];if(!(s=tableForMeterCategory("damage-taken-by-ability"==meterCategory?replayGlobalActorInfo:replayActorSet[meterActorID]))||!s[t])return"";for(var r in s[t].abilities)s[t].abilities[r].total>0&&o.push(s[t].abilities[r]);for(o.sort(sortByMeterAmount),a=0,n=0;n<o.length;++n)a+=o[n].total;for(n=0;n<o.length;++n)e+=buildReplayMeterAbilityBar(o[n],o[n].total,o[0].total,a)}}return e}function setMeterCategoryLevel(e){meterCategoryLevel=e}function backOutOneLevelInReplayMeter(){"categories"!=meterCategory&&(0==meterCategoryLevel?selectReplayMeterCategory("categories"):(setMeterCategoryLevel(0),meterActorID=0,$("#meters-frame-title-text").html(nameForMeterCategory()),$("#meters-frame-contents").html(buildReplayMeterBars())))}function updateLimitBreakBar(e,t){var i=100-t/100;$("#limit-break-contents-"+e).css("right",i+"%")}function buildLimitBreakFrame(){return"<div id='limit-break-frame'>Limit Break<br><div id='limit-break-contents'><div class='limit-break-bar' id='limit-break-bar-1'><div class='limit-break-bar-contents' id='limit-break-contents-1'></div></div><div class='limit-break-bar' id='limit-break-bar-2'><div class='limit-break-bar-contents' id='limit-break-contents-2'></div></div><div class='limit-break-bar' id='limit-break-bar-3'><div class='limit-break-bar-contents' id='limit-break-contents-3'></div></div></div></div>"}function buildDungeonPullsFrame(){var e=filterFightsArray.length?fightsTable[filterFightsArray[0]]:null;return e&&e.dungeonPulls&&e.dungeonPulls.length?"<div id='pulls-frame'><div id='pulls-frame-title'><span id='pulls-frame-title-text'>Dungeon Pulls</span></div><div id='pulls-frame-body'><div id='pulls-frame-navigation'><div class='pulls-frame-navigation' id='pulls-frame-back' onclick='changeReplayDungeonPull(-1)'><span class='zmdi zmdi-caret-left-circle'></span></div><div id='pulls-frame-contents'>Before First Pull</div><div id='pulls-frame-forward' class='pulls-frame-navigation' onclick='changeReplayDungeonPull(1)'><span class='zmdi zmdi-caret-right-circle'></span></div></div><div id='pulls-frame-controls'><div class='pulls-frame-control' id='toggle-route-view' onclick='toggleRouteView()'>View Route</div><div class='pulls-frame-control' id='toggle-map-snap' onclick='toggleSnapToPulls()'>Snap To Pulls</div></div></div></div>":""}function toggleSnapToPulls(){replaySnapToPulls?$("#toggle-map-snap").removeClass("selected"):$("#toggle-map-snap").addClass("selected"),replaySnapToPulls=!replaySnapToPulls}function toggleRouteView(){replayRouteView?$("#toggle-route-view").removeClass("selected"):$("#toggle-route-view").addClass("selected"),replayRouteView=!replayRouteView,positionChart.getContext("2d").clearRect(0,0,positionChart.width,positionChart.height),replayRouteView&&replayPlaying&&toggleReplayState(),updateAndRedrawReplayChart()}function changeReplayDungeonPull(e){var t=replayDungeonPull+e,i=replayPosition;if(t<=0)t=0,replayPosition=0;else{var r=filterFightsArray.length?fightsTable[filterFightsArray[0]]:null;r&&r.dungeonPulls?(t>=r.dungeonPulls.length&&(t=r.dungeonPulls.length),i=r.dungeonPulls[t-1].start_time):t=0}if(!e||replayDungeonPull!=t){var a=replayPosition;replayPosition=i,updateReplayPlotLine(),shiftReplayPositionToPlotLine(a)}}function updateReplayDungeonPullsFrame(){if(replayDungeonPull!=replayDisplayedDungeonPull||replayBetweenPulls!=replayDisplayedBetweenPulls){var e=filterFightsArray.length?fightsTable[filterFightsArray[0]]:null;if(!e||!e.dungeonPulls||!e.dungeonPulls.length)return replayDungeonPull=replayDisplayedDungeonPull,void(replayBetweenPulls=replayDisplayedBetweenPulls);if(replayDisplayedDungeonPull=replayDungeonPull,replayDisplayedBetweenPulls=replayBetweenPulls,$(".replay-legend-item.enemy").hide(),replayBetweenPulls){var t;return t=1==replayDungeonPull?"Before First Pull":replayDungeonPull==e.dungeonPulls.length?"After Last Pull":"Between Pulls "+(replayDungeonPull-1)+" and "+replayDungeonPull,$("#pulls-frame-contents").html(t),void(replaySnapToPulls&&changeReplayDungeonPull(0))}if($("#pulls-frame-contents").html(outputReplayDungeonPull(replayDungeonPull)),!(replayDungeonPull<1||replayDungeonPull>e.dungeonPulls.length))for(var i in e.dungeonPulls[replayDungeonPull-1].enemies){var r=e.dungeonPulls[replayDungeonPull-1].enemies[i];$("#legend-item-"+r[1]).show()}}}function outputReplayDungeonPull(e){if(e<=0)return"";var t=filterFightsArray.length?fightsTable[filterFightsArray[0]]:null;if(!t||!t.dungeonPulls||e>t.dungeonPulls.length)return"";var i=t.dungeonPulls[e-1],r="<span>",a="<div>"+(r+="Pull "+e+addFightTimeAndDuration(i,fightsTable[filterFightsArray[0]].start_time)+"</span>")+"<br>";if(i.boss)a+="<span class='"+(i.kill?"kill":"wipe")+"'>"+i.name;else{var n=!0;for(var s in i.enemies){n?n=!1:a+=", ";var o=i.enemies[s];a+='<span class="NPC">'+actorTable[o[1]].name,o[3]-o[2]>0&&(a+=" (x<span class='estimate'>"+(o[3]-o[2]+1)+"</span>)"),a+="</span>"}}return a+"</span></div>"}function buildReplayMetersFrame(){var e="<div id='meters-frame' oncontextmenu=\"backOutOneLevelInReplayMeter(); return false\">";return e+="<div id='meters-frame-title'><span id='meters-frame-title-text'>"+nameForMeterCategory()+"</span><img id='meters-category-up-arrow' style='display:none' onmousedown='if (event.button != 0) return; backOutOneLevelInReplayMeter()' src='"+assetServer+"/img/arrow_up2.png'></div>",e+="<div id='meters-frame-body'><div id='meters-frame-contents'>",(e+=buildReplayMeterBars())+"</div></div></div>"}var lastReplayMeterUpdatePosition=-1e3;function updateReplayMeters(){(replayPosition-lastReplayMeterUpdatePosition>100||replayPosition-lastReplayMeterUpdatePosition<-100)&&($("#meters-frame-contents").html(buildReplayMeterBars()),lastReplayMeterUpdatePosition=replayPosition)}function toggleReplayLegendItem(e,t){var i=replayActorSet[t];if(i){var r=i.series;if(r.visible){if(r.visible=!1,$(e).addClass("hidden"),r.pets)for(a=0;a<r.pets.length;++a)r.pets[a].visible=!1}else if(r.visible=!0,$(e).removeClass("hidden"),r.pets)for(var a=0;a<r.pets.length;++a)r.pets[a].visible=!0;return updateAndRedrawPositionChart(!0),!1}}function buildReplayLegendItem(e){if(!1===e.showInLegend)return"";var t=e.actorid,i=replayActorSet[t],r="<div onclick='return toggleReplayLegendItem(this, "+t+")' class='replay-legend-item "+(e.enemy?"enemy":"friendly")+"' id='legend-item-"+t+"'";return e.visible||(r+=" hidden"),r+="'><img class='replay-legend-icon' src='"+iconForReplayActor(i.actor,i.spec)+"'>",(r+="<span class='replay-legend-name' style='color: "+e.color+"'>"+e.name+"</span>")+"</div>"}function buildReplayRaidUI(e){if(e){e.sort(sortByRoleAndName);for(var t=2==game_id||4==game_id?4:5,i="<div id='raid-frames'>",r=Math.ceil(e.length/t),a=Math.floor(100/r),n=0;n<e.length;++n){var s=e[n];replayActorSet[s.id].role=s.specs&&s.specs.length>0?s.specs[0].role:null,replayActorSet[s.id].spec=s.specs&&s.specs.length>0?s.specs[0].spec:null,n%t==0&&(n>0&&(i+="</div>"),i+="<div class='raid-frames-row' style='height:"+a+"%'>"),i+="<div class='raid-frames-column'><div onclick='toggleReplayRaidFrameSelection(this)' class='raid-frame "+s.type+"' id='raid-frame-"+s.id+"' actorid='"+s.id+"'><div class='raid-frame-health'></div>",gameHasShieldsOrAbsorbs()&&(i+="<div class='raid-frame-shield'></div>"),i+="<div class='raid-frame-debuffs'></div><img class='raid-frame-marker' src=''><div style='height:100%;width:100%;overflow:hidden'><table style='width:100%; height:100%;border-spacing:0'><tr><td class='raid-frame-contents'>"+s.name+"</table></div></div></div>"}i+="</div>",i+="</div>",i+="<div id='boss-frames'>",i+="<div id='boss-frame-section'></div>",i+="<div id='npc-frame-section'></div>",i+="</div>",i+="<div id='source-frames'></div>",i+="<div id='target-frames'></div>",i+="<div id='tot-frames'></div>",2==game_id&&(i+=buildLimitBreakFrame()),i+=buildReplayMetersFrame(),i+=buildDungeonPullsFrame(),i+="<div id='video-frame'><div id='video-frame-inner'></div><div id='video-frame-controls'><span onclick='toggleMuteForVideo()' class='graph-legend-button' style='float:left' id='mute-video'>Unmute</span><span class='graph-legend-button' onclick='toggleFullscreenVideo()' style='float:right' id='fullscreen-video'>Enter Fullscreen</span><span id='remove-video' onclick='removeVideo()' style='display:none; float:right; margin-right:10px' class='graph-legend-button'>Delete Video</span><span id='select-video' onclick='showSelectVideoUI()' style='display:none; margin-right:-1px; float:right' class='graph-legend-button'>Select Video</span></div></div>",$("#unit-frames-container").html(i),$("#meters-frame-body").mCustomScrollbar({theme:"light-thin",scrollButtons:{enable:!0}}),document.getElementById("raid-frames").style.height=4*r+"%";var o="<div id='replay-legend-inset'>";for(n=0;n<replaySeries.length;++n)o+=buildReplayLegendItem(replaySeries[n]);o+="</div>",$("#replay-legend").html(o);var l=filterFightsArray.length?fightsTable[filterFightsArray[0]]:null;l&&l.dungeonPulls&&l.dungeonPulls.length&&$(".replay-legend-item.enemy").hide()}}function countReplayPinMatchesForSlideshow(e){for(var t=replayEvents[e].events,i=0;i<t.length;++i){var r=t[i];r.pin&&r.pin.length&&replayTotalSlides++}$("#slideshow-total-slides").html(replayTotalSlides)}function nextReplaySlide(){replayCurrentSlide>=replayTotalSlides||findReplaySlide(!1)}function previousReplaySlide(){replayCurrentSlide<=1||findReplaySlide(!0)}function findReplaySlide(e){for(;!replayEvents[replayEventsSegment].events.length||(e?replayEventIndex>=0:replayEvents[replayEventsSegment]&&replayEventIndex<replayEvents[replayEventsSegment].events.length);e?--replayEventIndex:++replayEventIndex){var t=replayEvents[replayEventsSegment].events,i=t[replayEventIndex];if(i){var r=i!=replayCurrentSlideEvent&&i.pin&&i.pin.length;if(updateReplayForEvent(i,e),replayPosition=i.timestamp,r)break}if(e||replayEvents[replayEventsSegment].events.length&&replayEventIndex!=t.length-1){if(e&&(!replayEvents[replayEventsSegment].events.length||0==replayEventIndex)){if(!(replayEventsSegment-1>=0))break;replayEventsSegment--,replayEventIndex=replayEvents[replayEventsSegment].events.length}}else{if(!(replayEventsSegment+1<replayEvents.length))break;replayEventsSegment++,replayEventIndex=-1}}removeStaleActorsFromReplay(),updateAndRedrawPositionChart(),updateReplayMeters(),updateReplayPlotLine(),document.getElementById("replay-current-time").innerHTML=makeSmartDuration(Math.floor((replayPosition-fightSegmentStartTime)/1e3),!0)}replayLoaded=!0,Highcharts.theme={colors:["#aaeeee","#f45b5b","#90ee7e","#7798BF","#777777","#ff0066","#7E4DB1","#55BF3B","#DF5353","#058DC7","#50B432","#ED561B","#DDDF00","#24CBE5","#64E572","#FF9655","#FFF263","#6AF9C4"],chart:{backgroundColor:"#141414",borderWidth:1,borderRadius:0,borderColor:"#333",plotBackgroundColor:null,plotShadow:!1,spacingTop:15,plotBorderWidth:0,zoomType:"x"},title:{style:{color:"#fff",font:"16px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif"}},subtitle:{style:{color:"#fff",font:"12px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif"}},xAxis:{ordinal:!1,gridLineWidth:0,lineColor:"#333",tickColor:"#333",labels:{style:{color:"#fff",fontWeight:"normal"}},title:{style:{color:"#fff",font:"bold 12px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif"}}},yAxis:{ordinal:!1,alternateGridColor:null,minorTickInterval:null,gridLineColor:"rgba(255, 255, 255, .1)",lineWidth:0,tickWidth:0,labels:{style:{color:"#fff",fontWeight:"normal"}},title:{style:{color:"#fff",font:"bold 12px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif"}}},legend:{itemStyle:{color:"#c2c7d0",fontSize:"9px"},itemHoverStyle:{color:"#fff"},itemHiddenStyle:{color:"#666"},maxHeight:60,navigation:{activeColor:"#333",inactiveColor:"#141414",arrowSize:11,style:{color:"#fff",fontSize:"10px"}}},labels:{style:{color:"#fff"}},tooltip:{backgroundColor:"#202020",borderWidth:5,borderColor:"rgba(33%, 33%, 33%, 0.8)",borderRadius:2,style:{color:"#FFF"}},plotOptions:{line:{dataLabels:{color:"#fff"},marker:{lineColor:"#333"}},spline:{marker:{lineColor:"#333"}},scatter:{marker:{lineColor:"#333"}},candlestick:{lineColor:"fff"}},toolbar:{itemStyle:{color:"#fff"}},navigation:{buttonOptions:{backgroundColor:"#fff",borderColor:"#4d4d4d",symbolStroke:"#fff",hoverSymbolStroke:"#fff"}},exporting:{buttons:{exportButton:{symbolFill:"#fff"},printButton:{symbolFill:"#fff"}}},rangeSelector:{buttonTheme:{fill:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[.4,"#888"],[.6,"#555"]]},stroke:"#747474",style:{color:"#fff",fontWeight:"normal"},states:{hover:{fill:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[.4,"#BBB"],[.6,"#888"]]},stroke:"#747474",style:{color:"white"}},select:{fill:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[.1,"#000"],[.3,"#333"]]},stroke:"#747474",style:{color:"#fff"}}}},inputStyle:{backgroundColor:"#141414",color:"#fff",fontSize:"x-small",borderColor:"#4d4d4d"},labelStyle:{color:"#ff"}},navigator:{handles:{backgroundColor:"#141414",borderColor:"#d6d6d6"},outlineColor:"#4d4d4d",maskFill:"rgba(16, 16, 16, 0.5)",series:{color:"#808a9c",lineColor:"rgba(16,16,16,0.0)"}},scrollbar:{barBackgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[.4,"#888"],[.6,"#555"]]},barBorderColor:"#747474",buttonArrowColor:"#d6d6d6",buttonBackgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[.4,"#888"],[.6,"#555"]]},buttonBorderColor:"#747474",rifleColor:"#d6d6d6",trackBackgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#000"],[1,"#333"]]},trackBorderColor:"#747474"},legendBackgroundColor:"rgba(48, 48, 48, 0.8)",legendBackgroundColorSolid:"rgb(70, 70, 70)",dataLabelsColor:"#fff",textColor:"#fff",maskColor:"rgba(255,255,255,0.3)"};var highchartsOptions=Highcharts.setOptions(Highcharts.theme);!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=t(require("jquery")):e.Tipped=t(jQuery)}(this,(function($){function degrees(e){return 180*e/Math.PI}function radian(e){return e*Math.PI/180}function sec(e){return 1/Math.cos(e)}function sfcc(e){return String.fromCharCode.apply(String,e.replace(" ","").split(","))}function deepExtend(e,t){for(var i in t)t[i]&&t[i].constructor&&t[i].constructor===Object?(e[i]=$.extend({},e[i])||{},deepExtend(e[i],t[i])):e[i]=t[i];return e}function Spin(){return this.initialize.apply(this,_slice.call(arguments))}function Visible(){return this.initialize.apply(this,_slice.call(arguments))}function Skin(){this.initialize.apply(this,_slice.call(arguments))}function Stem(){this.initialize.apply(this,_slice.call(arguments))}function Tooltip(){this.initialize.apply(this,_slice.call(arguments))}function Collection(){this.initialize.apply(this,_slice.call(arguments))}var Tipped={};$.extend(Tipped,{version:"4.5.7"}),Tipped.Skins={base:{afterUpdate:!1,ajax:{},cache:!0,container:!1,containment:{selector:"viewport",padding:5},close:!1,detach:!0,fadeIn:200,fadeOut:200,showDelay:75,hideDelay:25,hideAfter:!1,hideOn:{element:"mouseleave"},hideOthers:!1,position:"top",inline:!1,offset:{x:0,y:0},onHide:!1,onShow:!1,padding:!0,radius:!0,shadow:!0,showOn:{element:"mousemove"},size:"medium",spinner:!0,stem:!0,target:"element",voila:!0},reset:{ajax:!1,hideOn:{element:"mouseleave",tooltip:"mouseleave"},showOn:{element:"mouseenter",tooltip:"mouseenter"}}},$.each("dark".split(" "),(function(e,t){Tipped.Skins[t]={}}));var Browser=function(e){function t(t){var i=new RegExp(t+"([\\d.]+)").exec(e);return!i||parseFloat(i[1])}return{IE:!(!window.attachEvent||-1!==e.indexOf("Opera"))&&t("MSIE "),Opera:e.indexOf("Opera")>-1&&(!!window.opera&&opera.version&&parseFloat(opera.version())||7.55),WebKit:e.indexOf("AppleWebKit/")>-1&&t("AppleWebKit/"),Gecko:e.indexOf("Gecko")>-1&&-1===e.indexOf("KHTML")&&t("rv:"),MobileSafari:!!e.match(/Apple.*Mobile.*Safari/),Chrome:e.indexOf("Chrome")>-1&&t("Chrome/"),ChromeMobile:e.indexOf("CrMo")>-1&&t("CrMo/"),Android:e.indexOf("Android")>-1&&t("Android "),IEMobile:e.indexOf("IEMobile")>-1&&t("IEMobile/")}}(navigator.userAgent),Support=function(){function e(e,t){for(var r in e)if(void 0!==i.style[e[r]])return"prefix"!=t||e[r];return!1}function t(t,i){var a=t.charAt(0).toUpperCase()+t.substr(1);return e((t+" "+r.join(a+" ")+a).split(" "),i)}var i=document.createElement("div"),r="Webkit Moz O ms Khtml".split(" ");return{css:{animation:t("animation"),transform:t("transform"),prefixed:function(e){return t(e,"prefix")}},shadow:t("boxShadow")&&t("pointerEvents"),touch:function(){try{return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}catch(e){return!1}}()}}(),_slice=Array.prototype.slice,_={wrap:function(e,t){var i=e;return function(){var e=[$.proxy(i,this)].concat(_slice.call(arguments));return t.apply(this,e)}},isElement:function(e){return e&&1==e.nodeType},isText:function(e){return e&&3==e.nodeType},isDocumentFragment:function(e){return e&&11==e.nodeType},delay:function(e,t){var i=_slice.call(arguments,2);return setTimeout((function(){return e.apply(e,i)}),t)},defer:function(e){return _.delay.apply(this,[e,1].concat(_slice.call(arguments,1)))},pointer:function(e){return{x:e.pageX,y:e.pageY}},element:{isAttached:function(e){var t=function(e){for(var t=e;t&&t.parentNode;)t=t.parentNode;return t}(e);return!(!t||!t.body)}}},getUID=(a=0,function(e){for(e=e||"_tipped-uid-",a++;document.getElementById(e+a);)a++;return e+a}),Position={positions:["topleft","topmiddle","topright","righttop","rightmiddle","rightbottom","bottomright","bottommiddle","bottomleft","leftbottom","leftmiddle","lefttop"],regex:{toOrientation:/^(top|left|bottom|right)(top|left|bottom|right|middle|center)$/,horizontal:/^(top|bottom)/,isCenter:/(middle|center)/,side:/^(top|bottom|left|right)/},toDimension:function(){var e={top:"height",left:"width",bottom:"height",right:"width"};return function(t){return e[t]}}(),isCenter:function(e){return!!e.toLowerCase().match(this.regex.isCenter)},isCorner:function(e){return!this.isCenter(e)},getOrientation:function(e){return e.toLowerCase().match(this.regex.horizontal)?"horizontal":"vertical"},getSide:function(e){var t=null,i=e.toLowerCase().match(this.regex.side);return i&&i[1]&&(t=i[1]),t},split:function(e){return e.toLowerCase().match(this.regex.toOrientation)},_flip:{top:"bottom",bottom:"top",left:"right",right:"left"},flip:function(e,t){var i=this.split(e);return t?this.inverseCornerPlane(this.flip(this.inverseCornerPlane(e))):this._flip[i[1]]+i[2]},inverseCornerPlane:function(e){if(Position.isCorner(e)){var t=this.split(e);return t[2]+t[1]}return e},adjustOffsetBasedOnPosition:function(e,t,i){var r=$.extend({},e),a={horizontal:"x",vertical:"y"},n=Position.getOrientation(t);if(n==Position.getOrientation(i))Position.getSide(t)!=Position.getSide(i)&&(r[{x:"y",y:"x"}[a[n]]]*=-1);else{var s=r.x;r.x=r.y,r.y=s;var o={top:{right:"x"},bottom:{left:"x"},left:{bottom:"y"},right:{top:"y"}}[Position.getSide(t)][Position.getSide(i)];o&&(r[o]*=-1),r[a[Position.getOrientation(i)]]=0}return r},getBoxFromPoints:function(e,t,i,r){var a=Math.min(e,i),n=Math.max(e,i),s=Math.min(t,r),o=Math.max(t,r);return{left:a,top:s,width:Math.max(n-a,0),height:Math.max(o-s,0)}},isPointWithinBox:function(e,t,i,r,a,n){var s=this.getBoxFromPoints(i,r,a,n);return e>=s.left&&e<=s.left+s.width&&t>=s.top&&t<=s.top+s.height},isPointWithinBoxLayout:function(e,t,i){return this.isPointWithinBox(e,t,i.position.left,i.position.top,i.position.left+i.dimensions.width,i.position.top+i.dimensions.height)},getDistance:function(e,t,i,r){return Math.sqrt(Math.pow(Math.abs(i-e),2)+Math.pow(Math.abs(r-t),2))},intersectsLine:function(){var e=function(e,t,i,r,a,n){var s=(n-t)*(i-e)-(r-t)*(a-e);return s>0||!(0>s)};return function(t,i,r,a,n,s,o,l,p){return p?(m=((u=o-n)*(i-s)-(h=l-s)*(t-n))/(-u*(c=a-i)+(d=r-t)*h),(f=(-c*(t-n)+d*(i-s))/(-u*c+d*h))>=0&&1>=f&&m>=0&&1>=m&&{x:t+m*d,y:i+m*c}):e(t,i,n,s,o,l)!=e(r,a,n,s,o,l)&&e(t,i,r,a,n,s)!=e(t,i,r,a,o,l);var d,c,u,h,f,m}}()},Bounds={viewport:function(){return Browser.MobileSafari||Browser.Android&&Browser.Gecko?{width:window.innerWidth,height:window.innerHeight}:{height:$(window).height(),width:$(window).width()}}},Mouse={_buffer:{pageX:0,pageY:0},_dimensions:{width:30,height:30},_shift:{x:2,y:10},getPosition:function(e){var t=this.getActualPosition(e);return{left:t.left-Math.round(.5*this._dimensions.width)+this._shift.x,top:t.top-Math.round(.5*this._dimensions.height)+this._shift.y}},getActualPosition:function(e){var t=e&&"number"==$.type(e.pageX)?e:this._buffer;return{left:t.pageX,top:t.pageY}},getDimensions:function(){return this._dimensions}},Color=function(){function e(e){return("0"+parseInt(e).toString(16)).slice(-2)}function t(t){return"#"+e((t=t.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/))[1])+e(t[2])+e(t[3])}var i={_default:"#000000",aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"};return{toRGB:function(e){if(/^rgba?\(/.test(e))return t(e);i[e]&&(e=i[e]);var r=e.replace("#","");return/^(?:[0-9a-fA-F]{3}){1,2}$/.test(r),3==r.length&&(r=r.charAt(0)+r.charAt(0)+r.charAt(1)+r.charAt(1)+r.charAt(2)+r.charAt(2)),"#"+r}}}(),a;Spin.supported=Support.css.transform&&Support.css.animation,$.extend(Spin.prototype,{initialize:function(){this.options=$.extend({},arguments[0]||{}),this.build(),this.start()},build:function(){var e=2*(this.options.length+this.options.radius),t={height:e,width:e};this.element=$("<div>").addClass("tpd-spin").css(t),this.element.append(this._rotate=$("<div>").addClass("tpd-spin-rotate")),this.element.css({"margin-left":-.5*t.width,"margin-top":-.5*t.height});for(var i=this.options.lines,r=0;i>r;r++){var a,n;this._rotate.append(a=$("<div>").addClass("tpd-spin-frame").append(n=$("<div>").addClass("tpd-spin-line"))),n.css({"background-color":this.options.color,width:this.options.width,height:this.options.length,"margin-left":-.5*this.options.width,"border-radius":Math.round(.5*this.options.width)}),a.css({opacity:(1/i*(r+1)).toFixed(2)});var s={};s[Support.css.prefixed("transform")]="rotate("+360/i*(r+1)+"deg)",a.css(s)}},start:function(){var e={};e[Support.css.prefixed("animation")]="tpd-spin 1s infinite steps("+this.options.lines+")",this._rotate.css(e)},stop:function(){var e={};e[Support.css.prefixed("animation")]="none",this._rotate.css(e),this.element.detach()}}),$.extend(Visible.prototype,{initialize:function(e){return e="array"==$.type(e)?e:[e],this.elements=e,this._restore=[],$.each(e,$.proxy((function(e,t){var i=$(t).is(":visible");i||$(t).show(),this._restore.push({element:t,visible:i})}),this)),this},restore:function(){$.each(this._restore,(function(e,t){t.visible||$(t.element).show()})),this._restore=null}});var AjaxCache=function(){var e=[];return{get:function(t){for(var i=null,r=0;r<e.length;r++)e[r]&&e[r].url==t.url&&(e[r].type||"GET").toUpperCase()==(t.type||"GET").toUpperCase()&&$.param(e[r].data||{})==$.param(t.data||{})&&(i=e[r]);return i},set:function(t,i,r){var a=this.get(t);a||(a=$.extend({callbacks:{}},t),e.push(a)),a.callbacks[i]=r},remove:function(t){for(var i=0;i<e.length;i++)e[i]&&e[i].url==t&&delete e[i]},clear:function(){e=[]}}}(),Voila=function(e){function t(i,r,a){if(!(this instanceof t))return new t(i,r,a);var n=e.type(arguments[1]),s="object"===n?arguments[1]:{},o="function"===n?arguments[1]:"function"===e.type(arguments[2])&&arguments[2];return this.options=e.extend({method:"onload"},s),this.deferred=new jQuery.Deferred,o&&this.always(o),this._processed=0,this.images=[],this._add(i),this}e.extend(t.prototype,{_add:function(t){var r="string"==e.type(t)?e(t):t instanceof jQuery||t.length>0?t:[t];e.each(r,e.proxy((function(t,r){var a=e(),n=e(r);(a=n.is("img")?a.add(n):a.add(n.find("img"))).each(e.proxy((function(t,r){this.images.push(new i(r,e.proxy((function(e){this._progress(e)}),this),e.proxy((function(e){this._progress(e)}),this),this.options))}),this))}),this)),this.images.length<1&&setTimeout(e.proxy((function(){this._resolve()}),this))},abort:function(){this._progress=this._notify=this._reject=this._resolve=function(){},e.each(this.images,(function(e,t){t.abort()})),this.images=[]},_progress:function(e){this._processed++,e.isLoaded||(this._broken=!0),this._notify(e),this._processed==this.images.length&&this[this._broken?"_reject":"_resolve"]()},_notify:function(e){this.deferred.notify(this,e)},_reject:function(){this.deferred.reject(this)},_resolve:function(){this.deferred.resolve(this)},always:function(e){return this.deferred.always(e),this},done:function(e){return this.deferred.done(e),this},fail:function(e){return this.deferred.fail(e),this},progress:function(e){return this.deferred.progress(e),this}});var i=function(e){var t=function(){return this.initialize.apply(this,Array.prototype.slice.call(arguments))};e.extend(t.prototype,{initialize:function(){this.options=e.extend({test:function(){},success:function(){},timeout:function(){},callAt:!1,intervals:[[0,0],[1e3,10],[2e3,50],[4e3,100],[2e4,500]]},arguments[0]||{}),this._test=this.options.test,this._success=this.options.success,this._timeout=this.options.timeout,this._ipos=0,this._time=0,this._delay=this.options.intervals[this._ipos][1],this._callTimeouts=[],this.poll(),this._createCallsAt()},poll:function(){this._polling=setTimeout(e.proxy((function(){if(this._test())this.success();else{if(this._time+=this._delay,this._time>=this.options.intervals[this._ipos][0]){if(!this.options.intervals[this._ipos+1])return void("function"==e.type(this._timeout)&&this._timeout());this._ipos++,this._delay=this.options.intervals[this._ipos][1]}this.poll()}}),this),this._delay)},success:function(){this.abort(),this._success()},_createCallsAt:function(){this.options.callAt&&e.each(this.options.callAt,e.proxy((function(t,i){var r=i[0],a=i[1],n=setTimeout(e.proxy((function(){a()}),this),r);this._callTimeouts.push(n)}),this))},_stopCallTimeouts:function(){e.each(this._callTimeouts,(function(e,t){clearTimeout(t)})),this._callTimeouts=[]},abort:function(){this._stopCallTimeouts(),this._polling&&(clearTimeout(this._polling),this._polling=null)}});var i=function(){return this.initialize.apply(this,Array.prototype.slice.call(arguments))};return e.extend(i.prototype,{supports:{naturalWidth:"naturalWidth"in new Image},initialize:function(t,i,r){return this.img=e(t)[0],this.successCallback=i,this.errorCallback=r,this.isLoaded=!1,this.options=e.extend({method:"onload",pollFallbackAfter:1e3},arguments[3]||{}),"onload"!=this.options.method&&this.supports.naturalWidth?void this.poll():void this.load()},poll:function(){this._poll=new t({test:e.proxy((function(){return this.img.naturalWidth>0}),this),success:e.proxy((function(){this.success()}),this),timeout:e.proxy((function(){this.error()}),this),callAt:[[this.options.pollFallbackAfter,e.proxy((function(){this.load()}),this)]]})},load:function(){this._loading=setTimeout(e.proxy((function(){var t=new Image;this._onloadImage=t,t.onload=e.proxy((function(){t.onload=function(){},this.supports.naturalWidth||(this.img.naturalWidth=t.width,this.img.naturalHeight=t.height,t.naturalWidth=t.width,t.naturalHeight=t.height),this.success()}),this),t.onerror=e.proxy(this.error,this),t.src=this.img.src}),this))},success:function(){this._calledSuccess||(this._calledSuccess=!0,this.abort(),this.waitForRender(e.proxy((function(){this.isLoaded=!0,this.successCallback(this)}),this)))},error:function(){this._calledError||(this._calledError=!0,this.abort(),this._errorRenderTimeout=setTimeout(e.proxy((function(){this.errorCallback&&this.errorCallback(this)}),this)))},abort:function(){this.stopLoading(),this.stopPolling(),this.stopWaitingForRender()},stopPolling:function(){this._poll&&(this._poll.abort(),this._poll=null)},stopLoading:function(){this._loading&&(clearTimeout(this._loading),this._loading=null),this._onloadImage&&(this._onloadImage.onload=function(){},this._onloadImage.onerror=function(){})},waitForRender:function(e){this._renderTimeout=setTimeout(e)},stopWaitingForRender:function(){this._renderTimeout&&(clearTimeout(this._renderTimeout),this._renderTimeout=null),this._errorRenderTimeout&&(clearTimeout(this._errorRenderTimeout),this._errorRenderTimeout=null)}}),i}(jQuery);return t}(jQuery);Tipped.Behaviors={hide:{showOn:{element:"mouseenter",tooltip:!1},hideOn:{element:"mouseleave",tooltip:"mouseenter"}},mouse:{showOn:{element:"mouseenter",tooltip:!1},hideOn:{element:"mouseleave",tooltip:"mouseenter"},target:"mouse",showDelay:100,fadeIn:0,hideDelay:0,fadeOut:0},sticky:{showOn:{element:"mouseenter",tooltip:"mouseenter"},hideOn:{element:"mouseleave",tooltip:"mouseleave"},showDelay:150,target:"mouse",fixed:!0}};var Options={create:function(){function e(t){return a=Tipped.Skins.base,n=deepExtend($.extend({},a),Tipped.Skins.reset),e=r,r(t)}function t(e){return e.match(/^(top|left|bottom|right)$/)&&(e+="middle"),e.replace("center","middle").replace(" ",""),e}function i(e){var t;return e.behavior&&(t=Tipped.Behaviors[e.behavior])?deepExtend($.extend({},t),e):e}function r(e){var r=e.skin?e.skin:Tooltips.options.defaultSkin,s=$.extend({},Tipped.Skins[r]||{});s.skin||(s.skin=Tooltips.options.defaultSkin||"dark");var o=deepExtend($.extend({},n),i(s)),l=deepExtend($.extend({},o),i(e));l[sfcc("115,107,105,110")]=sfcc("100,97,114,107"),l.ajax&&(n.ajax,a.ajax,"boolean"==$.type(l.ajax)&&(l.ajax={}),l.ajax=!1);var p,d=d=l.position&&l.position.target||"string"==$.type(l.position)&&l.position||n.position&&n.position.target||"string"==$.type(n.position)&&n.position||a.position&&a.position.target||a.position;d=t(d);var c,u=l.position&&l.position.tooltip||n.position&&n.position.tooltip||a.position&&a.position.tooltip||Tooltips.Position.getInversedPosition(d);if(u=t(u),l.position?"string"==$.type(l.position)?(l.position=t(l.position),p={target:l.position,tooltip:Tooltips.Position.getTooltipPositionFromTarget(l.position)}):(p={tooltip:u,target:d},l.position.tooltip&&(p.tooltip=t(l.position.tooltip)),l.position.target&&(p.target=t(l.position.target))):p={tooltip:u,target:d},Position.isCorner(p.target)&&Position.getOrientation(p.target)!=Position.getOrientation(p.tooltip)&&(p.target=Position.inverseCornerPlane(p.target)),"mouse"==l.target){var h=Position.getOrientation(p.target);p.target="horizontal"==h?p.target.replace(/(left|right)/,"middle"):p.target.replace(/(top|bottom)/,"middle")}if(l.position=p,"mouse"==l.target?(c=$.extend({},a.offset),$.extend(c,Tipped.Skins.reset.offset||{}),c=Position.adjustOffsetBasedOnPosition(a.offset,a.position,p.target,!0),e.offset&&(c=$.extend(c,e.offset||{}))):c={x:l.offset.x,y:l.offset.y},l.offset=c,l.hideOn&&"click-outside"==l.hideOn&&(l.hideOnClickOutside=!0,l.hideOn=!1,l.fadeOut=0),l.showOn){var f=l.showOn;"string"==$.type(f)&&(f={element:f}),l.showOn=f}if(l.hideOn){var m=l.hideOn;"string"==$.type(m)&&(m={element:m}),l.hideOn=m}return l.inline&&"string"!=$.type(l.inline)&&(l.inline=!1),Browser.IE&&Browser.IE<9&&$.extend(l,{fadeIn:0,fadeOut:0,hideDelay:0}),l.spinner&&(Spin.supported?"boolean"==$.type(l.spinner)&&(l.spinner=n.spinner||a.spinner||{}):l.spinner=!1),l.container||(l.container=document.body),l.containment&&"string"==$.type(l.containment)&&(l.containment={selector:l.containment,padding:n.containment&&n.containment.padding||a.padding&&a.containment.padding}),l.shadow&&(l.shadow=Support.shadow),l}var a,n;return e}()};$.extend(Skin.prototype,{initialize:function(e){this.tooltip=e,this.element=e._skin;var t=this.tooltip.options;this.tooltip._tooltip[(t.shadow?"remove":"add")+"Class"]("tpd-no-shadow")[(t.radius?"remove":"add")+"Class"]("tpd-no-radius")[(t.stem?"remove":"add")+"Class"]("tpd-no-stem");var i,r,a,n,s=Support.css.prefixed("borderTopLeftRadius");this.element.append(i=$("<div>").addClass("tpd-frames").append($("<div>").addClass("tpd-frame").append($("<div>").addClass("tpd-backgrounds").append(r=$("<div>").addClass("tpd-background").append(a=$("<div>").addClass("tpd-background-content")))))).append(n=$("<div>").addClass("tpd-spinner")),r.css({width:999,height:999,zoom:1}),this._css={border:parseFloat(r.css("border-top-width")),radius:parseFloat(s?r.css(s):0),padding:parseFloat(e._content.css("padding-top")),borderColor:r.css("border-top-color"),backgroundColor:a.css("background-color"),backgroundOpacity:a.css("opacity"),spinner:{dimensions:{width:n.innerWidth(),height:n.innerHeight()}}},n.remove(),i.remove(),this._side=Position.getSide(e.options.position.tooltip)||"top",this._vars={}},destroy:function(){this.frames&&($.each("top right bottom left".split(" "),$.proxy((function(e,t){this["stem_"+t]&&this["stem_"+t].destroy()}),this)),this.frames.remove(),this.frames=null)},build:function(){this.frames||(this.element.append(this.frames=$("<div>").addClass("tpd-frames")),$.each("top right bottom left".split(" "),$.proxy((function(e,t){this.insertFrame(t)}),this)),this._spinner||this.tooltip._tooltip.append(this._spinner=$("<div>").addClass("tpd-spinner").hide().append($("<div>").addClass("tpd-spinner-spin"))))},_frame:function(){var e,t=$("<div>").addClass("tpd-frame").append(e=$("<div>").addClass("tpd-backgrounds").append($("<div>").addClass("tpd-background-shadow"))).append($("<div>").addClass("tpd-shift-stem").append($("<div>").addClass("tpd-shift-stem-side tpd-shift-stem-side-before")).append($("<div>").addClass("tpd-stem")).append($("<div>").addClass("tpd-shift-stem-side tpd-shift-stem-side-after")));return $.each("top right bottom left".split(" "),$.proxy((function(t,i){e.append($("<div>").addClass("tpd-background-box tpd-background-box-"+i).append($("<div>").addClass("tpd-background-box-shift").append($("<div>").addClass("tpd-background-box-shift-further").append($("<div>").addClass("tpd-background").append($("<div>").addClass("tpd-background-title")).append($("<div>").addClass("tpd-background-content"))).append($("<div>").addClass("tpd-background tpd-background-loading")).append($("<div>").addClass("tpd-background-border-hack").hide()))))}),this)),t}(),_getFrame:function(e){var t=this._frame.clone();t.addClass("tpd-frame-"+e),t.find(".tpd-background-shadow").css({"border-radius":this._css.radius}),this.tooltip.options.stem&&t.find(".tpd-stem").attr("data-stem-position",e);var i=Math.max(this._css.radius-this._css.border,0);t.find(".tpd-background-title").css({"border-top-left-radius":i,"border-top-right-radius":i}),t.find(".tpd-background-content").css({"border-bottom-left-radius":i,"border-bottom-right-radius":i}),t.find(".tpd-background-loading").css({"border-radius":i});var r={backgroundColor:this._css.borderColor};return r["horizontal"==Position.getOrientation(e)?"height":"width"]=this._css.border+"px",r[{top:"bottom",bottom:"top",left:"right",right:"left"}[e]]=0,t.find(".tpd-shift-stem-side").css(r),t},insertFrame:function(e){var t=this["frame_"+e]=this._getFrame(e);if(this.frames.append(t),this.tooltip.options.stem){var i=t.find(".tpd-stem");this["stem_"+e]=new Stem(i,this,{})}},startLoading:function(){this.tooltip.supportsLoading&&(this.build(),this._spinner||this.tooltip.is("resize-to-content")||this.setDimensions(this._css.spinner.dimensions),this._spinner&&this._spinner.show())},stopLoading:function(){this.tooltip.supportsLoading&&this._spinner&&(this.build(),this._spinner.hide())},updateBackground:function(){var e=this._vars.frames[this._side],t=$.extend({},e.background.dimensions);if(this.tooltip.title&&!this.tooltip.is("loading")){this.element.find(".tpd-background-title, .tpd-background-content").show(),this.element.find(".tpd-background").css({"background-color":"transparent"});var i=$.extend({},t),r=Math.max(this._css.radius-this._css.border,0),a={"border-top-left-radius":r,"border-top-right-radius":r,"border-bottom-left-radius":r,"border-bottom-right-radius":r},n=new Visible(this.tooltip._tooltip),s=this.tooltip._titleWrapper.innerHeight();i.height-=s,this.element.find(".tpd-background-title").css({height:s,width:t.width}),a["border-top-left-radius"]=0,a["border-top-right-radius"]=0,n.restore(),this.element.find(".tpd-background-content").css(i).css(a),this.element.find(".tpd-background-loading").css({"background-color":this._css.backgroundColor})}else this.element.find(".tpd-background-title, .tpd-background-content").hide(),this.element.find(".tpd-background").css({"background-color":this._css.backgroundColor});this._css.border&&(this.element.find(".tpd-background").css({"border-color":"transparent"}),this.element.find(".tpd-background-border-hack").css({width:t.width,height:t.height,"border-radius":this._css.radius,"border-width":this._css.border,"border-color":this._css.borderColor}).show())},paint:function(){if(!this._paintedDimensions||this._paintedDimensions.width!=this._dimensions.width||this._paintedDimensions.height!=this._dimensions.height||this._paintedStemPosition!=this._stemPosition){this._paintedDimensions=this._dimensions,this._paintedStemPosition=this._stemPosition,this.element.removeClass("tpd-visible-frame-top tpd-visible-frame-bottom tpd-visible-frame-left tpd-visible-frame-right").addClass("tpd-visible-frame-"+this._side);var e=this._vars.frames[this._side],t=$.extend({},e.background.dimensions);this.element.find(".tpd-background").css(t),this.element.find(".tpd-background-shadow").css({width:t.width+2*this._css.border,height:t.height+2*this._css.border}),this.updateBackground(),this.element.find(".tpd-background-box-shift, .tpd-background-box-shift-further").removeAttr("style"),this.element.add(this.frames).add(this.tooltip._tooltip).css(e.dimensions);var i=this._side,r=this._vars.frames[i],a=this.element.find(".tpd-frame-"+this._side),n=this._vars.frames[i].dimensions;a.css(n),a.find(".tpd-backgrounds").css($.extend({},r.background.position,{width:n.width-r.background.position.left,height:n.height-r.background.position.top}));var s=Position.getOrientation(i);if(this.tooltip.options.stem)if(a.find(".tpd-shift-stem").css($.extend({},r.shift.dimensions,r.shift.position)),"vertical"==s){(l=a.find(".tpd-background-box-top, .tpd-background-box-bottom")).css({height:this._vars.cut,width:this._css.border}),a.find(".tpd-background-box-bottom").css({top:r.dimensions.height-this._vars.cut}).find(".tpd-background-box-shift").css({"margin-top":-1*r.dimensions.height+this._vars.cut});var o="right"==i?r.dimensions.width-r.stemPx-this._css.border:0;l.css({left:o}).find(".tpd-background-box-shift").css({"margin-left":-1*o}),a.find(".tpd-background-box-"+("left"==i?"left":"right")).hide(),"right"==i?a.find(".tpd-background-box-left").css({width:r.dimensions.width-r.stemPx-this._css.border}):a.find(".tpd-background-box-right").css({"margin-left":this._css.border}).find(".tpd-background-box-shift").css({"margin-left":-1*this._css.border}),(p=a.find(".tpd-background-box-"+this._side)).css({height:r.dimensions.height-2*this._vars.cut,"margin-top":this._vars.cut}),p.find(".tpd-background-box-shift").css({"margin-top":-1*this._vars.cut})}else{var l,p;(l=a.find(".tpd-background-box-left, .tpd-background-box-right")).css({width:this._vars.cut,height:this._css.border}),a.find(".tpd-background-box-right").css({left:r.dimensions.width-this._vars.cut}).find(".tpd-background-box-shift").css({"margin-left":-1*r.dimensions.width+this._vars.cut}),o="bottom"==i?r.dimensions.height-r.stemPx-this._css.border:0,l.css({top:o}).find(".tpd-background-box-shift").css({"margin-top":-1*o}),a.find(".tpd-background-box-"+("top"==i?"top":"bottom")).hide(),"bottom"==i?a.find(".tpd-background-box-top").css({height:r.dimensions.height-r.stemPx-this._css.border}):a.find(".tpd-background-box-bottom").css({"margin-top":this._css.border}).find(".tpd-background-box-shift").css({"margin-top":-1*this._css.border}),(p=a.find(".tpd-background-box-"+this._side)).css({width:r.dimensions.width-2*this._vars.cut,"margin-left":this._vars.cut}),p.find(".tpd-background-box-shift").css({"margin-left":-1*this._vars.cut})}var d=e.background,c=d.position,u=d.dimensions;this._spinner.css({top:c.top+this._css.border+(.5*u.height-.5*this._css.spinner.dimensions.height),left:c.left+this._css.border+(.5*u.width-.5*this._css.spinner.dimensions.width)})}},getVars:function(){var e=(this._css.padding,this._css.radius,this._css.border),t=this._vars.maxStemHeight||0,i=$.extend({},this._dimensions||{}),r={frames:{},dimensions:i,maxStemHeight:t};r.cut=Math.max(this._css.border,this._css.radius)||0;var a={width:0,height:0},n=0,s=0;return this.tooltip.options.stem&&(a=this.stem_top.getMath().dimensions.outside,n=this.stem_top._css.offset,s=Math.max(a.height-this._css.border,0)),r.stemDimensions=a,r.stemOffset=n,Position.getOrientation(this._side),$.each("top right bottom left".split(" "),$.proxy((function(t,n){var o="vertical"==Position.getOrientation(n),l={width:i.width+2*e,height:i.height+2*e},p=l[o?"height":"width"]-2*r.cut,d={dimensions:l,stemPx:s,position:{top:0,left:0},background:{dimensions:$.extend({},i),position:{top:0,left:0}}};if(r.frames[n]=d,d.dimensions[o?"width":"height"]+=s,("top"==n||"left"==n)&&(d.background.position[n]+=s),$.extend(d,{shift:{position:{top:0,left:0},dimensions:{width:o?a.height:p,height:o?p:a.height}}}),Browser.IE&&Browser.IE<9){var c=d.shift.dimensions;c.width=Math.round(c.width),c.height=Math.round(c.height)}switch(n){case"top":case"bottom":d.shift.position.left+=r.cut,"bottom"==n&&(d.shift.position.top+=l.height-e-s);break;case"left":case"right":d.shift.position.top+=r.cut,"right"==n&&(d.shift.position.left+=l.width-e-s)}}),this)),r.connections={},$.each(Position.positions,$.proxy((function(e,t){r.connections[t]=this.getConnectionLayout(t,r)}),this)),r},setDimensions:function(e){this.build();var t=this._dimensions;t&&t.width==e.width&&t.height==e.height||(this._dimensions=e,this._vars=this.getVars())},setSide:function(e){this._side=e,this._vars=this.getVars()},getConnectionLayout:function(e,t){var i=Position.getSide(e),r=Position.getOrientation(e),a=(t.dimensions,t.cut),n=this["stem_"+i],s=t.stemOffset,o=this.tooltip.options.stem?n.getMath().dimensions.outside.width:0,l=a+s+.5*o,p={stem:{}},d={left:0,right:0,up:0,down:0},c={top:0,left:0},u={top:0,left:0},h=t.frames[i];if(l=0,"horizontal"==r){var f=h.dimensions.width;this.tooltip.options.stem&&(2*s>(f=h.shift.dimensions.width)-o&&(s=Math.floor(.5*(f-o))||0),l=a+s+.5*o);var m=f-2*s,g=s;switch((b=Position.split(e))[2]){case"left":d.right=m-o,c.left=l;break;case"middle":g+=Math.round(.5*m-.5*o),d.left=g-s,d.right=g-s,c.left=u.left=Math.round(.5*h.dimensions.width);break;case"right":g+=m-o,d.left=m-o,c.left=h.dimensions.width-l,u.left=h.dimensions.width}"bottom"==b[1]&&(c.top+=h.dimensions.height,u.top+=h.dimensions.height),$.extend(p.stem,{position:{left:g},before:{width:g},after:{left:g+o,width:f-g-o+1}})}else{var y=h.dimensions.height;this.tooltip.options.stem&&(2*s>(y=h.shift.dimensions.height)-o&&(s=Math.floor(.5*(y-o))||0),l=a+s+.5*o);var b,v=y-2*s,T=s;switch((b=Position.split(e))[2]){case"top":d.down=v-o,c.top=l;break;case"middle":T+=Math.round(.5*v-.5*o),d.up=T-s,d.down=T-s,c.top=u.top=Math.round(.5*h.dimensions.height);break;case"bottom":T+=v-o,d.up=v-o,c.top=h.dimensions.height-l,u.top=h.dimensions.height}"right"==b[1]&&(c.left+=h.dimensions.width,u.left+=h.dimensions.width),$.extend(p.stem,{position:{top:T},before:{height:T},after:{top:T+o,height:y-T-o+1}})}return p.move=d,p.stem.connection=c,p.connection=u,p},setStemPosition:function(e,t){if(this._stemPosition!=e){this._stemPosition=e;var i=Position.getSide(e);this.setSide(i)}this.tooltip.options.stem&&this.setStemShift(e,t)},setStemShift:function(e,t){var i=this._shift,r=this._dimensions;if(!i||i.stemPosition!=e||i.shift.x!=t.x||i.shift.y!=t.y||!r||i.dimensions.width!=r.width||i.dimensions.height!=r.height){this._shift={stemPosition:e,shift:t,dimensions:r};var a=Position.getSide(e),n={horizontal:"x",vertical:"y"}[Position.getOrientation(e)],s={x:{left:"left",width:"width"},y:{left:"top",width:"height"}}[n],o=this["stem_"+a],l=deepExtend({},this._vars.connections[e].stem);t&&0!==t[n]&&(l.before[s.width]+=t[n],l.position[s.left]+=t[n],l.after[s.left]+=t[n],l.after[s.width]-=t[n]),o.element.css(l.position),o.element.siblings(".tpd-shift-stem-side-before").css(l.before),o.element.siblings(".tpd-shift-stem-side-after").css(l.after)}}}),$.extend(Stem.prototype,{initialize:function(e,t){this.element=$(e),this.element[0]&&(this.skin=t,this.element.removeClass("tpd-stem-reset"),this._css=$.extend({},t._css,{width:this.element.innerWidth(),height:this.element.innerHeight(),offset:parseFloat(this.element.css("margin-left")),spacing:parseFloat(this.element.css("margin-top"))}),this.element.addClass("tpd-stem-reset"),this.options=$.extend({},arguments[2]||{}),this._position=this.element.attr("data-stem-position")||"top",this._m=100,this.build())},destroy:function(){this.element.html("")},build:function(){this.destroy();var e=this._css.backgroundColor,t=e.indexOf("rgba")>-1&&parseFloat(e.replace(/^.*,(.+)\)/,"$1")),i=t&&1>t;this._useTransform=i&&Support.css.transform,this._css.border||(this._useTransform=!1),this[(this._useTransform?"build":"buildNo")+"Transform"]()},buildTransform:function(){this.element.append(this.spacer=$("<div>").addClass("tpd-stem-spacer").append(this.downscale=$("<div>").addClass("tpd-stem-downscale").append(this.transform=$("<div>").addClass("tpd-stem-transform").append(this.first=$("<div>").addClass("tpd-stem-side").append(this.border=$("<div>").addClass("tpd-stem-border")).append($("<div>").addClass("tpd-stem-border-corner")).append($("<div>").addClass("tpd-stem-triangle")))))),this.transform.append(this.last=this.first.clone().addClass("tpd-stem-side-inversed")),this.sides=this.first.add(this.last);var e=this.getMath(),t=e.dimensions,i=this._m,r=Position.getSide(this._position);if(this.element.find(".tpd-stem-spacer").css({width:c?t.inside.height:t.inside.width,height:c?t.inside.width:t.inside.height}),"top"==r||"left"==r){var a={};"top"==r?(a.bottom=0,a.top="auto"):"left"==r&&(a.right=0,a.left="auto"),this.element.find(".tpd-stem-spacer").css(a)}this.transform.css({width:t.inside.width*i,height:t.inside.height*i});var n=Support.css.prefixed("transform"),s={"background-color":"transparent","border-bottom-color":this._css.backgroundColor,"border-left-width":.5*t.inside.width*i,"border-bottom-width":t.inside.height*i};s[n]="translate("+e.border*i+"px, 0)",this.element.find(".tpd-stem-triangle").css(s);var o=this._css.borderColor;alpha=o.indexOf("rgba")>-1&&parseFloat(o.replace(/^.*,(.+)\)/,"$1")),alpha&&1>alpha?o=(o.substring(0,o.lastIndexOf(","))+")").replace("rgba","rgb"):alpha=1;var l={"background-color":"transparent","border-right-width":e.border*i,width:e.border*i,"margin-left":-2*e.border*i,"border-color":o,opacity:alpha};l[n]="skew("+e.skew+"deg) translate("+e.border*i+"px, "+-1*this._css.border*i+"px)",this.element.find(".tpd-stem-border").css(l),o=this._css.borderColor,alpha=o.indexOf("rgba")>-1&&parseFloat(o.replace(/^.*,(.+)\)/,"$1")),alpha&&1>alpha?o=(o.substring(0,o.lastIndexOf(","))+")").replace("rgba","rgb"):alpha=1;var p={width:e.border*i,"border-right-width":e.border*i,"border-right-color":o,background:o,opacity:alpha,"margin-left":-2*e.border*i};if(p[n]="skew("+e.skew+"deg) translate("+e.border*i+"px, "+(t.inside.height-this._css.border)*i+"px)",this.element.find(".tpd-stem-border-corner").css(p),this.setPosition(this._position),i>1){var d={};d[n]="scale("+1/i+","+1/i+")",this.downscale.css(d)}var c=/^(left|right)$/.test(this._position);this._css.border||this.element.find(".tpd-stem-border, .tpd-stem-border-corner").hide(),this.element.css({width:c?t.outside.height:t.outside.width,height:c?t.outside.width:t.outside.height})},buildNoTransform:function(){this.element.append(this.spacer=$("<div>").addClass("tpd-stem-spacer").append($("<div>").addClass("tpd-stem-notransform").append($("<div>").addClass("tpd-stem-border").append($("<div>").addClass("tpd-stem-border-corner")).append($("<div>").addClass("tpd-stem-border-center-offset").append($("<div>").addClass("tpd-stem-border-center-offset-inverse").append($("<div>").addClass("tpd-stem-border-center"))))).append($("<div>").addClass("tpd-stem-triangle"))));var e=this.getMath(),t=e.dimensions,i=/^(left|right)$/.test(this._position),r=/^(bottom)$/.test(this._position),a=/^(right)$/.test(this._position),n=Position.getSide(this._position);if(this.element.css({width:i?t.outside.height:t.outside.width,height:i?t.outside.width:t.outside.height}),this.element.find(".tpd-stem-notransform").add(this.element.find(".tpd-stem-spacer")).css({width:i?t.inside.height:t.inside.width,height:i?t.inside.width:t.inside.height}),"top"==n||"left"==n){var s={};"top"==n?(s.bottom=0,s.top="auto"):"left"==n&&(s.right=0,s.left="auto"),this.element.find(".tpd-stem-spacer").css(s)}this.element.find(".tpd-stem-border").css({width:"100%",background:"transparent"});var o={opacity:Browser.IE&&Browser.IE<9?this._css.borderOpacity:1};o[i?"height":"width"]="100%",o[i?"width":"height"]=this._css.border,o[r?"top":"bottom"]=0,$.extend(o,a?{left:0}:{right:0}),this.element.find(".tpd-stem-border-corner").css(o);var l={width:0,"background-color":"transparent",opacity:Browser.IE&&Browser.IE<9?this._css.borderOpacity:1},p=.5*t.inside.width+"px solid transparent",d={"background-color":"transparent"};if(t.inside.width,e.border,i){var c={left:"auto",top:"50%","margin-top":-.5*t.inside.width,"border-top":p,"border-bottom":p};if($.extend(l,c),l[a?"right":"left"]=0,l[a?"border-left":"border-right"]=t.inside.height+"px solid "+this._css.borderColor,$.extend(d,c),d[a?"border-left":"border-right"]=t.inside.height+"px solid "+this._css.backgroundColor,d[a?"right":"left"]=e.top,d[a?"left":"right"]="auto",Browser.IE&&Browser.IE<8){var u=.5*this._css.width+"px solid transparent";$.extend(d,{"margin-top":-.5*this._css.width,"border-top":u,"border-bottom":u}),d[a?"border-left":"border-right"]=this._css.height+"px solid "+this._css.backgroundColor}this.element.find(".tpd-stem-border-center-offset").css({"margin-left":-1*this._css.border*(a?-1:1)}).find(".tpd-stem-border-center-offset-inverse").css({"margin-left":this._css.border*(a?-1:1)})}else c={"margin-left":-.5*t.inside.width,"border-left":p,"border-right":p},$.extend(l,c),l[r?"border-top":"border-bottom"]=t.inside.height+"px solid "+this._css.borderColor,$.extend(d,c),d[r?"border-top":"border-bottom"]=t.inside.height+"px solid "+this._css.backgroundColor,d[r?"bottom":"top"]=e.top,d[r?"top":"bottom"]="auto",Browser.IE&&Browser.IE<8&&(u=.5*this._css.width+"px solid transparent",$.extend(d,{"margin-left":-.5*this._css.width,"border-left":u,"border-right":u}),d[r?"border-top":"border-bottom"]=this._css.height+"px solid "+this._css.backgroundColor),this.element.find(".tpd-stem-border-center-offset").css({"margin-top":-1*this._css.border*(r?-1:1)}).find(".tpd-stem-border-center-offset-inverse").css({"margin-top":this._css.border*(r?-1:1)});this.element.find(".tpd-stem-border-center").css(l),this.element.find(".tpd-stem-border-corner").css({"background-color":this._css.borderColor}),this.element.find(".tpd-stem-triangle").css(d),this._css.border||this.element.find(".tpd-stem-border").hide()},setPosition:function(e){this._position=e,this.transform.attr("class","tpd-stem-transform tpd-stem-transform-"+e)},getMath:function(){var e=this._css.height,t=this._css.width,i=this._css.border;this._useTransform&&Math.floor(t)%2&&(t=Math.max(Math.floor(t)-1,0));var r=degrees(Math.atan(.5*t/e)),a=90-r,n={width:t+i/Math.cos((90-a)*Math.PI/180)*2,height:e+i/Math.cos((90-r)*Math.PI/180)};Math.max(i,this._css.radius),e=n.height,t=.5*n.width;var s=90-degrees(Math.atan(e/t)),o=i/Math.cos(s*Math.PI/180),l=180*Math.atan(e/t)/Math.PI,p=-1*(90-l),d=90-l,c=i*Math.tan(d*Math.PI/180),u=i/Math.cos((90-d)*Math.PI/180),h=$.extend({},n),f=$.extend({},n);f.height+=this._css.spacing,f.height=Math.ceil(f.height);var m=!0;return 2*i>=n.width&&(m=!1),{enabled:m,outside:f,dimensions:{inside:h,outside:f},top:u,border:o,skew:p,corner:c}}});var Tooltips={tooltips:{},options:{defaultSkin:"dark",startingZIndex:999999},_emptyClickHandler:function(){},init:function(){this.reset(),this._resizeHandler=$.proxy(this.onWindowResize,this),$(window).bind("resize orientationchange",this._resizeHandler),Browser.MobileSafari&&$("body").bind("click",this._emptyClickHandler)},reset:function(){Tooltips.removeAll(),this._resizeHandler&&$(window).unbind("resize orientationchange",this._resizeHandler),Browser.MobileSafari&&$("body").unbind("click",this._emptyClickHandler)},onWindowResize:function(){this._resizeTimer&&(window.clearTimeout(this._resizeTimer),this._resizeTimer=null),this._resizeTimer=_.delay($.proxy((function(){var e=this.getVisible();$.each(e,(function(e,t){t.clearUpdatedTo(),t.position()}))}),this),15)},_getTooltips:function(e,t){var i,r=[],a=[];if(_.isElement(e)?(i=$(e).data("tipped-uids"))&&(r=r.concat(i)):$(e).each((function(e,t){(i=$(t).data("tipped-uids"))&&(r=r.concat(i))})),!r[0]&&!t){var n=this.getTooltipByTooltipElement($(e).closest(".tpd-tooltip")[0]);n&&n.element&&(i=$(n.element).data("tipped-uids")||[])&&(r=r.concat(i))}return r.length>0&&$.each(r,$.proxy((function(e,t){var i;(i=this.tooltips[t])&&a.push(i)}),this)),a},findElement:function(e){var t=[];return _.isElement(e)&&(t=this._getTooltips(e)),t[0]&&t[0].element},get:function(e){var t=$.extend({api:!1},arguments[1]||{}),i=[];return _.isElement(e)?i=this._getTooltips(e):e instanceof $?e.each($.proxy((function(e,t){var r=this._getTooltips(t,!0);r.length>0&&(i=i.concat(r))}),this)):"string"==$.type(e)&&$.each(this.tooltips,(function(t,r){r.element&&$(r.element).is(e)&&i.push(r)})),t.api&&$.each(i,(function(e,t){t.is("api",!0)})),i},getTooltipByTooltipElement:function(e){if(!e)return null;var t=null;return $.each(this.tooltips,(function(i,r){r.is("build")&&r._tooltip[0]===e&&(t=r)})),t},getBySelector:function(e){var t=[];return $.each(this.tooltips,(function(i,r){r.element&&$(r.element).is(e)&&t.push(r)})),t},getNests:function(){var e=[];return $.each(this.tooltips,(function(t,i){i.is("nest")&&e.push(i)})),e},show:function(e){$(this.get(e)).each((function(e,t){t.show(!1,!0)}))},hide:function(e){$(this.get(e)).each((function(e,t){t.hide()}))},toggle:function(e){$(this.get(e)).each((function(e,t){t.toggle()}))},hideAll:function(e){$.each(this.getVisible(),(function(t,i){e&&e==i||i.hide()}))},refresh:function(e){var t;t=e?$.grep(this.get(e),(function(e){return e.is("visible")})):this.getVisible(),$.each(t,(function(e,t){t.refresh()}))},getVisible:function(){var e=[];return $.each(this.tooltips,(function(t,i){i.visible()&&e.push(i)})),e},isVisibleByElement:function(e){var t=!1;return _.isElement(e)&&$.each(this.getVisible()||[],(function(i,r){return r.element==e?(t=!0,!1):void 0})),t},getHighestTooltip:function(){var e,t=0;return $.each(this.tooltips,(function(i,r){r.zIndex>t&&(t=r.zIndex,e=r)})),e},resetZ:function(){this.getVisible().length<=1&&$.each(this.tooltips,(function(e,t){t.is("build")&&!t.options.zIndex&&t._tooltip.css({zIndex:t.zIndex=+Tooltips.options.startingZIndex})}))},clearAjaxCache:function(){$.each(this.tooltips,$.proxy((function(e,t){t.options.ajax&&(t._cache&&t._cache.xhr&&(t._cache.xhr.abort(),t._cache.xhr=null),t.is("updated",!1),t.is("updating",!1),t.is("sanitized",!1))}),this)),AjaxCache.clear()},add:function(e){this.tooltips[e.uid]=e},remove:function(e){var t=this._getTooltips(e);this.removeTooltips(t)},removeTooltips:function(e){e&&$.each(e,$.proxy((function(e,t){var i=t.uid;delete this.tooltips[i],Browser.IE&&Browser.IE<9?_.defer((function(){t.remove()})):t.remove()}),this))},removeDetached:function(){var e=this.getNests(),t=[];e.length>0&&$.each(e,(function(e,i){i.is("detached")&&(t.push(i),i.attach())})),$.each(this.tooltips,$.proxy((function(e,t){t.element&&!_.element.isAttached(t.element)&&this.remove(t.element)}),this)),$.each(t,(function(e,t){t.detach()}))},removeAll:function(){$.each(this.tooltips,$.proxy((function(e,t){t.element&&this.remove(t.element)}),this)),this.tooltips={}},setDefaultSkin:function(e){this.options.defaultSkin=e||"dark"},setStartingZIndex:function(e){this.options.startingZIndex=e||0}};return Tooltips.Position={inversedPosition:{left:"right",right:"left",top:"bottom",bottom:"top",middle:"middle",center:"center"},getInversedPosition:function(e){var t=Position.split(e),i=t[1],r=t[2],a=Position.getOrientation(e),n=$.extend({horizontal:!0,vertical:!0},arguments[1]||{});return"horizontal"==a?(n.vertical&&(i=this.inversedPosition[i]),n.horizontal&&(r=this.inversedPosition[r])):(n.vertical&&(r=this.inversedPosition[r]),n.horizontal&&(i=this.inversedPosition[i])),i+r},getTooltipPositionFromTarget:function(e){var t=Position.split(e);return this.getInversedPosition(t[1]+this.inversedPosition[t[2]])}},$.extend(Tooltip.prototype,{supportsLoading:Support.css.transform&&Support.css.animation,initialize:function initialize(element,content){if(this.element=element,this.element){var options;"object"!=$.type(content)||_.isElement(content)||_.isText(content)||_.isDocumentFragment(content)||content instanceof $?options=arguments[2]||{}:(options=content,content=null);var dataOptions=$(element).data("tipped-options");dataOptions&&(options=deepExtend($.extend({},options),eval("({"+dataOptions+"})"))),this.options=Options.create(options),this._cache={dimensions:{width:0,height:0},events:[],timers:{},layouts:{},is:{},fnCallFn:"",updatedTo:{}},this.queues={showhide:$({})};var title=$(element).attr("title")||$(element).data("tipped-restore-title");if(!content){var dt=$(element).attr("data-tipped");if(dt?content=dt:title&&(content=title),content){var SCRIPT_REGEX=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;content=content.replace(SCRIPT_REGEX,"")}}if((!content||content instanceof $&&!content[0])&&!(this.options.ajax&&this.options.ajax.url||this.options.inline))return void(this._aborted=!0);title&&($(element).data("tipped-restore-title",title),$(element)[0].setAttribute("title","")),this.content=content,this.title=$(this.element).data("tipped-title"),"undefined"!=$.type(this.options.title)&&(this.title=this.options.title),this.zIndex=this.options.zIndex||+Tooltips.options.startingZIndex;var uids=$(element).data("tipped-uids");uids||(uids=[]);var uid=getUID();this.uid=uid,uids.push(uid),$(element).data("tipped-uids",uids);var parentTooltipElement=$(this.element).closest(".tpd-tooltip")[0],parentTooltip;parentTooltipElement&&(parentTooltip=Tooltips.getTooltipByTooltipElement(parentTooltipElement))&&parentTooltip.is("nest",!0);var target=this.options.target;this.target="mouse"==target?this.element:"element"!=target&&target?_.isElement(target)?target:target instanceof $&&target[0]?target[0]:this.element:this.element,this.options.inline&&(this.content=$("#"+this.options.inline)[0]),this.options.ajax&&(this.__content=this.content),"function"==$.type(this.content)&&(this._fn=this.content),this.preBuild(),Tooltips.add(this)}},remove:function(){this.unbind(),this.clearTimers(),this.restoreElementToMarker(),this.stopLoading(),this.abort(),this.is("build")&&this._tooltip&&(this._tooltip.remove(),this._tooltip=null);var e=$(this.element).data("tipped-uids")||[],t=$.inArray(this.uid,e);if(t>-1&&(e.splice(t,1),$(this.element).data("tipped-uids",e)),e.length<1){var i,r="tipped-restore-title";(i=$(this.element).data(r))&&(""!=!$(this.element)[0].getAttribute("title")&&$(this.element).attr("title",i),$(this.element).removeData(r)),$(this.element).removeData("tipped-uids")}var a=($(this.element).attr("class")||"").replace(/(tpd-delegation-uid-)\d+/g,"").replace(/^\s\s*/,"").replace(/\s\s*$/,"");$(this.element).attr("class",a)},detach:function(){this.options.detach&&!this.is("detached")&&(this._tooltip&&this._tooltip.detach(),this.is("detached",!0))},attach:function(){if(this.is("detached")){var e;if("string"==$.type(this.options.container)){var t=this.target;"mouse"==t&&(t=this.element),e=$($(t).closest(this.options.container).first())}else e=$(this.options.container);e[0]||(e=$(document.body)),e.append(this._tooltip),this.is("detached",!1)}},preBuild:function(){this.is("detached",!0);var e={left:"-10000px",top:"-10000px",opacity:0,zIndex:this.zIndex};this._tooltip=$("<div>").addClass("tpd-tooltip").addClass("tpd-skin-"+Tooltips.options.defaultSkin).addClass("tpd-size-"+this.options.size).css(e).hide(),this.createPreBuildObservers()},build:function(){this.is("build")||(this.attach(),Browser.IE&&Browser.IE<7&&this._tooltip.append(this.iframeShim=$("<iframe>").addClass("tpd-iframeshim").attr({frameBorder:0,src:"javascript:'';"})),this._tooltip.append(this._skin=$("<div>").addClass("tpd-skin")).append(this._contentWrapper=$("<div>").addClass("tpd-content-wrapper").append(this._contentSpacer=$("<div>").addClass("tpd-content-spacer").append(this._titleWrapper=$("<div>").addClass("tpd-title-wrapper").append(this._titleSpacer=$("<div>").addClass("tpd-title-spacer").append(this._titleRelative=$("<div>").addClass("tpd-title-relative").append(this._titleRelativePadder=$("<div>").addClass("tpd-title-relative-padder").append(this._title=$("<div>").addClass("tpd-title"))))).append(this._close=$("<div>").addClass("tpd-close").append($("<div>").addClass("tpd-close-icon").html("&times;")))).append(this._contentRelative=$("<div>").addClass("tpd-content-relative").append(this._contentRelativePadder=$("<div>").addClass("tpd-content-relative-padder").append(this._content=$("<div>").addClass("tpd-content"))).append(this._inner_close=$("<div>").addClass("tpd-close").append($("<div>").addClass("tpd-close-icon").html("&times;")))))),this.skin=new Skin(this),this._contentSpacer.css({"border-radius":Math.max(this.skin._css.radius-this.skin._css.border,0)}),this.createPostBuildObservers(),this.is("build",!0))},createPostBuildObservers:function(){this._tooltip.delegate(".tpd-close, .close-tooltip","click",$.proxy((function(e){e.stopPropagation(),e.preventDefault(),this.is("api",!1),this.hide(!0)}),this))},createPreBuildObservers:function(){this.bind(this.element,"mouseenter",this.setActive),this.bind(this._tooltip,Support.touch&&Browser.MobileSafari?"touchstart":"mouseenter",this.setActive),this.bind(this.element,"mouseleave",(function(e){this.setIdle(e)})),this.bind(this._tooltip,"mouseleave",(function(e){this.setIdle(e)})),this.options.showOn&&($.each(this.options.showOn,$.proxy((function(e,t){var i,r=!1;switch(e){case"element":i=this.element,this.options.hideOn&&this.options.showOn&&"click"==this.options.hideOn.element&&"click"==this.options.showOn.element&&(r=!0,this.is("toggleable",r));break;case"tooltip":i=this._tooltip;break;case"target":i=this.target}if(i&&t){var a=t;this.bind(i,a,"click"==t&&r?function(){this.is("api",!1),this.toggle()}:function(){this.is("api",!1),this.showDelayed()})}}),this)),Support.touch&&Browser.MobileSafari&&this.bind(this._tooltip,"touchend",(function(){this._tooltipTouchEndTime=(new Date).getTime()}))),this.options.hideOn&&$.each(this.options.hideOn,$.proxy((function(e,t){var i;switch(e){case"element":if(this.is("toggleable")&&"click"==t)return;i=this.element;break;case"tooltip":i=this._tooltip;break;case"target":i=this.target}if(i&&t){var r=t;Support.touch&&Browser.MobileSafari&&/^(target|element)/.test(e)&&/mouse(leave|out)/.test(r)?this.bind(i,r,(function(e){this._tooltipTouchEndTime&&/^mouse(leave|out)$/.test(e.type)&&(new Date).getTime()-this._tooltipTouchEndTime<450||(this.is("api",!1),this.hideDelayed())})):this.bind(i,r,(function(){this.is("api",!1),this.hideDelayed()}))}}),this)),this.options.hideOnClickOutside&&($(this.element).addClass("tpd-hideOnClickOutside"),this.bind(document.documentElement,"click touchend",$.proxy((function(e){if(this.visible()){var t=$(e.target).closest(".tpd-tooltip, .tpd-hideOnClickOutside")[0];(!t||t&&t!=this._tooltip[0]&&t!=this.element)&&this.hide()}}),this))),"mouse"==this.options.target&&this.bind(this.element,"mouseenter mousemove",$.proxy((function(e){this._cache.event=e}),this));var e=!1;this.options.showOn&&"mouse"==this.options.target&&!this.options.fixed&&(e=!0),e&&this.bind(this.element,"mousemove",(function(){this.is("build")&&(this.is("api",!1),this.position())}))}}),$.extend(Tooltip.prototype,{stop:function(){this._tooltip&&(this.queues.showhide.queue([]),this._tooltip.stop(1,0))},showDelayed:function(){this.is("disabled")||(this.clearTimer("hide"),this.is("visible")||this.getTimer("show")||this.setTimer("show",$.proxy((function(){this.clearTimer("show"),this.show()}),this),this.options.showDelay||1))},show:function(){if(this.clearTimer("hide"),!this.visible()&&!this.is("disabled")&&$(this.target).is(":visible")){this.is("visible",!0),this.attach(),this.stop();var e=this.queues.showhide;this.is("updated")||this.is("updating")||e.queue($.proxy((function(e){this._onResizeDimensions={width:0,height:0},this.update($.proxy((function(t){return t?(this.is("visible",!1),void this.detach()):void e()}),this))}),this)),e.queue($.proxy((function(e){this.is("sanitized")?(this.stopLoading(),this._contentWrapper.css({visibility:"visible"}),this.is("resize-to-content",!0),e()):(this._contentWrapper.css({visibility:"hidden"}),this.startLoading(),this.sanitize($.proxy((function(){this.stopLoading(),this._contentWrapper.css({visibility:"visible"}),this.is("resize-to-content",!0),e()}),this)))}),this)),e.queue($.proxy((function(e){this.position(),this.raise(),e()}),this)),e.queue($.proxy((function(e){if(this.is("updated")&&"function"==$.type(this.options.onShow)){var t=new Visible(this._tooltip);this.options.onShow(this._content[0],this.element),t.restore(),e()}else e()}),this)),e.queue($.proxy((function(e){this._show(this.options.fadeIn,(function(){e()}))}),this))}},_show:function(e,t){e=("number"==$.type(e)?e:this.options.fadeIn)||0,t=t||"function"==$.type(arguments[0])&&arguments[0],this.options.hideOthers&&Tooltips.hideAll(this),this._tooltip.fadeTo(e,1,$.proxy((function(){t&&t()}),this))},hideDelayed:function(){this.clearTimer("show"),this.getTimer("hide")||!this.visible()||this.is("disabled")||this.setTimer("hide",$.proxy((function(){this.clearTimer("hide"),this.hide()}),this),this.options.hideDelay||1)},hide:function(e,t){if(this.clearTimer("show"),this.visible()&&!this.is("disabled")){this.is("visible",!1),this.stop();var i=this.queues.showhide;i.queue($.proxy((function(e){this.abort(),e()}),this)),i.queue($.proxy((function(t){this._hide(e,t)}),this)),i.queue((function(e){Tooltips.resetZ(),e()})),i.queue($.proxy((function(e){this.clearUpdatedTo(),e()}),this)),"function"==$.type(this.options.afterHide)&&this.is("updated")&&i.queue($.proxy((function(e){this.options.afterHide(this._content[0],this.element),e()}),this)),this.options.cache||!this.options.ajax&&!this._fn||i.queue($.proxy((function(e){this.is("updated",!1),this.is("updating",!1),this.is("sanitized",!1),e()}),this)),"function"==$.type(t)&&i.queue((function(e){t(),e()})),i.queue($.proxy((function(e){this.detach(),e()}),this))}},_hide:function(e,t){t=t||"function"==$.type(arguments[0])&&arguments[0],this.attach(),this._tooltip.fadeTo(e?0:this.options.fadeOut,0,$.proxy((function(){this.stopLoading(),this.is("resize-to-content",!1),this._tooltip.hide(),t&&t()}),this))},toggle:function(){this.is("disabled")||this[this.visible()?"hide":"show"]()},raise:function(){if(this.is("build")&&!this.options.zIndex){var e=Tooltips.getHighestTooltip();e&&e!=this&&this.zIndex<=e.zIndex&&(this.zIndex=e.zIndex+1,this._tooltip.css({"z-index":this.zIndex}),this._tooltipShadow&&(this._tooltipShadow.css({"z-index":this.zIndex}),this.zIndex=e.zIndex+2,this._tooltip.css({"z-index":this.zIndex})))}}}),$.extend(Tooltip.prototype,{createElementMarker:function(){!this.elementMarker&&this.content&&_.element.isAttached(this.content)&&($(this.content).data("tpd-restore-inline-display",$(this.content).css("display")),this.elementMarker=$("<div>").hide(),$(this.content).before($(this.elementMarker).hide()))},restoreElementToMarker:function(){var e;this.content,this.elementMarker&&this.content&&((e=$(this.content).data("tpd-restore-inline-display"))&&$(this.content).css({display:e}),$(this.elementMarker).before(this.content).remove())},startLoading:function(){this.is("loading")||(this.build(),this.is("loading",!0),this.options.spinner&&(this._tooltip.addClass("tpd-is-loading"),this.skin.startLoading(),this.is("resize-to-content")||(this.position(),this.raise(),this._show())))},stopLoading:function(){this.build(),this.is("loading",!1),this.options.spinner&&(this._tooltip.removeClass("tpd-is-loading"),this.skin.stopLoading())},abort:function(){this.abortAjax(),this.abortSanitize(),this.is("refreshed-before-sanitized",!1)},abortSanitize:function(){this._cache.voila&&(this._cache.voila.abort(),this._cache.voila=null)},abortAjax:function(){this._cache.xhr&&(this._cache.xhr.abort(),this._cache.xhr=null,this.is("updated",!1),this.is("updating",!1))},update:function(e){if(!this.is("updating")){this.is("updating",!0),this.build();var t=this.options.inline?"inline":this.options.ajax?"ajax":_.isElement(this.content)||_.isText(this.content)||_.isDocumentFragment(this.content)?"element":this._fn?"function":"html";switch(this._contentWrapper.css({visibility:"hidden"}),t){case"html":case"element":case"inline":if(this.is("updated"))return void(e&&e());this._update(this.content,e);break;case"function":if(this.is("updated"))return void(e&&e());var i=this._fn(this.element);if(!i)return this.is("updating",!1),void(e&&e(!0));this._update(i,e)}}},_update:function(e,t){var i={title:this.options.title,close:this.options.close};"string"==$.type(e)||_.isElement(e)||_.isText(e)||_.isDocumentFragment(e)||e instanceof $?i.content=e:$.extend(i,e),e=i.content;var r=i.title,a=i.close;this.content=e,this.title=r,this.close=a,this.createElementMarker(),(_.isElement(e)||e instanceof $)&&$(e).show(),this._content.html(this.content),this._title.html(r&&"string"==$.type(r)?r:""),this._titleWrapper[r?"show":"hide"](),this._close[(this.title||this.options.title)&&a?"show":"hide"]();var n=a&&!(this.options.title||this.title),s=a&&!(this.options.title||this.title)&&"overlap"!=a,o=a&&(this.options.title||this.title)&&"overlap"!=a;this._inner_close[n?"show":"hide"](),this._tooltip[(s?"add":"remove")+"Class"]("tpd-has-inner-close"),this._tooltip[(o?"add":"remove")+"Class"]("tpd-has-title-close"),this._content[(this.options.padding?"remove":"add")+"Class"]("tpd-content-no-padding"),this.finishUpdate(t)},sanitize:function(e){return!this.options.voila||this._content.find("img").length<1?(this.is("sanitized",!0),void(e&&e())):void(this._cache.voila=Voila(this._content,{method:"onload"},$.proxy((function(t){this._markImagesAsSanitized(t.images),this.is("refreshed-before-sanitized")?(this.is("refreshed-before-sanitized",!1),this.sanitize(e)):(this.is("sanitized",!0),e&&e())}),this)))},_markImagesAsSanitized:function(e){$.each(e,(function(e,t){var i=t.img;$(i).data("completed-src",t.img.src)}))},_hasAllImagesSanitized:function(){var e=!0;return this._content.find("img").each((function(t,i){var r=$(i).data("completed-src");return r&&i.src==r?void 0:(e=!1,!1)})),e},refresh:function(){if(this.visible()){if(!this.is("sanitized"))return void this.is("refreshed-before-sanitized",!0);this.is("refreshing",!0),this.clearTimer("refresh-spinner"),!this.options.voila||this._content.find("img").length<1||this._hasAllImagesSanitized()?(this.is("should-update-dimensions",!0),this.position(),this.is("refreshing",!1)):(this.is("sanitized",!1),this._contentWrapper.css({visibility:"hidden"}),this.startLoading(),this.sanitize($.proxy((function(){this._contentWrapper.css({visibility:"visible"}),this.stopLoading(),this.is("should-update-dimensions",!0),this.position(),this.is("refreshing",!1)}),this)))}},finishUpdate:function(e){if(this.is("updated",!0),this.is("updating",!1),"function"==$.type(this.options.afterUpdate)){var t=this._contentWrapper.css("visibility");t&&this._contentWrapper.css({visibility:"visible"}),this.options.afterUpdate(this._content[0],this.element),t&&this._contentWrapper.css({visibility:"hidden"})}e&&e()}}),$.extend(Tooltip.prototype,{clearUpdatedTo:function(){this._cache.updatedTo={}},updateDimensionsToContent:function(e,t){this.skin.build();var i=this.is("loading"),r=this._cache.updatedTo;if((this._maxWidthPass||this.is("api")||this.is("should-update-dimensions")||r.stemPosition!=t||r.loading!=i)&&(!i||!this.is("resize-to-content"))){this._cache.updatedTo={type:this.is("resize-to-content")?"content":"spinner",loading:this.is("loading"),stemPosition:t},this.is("should-update-dimensions")&&this.is("should-update-dimensions",!1),e=e||this.options.position.target,t=t||this.options.position.tooltip;var a=Position.getSide(t),n=Position.getOrientation(t),s=this.skin._css.border;this._tooltip.addClass("tpd-tooltip-measuring");var o=this._tooltip.attr("style");this._tooltip.removeAttr("style");var l={top:s,right:s,bottom:s,left:s},p=0;if("vertical"==Position.getOrientation(t)){this.options.stem&&(l[a]=this.skin["stem_"+a].getMath().dimensions.outside.height);var d=this.getMouseRoom();d[Position._flip[a]]&&(l[a]+=d[Position._flip[a]]);var c=this.getContainmentLayout(t),u=this.getPaddingLine(e),h=!1;Position.isPointWithinBoxLayout(u.x1,u.y1,c)||Position.isPointWithinBoxLayout(u.x2,u.y2,c)?h=!0:$.each("top right bottom left".split(" "),$.proxy((function(e,t){var i=this.getSideLine(c,t);return Position.intersectsLine(u.x1,u.y1,u.x2,u.y2,i.x1,i.y1,i.x2,i.y2)?(h=!0,!1):void 0}),this)),h&&(p="left"==a?u.x1-c.position.left:c.position.left+c.dimensions.width-u.x1,l[a]+=p)}if(this.options.offset&&"vertical"==n){var f=Position.adjustOffsetBasedOnPosition(this.options.offset,this.options.position.target,e);0!==f.x&&(l.right+=Math.abs(f.x))}this.options.containment&&(p=this.options.containment.padding)&&($.each(l,(function(e){l[e]+=p})),"vertical"==n?l["left"==a?"left":"right"]-=p:l["top"==a?"top":"bottom"]-=p);var m=Bounds.viewport(),g={width:0,height:0};this.close&&"overlap"!=this.close&&!this.title&&(g=this._innerCloseDimensions||{width:this._inner_close.outerWidth(!0),height:this._inner_close.outerHeight(!0)},this._innerCloseDimensions=g),this._contentRelativePadder.css({"padding-right":g.width}),this._contentSpacer.css({width:m.width-l.left-l.right});var y={width:this._content.innerWidth()+g.width,height:Math.max(this._content.innerHeight(),g.height||0)},b={width:0,height:0};if(this.title){var v={width:0,height:0};this._titleWrapper.add(this._titleSpacer).css({width:"auto",height:"auto"}),this.close&&"overlap"!=this.close&&(v={width:this._close.outerWidth(!0),height:this._close.outerHeight(!0)},this._close.hide()),this._maxWidthPass&&y.width>this.options.maxWidth&&this._titleRelative.css({width:y.width}),this._titleRelativePadder.css({"padding-right":v.width});var T=parseFloat(this._titleWrapper.css("border-bottom-width"));(b={width:this.title?this._titleWrapper.innerWidth():0,height:Math.max(this.title?this._titleWrapper.innerHeight()+T:0,v.height+T)}).width>m.width-l.left-l.right&&(b.width=m.width-l.left-l.right,this._titleSpacer.css({width:b.width}),b.height=Math.max(this.title?this._titleWrapper.innerHeight()+T:0,v.height+T)),y.width=Math.max(b.width,y.width),y.height+=b.height,this._titleWrapper.css({height:Math.max(this.title?this._titleWrapper.innerHeight():0,v.height)}),this.close&&this._close.show()}if(this.options.stem){var w="vertical"==n?"height":"width",x=this.skin["stem_"+a].getMath().outside.width+2*this.skin._css.radius;y[w]<x&&(y[w]=x)}if(this._contentSpacer.css({width:y.width}),y.height!=Math.max(this._content.innerHeight(),g.height)+(this.title?this._titleRelative.outerHeight():0)&&y.width++,this.is("resize-to-content")||(y=this.skin._css.spinner.dimensions),this.setDimensions(y),l={top:s,right:s,bottom:s,left:s},this.options.stem){var I=Position.getSide(t);l[I]=this.skin.stem_top.getMath().dimensions.outside.height}this._contentSpacer.css({"margin-top":l.top,"margin-left":+l.left,width:y.width}),(this.title||this.close)&&this._titleWrapper.css({height:this._titleWrapper.innerHeight(),width:y.width}),this._tooltip.removeClass("tpd-tooltip-measuring"),this._tooltip.attr("style",o);var C=this._contentRelative.add(this._titleRelative);this.options.maxWidth&&y.width>this.options.maxWidth&&!this._maxWidthPass&&this.is("resize-to-content")&&(C.css({width:this.options.maxWidth}),this._maxWidthPass=!0,this.updateDimensionsToContent(e,t),this._maxWidthPass=!1,C.css({width:"auto"}))}},setDimensions:function(e){this.skin.setDimensions(e)},getContainmentSpace:function(e,t){var i=this.getContainmentLayout(e,t),r=this.getTargetLayout(),a=r.position,n=r.dimensions,s=i.position,o=i.dimensions,l={top:Math.max(a.top-s.top,0),bottom:Math.max(s.top+o.height-(a.top+n.height),0),left:Math.max(a.left-s.left,0),right:Math.max(s.left+o.width-(a.left+n.width),0)};return a.top>s.top+o.height&&(l.top-=a.top-(s.top+o.height)),a.top+n.height<s.top&&(l.bottom-=s.top-(a.top+n.height)),a.left>s.left+o.width&&s.left+o.width>=a.left&&(l.left-=a.left-(s.left+o.width)),a.left+n.width<s.left&&(l.right-=s.left-(a.left+n.width)),this._cache.layouts.containmentSpace=l,l},position:function(){if(this.visible()){this.is("positioning",!0),this._cache.layouts={},this._cache.dimensions;var e=this.options.position.target,t=this.options.position.tooltip,i=t,r=e;this.updateDimensionsToContent(r,i);var a=deepExtend(this.getPositionBasedOnTarget(r,i)),n=[];if(this.options.containment){var s=!1,o={};if($.each("top right bottom left".split(" "),$.proxy((function(e,t){(o[t]=this.isSideWithinContainment(t,i,!0))&&(s=!0)}),this)),s||(a.contained=!0),a.contained)this.setPosition(a);else if(n.unshift({position:a,targetPosition:r,stemPosition:i}),r=Position.flip(e),i=Position.flip(t),o[Position.getSide(r)]?(this.updateDimensionsToContent(r,i),a=this.getPositionBasedOnTarget(r,i)):a.contained=!1,a.contained)this.setPosition(a,i);else{n.unshift({position:a,targetPosition:r,stemPosition:i});var l=e,p=this.getContainmentSpace(i,!0),d="horizontal"==Position.getOrientation(l)?["left","right"]:["top","bottom"],c=(p[d[0]]===p[d[1]]?"horizontal"==Position.getOrientation(l)?"left":"top":d[p[d[0]]>p[d[1]]?0:1])+Position.split(l)[1],u=Position.flip(c);if(r=c,i=u,o[Position.getSide(r)]?(this.updateDimensionsToContent(r,i),a=this.getPositionBasedOnTarget(r,i)):a.contained=!1,a.contained)this.setPosition(a,i);else{n.unshift({position:a,targetPosition:r,stemPosition:i});var h,f=[];if($.each(n,(function(e,t){if(t.position.top>=0&&t.position.left>=0)h=t;else{var i=t.position.top>=0?1:Math.abs(t.position.top),r=t.position.left>=0?1:Math.abs(t.position.left);f.push({result:t,negativity:i*r})}})),!h){var m=f[f.length-1];$.each(f,(function(e,t){t.negativity<m.negativity&&(m=t)})),h=m.result}this.updateDimensionsToContent(h.targetPosition,h.stemPosition,!0),this.setPosition(h.position,h.stemPosition)}}}else this.setPosition(a);this._cache.dimensions=this.skin._vars.dimensions,this.skin.paint(),this.is("positioning",!1)}},getPositionBasedOnTarget:function(e,t){t=t||this.options.position.tooltip;var i=this.getTargetDimensions(),r={left:0,top:0},a={left:0,top:0};Position.getSide(e);var n=this.skin._vars,s=n.frames[Position.getSide(t)],o=Position.getOrientation(e),l=Position.split(e);if("horizontal"==o){var p=Math.floor(.5*i.width);switch(l[2]){case"left":a.left=p;break;case"middle":r.left=i.width-p,a.left=r.left;break;case"right":r.left=i.width,a.left=i.width-p}"bottom"==l[1]&&(r.top=i.height,a.top=i.height)}else{switch(p=Math.floor(.5*i.height),l[2]){case"top":a.top=p;break;case"middle":r.top=i.height-p,a.top=r.top;break;case"bottom":a.top=i.height-p,r.top=i.height}"right"==l[1]&&(r.left=i.width,a.left=i.width)}var d=this.getTargetPosition(),c=$.extend({},i,{top:d.top,left:d.left,connection:r,max:a}),u={width:s.dimensions.width,height:s.dimensions.height,top:0,left:0,connection:n.connections[t].connection,stem:n.connections[t].stem};if(u.top=c.top+c.connection.top,u.left=c.left+c.connection.left,u.top-=u.connection.top,u.left-=u.connection.left,this.options.stem){var h=n.stemDimensions.width,f={stem:{top:u.top+u.stem.connection.top,left:u.left+u.stem.connection.left},connection:{top:c.top+c.connection.top,left:c.left+c.connection.left},max:{top:c.top+c.max.top,left:c.left+c.max.left}};if(!Position.isPointWithinBox(f.stem.left,f.stem.top,f.connection.left,f.connection.top,f.max.left,f.max.top)){f={stem:{top:u.top+u.stem.connection.top,left:u.left+u.stem.connection.left},connection:{top:c.top+c.connection.top,left:c.left+c.connection.left},max:{top:c.top+c.max.top,left:c.left+c.max.left}};var m={connection:Position.getDistance(f.stem.left,f.stem.top,f.connection.left,f.connection.top),max:Position.getDistance(f.stem.left,f.stem.top,f.max.left,f.max.top)},g=Math.min(m.connection,m.max),y=f[m.connection<=m.max?"connection":"max"],b="horizontal"==Position.getOrientation(t)?"left":"top";if(Position.getDistance(f.connection.left,f.connection.top,f.max.left,f.max.top)>=h){var v={top:0,left:0},T=y[b]<f.stem[b]?-1:1;v[b]=g*T,v[b]+=Math.floor(.5*h)*T,u.left+=v.left,u.top+=v.top}else{$.extend(f,{center:{top:Math.round(c.top+.5*i.height),left:Math.round(c.left+.5*i.left)}});var w={connection:Position.getDistance(f.center.left,f.center.top,f.connection.left,f.connection.top),max:Position.getDistance(f.center.left,f.center.top,f.max.left,f.max.top)},x=(g=m[w.connection<=w.max?"connection":"max"],{top:0,left:0});T=y[b]<f.stem[b]?-1:1,x[b]=g*T,u.left+=x.left,u.top+=x.top}}}if(this.options.offset){var I=$.extend({},this.options.offset);I=Position.adjustOffsetBasedOnPosition(I,this.options.position.target,e),u.top+=I.y,u.left+=I.x}var C=this.getContainment({top:u.top,left:u.left},t),P=C.horizontal&&C.vertical,S={x:0,y:0},k=Position.getOrientation(t);if(!C[k]){var A="horizontal"==k,F=A?["left","right"]:["up","down"],M=A?"x":"y",E=A?"left":"top",D=C.correction[M],R=this.getContainmentLayout(t),_=R.position[A?"left":"top"];if(0!==D){var B=n.connections[t].move,L=B[F[0>-1*D?0:1]],O=0>D?-1:1;if(L>=D*O&&u[E]+D>=_)u[E]+=D,S[M]=-1*D,P=!0;else if(Position.getOrientation(e)==Position.getOrientation(t)){if(u[E]+=L*O,S[M]=-1*L*O,u[E]<_){var U=_-u[E],z=B[F[0]]+B[F[1]];U=Math.min(U,z),u[E]+=U;var V=S[M]-U;V>=n.connections[t].move[F[0]]&&V<=n.connections[t].move[F[1]]&&(S[M]-=U)}var H=(C=this.getContainment({top:u.top,left:u.left},t)).correction[M],W=deepExtend({},u);this.options.offset&&(W.left-=this.options.offset.x,W.top-=this.options.offset.y),(f={stem:{top:W.top+u.stem.connection.top,left:W.left+u.stem.connection.left}}).stem[E]+=S[M];var N=this.getTargetLayout(),G=(h=n.stemDimensions.width,Math.floor(.5*h)),q=_+R.dimensions[A?"width":"height"];if("x"==M){var X=N.position.left+G;H>0&&(X+=N.dimensions.width-2*G),(0>H&&f.stem.left+H>=X&&W.left+H>=_||H>0&&f.stem.left+H<=X&&W.left+H<=q)&&(W.left+=H)}else{var Y=N.position.top+G;H>0&&(Y+=N.dimensions.height-2*G),(0>H&&f.stem.top+H>=Y&&W.top+H>=_||H>0&&f.stem.top+H<=Y&&W.top+H<=q)&&(W.top+=H)}u=W,this.options.offset&&(u.left+=this.options.offset.x,u.top+=this.options.offset.y)}}P=(C=this.getContainment({top:u.top,left:u.left},t)).horizontal&&C.vertical}return{top:u.top,left:u.left,contained:P,shift:S}},setPosition:function(e,t){var i=this._position;if(!i||i.top!=e.top||i.left!=e.left){var r;if(this.options.container!=document.body){if("string"==$.type(this.options.container)){var a=this.target;"mouse"==a&&(a=this.element),r=$($(a).closest(this.options.container).first())}else r=$(r);if(r[0]){var n=$(r).offset(),s={top:Math.round(n.top),left:Math.round(n.left)},o={top:Math.round($(r).scrollTop()),left:Math.round($(r).scrollLeft())};e.top-=s.top,e.top+=o.top,e.left-=s.left,e.left+=o.left}}this._position=e,this._tooltip.css({top:e.top,left:e.left})}this.skin.setStemPosition(t||this.options.position.tooltip,e.shift||{x:0,y:0})},getSideLine:function(e,t){var i=e.position.left,r=e.position.top,a=e.position.left,n=e.position.top;switch(t){case"top":a+=e.dimensions.width;break;case"bottom":r+=e.dimensions.height,a+=e.dimensions.width,n+=e.dimensions.height;break;case"left":n+=e.dimensions.height;break;case"right":i+=e.dimensions.width,a+=e.dimensions.width,n+=e.dimensions.height}return{x1:i,y1:r,x2:a,y2:n}},isSideWithinContainment:function(e,t,i){var r=this.getContainmentLayout(t,i),a=this.getTargetLayout(),n=this.getSideLine(a,e);if(Position.isPointWithinBoxLayout(n.x1,n.y1,r)||Position.isPointWithinBoxLayout(n.x2,n.y2,r))return!0;var s=!1;return $.each("top right bottom left".split(" "),$.proxy((function(e,t){var i=this.getSideLine(r,t);return Position.intersectsLine(n.x1,n.y1,n.x2,n.y2,i.x1,i.y1,i.x2,i.y2)?(s=!0,!1):void 0}),this)),s},getContainment:function(e,t){var i={horizontal:!0,vertical:!0,correction:{y:0,x:0}};if(this.options.containment){var r=this.getContainmentLayout(t),a=this.skin._vars.frames[Position.getSide(t)].dimensions;this.options.containment&&((e.left<r.position.left||e.left+a.width>r.position.left+r.dimensions.width)&&(i.horizontal=!1,i.correction.x=e.left<r.position.left?r.position.left-e.left:r.position.left+r.dimensions.width-(e.left+a.width)),(e.top<r.position.top||e.top+a.height>r.position.top+r.dimensions.height)&&(i.vertical=!1,i.correction.y=e.top<r.position.top?r.position.top-e.top:r.position.top+r.dimensions.height-(e.top+a.height)))}return i},getContainmentLayout:function(e,t){var i={top:$(window).scrollTop(),left:$(window).scrollLeft()},r=this.target;"mouse"==r&&(r=this.element);var a,n=$(r).closest(this.options.containment.selector).first()[0];a=n&&"viewport"!=this.options.containment.selector?{dimensions:{width:$(n).innerWidth(),height:$(n).innerHeight()},position:$(n).offset()}:{dimensions:Bounds.viewport(),position:i};var s=this.options.containment.padding;if(s&&!t){var o=Math.max(a.dimensions.height,a.dimensions.width);2*s>o&&(s=Math.max(Math.floor(.5*o),0)),s&&(a.dimensions.width-=2*s,a.dimensions.height-=2*s,a.position.top+=s,a.position.left+=s,"vertical"==Position.getOrientation(e)?(a.dimensions.width+=s,"left"==Position.getSide(e)&&(a.position.left-=s)):(a.dimensions.height+=s,"top"==Position.getSide(e)&&(a.position.top-=s)))}return this._cache.layouts.containmentLayout=a,a},getMouseRoom:function(){var e={top:0,left:0,right:0,bottom:0};if("mouse"==this.options.target&&!this.is("api")){var t=Mouse.getActualPosition(this._cache.event),i=$(this.element).offset(),r={width:$(this.element).innerWidth(),height:$(this.element).innerHeight()};e={top:Math.max(0,t.top-i.top),bottom:Math.max(0,i.top+r.height-t.top),left:Math.max(0,t.left-i.left),right:Math.max(0,i.left+r.width-t.left)}}return e},getTargetPosition:function(){var e;if("mouse"==this.options.target)if(this.is("api")){var t=$(this.element).offset();e={top:Math.round(t.top),left:Math.round(t.left)}}else e=Mouse.getPosition(this._cache.event);else t=$(this.target).offset(),e={top:Math.round(t.top),left:Math.round(t.left)};return this._cache.layouts.targetPosition=e,e},getTargetDimensions:function(){return this._cache.layouts.targetDimensions?this._cache.layouts.targetDimensions:(e="mouse"==this.options.target?Mouse.getDimensions():{width:$(this.target).innerWidth(),height:$(this.target).innerHeight()},this._cache.layouts.targetDimensions=e,e);var e},getTargetLayout:function(){if(this._cache.layouts.targetLayout)return this._cache.layouts.targetLayout;var e={position:this.getTargetPosition(),dimensions:this.getTargetDimensions()};return this._cache.layouts.targetLayout=e,e},getPaddingLine:function(e){var t=this.getTargetLayout(),i="left";if("vertical"==Position.getOrientation(e))return this.getSideLine(t,Position.getSide(e));if(Position.isCorner(e)){var r=Position.inverseCornerPlane(e);return i=Position.getSide(r),this.getSideLine(t,i)}var a=this.getSideLine(t,i),n=Math.round(.5*t.dimensions.width);return a.x1+=n,a.x2+=n,a}}),$.extend(Tooltip.prototype,{setActive:function(){this.is("active",!0),this.visible()&&this.raise(),this.options.hideAfter&&this.clearTimer("idle")},setIdle:function(){this.is("active",!1),this.options.hideAfter&&this.setTimer("idle",$.proxy((function(){this.clearTimer("idle"),this.is("active")||this.hide()}),this),this.options.hideAfter)}}),$.extend(Tooltip.prototype,{bind:function(e,t,i,r){t=t;var a=$.proxy(i,r||this);this._cache.events.push({element:e,eventName:t,handler:a}),$(e).bind(t,a)},unbind:function(){$.each(this._cache.events,(function(e,t){$(t.element).unbind(t.eventName,t.handler)})),this._cache.events=[]}}),$.extend(Tooltip.prototype,{disable:function(){this.is("disabled")||this.is("disabled",!0)},enable:function(){this.is("disabled")&&this.is("disabled",!1)}}),$.extend(Tooltip.prototype,{is:function(e,t){return"boolean"==$.type(t)&&(this._cache.is[e]=t),this._cache.is[e]},visible:function(){return this.is("visible")}}),$.extend(Tooltip.prototype,{setTimer:function(e,t,i){this._cache.timers[e]=_.delay(t,i)},getTimer:function(e){return this._cache.timers[e]},clearTimer:function(e){this._cache.timers[e]&&(clearTimeout(this._cache.timers[e]),delete this._cache.timers[e])},clearTimers:function(){$.each(this._cache.timers,(function(e,t){clearTimeout(t)})),this._cache.timers={}}}),$.extend(Tipped,{init:function(){Tooltips.init()},create:function(e,t){var i=$.extend({},arguments[2]||{}),r=[];return _.isElement(e)?r.push(new Tooltip(e,t,i)):$(e).each((function(e,a){r.push(new Tooltip(a,t,i))})),new Collection(r)},get:function(e){return new Collection(Tooltips.get(e))},findElement:function(e){return Tooltips.findElement(e)},refresh:function(e,t,i){return Tooltips.refresh(e,t,i),this},setStartingZIndex:function(e){return Tooltips.setStartingZIndex(e),this},remove:function(e){return Tooltips.remove(e),this}}),$.extend(Collection.prototype,{initialize:function(e){return this.tooltips=e,this},items:function(){return $.each(this.tooltips,(function(e,t){t.is("api",!0)})),this.tooltips},refresh:function(){return $.each(this._tooltips,(function(e,t){t.is("visible")&&t.refresh()})),this},remove:function(){return Tooltips.removeTooltips(this.tooltips),this.tooltips=[],this}}),Tipped.init(),Tipped})),function(e){var t,i,r,a,n,s,o,l,p,d,c,u,h,f,m,g,y,b,v,T,w,x,I,C,P,S,k,A,$,F,M,E,D,R,_,B,L,O=(t=65,i={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!1},r=function(t,i){var r=_(t);e(i).data("colorpicker").fields.eq(1).val(r.r).end().eq(2).val(r.g).end().eq(3).val(r.b).end()},a=function(t,i){e(i).data("colorpicker").fields.eq(4).val(t.h).end().eq(5).val(t.s).end().eq(6).val(t.b).end()},n=function(t,i){e(i).data("colorpicker").fields.eq(0).val(B(t)).end()},s=function(t,i){e(i).data("colorpicker").selector.css("backgroundColor","#"+B({h:t.h,s:100,b:100})),e(i).data("colorpicker").selectorIndic.css({left:parseInt(150*t.s/100,10),top:parseInt(150*(100-t.b)/100,10)})},o=function(t,i){e(i).data("colorpicker").hue.css("top",parseInt(150-150*t.h/360,10))},l=function(t,i){e(i).data("colorpicker").currentColor.css("backgroundColor","#"+B(t))},p=function(t,i){e(i).data("colorpicker").newColor.css("backgroundColor","#"+B(t))},d=function(i){var r=i.charCode||i.keyCode||-1;if(r>t&&r<=90||32==r)return!1;!0===e(this).parent().parent().data("colorpicker").livePreview&&c.apply(this)},c=function(t){var i,l=e(this).parent().parent();this.parentNode.className.indexOf("_hex")>0?l.data("colorpicker").color=i=D(E(this.value)):this.parentNode.className.indexOf("_hsb")>0?l.data("colorpicker").color=i=F({h:parseInt(l.data("colorpicker").fields.eq(4).val(),10),s:parseInt(l.data("colorpicker").fields.eq(5).val(),10),b:parseInt(l.data("colorpicker").fields.eq(6).val(),10)}):l.data("colorpicker").color=i=R(M({r:parseInt(l.data("colorpicker").fields.eq(1).val(),10),g:parseInt(l.data("colorpicker").fields.eq(2).val(),10),b:parseInt(l.data("colorpicker").fields.eq(3).val(),10)})),t&&(r(i,l.get(0)),n(i,l.get(0)),a(i,l.get(0))),s(i,l.get(0)),o(i,l.get(0)),p(i,l.get(0)),l.data("colorpicker").onChange.apply(l,[i,B(i),_(i)])},u=function(t){e(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus")},h=function(){t=this.parentNode.className.indexOf("_hex")>0?70:65,e(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus"),e(this).parent().addClass("colorpicker_focus")},f=function(t){var i=e(this).parent().find("input").focus(),r={el:e(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:t.pageY,field:i,val:parseInt(i.val(),10),preview:e(this).parent().parent().data("colorpicker").livePreview};e(document).bind("mouseup",r,g),e(document).bind("mousemove",r,m)},m=function(e){return e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val+e.pageY-e.data.y,10)))),e.data.preview&&c.apply(e.data.field.get(0),[!0]),!1},g=function t(i){return c.apply(i.data.field.get(0),[!0]),i.data.el.removeClass("colorpicker_slider").find("input").focus(),e(document).unbind("mouseup",t),e(document).unbind("mousemove",m),!1},y=function(t){var i={cal:e(this).parent(),y:e(this).offset().top};i.preview=i.cal.data("colorpicker").livePreview,e(document).bind("mouseup",i,v),e(document).bind("mousemove",i,b)},b=function(e){return c.apply(e.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,e.pageY-e.data.y)))/150,10)).get(0),[e.data.preview]),!1},v=function t(i){return r(i.data.cal.data("colorpicker").color,i.data.cal.get(0)),n(i.data.cal.data("colorpicker").color,i.data.cal.get(0)),e(document).unbind("mouseup",t),e(document).unbind("mousemove",b),!1},T=function(t){var i={cal:e(this).parent(),pos:e(this).offset()};i.preview=i.cal.data("colorpicker").livePreview,e(document).bind("mouseup",i,x),e(document).bind("mousemove",i,w)},w=function(e){return c.apply(e.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,e.pageY-e.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,e.pageX-e.data.pos.left))/150,10)).get(0),[e.data.preview]),!1},x=function t(i){return r(i.data.cal.data("colorpicker").color,i.data.cal.get(0)),n(i.data.cal.data("colorpicker").color,i.data.cal.get(0)),e(document).unbind("mouseup",t),e(document).unbind("mousemove",w),!1},I=function(t){e(this).addClass("colorpicker_focus")},C=function(t){e(this).removeClass("colorpicker_focus")},P=function(t){var i=e(this).parent(),r=i.data("colorpicker").color;i.data("colorpicker").origColor=r,l(r,i.get(0)),i.data("colorpicker").onSubmit(r,B(r),_(r),i.data("colorpicker").el)},S=function(t){var i=e("#"+e(this).data("colorpickerId"));i.data("colorpicker").onBeforeShow.apply(this,[i.get(0)]);var r=e(this).offset(),a=$(),n=r.top+this.offsetHeight,s=r.left;return n+176>a.t+a.h&&(n-=this.offsetHeight+176),s+356>a.l+a.w&&(s-=356),i.css({left:s+"px",top:n+"px"}),0!=i.data("colorpicker").onShow.apply(this,[i.get(0)])&&i.show(),e(document).bind("mousedown",{cal:i},k),!1},k=function t(i){A(i.data.cal.get(0),i.target,i.data.cal.get(0))||(0!=i.data.cal.data("colorpicker").onHide.apply(this,[i.data.cal.get(0)])&&i.data.cal.hide(),e(document).unbind("mousedown",t))},A=function(e,t,i){if(e==t)return!0;if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));for(var r=t.parentNode;r&&r!=i;){if(r==e)return!0;r=r.parentNode}return!1},$=function(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}},F=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},M=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},E=function(e){var t=6-e.length;if(t>0){for(var i=[],r=0;r<t;r++)i.push("0");i.push(e),e=i.join("")}return e},D=function(e){return R(function(e){return{r:(e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16))>>16,g:(65280&e)>>8,b:255&e}}(e))},R=function(e){var t={h:0,s:0,b:0},i=Math.min(e.r,e.g,e.b),r=Math.max(e.r,e.g,e.b),a=r-i;return t.b=r,t.s=0!=r?255*a/r:0,0!=t.s?e.r==r?t.h=(e.g-e.b)/a:e.g==r?t.h=2+(e.b-e.r)/a:t.h=4+(e.r-e.g)/a:t.h=-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},_=function(e){var t={},i=Math.round(e.h),r=Math.round(255*e.s/100),a=Math.round(255*e.b/100);if(0==r)t.r=t.g=t.b=a;else{var n=a,s=(255-r)*a/255,o=i%60*(n-s)/60;360==i&&(i=0),i<60?(t.r=n,t.b=s,t.g=s+o):i<120?(t.g=n,t.b=s,t.r=n-o):i<180?(t.g=n,t.r=s,t.b=s+o):i<240?(t.b=n,t.r=s,t.g=n-o):i<300?(t.b=n,t.g=s,t.r=s+o):i<360?(t.r=n,t.g=s,t.b=n-o):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},B=function(t){return i=_(t),r=[i.r.toString(16),i.g.toString(16),i.b.toString(16)],e.each(r,(function(e,t){1==t.length&&(r[e]="0"+t)})),r.join("");var i,r},L=function(){var t=e(this).parent(),i=t.data("colorpicker").origColor;t.data("colorpicker").color=i,r(i,t.get(0)),n(i,t.get(0)),a(i,t.get(0)),s(i,t.get(0)),o(i,t.get(0)),p(i,t.get(0))},{init:function(t){if("string"==typeof(t=e.extend({},i,t||{})).color)t.color=D(t.color);else if(null!=t.color.r&&null!=t.color.g&&null!=t.color.b)t.color=R(t.color);else{if(null==t.color.h||null==t.color.s||null==t.color.b)return this;t.color=F(t.color)}return this.each((function(){if(!e(this).data("colorpickerId")){var i=e.extend({},t);i.origColor=t.color;var m="collorpicker_"+parseInt(1e3*Math.random());e(this).data("colorpickerId",m);var g=e('<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>').attr("id",m);i.flat?g.appendTo(this).show():g.appendTo(document.body),i.fields=g.find("input").bind("keyup",d).bind("change",c).bind("blur",u).bind("focus",h),g.find("span").bind("mousedown",f).end().find(">div.colorpicker_current_color").bind("click",L),i.selector=g.find("div.colorpicker_color").bind("mousedown",T),i.selectorIndic=i.selector.find("div div"),i.el=this,i.hue=g.find("div.colorpicker_hue div"),g.find("div.colorpicker_hue").bind("mousedown",y),i.newColor=g.find("div.colorpicker_new_color"),i.currentColor=g.find("div.colorpicker_current_color"),g.data("colorpicker",i),g.find("div.colorpicker_submit").bind("mouseenter",I).bind("mouseleave",C).bind("click",P),r(i.color,g.get(0)),a(i.color,g.get(0)),n(i.color,g.get(0)),o(i.color,g.get(0)),s(i.color,g.get(0)),l(i.color,g.get(0)),p(i.color,g.get(0)),i.flat?g.css({position:"relative",display:"block"}):e(this).bind(i.eventName,S)}}))},showPicker:function(){return this.each((function(){e(this).data("colorpickerId")&&S.apply(this)}))},hidePicker:function(){return this.each((function(){e(this).data("colorpickerId")&&e("#"+e(this).data("colorpickerId")).hide()}))},setColor:function(t){if("string"==typeof t)t=D(t);else if(null!=t.r&&null!=t.g&&null!=t.b)t=R(t);else{if(null==t.h||null==t.s||null==t.b)return this;t=F(t)}return this.each((function(){if(e(this).data("colorpickerId")){var i=e("#"+e(this).data("colorpickerId"));i.data("colorpicker").color=t,i.data("colorpicker").origColor=t,r(t,i.get(0)),a(t,i.get(0)),n(t,i.get(0)),o(t,i.get(0)),s(t,i.get(0)),l(t,i.get(0)),p(t,i.get(0))}}))}});e.fn.extend({ColorPicker:O.init,ColorPickerHide:O.hidePicker,ColorPickerShow:O.showPicker,ColorPickerSetColor:O.setColor})}(jQuery);